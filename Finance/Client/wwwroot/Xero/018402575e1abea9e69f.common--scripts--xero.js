!function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/assets/",e(e.s=342)}(Array(21).concat([function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},,,,,,,,,,,,,,,,,,function(t,e){!function(){"use strict";function t(t,e){c?window.analytics[t].apply(this,e):d.push({method:t,args:e})}function e(){for(;d.length>0;)window.analytics[d[0].method].apply(this,d[0].args),d.shift()}function n(t,e){return(void 0!==e&&h.hasOwnProperty(e)?h[e]:h[f])+t}function i(t){window.analytics.load(u,a)}function a(t){s.initialize.Mixpanel=s.initialize.mixpanel,window.analytics.initialize(s.initialize);for(var n in l)l.hasOwnProperty(n)&&(s.identify[n]=l[n]);if(null!==s.identify.orgCreatedDateUTC){var i=new Date(s.identify.orgCreatedDateUTC);s.identify.orgCreatedDateUTC=i.toUTCString()}else s.identify.orgCreatedDateUTC=void 0,s.identify.orgAgeDays=void 0;s.identify.userId?window.analytics.identify(s.identify.userId,o(s.identify)):window.analytics.identify(o(s.identify)),c=!0,e(),XERO.analytics.Analytics.fireEvent("analyticsready")}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[r(n)]=t[n]);return e}function r(t){return t.charAt(0).toUpperCase()+t.substr(1)}var s,l,u,c=!1,d=[],h={xc:"XC: ",snp:"SNP: ",xx:"XX: ",ogs:"OGS: "},f="xc";Ext.define("XERO.analytics.Analytics",{extend:"Ext.util.Observable",singleton:!0,init:function(t,e){this.addEvents({analyticsready:!0}),s=e.analytics.config,u=e.analytics.libraryUrl,l=e.organisationSetupStatus,document.querySelector(t).addEventListener("load",i,!1)},onAnalyticsReady:function(t,e){c?t.apply(e):this.on("analyticsready",t,e)},trackAction:function(t,e,n,i,a,o){if((this.isTrial()||o)&&(n=n||{},this.track(e,n)),"function"==typeof i){var r=a?300:0;Ext.defer(function(){i.apply(t)},r)}},track:function(e,i,a){t("track",[n(e,a),i])},trackGa:function(t,e,n,i,a,o){if(window.ga)try{window.ga("send",{hitType:"event",eventCategory:t,eventAction:e,eventLabel:n,dimension31:o,dimension32:i,dimension33:a})}catch(t){window.console.log(t)}},trackLinks:function(e,i,a,o){var r;r="string"==typeof e?Ext.query(e):e,t("trackLink",[r,n(i,o),a])},isTrial:function(){return!!c&&s.identify.orgTrial},hasBankAccount:function(){return!!c&&l.hasBankAccount},hasCOAChange:function(){return!!c&&l.hasCOAChange},hasOrgAddress:function(){return!!c&&l.hasOrgAddress},set:function(e){t("identify",[e])}})}()},,,,,,,,,,,,,,,,,,,,,,,function(t,e){window.intellisenseCompleters={accountCompleter:function(t){var e=t.getToken().trim().toUpperCase(),n=!1;if(""==e)return t.localData;for(var i=[],a=t.localData.length,o="",r=0;r<a;r++)if(o=t.localData[r].value.toUpperCase(),t.localData[r].data.keys.length>0&&-1!=o.indexOf(e)&&(o==e&&(n=!0),i.push(t.localData[r]),n))return i;return i}}},,,,,,,,,,,function(module,exports){Ext.BLANK_IMAGE_URL="/common/images/default/s.gif",Ext.ns("XERO"),XERO.ns=Ext.ns,XERO.ns("XERO.data","XERO.grid","XERO.grid.util","XERO.grid.renderers","XERO.util","XERO.widget","XERO.ui","XERO.buttons","XERO.globalization","XERO.widget.chart","XERO.widget.tree"),document.getElementsByAttribute=function(t,e){return $A(($(e)||document.body).getElementsByTagName("*")).inject([],function(e,n){return Element.readAttribute(n,t)&&e.push(Element.extend(n)),e})},document.getElementsByAttributeValue=function(t,e,n){return $A(($(n)||document.body).getElementsByTagName("*")).inject([],function(n,i){return Element.readAttribute(i,t)==e&&n.push(Element.extend(i)),n})},Element.addMethods({getElementsByAttribute:function(t,e){return document.getElementsByAttribute(e,t)},getElementsByAttributeValue:function(t,e,n){return document.getElementsByAttributeValue(e,n,t)}}),window.state="none",window.submitting=!1,window.SubmitAction=function(t){if(!submitting)return submitting=!0,document.getElementById("Action").value=t,document.body.style.cursor="wait",document.getElementById("frmMain").submit(),!1},window.SubmitAction=function(t,e,n){if(!submitting){submitting=!0,document.getElementById("Action").value=t,document.getElementById("ActionArgument").value=e;var i=document.getElementById("frmMain");return n?i.target=n:document.body.style.cursor="wait",Ext.isSafari&&Ext.util.DelayedTask?(go=new Ext.util.DelayedTask(function(){i.submit()},this),go.delay(10)):i.submit(),i.target="_self",(t="Print")&&(submitting=!1),!1}},XERO.requires=function(){for(var i=0,len=arguments.length;i<len;i++)"undefined"==eval("typeof "+arguments[i])&&alert("Requires "+arguments[i]+" to be loaded.")},XERO.Accounts={},XERO.Accounts.code=function(t,e){var n=Ext.fly(t).getValue().trim();Ext.fly(t).dom.value=n;var i,a=Ext.get("CodeComment");""!=n?(a.update('<span class="gray">checking...</span>'),a.show(),result=e&&""!=e?Ajax.AccountCodeChanged_2(n,e):Ajax.AccountCodeChanged_1(n),result=result.value,i=result?result.Result:""):i="",a.update(i),""!=i?a.show():a.hide()},XERO.util.emphasizeText=function(t,e){var n=new RegExp(e,"gi");return t.replace(n,"<strong>$&</strong>")},XERO.util.escapeRegexSpecialCharacters=function(t){return t.replace(/([.+*^$\\()[?|{#])/g,"\\$1")},XERO.util.htmlDecode=function(t){return null==t?t:(t=Ext.util.Format.htmlDecode(t),t=t.replace(/&#39;/g,"'"))},XERO.util.flattenObject=function(t,e){var n={};e=e||"";for(var i in t)if(t.hasOwnProperty(i))if("object"==typeof t[i]){var a=XERO.util.flattenObject(t[i]);for(var o in a)a.hasOwnProperty(o)&&(n[i+e+o]=a[o])}else n[i]=t[i];return n},XERO.util.enableButtons=function(){new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(1e3)},Ext.onReady(function(){Ext.getBody().on({keydown:function(t,e){if(e&&e.nodeName){var n=e.nodeName.toLowerCase();"input"!=n&&"textarea"!=n&&t.getKey()===Ext.EventObject.BACKSPACE&&t.stopEvent()}}})}),Ext.Ajax.on("beforerequest",function(t,e){var n=e&&e.method?e.method.toUpperCase():"GET";if("POST"==n){var i=Ext.query('input[@Name="__RequestVerificationToken"]'),a=i?i[0].value:"";!a||"POST"!==n||/^http:.*/.test(e.url)||/^https:.*/.test(e.url)||(e.headers=e.headers||{},e.headers["X-CSRFToken"]=a)}},this)},function(module,exports){Object.extend=function(t,e,n){for(prop in e)0==n&&null!=t[prop]||(t[prop]=e[prop]);return t},Object.extend(Object,{contains:function(t,e){for(var n in t)if(e==n)return!0;return!1},addAsProperty:function(t,e,n,i){0==i&&null!=t[n]||(t[n]=e)},toNull:function(t){return Object.isUndefined(t)?null:t},clone:function(t){var e=new this.constructor;for(var n in this)t&&"object"==typeof this[n]?e[n]=this[n].clone(t):e[n]=this[n];return e}}),Object.extend(Function.prototype,{apply:function(o,a){var r,x="__fapply";"object"!=typeof o&&(o={}),o[x]=this;for(var s="r = o."+x+"(",i=0;i<a.length;i++)i>0&&(s+=","),s+="a["+i+"]";return s+=");",eval(s),delete o[x],r},getArguments:function(){for(var t=[],e=0;e<this.arguments.length;e++)t.push(this.arguments[e]);return t},bind:function(t){Function.__objs||(Function.__objs=[],Function.__funcs=[]);var e=t.__oid;e||(Function.__objs[e=t.__oid=Function.__objs.length]=t);var n=this,i=n.__fid;i||(Function.__funcs[i=n.__fid=Function.__funcs.length]=n),t.__closures||(t.__closures=[]);var a=t.__closures[i];return a||(t=null,n=null,Function.__objs[e].__closures[i]=function(){return Function.__funcs[i].apply(Function.__objs[e],arguments)})}},!1),document.getElementViaParent=function(t,e){if(!(e=$(e)))return $(t);for(var n=e.getElementsByTagName("*"),i=0;i<n.length;i++){var a=n[i];if(a.id.match(new RegExp("(^|\\s)"+t+"(\\s|$)")))return $(a)}return null},window.$_$=function(t,e){return document.getElementViaParent(t,e)},Object.extend(Array.prototype,{addRange:function(t){if(t.length>0)for(var e=0;e<t.length;e++)this.push(t[e])}},!1),Object.extend(String.prototype,{trimLeft:function(){return this.replace(/^\s*/,"")},trimRight:function(){return this.replace(/\s*$/,"")},trim:function(){return this.trimRight().trimLeft()},endsWith:function(t){return!(0==this.length||this.length<t.length)&&this.substr(this.length-t.length)==t},startsWith:function(t){return!(0==this.length||this.length<t.length)&&this.substr(0,t.length)==t},left:function(t){return t<=0?"":t>this.length?this:this.substring(0,t)},right:function(t){return t<=0?"":t>this.length?this:this.substring(this.length,this.length-t)},isNullOrEmpty:function(t){var e=this;return t&&(e=e.trim()),0!=e.length},zf:function(t){var e=this,n="",a=e.length;if(t>a)for(i=0;i<t-a;i++)n+="0";return n+e},unescapeHTML2:function(){var t={amp:"&",lt:"<",gt:">",apos:"'",quot:'"'};return this.replace(/&(\w+);/g,function(e,n){return t[n]||e})}},!1),Object.extend(String,{format:function(t){for(var e=1;e<arguments.length;e++)t=t.replace("{"+(e-1)+"}",arguments[e]);return t},isNullOrEmpty:function(t,e){return null!=t&&(e&&(t=t.trim()),0!=t.length)},toNull:function(t){return null==t?null:Ext.isEmpty(t.trim())?null:t}},!1),Object.extend(Number.prototype,{zf:function(t){return this.toString().zf(t)}},!1),Object.extend(Date.prototype,{_monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],_dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],addMilliseconds:function(t){return this.add("ms",t)},addHours:function(t){return this.add("hour",t)},addDays:function(t){return this.add("day",t)},addMonths:function(t){return this.add("month",t)},addYears:function(t){return this.add("year",t)},add:function(t,e){var n=new Date(this);if(isNaN(e))return n;if(!t||0==e)return n;switch(t.toLowerCase()){case"ms":case"milliseconds":n.setMilliseconds(n.getMilliseconds()+e);break;case"s":case"seconds":n.setSeconds(n.getSeconds()+e);break;case"mi":case"n":case"minutes":n.setMinutes(n.getMinutes()+e);break;case"h":case"hour":n.setHours(n.getHours()+e);break;case"d":case"wd":case"day":case"weekday":n.setDate(n.getDate()+e);break;case"mo":case"month":n.setMonth(n.getMonth()+e);break;case"y":case"yyyy":case"year":n.setFullYear(n.getFullYear()+e)}return n},formatDate:function(t){if(!this.valueOf())return"&nbsp;";var e=this;return t.replace(/(yyyy|yy|y|MMMM|MMM|MM|M|dddd|ddd|dd|d|HH|H|hh|h|mm|m|ss|s|t)/gi,function(t){switch(t){case"yyyy":return e.getFullYear();case"yy":return(e.getFullYear()%100).zf(2);case"y":return e.getFullYear()%100;case"MMMM":return e._monthNames[e.getMonth()];case"MMM":return e._monthNames[e.getMonth()].substr(0,3);case"MM":return(e.getMonth()+1).zf(2);case"M":return e.getMonth()+1;case"dddd":return e._dayNames[e.getDay()];case"ddd":return e._dayNames[e.getDay()].substr(0,3);case"dd":return e.getDate().zf(2);case"d":return e.getDate();case"HH":return e.getHours().zf(2);case"H":return e.getHours();case"hh":return((h=e.getHours()%12)?h:12).zf(2);case"h":return(h=e.getHours()%12)?h:12;case"mm":return e.getMinutes().zf(2);case"m":return e.getMinutes();case"ss":return e.getSeconds().zf(2);case"s":return e.getSeconds();case"t":return e.getHours()<12?"A.M.":"P.M."}})}},!1),Element.addMethods({addClassNames:function(t,e){if(t=$(t)){for(var n=$A(arguments).without(t),i=0,a=n.length;i<a;i++)t.addClassName(n[i]);return t}},removeClassNames:function(t,e){if(t=$(t)){for(var n=$A(arguments).without(t),i=0,a=n.length;i<a;i++)t.removeClassName(n[i]);return t}}}),Object.extend(Form,{serializeToCollection:function(t){for(var e=new Data.NameValueCollection,n=Form.getElements($(t)),i=new Array,a=0;a<n.length;a++){var o=this.serializeFormElement2(n[a]);o&&(i=i.concat(o))}for(var a=0;a<i.length;a++)a%2==0&&e.add(i[a],i[a+1]);return e},serializeFormElement:function(t){t=$(t);var e=t.tagName.toLowerCase(),n=Form.Element.CustomSerializers[e](t);if(n){var i=n[0];if(0==i.length)return;return n[1].constructor!=Array&&(n[1]=[n[1]]),n[1].map(function(t){return i+"="+t}).join("&")}},serializeFormElement2:function(t){t=$(t);var e=t.tagName.toLowerCase(),n=Form.Element.CustomSerializers[e](t);if(n){var i=n[0];if(0==i.length)return;return n[1].constructor!=Array&&(n[1]=[n[1]]),[i,n[1].map(function(t){return t}).join("&")]}},toJSON:function(t){var e={};return t.keys.forEach(function(n,i){e[t.keys[i]]=t.values[i]},this),Object.toJSON(e)}}),Form.Element.CustomSerializers={input:function(t){switch(t.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.CustomSerializers.inputSelector(t);default:return Form.Element.CustomSerializers.textarea(t)}},inputSelector:function(t){if(t.checked)return[t.name,t.value]},textarea:function(t){return[t.name,t.value]},select:function(t){return Form.Element.CustomSerializers["select-one"==t.type?"selectOne":"selectMany"](t)},selectOne:function(t){var e,n="",i=t.selectedIndex;return i>=0&&(e=Element.extend(t.options[i]),n=e.hasAttribute("value")?e.value:e.text),[t.name,n]},selectMany:function(t){for(var e=[],n=0;n<t.length;n++){var i=Element.extend(t.options[n]);i.selected&&e.push(i.hasAttribute("value")?i.value:i.text)}return[t.name,e]}},window.openDialog=function(t,e,n){return window.open(t,null,"toolbar=no,scrollbars=yes,location=no,statusbar=no,menubar=no,resizable=yes,height="+n+",width="+e+",top=0,left=0")},window.Debug={},Object.extend(Debug,{inspect:function(t){},log:function(t){}}),window.Cookies={},Object.extend(Cookies,{getCookie:function(t){var e=document.cookie.indexOf(t+"="),n=e+t.length+1;if(!e&&t!=document.cookie.substring(0,t.length))return null;if(-1==e)return null;var i=document.cookie.indexOf(";",n);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(n,i))},setCookie:function(t,e,n,i,a,o){var r=new Date;r.setTime(r.getTime()),n&&(n=1e3*n*60*60*24);var s=new Date(r.getTime()+n);document.cookie=t+"="+escape(e)+(n?"; expires="+s.toGMTString():"")+"; path=/"},deleteCookie:function(t,e,n){getCookie(t)&&(document.cookie=t+"="+(e?";path="+e:"")+(n?";domain="+n:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")}}),window.StringBuilder=Class.create(),Object.extend(StringBuilder.prototype,{buffer:null,bufferLength:0,initialize:function(t){this.buffer=new Array,this.bufferLength=0,null!=t&&this.append(t)},append:function(t){null!=t&&(this.bufferLength+=t.length,this.buffer.push(t))},remove:function(t,e){this.buffer.splice(t,e)},removeLast:function(){this.buffer.pop()},clear:function(){this.buffer=new Array(""),this.bufferLength=0},length:function(){return this.bufferLength},toString:function(){return this.buffer.join("")},toStr:function(){return this.buffer.join("")}}),"undefined"==typeof addEvent&&(addEvent=function(t,e,n,i){if(null==t)return!1;if(t.addEventListener)return t.addEventListener(e,n,i),!0;if(t.attachEvent){return t.attachEvent("on"+e,n)}try{t["on"+e]=n}catch(t){}}),"undefined"==typeof removeEvent&&(removeEvent=function(t,e,n,i){if(null==t)return!1;if(t.removeEventListener)return t.removeEventListener(e,n,i),!0;if(t.detachEvent)t.detachEvent("on"+e,n);else try{t["on"+e]=function(){}}catch(t){}}),Object.extend(Event,{_domReady:function(){arguments.callee.done||(arguments.callee.done=!0,this._timer&&clearInterval(this._timer),this._readyCallbacks.each(function(t){t()}),this._readyCallbacks=null)},onDOMReady:function(t){if(!this._readyCallbacks){var e=this._domReady.bind(this);document.addEventListener&&document.addEventListener("DOMContentLoaded",e,!1),/WebKit/i.test(navigator.userAgent)&&(this._timer=setInterval(function(){/loaded|complete/.test(document.readyState)&&e()},10)),Event.observe(window,"load",e),Event._readyCallbacks=[]}Event._readyCallbacks.push(t)}}),addEvent(window,"load",function(){Globals.add("PageLoaded",!0)})},function(module,exports){window.MS={Browser:{}},Object.extend(MS.Browser,{isIE:-1!=navigator.userAgent.indexOf("MSIE"),isFirefox:-1!=navigator.userAgent.indexOf("Firefox"),isOpera:null!=window.opera},!1),window.AjaxPro={},AjaxPro.IFrameXmlHttp=function(){},AjaxPro.IFrameXmlHttp.prototype={onreadystatechange:null,headers:[],method:"POST",url:null,async:!0,iframe:null,status:0,readyState:0,responseText:null,abort:function(){},readystatechanged:function(){var t=this.iframe.contentDocument||this.iframe.document;if(null!=t&&"complete"==t.readyState&&null!=t.body&&null!=t.body.res)return this.status=200,this.statusText="OK",this.readyState=4,this.responseText=t.body.res,void this.onreadystatechange();setTimeout(this.readystatechanged.bind(this),10)},open:function(t,e,n){if(0==n)return void alert("Synchronous call using IFrameXMLHttp is not supported.");if(null==this.iframe){if(document.createElement&&document.documentElement&&(window.opera||-1==navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id","hans"),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",this.iframe=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="hans" id="hans" style="border:1px solid black;display:none"></iframe>');window.frames&&window.frames.hans&&(this.iframe=window.frames.hans),this.iframe.name="hans",this.iframe.document.open(),this.iframe.document.write("<html><body></body></html>"),this.iframe.document.close()}this.method=t,this.url=e,this.async=n},setRequestHeader:function(t,e){for(var n=0;n<this.headers.length;n++)if(this.headers[n].name==t)return void(this.headers[n].value=e);this.headers.push({name:t,value:e})},getResponseHeader:function(t,e){return null},addInput:function(t,e,n,i){var a,o="input";i.indexOf("\n")>=0&&(o="textarea"),t.all?a=t.createElement("<"+o+' name="'+n+'" />'):(a=t.createElement(o),a.setAttribute("name",n)),a.setAttribute("value",i),e.appendChild(a),a=null},send:function(t){if(null!=this.iframe){var e=this.iframe.contentDocument||this.iframe.document,n=e.createElement("form");e.body.appendChild(n),n.setAttribute("action",this.url),n.setAttribute("method",this.method),n.setAttribute("enctype","application/x-www-form-urlencoded");for(var i=0;i<this.headers.length;i++)switch(this.headers[i].name.toLowerCase()){case"content-length":case"accept-encoding":case"content-type":break;default:this.addInput(e,n,this.headers[i].name,this.headers[i].value)}this.addInput(e,n,"data",t),n.submit(),setTimeout(this.readystatechanged.bind(this),1)}}},Object.extend(AjaxPro,{noOperation:function(){},onLoading:function(){},onError:function(){},onTimeout:function(){},onStateChanged:function(){},cryptProvider:null,queue:null,token:"",version:"6.7.10.2",ID:"AjaxPro",noActiveX:!1,timeoutPeriod:12e4,queue:null,toJSON:function(t){if(null==t)return"null";switch(t.constructor){case String:for(var e=[],n=0;n<t.length;n++){var i=t.charAt(n);if(i>=" ")"\\"!=i&&'"'!=i||e.push("\\"),e.push(i);else switch(i){case"\n":e.push("\\n");break;case"\r":e.push("\\r");break;case"\b":e.push("\\b");break;case"\f":e.push("\\f");break;case"\t":e.push("\\t");break;default:e.push("\\u00"),e.push(i.charCodeAt().toString(16))}}return'"'+e.join("")+'"';case Array:for(var e=[],n=0;n<t.length;n++)e.push(AjaxPro.toJSON(t[n]));return"["+e.join(",")+"]";case Number:return isFinite(t)?t.toString():AjaxPro.toJSON(null);case Boolean:return t.toString();case Date:var a=new Object;return a.__type="System.DateTime",a.Year=t.getUTCFullYear(),a.Month=t.getUTCMonth()+1,a.Day=t.getUTCDate(),a.Hour=t.getUTCHours(),a.Minute=t.getUTCMinutes(),a.Second=t.getUTCSeconds(),a.Millisecond=t.getUTCMilliseconds(),AjaxPro.toJSON(a);default:if("function"==typeof t.toJSON)return t.toJSON();if("object"==typeof t){var e=[];for(attr in t)"function"!=typeof t[attr]&&e.push('"'+attr+'":'+AjaxPro.toJSON(t[attr]));return e.length>0?"{"+e.join(",")+"}":"{}"}return t.toString()}},dispose:function(){null!=AjaxPro.queue&&AjaxPro.queue.dispose()}},!1),addEvent(window,"unload",AjaxPro.dispose),AjaxPro.csrfProvider={csrfToken:null,getCsrfToken:function(){if(null==this.csrfToken){var t=AjaxPro.csrfTokenName,e="notFound",n=document.getElementById("frmMain");if(n){var i=n.elements[t];if(i)var e=i.value}this.csrfToken={name:AjaxPro.csrfHeaderName,value:e}}return this.csrfToken}},AjaxPro.Request=function(t){this.url=t,this.xmlHttp=null},AjaxPro.Request.prototype={url:null,callback:null,onLoading:AjaxPro.noOperation,onError:AjaxPro.noOperation,onTimeout:AjaxPro.noOperation,onStateChanged:AjaxPro.noOperation,args:null,context:null,isRunning:!1,abort:function(){null!=this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.xmlHttp&&(this.xmlHttp.onreadystatechange=AjaxPro.noOperation,this.xmlHttp.abort()),this.isRunning&&(this.isRunning=!1,this.onLoading(!1))},dispose:function(){this.abort()},getEmptyRes:function(){return{__type:"AjaxResult",error:null,value:null,scripts:null,request:{method:this.method,args:this.args},context:this.context,duration:this.duration}},endRequest:function(t){this.abort(),null!=t.error&&this.onError(t.error,this),"function"==typeof this.callback&&this.callback(t,this)},mozerror:function(){null!=this.timeoutTimer&&clearTimeout(this.timeoutTimer);var t=this.getEmptyRes();t.error={Message:"Unknown",Type:"ConnectFailure",Status:0},this.endRequest(t)},doStateChange:function(){if(this.onStateChanged(this.xmlHttp.readyState,this),4==this.xmlHttp.readyState&&this.isRunning){this.duration=(new Date).getTime()-this.__start,null!=this.timeoutTimer&&clearTimeout(this.timeoutTimer);var t=this.getEmptyRes();200==this.xmlHttp.status?t=this.createResponse(t):(t=this.createResponse(t,!0),t.error={Message:this.xmlHttp.statusText,Type:"ConnectFailure",Status:this.xmlHttp.status}),this.endRequest(t)}},createResponse:function(r,noContent){if(!noContent){var responseText=new String(this.xmlHttp.responseText);if(null!=AjaxPro.cryptProvider&&"function"==typeof AjaxPro.cryptProvider&&(responseText=AjaxPro.cryptProvider.decrypt(responseText)),"text/xml"==this.xmlHttp.getResponseHeader("Content-Type"))r.value=this.xmlHttp.responseXML;else if(null!=responseText&&responseText.trim().length>0&&(r.json=responseText,eval("r.value = "+responseText+"*/"),r.error))if("Xero.Accounting.Exceptions.AjaxAuthenticationFailedException"==r.error.Type){var loginHtml='<div style="padding:0em 1em 1em;overflow:hidden;" id="timedOutLoginContainer"><div class="error" id="timedOutLoginError" style="display:none;clear:both;margin-top:0px;"></div><div><div style="margin-bottom:10px;"><p style="line-height:150%;">For your protection, Xero will temporarily log out if there is no activity for more than 30 minutes. To continue using Xero log in now:</p></div><div style="float:left;margin-bottom:5px;"><label for="timedOutUserName" style="float:left;text-align:right;width:65px;" class="LabelBlue">Email</label><input type="text" tabIndex="900" id="timedOutUserName" style="width:160px;float:left;margin-left:10px;border:solid 1px #7F9DB9;padding:1px;" /></div><div style="padding-top:3px;"><label for="timedOutPassword" style="float:left;text-align:right;width:65px;clear:both;" class="LabelBlue">Password</label><input type="password" tabIndex="900" id="timedOutPassword" style="width:160px;float:left;margin-left:10px;border:solid 1px #7F9DB9;padding:1px;" /></div></div></div></div>';XERO.MsgBox.confirm(loginHtml,"Please log in",null,"Login",function(){},"Logout",function(){location.href="/Login/Login.aspx?logout=true"}),$("timedOutLoginContainer").observe("keypress",function(t){switch(t.keyCode){case Event.KEY_RETURN:}})}else"NetProfit.Construct.Web.Validation.ValidationException"==r.error.Type?XERO.MsgBox.alert(r.error.Message,"Validation Failed"):XERO.MsgBox.alert("Sorry, an error occurred. Please contact Xero Support if you require assistance.","Error")}return r},timeout:function(){this.duration=(new Date).getTime()-this.__start;var t=this.onTimeout(this.duration,this);void 0===t||0!=t?this.abort():this.timeoutTimer=setTimeout(this.timeout.bind(this),AjaxPro.timeoutPeriod)},invoke:function(t,e,n,i){this.url=this.url+window.location.search,this.__start=(new Date).getTime(),null==this.xmlHttp&&(this.xmlHttp=new XMLHttpRequest),this.isRunning=!0,this.method=t,this.args=e,this.callback=n,this.context=i;var a="function"==typeof n&&n!=AjaxPro.noOperation;a&&(MS.Browser.isIE?this.xmlHttp.onreadystatechange=this.doStateChange.bind(this):(this.xmlHttp.onload=this.doStateChange.bind(this),this.xmlHttp.onerror=this.mozerror.bind(this)),this.onLoading(!0));var o=AjaxPro.toJSON(e)+"";if(null!=AjaxPro.cryptProvider&&(o=AjaxPro.cryptProvider.encrypt(o)),this.xmlHttp.open("POST",this.url,a),this.xmlHttp.setRequestHeader("Content-Type","text/plain; charset=utf-8"),this.xmlHttp.setRequestHeader("X-"+AjaxPro.ID+"-Method",t),null!=AjaxPro.token&&AjaxPro.token.length>0&&this.xmlHttp.setRequestHeader("X-"+AjaxPro.ID+"-Token",AjaxPro.token),null!=AjaxPro.csrfProvider){var r=AjaxPro.csrfProvider.getCsrfToken();this.xmlHttp.setRequestHeader(r.name,r.value)}this.timeoutTimer=setTimeout(this.timeout.bind(this),AjaxPro.timeoutPeriod);try{this.xmlHttp.send(o)}catch(t){}return!!a||this.createResponse({error:null,value:null})}},AjaxPro.RequestQueue=function(t){this.queue=[],this.requests=[],this.timer=null,isNaN(t)&&(t=2);for(var e=0;e<t;e++)this.requests[e]=new AjaxPro.Request,this.requests[e].callback=function(t){var e=t.context;t.context=e[3][1],e[3][0](t,this)},this.requests[e].callbackHandle=this.requests[e].callback.bind(this.requests[e])},AjaxPro.RequestQueue.prototype={process:function(){if(this.timer=null,0!=this.queue.length){for(var t=0;t<this.requests.length&&this.queue.length>0;t++)if(0==this.requests[t].isRunning){var e=this.queue.shift();this.requests[t].url=e[0],this.requests[t].onLoading=e[3].length>2&&null!=e[3][2]&&"function"==typeof e[3][2]?e[3][2]:AjaxPro.onLoading,this.requests[t].onError=e[3].length>3&&null!=e[3][3]&&"function"==typeof e[3][3]?e[3][3]:AjaxPro.onError,this.requests[t].onTimeout=e[3].length>4&&null!=e[3][4]&&"function"==typeof e[3][4]?e[3][4]:AjaxPro.onTimeout,this.requests[t].onStateChanged=e[3].length>5&&null!=e[3][5]&&"function"==typeof e[3][5]?e[3][5]:AjaxPro.onStateChanged,this.requests[t].invoke(e[1],e[2],this.requests[t].callbackHandle,e),e=null}this.queue.length>0&&null==this.timer&&(this.timer=setTimeout(this.process.bind(this),10))}},add:function(t,e,n,i){this.queue.push([t,e,n,i]),null==this.timer&&(this.timer=setTimeout(this.process.bind(this),1))},abort:function(){this.queue.length=0,null!=this.timer&&clearTimeout(this.timer),this.timer=null;for(var t=0;t<this.requests.length;t++)1==this.requests[t].isRunning&&this.requests[t].abort()},dispose:function(){for(var t=0;t<this.requests.length;t++){this.requests[t].dispose()}this.requests.clear()}},AjaxPro.queue=new AjaxPro.RequestQueue(2),AjaxPro.AjaxClass=function(t){this.url=t},AjaxPro.AjaxClass.prototype={invoke:function(t,e,n){if(null!=n){if(6!=n.length)for(;n.length<6;)n.push(null);if(null!=n[0]&&"function"==typeof n[0])return AjaxPro.queue.add(this.url,t,e,n)}var i=new AjaxPro.Request;return i.url=this.url,i.invoke(t,e)}}},function(t,e){"undefined"==typeof Data&&(Data={}),Data.NameValueCollection=function(t){if(this.__type="System.Collections.Specialized.NameValueCollection",this.keys=[],this.values=[],null!=t&&!isNaN(t.length))for(var e=0;e<t.length;e++)this.add(t[e][0],t[e][1])},Object.extend(Data.NameValueCollection.prototype,{add:function(t,e){return null==t||t.constructor!=String||null==e||e.constructor!=String?-1:(this.keys.push(t),this.values.push(e),this.values.length-1)},containsKey:function(t){for(var e=0;e<this.keys.length;e++)if(this.keys[e]==t)return!0;return!1},getKeys:function(){return this.keys},getValue:function(t){for(var e=0;e<this.keys.length&&e<this.values.length;e++)if(this.keys[e]==t)return this.values[e];return null},setValue:function(t,e){if(null==t||t.constructor!=String||null==e||e.constructor!=String)return-1;for(var n=0;n<this.keys.length&&n<this.values.length;n++)if(this.keys[n]==t)return this.values[n]=e,n;return this.add(t,e)},toJSON:function(){return AjaxPro.toJSON({__type:this.__type,keys:this.keys,values:this.values})}},!0),"undefined"==typeof Data&&(Data={}),Data.DataSet=function(t){if(this.__type="System.Data.DataSet,System.Data",this.Tables=[],this.addTable=function(t){this.Tables.push(t)},null!=t)for(var e=0;e<t.length;e++)this.addTable(t[e])},"undefined"==typeof Data&&(Data={}),Data.DataTable=function(t,e){if(this.__type="System.Data.DataTable,System.Data",this.Columns=[],this.Rows=[],this.addColumn=function(t,e){this.Columns.push({Name:t,__type:e})},this.toJSON=function(){var t={};t.Columns=[];for(var e=0;e<this.Columns.length;e++)t.Columns.push([this.Columns[e].Name,this.Columns[e].__type]);t.Rows=[];for(var e=0;e<this.Rows.length;e++){for(var n=[],i=0;i<this.Columns.length;i++)n.push(this.Rows[e][this.Columns[i].Name]);t.Rows.push(n)}return AjaxPro.toJSON(t)},this.addRow=function(t){this.Rows.push(t)},null!=t)for(var n=0;n<t.length;n++)this.addColumn(t[n][0],t[n][1]);if(null!=e)for(var n=0;n<e.length;n++){for(var i={},t=0;t<this.Columns.length&&t<e[n].length;t++)i[this.Columns[t].Name]=e[n][t];this.addRow(i)}},"undefined"==typeof Data&&(Data={}),Data.Profile=function(){this.toJSON=function(){throw"Data.Profile cannot be converted to JSON format."},this.setProperty_callback=function(t){},this.setProperty=function(t,e){this[t]=e,AjaxPro.Services.Profile.SetProfile({name:o},this.setProperty_callback.bind(this))}},"undefined"==typeof Data&&(Data={}),Data.Dictionary=function(t,e){if(this.__type=t,this.keys=[],this.values=[],null!=e&&!isNaN(e.length))for(var n=0;n<e.length;n++)this.add(e[n][0],e[n][1])},Object.extend(Data.Dictionary.prototype,{add:function(t,e){return this.keys.push(t),this.values.push(e),this.values.length-1},clear:function(){this.keys=[],this.values=[]},count:function(){return this.keys.length},containsKey:function(t){for(var e=0;e<this.keys.length;e++)if(this.keys[e]==t)return!0;return!1},getIndexByKey:function(t){for(var e=0,n=this.keys.length;e<n;e++)if(this.keys[e]==t)return e;return null},getKeys:function(){return this.keys},getValue:function(t){for(var e=0;e<this.keys.length&&e<this.values.length;e++)if(this.keys[e]==t)return this.values[e];return null},getValueByIndex:function(t){return this.values[t]},setValue:function(t,e){for(var n=0;n<this.keys.length&&n<this.values.length;n++)return this.keys[n]==t&&(this.values[n]=e),n;return this.add(t,e)},remove:function(t){for(var e=null,n=!1,i=0;i<this.keys.length;i++)if(this.keys[i]==t){e=i,n=!0;break}n&&null!=e&&this.removeAtIndex(e)},removeAtIndex:function(t){this.keys.splice(t,1),this.values.splice(t,1)},toJSON:function(){return AjaxPro.toJSON({__type:this.__type,keys:this.keys,values:this.values})}},!0),window.Decimal=Class.create(),Object.extend(Decimal.prototype,{initialize:function(t,e,n){this.COMMA=",",this.PERIOD=".",this.DASH="-",this.LEFT_PAREN="(",this.RIGHT_PAREN=")",this.LEFT_OUTSIDE=0,this.LEFT_INSIDE=1,this.RIGHT_INSIDE=2,this.RIGHT_OUTSIDE=3,this.LEFT_DASH=0,this.RIGHT_DASH=1,this.PARENTHESIS=2,this.NO_ROUNDING=-1,this.num,this.numOriginal,this.hasSeparators=!1,this.separatorValue,this.inputDecimalValue,this.decimalValue,this.negativeFormat,this.negativeRed,this.hasCurrency,this.currencyPosition,this.currencyValue,this.places,this.roundToPlaces,this.truncate,null==e?this.setNumber(t,this.PERIOD):this.setNumber(t,e),this.setCommas(!0),this.setNegativeFormat(this.LEFT_DASH),this.setNegativeRed(!1),this.setCurrency(!1),this.setCurrencyPrefix("$"),n||0===n?this.setPlaces(n):this.setPlaces(2)},setInputDecimal:function(t){this.inputDecimalValue=t},setNumber:function(t,e){null!=e&&this.setInputDecimal(e),this.numOriginal=t,this.num=this.justNumber(t)},toUnformatted:function(){return this.num},getOriginal:function(){return this.numOriginal},setNegativeFormat:function(t){this.negativeFormat=t},setNegativeRed:function(t){this.negativeRed=t},setSeparators:function(t,e,n){this.hasSeparators=t,null==e&&(e=this.COMMA),null==n&&(n=this.PERIOD),this.decimalValue=e==n?n==this.PERIOD?this.COMMA:this.PERIOD:n,this.separatorValue=e},setCommas:function(t){this.setSeparators(t,this.COMMA,this.PERIOD)},setCurrency:function(t){this.hasCurrency=t},setCurrencyValue:function(t){this.currencyValue=t},setCurrencyPrefix:function(t){this.setCurrencyValue(t),this.setCurrencyPosition(this.LEFT_OUTSIDE)},setCurrencyPosition:function(t){this.currencyPosition=t},setPlaces:function(t,e){this.roundToPlaces=!(t==this.NO_ROUNDING),this.truncate=null!=e&&e,this.places=t<0?0:t},addSeparators:function(t,e,n,i){t+="";var a=t.indexOf(e),o="";-1!=a&&(o=n+t.substring(a+1,t.length),t=t.substring(0,a));for(var r=/(\d+)(\d{3})/;r.test(t);)t=t.replace(r,"$1"+i+"$2");return t+o},toFormatted:function(t,e){var n,i=this.num;new Array(2);if(this.roundToPlaces){var a=i<0;t&&(i=Math.abs(i)),i=this.getRounded(i),n=this.preserveZeros(Math.abs(i),e),t&&a&&(i*=-1)}else n=this.expandExponential(Math.abs(i));n=this.hasSeparators?this.addSeparators(n,this.PERIOD,this.decimalValue,this.separatorValue):n.replace(new RegExp("\\"+this.PERIOD),this.decimalValue);var o="",r="",s="",l="",u="",c="",d="",h="",f=this.negativeFormat==this.PARENTHESIS?this.LEFT_PAREN:this.DASH,p=this.negativeFormat==this.PARENTHESIS?this.RIGHT_PAREN:this.DASH;return this.currencyPosition==this.LEFT_OUTSIDE?(i<0&&(this.negativeFormat!=this.LEFT_DASH&&this.negativeFormat!=this.PARENTHESIS||(l=f),this.negativeFormat!=this.RIGHT_DASH&&this.negativeFormat!=this.PARENTHESIS||(u=p)),this.hasCurrency&&(o=this.currencyValue)):this.currencyPosition==this.LEFT_INSIDE?(i<0&&(this.negativeFormat!=this.LEFT_DASH&&this.negativeFormat!=this.PARENTHESIS||(r=f),this.negativeFormat!=this.RIGHT_DASH&&this.negativeFormat!=this.PARENTHESIS||(d=p)),this.hasCurrency&&(s=this.currencyValue)):this.currencyPosition==this.RIGHT_INSIDE?(i<0&&(this.negativeFormat!=this.LEFT_DASH&&this.negativeFormat!=this.PARENTHESIS||(r=f),this.negativeFormat!=this.RIGHT_DASH&&this.negativeFormat!=this.PARENTHESIS||(d=p)),this.hasCurrency&&(c=this.currencyValue)):this.currencyPosition==this.RIGHT_OUTSIDE&&(i<0&&(this.negativeFormat!=this.LEFT_DASH&&this.negativeFormat!=this.PARENTHESIS||(l=f),this.negativeFormat!=this.RIGHT_DASH&&this.negativeFormat!=this.PARENTHESIS||(u=p)),this.hasCurrency&&(h=this.currencyValue)),n=o+r+s+l+n+u+c+d+h,this.negativeRed&&i<0&&(n='<font color="red">'+n+"</font>"),n},toPercentage:function(){return nNum=100*this.num,nNum=this.getRounded(nNum),nNum+"%"},getZeros:function(t){var e,n="";for(e=0;e<t;e++)n+="0";return n},expandExponential:function(t){if(isNaN(t))return t;var e=parseFloat(t)+"",n=e.toLowerCase().indexOf("e");if(-1!=n){var i=e.toLowerCase().indexOf("+"),a=e.toLowerCase().indexOf("-",n),o=e.substring(0,n);if(-1!=a){var r=e.substring(a+1,e.length);o=this.moveDecimalAsString(o,!0,parseInt(r))}else{-1==i&&(i=n);var r=e.substring(i+1,e.length);o=this.moveDecimalAsString(o,!1,parseInt(r))}e=o}return e},moveDecimalRight:function(t,e){return null==e?this.moveDecimal(t,!1):this.moveDecimal(t,!1,e)},moveDecimalLeft:function(t,e){return null==e?this.moveDecimal(t,!0):this.moveDecimal(t,!0,e)},moveDecimalAsString:function(t,e,n){var i=arguments.length<3?this.places:n;if(i<=0)return t;var a=t+"",o=this.getZeros(i),r=new RegExp("([0-9.]+)");if(e){a=a.replace(r,o+"$1");var s=new RegExp("(-?)([0-9]*)([0-9]{"+i+"})(\\.?)");a=a.replace(s,"$1$2.$3")}else{var l=r.exec(a);null!=l&&(a=a.substring(0,l.index)+l[1]+o+a.substring(l.index+l[0].length));var s=new RegExp("(-?)([0-9]*)(\\.?)([0-9]{"+i+"})");a=a.replace(s,"$1$2$4.")}return a=a.replace(/\.$/,"")},moveDecimal:function(t,e,n){var i="";return i=null==n?this.moveDecimalAsString(t,e):this.moveDecimalAsString(t,e,n),parseFloat(i)},toRounded:function(){return this.getRounded(this.num)},toRoundedAwayFromZero:function(){return this.num<0?-this.getRounded(-this.num):this.getRounded(this.num)},getRounded:function(t){return t||(t=this.num),t=this.moveDecimalRight(t),t=this.truncate?t>=0?Math.floor(t):Math.ceil(t):Math.round(t),t=this.moveDecimalLeft(t)},preserveZeros:function(t,e){var n;if(e=e||this.places,t=this.expandExponential(t),this.places<=0)return t;var i=t.indexOf(".");if(-1==i)for(t+=".",n=0;n<e;n++)t+="0";else{var a=t.length-1-i,o=e-a;for(n=0;n<o;n++)t+="0"}return t},justNumber:function(t){newVal=t+"";var e=!1;-1!=newVal.indexOf("%")&&(newVal=newVal.replace(/\%/g,""),e=!0);var n=new RegExp("[^\\"+this.inputDecimalValue+"\\d\\-\\+\\(\\)eE]","g");newVal=newVal.replace(n,"");var i=new RegExp("["+this.inputDecimalValue+"]","g"),a=i.exec(newVal);if(null!=a){var o=newVal.substring(a.index+a[0].length);newVal=newVal.substring(0,a.index)+this.PERIOD+o.replace(i,"")}return newVal.charAt(newVal.length-1)==this.DASH?(newVal=newVal.substring(0,newVal.length-1),newVal="-"+newVal):newVal.charAt(0)==this.LEFT_PAREN&&newVal.charAt(newVal.length-1)==this.RIGHT_PAREN&&(newVal=newVal.substring(1,newVal.length-1),newVal="-"+newVal),newVal=parseFloat(newVal),isFinite(newVal)||(newVal=0),e&&(newVal=this.moveDecimalLeft(newVal,2)),newVal},abs:function(){return this.num=Math.abs(this.num),this},multiply:function(t,e){var n=this.getPlaces(t,e);return 0==n?t*e:this.moveDecimalLeft(this.moveDecimalRight(t,n)*this.moveDecimalRight(e,n),2*n)},subtract:function(t,e){var n=this.getPlaces(t,e);return 0==n?t-e:this.moveDecimalLeft(this.moveDecimalRight(t,n)-this.moveDecimalRight(e,n),n)},add:function(t,e){return this.subtract(t,this.multiply(e,-1))},getPlaces:function(t,e){t=t.toString(),e=e.toString();var n=t.indexOf(this.PERIOD),i=e.indexOf(this.PERIOD);return n=-1==n?0:t.length-n-1,i=-1==i?0:e.length-i-1,n>i?n:i}}),Decimal.TWO=function(t){return new Decimal(t,null,2)},Decimal.FOUR=function(t){return new Decimal(t,null,4)},window.Money={},Object.extend(Money,{parse:function(t,e){return new Decimal(t,2)},format:function(t){return new Decimal(t,2).toFormatted()}}),window.Guid=function(){this.__value=Guid.newGuid()},Guid.prototype.toFormatted=function(t){switch(t){case"N":return this.__value.replace(/{|-|}/g,"");case"D":return this.__value.replace(/{|}/g,"");case"B":return this.__value;case"P":return this.__value.replace(/{/g,"(").replace(/}/g,")")}return this.__value},Guid.empty=function(){for(var t=new Guid,e="",n=0;n<32;n++)e+="0"+(8==n||12==n||16==n||20==n?"-":"");return t.__value=e+"",t},Guid.newGuid=function(){var t=new Date(1582,10,15,0,0,0,0).getTime(),e=(new Date).getTime(),n=t<0?Math.abs(t)+e:e-t,i="-";return Guid.getIntegerBits(n,0,31)+i+Guid.getIntegerBits(n,32,47)+i+(Guid.getIntegerBits(n,48,59)+"1")+i+Guid.getIntegerBits(Math.randRange(0,4095),0,7)+Guid.getIntegerBits(Math.randRange(0,4095),0,7)+i+(Guid.getIntegerBits(Math.randRange(0,8191),0,7)+Guid.getIntegerBits(Math.randRange(0,8191),8,15)+Guid.getIntegerBits(Math.randRange(0,8191),0,7)+Guid.getIntegerBits(Math.randRange(0,8191),8,15)+Guid.getIntegerBits(Math.randRange(0,8191),0,15))},Guid.getIntegerBits=function(t,e,n){var i=Guid.returnBase(t,16),a=i.split(""),o="",r=0;for(r=Math.floor(e/4);r<=Math.floor(n/4);r++)a[r]&&""!=a[r]?o+=a[r]:o+="0";return o},Guid.returnBase=function(t,e){return t.toString(e).toUpperCase()},Ext.applyIf(Math,{randRange:function(t,e){return Math.max(Math.min(Math.round(Math.random()*e),e),t)}}),window.Globals=new Data.Dictionary},,function(t,e,n){(function(i,a){var o;!function(i){function r(t){return"[object Array]"===Object.prototype.toString.call(t)}function s(){for(var t=0;t<S.length;t++)S[t][0](S[t][1]);S=[],w=!1}function l(t,e){S.push([t,e]),w||(w=!0,R(s,0))}function u(t,e){function n(t){h(e,t)}function i(t){p(e,t)}try{t(n,i)}catch(t){i(t)}}function c(t){var e=t.owner,n=e.state_,i=e.data_,a=t[n],o=t.then;if("function"==typeof a){n=A;try{i=a(i)}catch(t){p(o,t)}}d(o,i)||(n===A&&h(o,i),n===k&&p(o,i))}function d(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var i=e.then;if("function"==typeof i)return i.call(e,function(i){n||(n=!0,e!==i?h(t,i):f(t,i))},function(e){n||(n=!0,p(t,e))}),!0}}catch(e){return n||p(t,e),!0}return!1}function h(t,e){t!==e&&d(t,e)||f(t,e)}function f(t,e){t.state_===b&&(t.state_=C,t.data_=e,l(g,t))}function p(t,e){t.state_===b&&(t.state_=C,t.data_=e,l(v,t))}function m(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)c(e[n])}function g(t){t.state_=A,m(t)}function v(t){t.state_=k,m(t)}function y(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof y==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],u(t,this)}var E=i.Promise,x=E&&"resolve"in E&&"reject"in E&&"all"in E&&"race"in E&&function(){var t;return new E(function(e){t=e}),"function"==typeof t}();void 0!==e&&e?(e.Promise=x?E:y,e.Polyfill=y):void 0!==(o=function(){return x?E:y}.call(e,n,e,t))&&(t.exports=o);var w,b="pending",C="sealed",A="fulfilled",k="rejected",T=function(){},R=void 0!==a?a:setTimeout,S=[];y.prototype={constructor:y,state_:b,then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(T),fulfilled:t,rejected:e};return this.state_===A||this.state_===k?l(c,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},y.all=function(t){var e=this;if(!r(t))throw new TypeError("You must pass an array to Promise.all().");return new e(function(e,n){for(var i,a=[],o=0,r=0;r<t.length;r++)i=t[r],i&&"function"==typeof i.then?i.then(function(t){return o++,function(n){a[t]=n,--o||e(a)}}(r),n):a[r]=i;o||e(a)})},y.race=function(t){var e=this;if(!r(t))throw new TypeError("You must pass an array to Promise.race().");return new e(function(e,n){for(var i,a=0;a<t.length;a++)i=t[a],i&&"function"==typeof i.then?i.then(e,n):e(i)})},y.resolve=function(t){var e=this;return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},y.reject=function(t){return new this(function(e,n){n(t)})}}("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this)}).call(e,n(21),n(79).setImmediate)},function(t,e,n){function i(t,e){this._id=t,this._clearFn=e}var a=Function.prototype.apply;e.setTimeout=function(){return new i(a.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new i(a.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(80),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,n){(function(t,e){!function(t,n){"use strict";function i(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return u[l]=i,s(l),l++}function a(t){delete u[t]}function o(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}function r(t){if(c)setTimeout(r,0,t);else{var e=u[t];if(e){c=!0;try{o(e)}finally{a(t),c=!1}}}}if(!t.setImmediate){var s,l=1,u={},c=!1,d=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){r(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&r(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),s=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){r(t.data)},s=function(e){t.port2.postMessage(e)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var t=d.documentElement;s=function(e){var n=d.createElement("script");n.onreadystatechange=function(){r(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function(){s=function(t){setTimeout(r,0,t)}}(),h.setImmediate=i,h.clearImmediate=a}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,n(21),n(81))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(d===clearTimeout)return clearTimeout(t);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function r(){m&&f&&(m=!1,f.length?p=f.concat(p):g=-1,p.length&&s())}function s(){if(!m){var t=a(r);m=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,m=!1,o(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var c,d,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(t){d=i}}();var f,p=[],m=!1,g=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new l(t,e)),1!==p.length||m||a(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.prependListener=u,h.prependOnceListener=u,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){XERO.util.PageNavigation={preventNavigationIfDirty:function(t,e,n){this.pageName=t,this.isDirty=e,this.trackingOptions=n||{},window.addEventListener("beforeunload",this.onBeforeWindowUnload.bind(this)),window.addEventListener("unload",this.onWindowUnload.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this))},onBeforeWindowUnload:function(t){if(this.isDirty()){this.hasUnloadConfirmationShown=!0,this.lastActiveHref=document.activeElement.href;return(t||window.event).returnValue="Changes that you made may not be saved.",t.preventDefault(),"Changes that you made may not be saved."}},onWindowUnload:function(t){this.hasUnloadConfirmationShown&&this.fireUnloadNavigationTracking.bind(this)(!0,this.lastActiveHref)},onWindowFocus:function(t){this.hasUnloadConfirmationShown&&setTimeout(function(){this.fireUnloadNavigationTracking.bind(this)(!1,this.lastActiveHref),this.hasUnloadConfirmationShown=!1,this.lastActiveHref=null}.bind(this),5e3)},fireUnloadNavigationTracking:function(t,e){var n=t?"Confirmed":"Cancelled",i=!1;e&&(i=e.indexOf("xero.")>-1||e.indexOf("xero-test.")>-1);var a=i?"internal":"external or reloaded";XERO.analytics.Analytics.trackGa("Page unload navigation",n+" navigation",n+" navigation away to "+a+" page from "+this.pageName,this.trackingOptions.productGroup,this.trackingOptions.primaryContentId,this.trackingOptions.documentStatus)}}},function(t,e){OrangeGirlTips={options:{delayOver:200,delayOut:1e3,shiftX:0,shiftY:0,className:"OG",width:450,height:null,showEvent:"click",hideEvent:"mouseout",autoHide:!1,pinnable:!1,draggable:!0,minimizable:!1,maximizable:!1,showEffect:Element.show,hideEffect:Element.hide},elements:null,showTimer:null,hideTimer:null,_isOnHover:!1,_isOnClick:!0,init:function(t){OrangeGirlTips.options=Object.extend(OrangeGirlTips.options,t||{}),this._isOnHover="mouseover"==this.options.showEvent,this._isOnClick="click"==this.options.showEvent,this._isOnHover||(this.options.delayOver=0),this.options.autoHide||(this.options.delayOut=0),XERO.bus&&XERO.bus.addListener("toggleOrangeTips",this.toggle)},add:function(t,e){t=$(t),t["on"+OrangeGirlTips.options.showEvent]=function(){return OrangeGirlTips._mouseOver(t,e),!1},t["on"+OrangeGirlTips.options.hideEvent]=function(){return OrangeGirlTips._mouseOut(t,e),!1}},toggle:function(t){var e=!1,n=Cookies.getCookie("OG_TIP_STATE");e=void 0===n||null==n||(t?"ON"==Cookies.getCookie("OG_TIP_STATE"):!("ON"==Cookies.getCookie("OG_TIP_STATE"))),$$(".xoOGTip").each(function(t){e?Element.show(t):Element.hide(t)}),$$(".ogtip").each(function(t){e?t.up("div.tip")&&Element.show(t.up("div.tip")):t.up("div.tip")&&Element.hide(t.up("div.tip"))}),XERO.bus&&XERO.bus.fireEvent("toggleOrangeTipsSwitch")},close:function(){OrangeGirlTips.tooltipWindow&&OrangeGirlTips.tooltipWindow.hide()},preloadImages:function(t,e,n){n||(n=".gif"),$A(e).each(function(e){(new Image).src=t+"/"+e+n})},show:function(t,e){OrangeGirlTips._showTooltip(t,e)},_showTooltip:function(t,e){this.element=t,OrangeGirlTips.showTimer=null,OrangeGirlTips.hideTimer&&clearTimeout(OrangeGirlTips.hideTimer);var n=Position.cumulativeOffset(t),i={width:37,height:13},a=n[0]>550?-280:OrangeGirlTips.options.shiftX;this.tooltipWindow&&this.tooltipWindow.close(),this.tooltipWindow=new Ext.Window({id:"__orangegirl_tooltip__",cls:"OG",html:"<div style='margin:1em;width:400;text-align:center'><img src='/common/images/indicator_orange.gif' /></div>"}),this.tooltipWindow.setPosition(n[0]+a,n[1]+i.height+OrangeGirlTips.options.shiftY),this.tooltipWindow.setHeight(OrangeGirlTips.options.height),this.tooltipWindow.setWidth(OrangeGirlTips.options.width),this.tooltipWindow.ddGhost=!1,this.tooltipWindow.show(this.element),this.tooltipWindow.toFront(),Ajax.GetHelpTip(e,OrangeGirlTips._onComplete.bind(this))},_onComplete:function(t){var e=t.value,n=new StringBuilder;e&&e.Body?(this.tooltipWindow.setTitle(e.Header),n.append("<div>"),n.append(e.Body)):(n.append("<div style='margin:1em;width:400'>"),n.append("The tip for this section is currently unavailable."),n.append("</div>")),this.tooltipWindow.body.update(n.toStr())},_hideTooltip:function(t){this.tooltipWindow&&(this.options.autoHide&&this.tooltipWindow.hide(),this.element=null)},_mouseOver:function(t,e){OrangeGirlTips._showTooltip(t,e)},_mouseOut:function(t){if(OrangeGirlTips.showTimer)return clearTimeout(OrangeGirlTips.showTimer),void(OrangeGirlTips.showTimer=null);OrangeGirlTips.tooltipWindow&&(OrangeGirlTips.hideTimer=setTimeout(function(){OrangeGirlTips._hideTooltip(t)},OrangeGirlTips.options.delayOut))},_tooltipOver:function(t,e){OrangeGirlTips.hideTimer&&(clearTimeout(OrangeGirlTips.hideTimer),OrangeGirlTips.hideTimer=null)},_tooltipOut:function(t,e){null==OrangeGirlTips.hideTimer&&(OrangeGirlTips.hideTimer=setTimeout(function(){OrangeGirlTips._hideTooltip(e)},OrangeGirlTips.options.delayOut))},onBeforeShow:function(t,e){if(OrangeGirlTips.tooltipWindow&&OrangeGirlTips.tooltipWindow==e){parseFloat(e.getLocation().top)+e.element.getDimensions().height>OrangeGirlTips._getScrollTop()+OrangeGirlTips._getPageHeight()&&this.element.scrollIntoView(!0)}},_getPageWidth:function(){return window.innerWidth||document.documentElement.clientWidth||0},_getPageHeight:function(){return window.innerHeight||document.documentElement.clientHeight||0},_getScrollTop:function(){return document.documentElement.scrollTop||window.pageYOffset||0},_getScrollLeft:function(){return document.documentElement.scrollLeft||window.pageXOffset||0}},GettingStartedTips={initialize:function(t){this.bus=XERO.bus,$("gettingstarted")&&(t?this.show():this.hide(),this.bus.addListener("gettingstarted:toggle",this.toggle,this))},show:function(){Element.show("gettingstarted"),this.bus.fireEvent("gettingstarted:show")},hide:function(){Element.hide("gettingstarted"),this.bus.fireEvent("gettingstarted:hide")},toggle:function(){var t=$("gettingstarted");if(t){var e=!Element.visible(t);e?this.show():this.hide(),Ajax.SaveGettingStarted(e,function(t){}),$("toggleGettingStartedMenuItem")&&($("toggleGettingStartedMenuItem").innerHTML=e?"Hide Getting Started":"Show Getting Started")}}},Notifications={toggle:function(t,e){if(t=$(t)){var n=!Element.visible(t);n?Element.show(t):Element.hide(t),Ajax.CloseNotification(e,n,function(t){})}}},OrangeGirlTips.init()},function(t,e){window.Currency={},Object.extend(Currency,{currentlyOpenWindow:"",toolTips:new Ext.util.MixedCollection,onCurrencyAfterUpdate:function(t,e,n){var i="undefined"!=typeof bankCurrency&&""!==bankCurrency?bankCurrency:defaultCurrency,a=n.data.getValue("CurrencyAbbreviation"),o="undefined"==typeof isCurrencyEditable||isCurrencyEditable;if(n.key==i&&Ext.fly("multicurrencyTotal")&&Ext.fly("multicurrencyTotal").setStyle("display","none"),n.key==defaultCurrency)if($("currency_exchangeTotal")&&$("currency_exchangeTotal").hide(),$("CurrencyValue").value=n.key,n.key!=i){var r,s,l,u,c=n.key,d=new Date;"undefined"!=typeof config&&null!=config&&(u=Ext.get("InvoiceDate_"+config.invoiceData.Invoice.CleanInvoiceID))&&""==u.dom.value&&(u.dom.value=d.format("d M Y"));var h=Ext.fly("CurrencyProviderRateID").getValue(),f=Ext.get("currencyRate");if(""!=h&&"null"!=h&&Ext.fly("exchangeRate").isVisible()&&null!=f)r=new Decimal(f.dom.innerHTML).num,0==r&&(r=1),s=new Decimal(1/r).num,l=Ext.fly("exchangeDateLabel").dom.innerHTML;else{var p=Currency.getCurrencyData(t,i);s=Currency.getInverseRateFromCurrencyData(p),r=Currency.sigFigs(p.data.getValue("CurrencyRate"),6),l=p.data.getValue("DateTime");var m=p.data.getValue("OrganisationCurrencyRateID");""!=m&&($("CurrencyProviderRateID").value=null,$("OrganisationCurrencyRateID").value=m)}Currency.updateMCInvoiceTotal(r,c,s,l)}else $("exchangeRate")&&$("exchangeRate").hide(),$("CurrencyProviderRateID").value=null,$("OrganisationCurrencyRateID").value=null;else if(o){var g=n.data.getValue("CurrencyProviderCurrencyRateID"),m=n.data.getValue("OrganisationCurrencyRateID");if("AddNew"==n.key)t.setValue($F("CurrencyValue"),!1);else if(""!=g||""!=m){Currency.setCurrencyHiddenFields(n);var r=Currency.sigFigs(n.data.getValue("CurrencyRate"),6),l=n.data.getValue("DateTime"),v="True"==n.data.getValue("IsLocked"),d=new Date;if("undefined"!=typeof config&&null!=config)$("InvoiceDate_"+Invoice.invoiceData.Invoice.CleanInvoiceID)&&""==$("InvoiceDate_"+Invoice.invoiceData.Invoice.CleanInvoiceID).value&&($("InvoiceDate_"+Invoice.invoiceData.Invoice.CleanInvoiceID).value=d.format("d M Y"));else if($("InvoiceID")&&""!=$F("InvoiceID")){var y=$F("InvoiceID");$("InvoiceDate_"+y)&&""==$F("InvoiceDate_"+y)&&($("InvoiceDate_"+y).value=d.format("d M Y"))}Currency.setExchangeRate(r,l,a,v),$("exchangeRate")&&$("exchangeRate").show(),$("currency_exchangeTotal")&&Currency.updateInvoiceTotalToolTip(),n.key!=i&&Currency.updateMCInvoiceTotal(r,a,s,l)}else $("exchangeRate").innerHTML="There is no rate available for this date",$("exchangeRate").show()}if("undefined"==typeof isFromInvoice||isFromInvoice){var v="True"==n.data.getValue("IsLocked");$("exchangeRateLink")&&(v?$("exchangeRateLink").update("Exchange Rates"):$("exchangeRateLink").update("<a href='javascript:' onClick='Currency.getEditExchangeRateHtml(); return false'>Exchange Rates</a>"))}"undefined"!=typeof config&&null!=config&&null!=a&&Invoice.lineItemsGrid.colModel.setColumnHeader(Invoice.lineItemsGrid.colModel.getIndexById(COLS.LINEAMOUNT),"Amount "+a)},setCurrencyHiddenFields:function(t){var e=t.data.getValue("CurrencyProviderCurrencyRateID"),n=t.data.getValue("OrganisationCurrencyRateID");""==e&&""==n||(""!=n?(Ext.fly("OrganisationCurrencyRateID").dom.value=n,Ext.fly("CurrencyProviderRateID").dom.value=""):""!=e&&(Ext.fly("CurrencyProviderRateID").dom.value=e,Ext.fly("OrganisationCurrencyRateID").dom.value="")),$("CurrencyValue").value=t.key},getCurrencyData:function(t,e){for(var n=0,i=t.localData.length;n<i;n++){var a=t.localData[n];if(a.key==e)return a}},getInverseRateFromCurrencyData:function(t){var e=t.data.getValue("CurrencyRate");return""!=e&&0!=e||(e=1),e=new Decimal(1/e).num},getInverseRate:function(t,e){var n=Currency.getCurrencyData(t,e);return Currency.getInverseRateFromCurrencyData(n)},updateMCInvoiceTotal:function(t,e,n,i){if(null!=Ext.fly("multicurrencyTotal")){var a="undefined"!=typeof bankCurrency&&""!=bankCurrency?bankCurrency:defaultCurrency,o=config.canEditFully||config.canEditFullyExceptTotal;if(void 0===t||void 0===e){var r=Invoice.invoiceData.Invoice.CleanInvoiceID,s=Globals.getValue("Currency_"+r+"_completer");if(config.invoiceData.Invoice.CurrencyCode!=a&&o)e=config.invoiceData.Invoice.CurrencyCode,null!=(t=Ext.fly("currencyRate"))&&(t=new Decimal(t.dom.innerHTML).num,0==t&&(t=1),n=new Decimal(1/t).num);else if("object"==typeof s&&s){var l=s.current;e=l.key;var u=Ext.fly("CurrencyProviderRateID").getValue(),c=Ext.get("currencyRate");if(""!=u&&"null"!=u&&Ext.fly("exchangeRate").isVisible()&&null!=c)t=new Decimal(c.dom.innerHTML).num,0==t&&(t=1),n=new Decimal(1/t).num,i=Ext.fly("exchangeDateLabel").dom.innerHTML;else if(e==defaultCurrency&&e!=a){var d=Currency.getCurrencyData(s,a);t=Currency.sigFigs(d.data.getValue("CurrencyRate"),6),n=Currency.getInverseRateFromCurrencyData(d),i=d.data.getValue("DateTime")}else t=Currency.sigFigs(l.data.getValue("CurrencyRate"),6),i=l.data.getValue("DateTime")}}if(e!=a){var h=new Decimal(Ext.fly("invoiceTotal").getValue()).num,f=e==defaultCurrency?new Decimal(n).num:new Decimal(t).num;0!=f&&(mcTotal=new Decimal(h/f),Ext.fly("mcInvoiceTotal").dom.value=mcTotal.toFormatted(),Ext.fly("multicurrencyTotal").setStyle("display","block"),o||(e==defaultCurrency?Currency.setExchangeRate(Currency.sigFigs(t,6),i,a.replace("CURR/","")):Currency.setExchangeRate(Currency.sigFigs(t,6),i,e.replace("CURR/","")),Ext.fly("exchangeRate")&&Ext.fly("exchangeRate").show()),e==defaultCurrency&&Ext.fly("exchangeRateLink")&&Ext.get("exchangeRateLink").setStyle("display","none"))}}},sigFigs:function(t,e){var n=parseFloat(t).toPrecision(e);return-1!=n.indexOf("e")?parseFloat(n):n},updateExchangeRate:function(){var t;t="undefined"!=typeof config&&null!=config?config.invoiceData.Invoice.CleanInvoiceID:$F("CleanInvoiceID");var e=Globals.getValue("Currency_"+t+"_completer");if(!Ext.get("OrganisationCurrencyRateID")||""==$F("OrganisationCurrencyRateID")&&""==$F("CurrencyProviderRateID")||"null"==$F("OrganisationCurrencyRateID")&&"null"==$F("CurrencyProviderRateID")){if(null!=e){var n=$("Currency_"+t+"_value"),i=e.current;$("InvoiceDate_"+t)&&""==$F("InvoiceDate_"+t)&&i.key!=defaultCurrency?$("exchangeRate")&&$("exchangeRate").hide():Currency.onCurrencyAfterUpdate(e,n,i)}}else{if((null!=e&&null!=e.current&&"undefined"==typeof isFromInvoice||isFromInvoice)&&null!=e.current){var a="True"==e.current.data.getValue("IsLocked");$("exchangeRateLink")&&(a?$("exchangeRateLink").update("Exchange Rates"):config.canEditFullyExceptTotal?Ext.get("exchangeRateLink").update(""):$("exchangeRateLink").update("<a href='javascript:' onClick='Currency.getEditExchangeRateHtml(); return false;'>Exchange Rates</a>"))}Ext.get("exchangeRate")&&Ext.get("CurrencyValue").dom.value!=defaultCurrency&&Ext.get("exchangeRate").show()}},onCurrencyChange:function(){var t;t="undefined"!=typeof config&&null!=config?config.invoiceData.Invoice.CleanInvoiceID:$F("InvoiceID");var e=Globals.getValue("Currency_"+t+"_completer");null==e.current&&"undefined"!=typeof defaultCurrency&&null!=defaultCurrency&&e.setValue(defaultCurrency,!1)},setExchangeRate:function(t,e,n,i){var a="";if(a="undefined"==typeof defaultCurrency&&null!=$("defaultCurrency")?$F("defaultCurrency"):defaultCurrency,$("exchangeRate")&&""!=a){var o="1 "+a.replace("CURR/","")+" = <span id='currencyRate'>"+t+"</span> "+n+" (<span id='exchangeDateLabel'>"+e+"</span>) ";o+=i?"Exchange Rates":"<span id='exchangeRateLink'><a href='javascript:' onClick='Currency.getEditExchangeRateHtml();'>Exchange Rates</a></span>",$("exchangeRate").innerHTML=o}},createAjaxWindow:function(t,e,n,i,a){XERO.MsgBox.createAjax(t,{fromEl:a,title:e,modal:!0,height:i,width:n,scope:Currency})},dateElement:null,invoiceNumElement:null,onInvoiceDateAfterUpdate:function(t,e,n){if(("undefined"==typeof isCurrencyEditable||isCurrencyEditable)&&"undefined"!=typeof config&&null!=config&&null!=Invoice.invoiceData.Invoice){var i=Invoice.invoiceData.Invoice.CleanInvoiceID;if($("InvoiceDate_"+i)){var a=$F("InvoiceDate_"+i);if(Currency.dateElement=$("DueDate_"+i),Currency.invoiceNumElement=$("InvoiceNumber_"+i),""!=a){$F("CurrencyValue")!=defaultCurrency&&isCurrencyEditable&&($("loading")&&$("loading").show(),$("exchangeRate")&&$("exchangeRate").hide());var o=Ext.fly("CurrencyValue").dom.value,r="INVOICETYPE/CASHPAID"===Invoice.invoiceTypeCode||"INVOICETYPE/CASHREC"===Invoice.invoiceTypeCode,s="INVOICETYPE/ARPREPAYMENT"===Invoice.invoiceTypeCode||"INVOICETYPE/APPREPAYMENT"===Invoice.invoiceTypeCode||"INVOICETYPE/AROVERPAYMENT"===Invoice.invoiceTypeCode||"INVOICETYPE/APOVERPAYMENT"===Invoice.invoiceTypeCode,l=o;(r||s&&bankCurrency!=defaultCurrency&&o==defaultCurrency)&&(l=bankCurrency,bankCurrency!=defaultCurrency&&o==defaultCurrency&&($("loading")&&$("loading").show(),$("exchangeRate")&&$("exchangeRate").hide())),Ajax.GetCurrencyAutocompleter(a,Invoice.invoiceTypeCode,l,Currency.getCurrencyAutocompleterCallback),(r||s)&&(Ext.fly("CurrencyProviderRateID").dom.value=null)}}}},onCashDateAfterUpdate:function(t,e,n){if(null!=window.Credit&&window.Credit.lastInvoiceType!=window.Credit.CASHTYPES.DIRECT)Currency.onInvoiceDateAfterUpdate(t,e,n);else{var i=Invoice.invoiceData.Invoice.CleanInvoiceID,a=$F("InvoiceDate_"+i),o=Ext.get("CurrencyValue")&&$F("CurrencyValue");Currency.dateElement=$("InvoiceDate_"+i),""!=a&&o&&(o!=defaultCurrency&&($("loading")&&$("loading").show(),$("exchangeRate")&&$("exchangeRate").hide()),Ajax.GetCurrencyRateData(a,o,Currency.getCurrencyRateDataCallback))}},getCurrencyRateDataCallback:function(t){var e=t.value;if(e&&e.IsValid){$F("CurrencyValue")!=defaultCurrency&&($("loading")&&$("loading").hide(),$("exchangeRate")&&$("exchangeRate").show());var n=Currency.sigFigs(e.Data.getValue("CurrencyRate"),6),i=e.Data.getValue("CurrencyDate"),a=e.Data.getValue("CurrencyCode").replace("CURR/",""),o=e.Data.getValue("IsInLockedPeriod");Currency.setExchangeRate(n,i,a,o),$("exchangeRate")&&$("exchangeRate").show();var r=e.Data.getValue("OrganisationCurrencyRateID"),s=e.Data.getValue("CurrencyProviderRateID");r?($("OrganisationCurrencyRateID").value=r,$("CurrencyProviderRateID").value=""):($("CurrencyProviderRateID").value=s,$("OrganisationCurrencyRateID").value="")}},getCurrencyAutocompleterCallback:function(t){var e=t.value;if(e){if(e.IsValid){var n=$F("CurrencyValue");if((n!=defaultCurrency||"undefined"!=typeof bankCurrency&&bankCurrency!=defaultCurrency&&n==defaultCurrency)&&($("loading")&&$("loading").hide(),$("exchangeRate")&&$("exchangeRate").show()),"undefined"!=typeof config&&null!=config){var i=config.invoiceData.Invoice.CleanInvoiceID;autocompleter=Globals.getValue("Currency_"+i+"_completer");var a=e.Data.getValue("UpdatedCurrencySubscriptions");null!=a&&""!=a&&(autocompleter.localData=a,autocompleter.initLocal(),autocompleter.setValue($F("CurrencyValue"),!1,!0))}}Currency.dateElement||Currency.invoiceNumElement}},getCurrencyAccountHtml:function(t){Currency.createAjaxWindow("CurrencyWindow","Add Currency",650,470),Ajax.GetCurrencyAccountHtml(t,Currency.getCurrencyHtmlCallback)},currencyDropDownKey:"",getCurrencyHtml:function(t,e,n,i,a){null==t&&(t="");var o="Add Currency",r="";null==e||e||(o="Edit Currency"),null!=$("ExchangeDate")&&""!=$F("ExchangeDate")&&(r=$F("ExchangeDate"));var s;if("undefined"!=typeof config){var l=config.invoiceData.Invoice.CleanInvoiceID;autocompleter=Globals.getValue("Currency_"+l+"_completer"),s=autocompleter.current,$("InvoiceDate_"+l)&&(r=$("InvoiceDate_"+l).value)}else $("CurrencyDropDown")&&(autocompleter=Globals.getValue("CurrencyDropDown_completer"),autocompleter.current&&autocompleter.current.key&&(Currency.currencyDropDownKey=new String(autocompleter.current.key)));Currency.createAjaxWindow("CurrencyWindow",o,650,470,n),Ajax.GetCurrencyHtml(t,r,Currency.getCurrencyHtmlCallback),null!=s&&autocompleter.setValue(s.key,!1)},getCurrencyHtmlCallback:function(t){var e=t.value;if(!e)return void(null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().destroy());if(e.IsValid&&null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().setHtml(e.Result),$("CurrencyDropDown")){var n=Globals.getValue("CurrencyDropDown_completer");""==Currency.currencyDropDownKey||"AddNew"==Currency.currencyDropDownKey?n.element.value="":n.setValue(Currency.currencyDropDownKey,!1)}},saveCurrency:function(t){null!=t&&""!=t||(t=$F("CurrencyCode")),Ajax.SaveCurrencySubscription_2(t,Form.serializeToCollection($("frmEditCurrency")),Currency.saveCurrencyCallBack)},saveCurrencyConfirmBank:function(t,e){null!=e&&""!=e||(e=$F("CurrencyCode")),Ajax.SaveCurrencySubscription_3(e,t,Form.serializeToCollection($("frmEditCurrency")),Currency.saveCurrencyConfirmBankCallBack)},saveCurrencyCallBack:function(t){var e=t.value;if(XERO.widget.Buttons&&XERO.widget.Buttons.enable(),e)if(e.IsValid){Windows.closeAll();var n=e.Data.getValue("RedirectUrl"),i=e.Data.getValue("ConfirmMessage"),a=e.Data.getValue("UpdateRequired");if(null!=i&&""!=i&&$("confirmMessage")&&($("confirmMessageContents").update(i),$("confirmMessage").show(),$("msg")&&$("msg").hide()),null!=a&&1==a){var o=e.Result;null!=$("CurrencySummary")&&null!=o&&""!=o&&$("CurrencySummary").update(o);var r=null,s=e.Data.getValue("UpdatedCurrencySubscriptions");if("undefined"!=typeof config&&null!=config){var l=config.invoiceData.Invoice.CleanInvoiceID;r=Globals.getValue("Currency_"+l+"_completer")}else $("CurrencyDropDown")&&(r=Globals.getValue("CurrencyDropDown_completer"));null!=r&&(r.localData=s,r.initLocal(),r.setValue(e.Data.getValue("NewCurrency"),!1))}null!=n&&""!=n&&(document.location=n),XERO.widget.Tables&&XERO.widget.Tables.refresh()}else null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().setHtml(e.Result)},saveCurrencyConfirmBankCallBack:function(t){var e=t.value;if(XERO.widget.Buttons&&XERO.widget.Buttons.enable(),e)if(e.IsValid){Windows.closeAll();for(var n=e.Data.getValue("UpdatedCurrencySubscriptions"),i=e.Data.getValue("CleanAccountIDs"),a=e.Data.getValue("CleanAccountID"),o=new Array,r=0;r<i.length;r++)if(o[r]=Globals.getValue("Currency"+i[r]+"_completer"),null!=o[r]){var s=n.length-1;o[r].localData=Currency.clone(n),o[r].localData[s].html=n[s].html.replace(a,i[r]),o[r].initLocal(),a==i[r]&&o[r].setValue(e.Data.getValue("NewCurrency"),!1)}XERO.widget.Tables&&XERO.widget.Tables.refresh()}else null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().setHtml(e.Result)},clone:function(t){if(null==t||"object"!=typeof t)return t;var e=new t.constructor;for(var n in t)e[n]=Currency.clone(t[n]);return e},getCurrencyProviderRates:function(){XERO.widget.Buttons&&XERO.widget.Buttons.disable();var t=$F("CurrencyCode");""!=t&&"CURR/NON"!=t&&($("currencyProviders").update("<tr><td colspan='3'><div class='loading'>Loading</div></td></tr>"),Ajax.GetCurrencyProviderRates(t,Currency.getCurrencyProviderRatesCallback))},getCurrencyProviderRatesCallback:function(t){var e=t.value;if(e)if(XERO.widget.Buttons&&XERO.widget.Buttons.enable(),e.IsValid){var n=e.Result;null!=$("currencyProviders")&&null!=n&&""!=n&&$("currencyProviders").update(n)}else null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().setHtml(e.Result)},toggleProvider:function(t){null!=t&&""!=t&&($(t).checked=!$(t).checked)},getEditExchangeRateHtml:function(){var t,e=null,n="";t="undefined"!=typeof config&&null!=config?Invoice.invoiceData.Invoice.CleanInvoiceID:$F("CleanInvoiceID");var i=Globals.getValue("Currency_"+t+"_completer"),a=i.current.key;"undefined"!=typeof config&&null!=config?n=$("InvoiceDate_"+t)&&""!=$F("InvoiceDate_"+t)?$F("InvoiceDate_"+t):i.current.data.getValue("DateTime"):$("InvoiceDate_"+t)&&""!=$F("InvoiceDate_"+t)&&(n=$F("InvoiceDate_"+t)),""!=$F("OrganisationCurrencyRateID")?e=$F("OrganisationCurrencyRateID"):""!=$F("CurrencyProviderRateID")&&(e=$F("CurrencyProviderRateID")),Currency.createAjaxWindow("EditExchangeRate","Set Exchange Rate",325,550),Ajax.GetEditExchangeRateHtml(a,e,n,!0,Currency.getEditExchangeRateHtmlCallback)},customRate:"",rateID:"",saveNonCustomRate:!1,getEditExchangeRateHtmlCallback:function(t){var e=t.value;if(!e)return void(null!=this.currentlyOpenWindow&&""!=this.currentlyOpenWindow&&this.currentlyOpenWindow.destroy());e.IsValid&&null!=Ext.WindowMgr.getActive()&&(Ext.WindowMgr.getActive().setHtml(e.Result),$("ExchangeRates_Rate")&&(Currency.customRate=$F("ExchangeRates_Rate")))},setRateOption:function(){if($("Custom").checked)$("DailyRateOption").show();else if($("OrganisationRate")&&$("OrganisationRate").checked&&""!=$F("OrganisationRate"))$("OrganisationCurrencyRateID").value=$F("OrganisationRate"),$("CurrencyProviderRateID").value="";else{$$("form#frmEditExchangeRate input.xoProviderRate").each(function(t){"radio"==t.type&&t.checked&&""!=t.valueOf&&($("CurrencyProviderRateID").value=t.value,$("OrganisationCurrencyRateID").value="")})}},toggleCustomRate:function(){$("Custom").checked&&$("DailyRateOption").show()},getPeriodDate:function(t,e){return Currency.saveNonCustomRate&&e&&e.isVisible()?Ext.get(t).getValue():null},getSaveExchangeRateCallback:function(t,e){return t&&t.isVisible()?function(t){Currency.periodCurrencyRatesCallback(t),t.value&&t.value.IsValid||($("Custom").checked=!0,Currency.setRateOption(),$("ExchangeRates_Rate").value=e)}:Currency.saveExchangeRateCallBack},periodCurrencyRatesCallback:function(t){var e=t.value;if(XERO.widget.Buttons&&XERO.widget.Buttons.enable(),e)if(e.IsValid){Windows.closeAll();var n=e.Result,i=Ext.get("CurrencySummary");i&&n&&i.update(n);var a=e.Data.getValue("ConfirmMessage");if(null!=a&&""!=a){var o=Ext.get("confirmMessage");if(o){Ext.get("confirmMessageContents").update(a),o.show();var r=Ext.get("msg");r&&(r.setVisibilityMode(Ext.Element.DISPLAY),r.hide())}}XERO.widget.Tables&&XERO.widget.Tables.refresh(),XERO.analytics.Analytics.track("Exchange Rates",{Mode:"Muliple Dates",Status:"Success"},"snp")}else null!=Ext.WindowMgr.getActive()&&(Ext.WindowMgr.getActive().setHtml(e.Result),Currency.toggleDateRange()),XERO.analytics.Analytics.track("Exchange Rates",{Mode:"Muliple Dates",Status:"Failed"},"snp")},toggleDateRange:function(){Ext.get("date-range-ct").show();var t=Ext.get("CurrencyDatesCt");t.setVisibilityMode(Ext.Element.DISPLAY),t.hide();var e=Ext.get("DateRangeLink");e.setVisibilityMode(Ext.Element.DISPLAY),e.hide(),Ext.get("CurrencyRateDetailsLabel").update("Rate will vary for each day of the period")},isPeriodValid:function(t,e){var n=Ext.get("LockDate").getValue(),i=new Date(t),a=new Date(e),o=new Date(n||t);return i<=a&&(a-i)/864e5<=400&&(!n||i>=o.add({days:1}))},saveExchangeRate:function(t,e){var t=$F("CurrencyCode");Currency.setRateOption();var n="True"==$F("CanEditDailyRate"),i=$("FXDate").innerHTML,a=Ext.get("date-range-ct"),o=Currency.getPeriodDate("FromDate",a),r=Currency.getPeriodDate("ToDate",a),s=function(t){if(a&&a.isVisible()&&Currency.isPeriodValid(o,r)){Ext.select("div[id=notify01]").each(function(t){t.remove()});XERO.MsgBox.create("ExistingCustomRates",{title:"Confirm Update",width:400,html:"Any custom exchange rates set between <b>"+o+"</b> and <b>"+r+"</b> will be updated. Are you sure you want to continue?",modal:!0,buttons:[XERO.buttons.createButton({text:"Update",size:"medium",type:"green",defaults:!0}),XERO.buttons.createButton({text:"Cancel",size:"medium",type:"gray",cancel:!0})],handler:function(e,n){e.destroy(),!0===n.cancel?XERO.widget.Buttons.enable():!0===n.defaults&&t()}}).show()}else t()};if($("Custom").checked){if($("ExchangeRates_Rate")){var l=new Decimal($F("ExchangeRates_Rate")).num,u=$F("Custom"),c="True"==$F("IsDailyRate")||a&&a.isVisible();if(Currency.customRate!=l||""==u||c){Currency.updateInvoiceTotalToolTipWithRateData(l,t);var d=!0;"undefined"!=typeof Invoice&&void 0!==Invoice.addNewCurrency&&null!=Invoice.addNewCurrency&&(d=Invoice.addNewCurrency),s(Currency.SaveExchangeRate(u,t,o,r,i,l,c,n,d,Currency.getSaveExchangeRateCallback(a,l)))}else $("OrganisationCurrencyRateID").value=u,$("CurrencyProviderRateID").value="",Windows.closeAll()}}else{var h,f,e,p=$F("ISOCurrencyCode");if(XERO.widget.Buttons&&setTimeout(function(){XERO.widget.Buttons.enable()},1e3),""!=$F("OrganisationCurrencyRateID")?e=$F("OrganisationCurrencyRateID"):""!=$F("CurrencyProviderRateID")&&(e=$F("CurrencyProviderRateID")),$("Rate_"+e)&&$("Date_"+e)){h=Currency.sigFigs($F("Rate_"+e),6),inverseRate=new Decimal(1/new Decimal(h).num).num,f=$F("Date_"+e).toString("d M Y"),Currency.setExchangeRate(h,f,p,!1),Currency.updateInvoiceTotalToolTipWithRateData(h,p);var m="undefined"!=typeof bankCurrency&&""!=bankCurrency?bankCurrency:defaultCurrency,t=Ext.fly("CurrencyCode").getValue();t!=m&&Currency.updateMCInvoiceTotal(h,t,inverseRate,f)}if(!0===Currency.saveNonCustomRate){var g=new Decimal(h).num,v=Ext.get("Provider_"+e),y=v&&v.dom.checked;a.isVisible()?s(y?Currency.ResetOrganisationCurrencyRates(e,t,o,r,i,Currency.periodCurrencyRatesCallback):Currency.SaveExchangeRate(e,t,o,r,i,g,!0,n,!1,Currency.periodCurrencyRatesCallback)):y?Ajax.ResetOrganisationCurrencyRates(e,t,i,i,i,Currency.periodCurrencyRatesCallback):i!=f||""!=Currency.rateID&&Currency.rateID!=e?Ajax.SaveExchangeRate("",t,null,null,i,g,!0,n,!1,Currency.saveExchangeRateCallBack):Windows.closeAll()}else Windows.closeAll()}},ResetOrganisationCurrencyRates:function(){var t=arguments;return function(){Ajax.ResetOrganisationCurrencyRates.apply(Ajax,t)}},SaveExchangeRate:function(){var t=arguments,e=new Decimal($F("ExchangeRates_Rate")).num;return window.Invoice&&"INVOICETYPE/ACCREC"===window.Invoice.invoiceTypeCode&&$("Custom").checked&&e>0&&window.ga&&"function"==typeof window.ga&&window.ga("send",{hitType:"event",eventCategory:"Manage Invoice",eventAction:"Save custom rate",eventLabel:"Save custom exchange rate from "+window.Invoice.invoiceTypeCode}),function(){Ajax.SaveExchangeRate.apply(Ajax,t)}},saveExchangeRateCallBack:function(t){var e=t.value;if(XERO.widget.Buttons&&XERO.widget.Buttons.enable(),e)if(e.IsValid){Windows.closeAll();var n=e.Data.getValue("RedirectUrl"),i=e.Data.getValue("ConfirmMessage"),a=e.Data.getValue("UpdateRequired");if(null!=i&&""!=i&&$("confirmMessage")&&($("confirmMessageContents").update(i),$("confirmMessage").show(),$("msg")&&$("msg").hide()),null!=a&&1==a){var o=e.Result;null!=$("CurrencySummary")&&null!=o&&""!=o&&$("CurrencySummary").update(o);var r=null,s=e.Data.getValue("UpdatedCurrencySubscriptions"),l=e.Data.getValue("SelectedCurrencySubscriptions");if("undefined"!=typeof config&&null!=config){var u=config.invoiceData.Invoice.CleanInvoiceID;r=Globals.getValue("Currency_"+u+"_completer"),r.localData=s,l&&(r.current=l),r.initLocal()}var c=e.Data.getValue("NewOrganisationRateID"),d=Currency.sigFigs(e.Data.getValue("NewOrganisationRate"),6),h=e.Data.getValue("ExchangeDate"),f=e.Data.getValue("CurrencyCode"),p=(e.Data.getValue("IsInLockedPeriod"),new Decimal(1/new Decimal(d).num).num);Currency.setExchangeRate(d,h,f,!1);var m="undefined"!=typeof bankCurrency&&""!==bankCurrency?bankCurrency:defaultCurrency;null!=r&&r.current.key!=m&&Currency.updateMCInvoiceTotal(d,f,p,h),null!=c&&""!=c&&$("OrganisationCurrencyRateID")&&($("OrganisationCurrencyRateID").value=c,$("CurrencyProviderRateID").value="")}null!=n&&""!=n&&(document.location=n),XERO.widget.Tables&&XERO.widget.Tables.refresh(),XERO.analytics.Analytics.track("Exchange Rates",{Mode:"Single Date",Status:"Success"},"snp")}else null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().setHtml(e.Result),XERO.analytics.Analytics.track("Exchange Rates",{Mode:"Single Date",Status:"Failed"},"snp")},getEditExchangeRateHtmlERP:function(t,e,n,i){var t,a=null,o="";""!=i?o=i:""!=$F("ExchangeDate")&&(o=$F("ExchangeDate")),a=null!=n&&""!=n?n:e,Currency.createAjaxWindow("EditExchangeRate","Set Exchange Rate",325,550),Ajax.GetEditExchangeRateHtml(t,a,o,!1,Currency.getEditExchangeRateHtmlCallback)},onExchangeDateEventHandler:function(){var t="";""!=$F("ExchangeDate")&&(t=$F("ExchangeDate")),""!=t&&(Ext.fly("CurrencySummary").update("<div class='loading'>Loading</div>"),Ajax.GetExchangeRatesForDate(t,Currency.getExchangeRatesHtmlCallback))},getExchangeRatesHtmlCallback:function(t){var e=t.value,n=e.Data.getValue("UpdateRequired");if(e&&e.IsValid){if(null!=n&&1==n){var i=e.Result;null!=$("CurrencySummary")&&null!=i&&""!=i&&$("CurrencySummary").update(i),$("msg")&&$("msg").hide(),$("confirmMessage")&&$("confirmMessage").hide()}XERO.widget.Tables&&XERO.widget.Tables.refresh()}},getActiveCurrenciesCallback:function(){},transferID:"",transferLineType:"",updateCurrencyConversions:function(t,e){var n=$("TransferDate")?$F("TransferDate"):"",i=$F("BaseCurrencyCode")?$("BaseCurrencyCode"):"",a="",o="";if($("SourceAccount")&&""!=$F("SourceAccount")||$("DestAccount")&&""!=$F("DestAccount")){var r=Globals.getValue("SourceAccount_completer"),s=Globals.getValue("DestAccount_completer");if(null!=r&&null!=r.current&&(a=r.current.data.getValue("CurrencyCode")),null!=s&&null!=s.current&&(o=s.current.data.getValue("CurrencyCode")),void 0===t||null==t||t){var l=a==o,u=""!=a&&""!=o;u&&l?(a!=i?$("AmountLabel").update("Amount "+a.replace("CURR/","")):$("AmountLabel").update("Amount"),$("Reference").style.margin="0 0 0 5px"):u&&!e&&($("Reference").style.margin="0 0 0 15px",$("CurrencyConversion").style.margin="70px 0px -40px 0px"),u&&e&&!l&&$("BankrecTrackingLink")?($("Tracking").style.margin="-105px 0px 0px -298px",$("Tracking").style.clear="none",$("BankrecTrackingLink").style.margin="68px 0 0 -85px",$("Reference").style.margin="0 0 0 15px"):e&&$("BankrecTrackingLink")&&($("Tracking").style.margin="-105px 0px 0px 124px",$("Tracking").style.clear="both",$("BankrecTrackingLink").style.margin="68px 0 0 -200px"),""!=a&&""!=o&&a!=o?($("ExchangeRates").hide(),$("XERates").hide(),$("loading")&&$("loading").show(),Ajax.GetCurrencyRateSummary(n,a,o,Currency.getCurrencyRatesCallback)):(Ext.fly("rateWarning"+Currency.transferID)&&Ext.fly("rateWarning"+Currency.transferID).setStyle("display","none"),Ext.fly("CurrencyConversion").setStyle("display","none"),Ext.fly("Amount").setStyle("display","block"))}}},getCurrencyRatesCallback:function(t){var e=t.value;if(e){if($("loading")&&$("loading").hide(),e.IsValid){var n=Currency.sigFigs(e.Data.getValue("fromRate"),6),i=e.Data.getValue("fromCurrency"),a=Currency.sigFigs(e.Data.getValue("toRate"),6),o=e.Data.getValue("toCurrency"),r=e.Data.getValue("exchangeDate"),s="Rate for ("+r+")",l="1 "+i+" = "+n+" "+o,u="1 "+o+" = "+a+" "+i;$("XERates")&&$("XERates").update(s+" "+l+"  /  "+u),$("XEFromRate").value=n,$("FromAmountLabel").update("Amount "+i),$("ToAmountLabel").update("Amount "+o),Currency.calculateTransferRates(),Ext.fly("ExchangeRates").setStyle("display","block"),Ext.fly("CurrencyConversion").setStyle("display","block"),$("Amount").hide()}$("CalculatedRates").show(),$("XERates").show()}},calculateTransferRates:function(){var t=new Decimal($F("XEFromRate")).num,e=new Decimal($F("FromAmountTextBox")).num,n=new Decimal($F("ToAmountTextBox")).num,i="",a="",o=0;$("bankFees")&&$("bankFees").visible()&&$("Amount_"+Currency.transferID)&&(o=new Decimal($F("Amount_"+Currency.transferID)).num,""!=Currency.transferLineType&&("SPENT"==Currency.transferLineType?e-=o:n+=o));var r=Globals.getValue("SourceAccount_completer"),s=Globals.getValue("DestAccount_completer");if(null!=r&&null!=r.current&&(i=r.current.data.getValue("CurrencyCode").replace("CURR/","")),null!=s&&null!=s.current&&(a=s.current.data.getValue("CurrencyCode").replace("CURR/","")),""!=i&&""!=a){var l="1 "+i+" = 0.000000 "+a+"<br/>1 "+a+" = 0.000000 "+i;if(0==e||0==n)Ext.fly("rateWarning"+Currency.transferID)&&0!=n&&Ext.fly("rateWarning"+Currency.transferID).setStyle("display","block"),Element.addClassName($("ExchangeRates"),"red");else{var u=Currency.sigFigs(n/e,6),c=Currency.sigFigs(1/u,6);if(new Decimal(u).num<0)l="<em>Mismatch</em>",Ext.fly("rateWarning"+Currency.transferID).setStyle("display","block"),Element.addClassName($("ExchangeRates"),"red");else{l="1 "+i+" = "+u+" "+a+"<br/>1 "+a+" = "+c+" "+i;var d=.1*t;u>=t-d&&u<=t+d?(Ext.fly("rateWarning"+Currency.transferID)&&Ext.fly("rateWarning"+Currency.transferID).setStyle("display","none"),Element.removeClassName($("ExchangeRates"),"red")):(Ext.fly("rateWarning"+Currency.transferID)&&Ext.fly("rateWarning"+Currency.transferID).setStyle("display","block"),Element.addClassName($("ExchangeRates"),"red"))}}$("ExchangeRates").update(l)}},createTip:function(t,e,n,i,a){var o=String.format("<em><strong>{0}</strong> {1}</em>",(i/a).toFixed(2),n),r=String.format("<span>1 {0} = {1} {2}</span>",n,Currency.sigFigs(a,6),e),s=String.format("<span>1 {0} = {1} {2}</span>",e,Currency.sigFigs(1/a,6),n);Currency.createExtToolTip(t,o+r+s)},createTipWithCustomHeaderLine:function(t,e,n,i,a,o){var r=String.format("<em>{0}</em>",o),s=String.format("<span>1 {0} = {1} {2}</span>",n,Currency.sigFigs(a,6),e),l=String.format("<span>1 {0} = {1} {2}</span>",e,Currency.sigFigs(1/a,6),n);Currency.createExtToolTip(t,r+s+l)},createExtToolTip:function(t,e){var n="currency_"+t;Currency.toolTips.containsKey(n)&&(Currency.toolTips.get(n).destroy(),Currency.toolTips.removeKey(n));var i=new Ext.ToolTip({target:n,cls:"currencyTip",dismissDelay:0,floating:!0,shadow:!1,anchorToTarget:!1,mouseOffset:[-100,-105],width:178,html:e});Currency.toolTips.add(n,i)},updateInvoiceTotalToolTip:function(){var t;t="undefined"!=typeof config&&null!=config?config.invoiceData.Invoice.CleanInvoiceID:$F("InvoiceID");var e=Globals.getValue("Currency_"+t+"_completer"),n=$("InvoiceDate_"+t),i=!1;if(null==n?i=!0:isFromInvoice?i=!0:""!=n.value&&(i=!0),null!=e&&null!=e.current&&i){var a,o=e.current,r=o.data.getValue("CurrencyAbbreviation");a=$("currencyRate")&&""!=$("currencyRate").innerHTML?$("currencyRate").innerHTML:o.data.getValue("CurrencyRate"),Currency.updateInvoiceTotalToolTipWithRateData(a,r)}},updateInvoiceTotalToolTipWithRateData:function(t,e){if($("invoiceTotal")){var n=new Decimal($F("invoiceTotal")).num;e=e.replace("CURR/",""),$("currency_exchangeTotal")&&(0!=n&&e!=defaultISOCurrency?(Currency.createTip("exchangeTotal",e,defaultISOCurrency,n,new Decimal(t).num),$("currency_exchangeTotal").show(),$("currency_exchangeTotal").update(e)):$("currency_exchangeTotal")&&$("currency_exchangeTotal").hide())}},getCrossRatePopup:function(t){var e=thisBankAmount<0,n=e?thisName:otherName,i=e?thisCurrencyCode:otherCurrencyCode,a=e?thisCurrencyRate:otherCurrencyRate,o=e?thisTransferAmount:otherTransferAmount,r=e?otherName:thisName,s=e?otherCurrencyCode:thisCurrencyCode,l=e?otherCurrencyRate:thisCurrencyRate,u=e?otherTransferAmount:thisTransferAmount,c="<div style='margin:1em;width:200;text-align:left'><strong>Source account</strong><br>"+n+" ("+i+")<br/><div style='border-bottom: 1px solid #cccccc;width:130px;'>1 "+defaultCurrencyCode+" = "+a+" "+i+"</div><div style='width:130px;text-align:right;'>"+o+" "+i+"</div><br/><strong>Target account</strong><br>"+r+" ("+s+")<br/><div style='border-bottom: 1px solid #cccccc;width:130px;'>1 "+defaultCurrencyCode+" = "+l+" "+s+"</div><div style='width:130px;text-align:right;'>"+u+" "+s+"</div><br/><strong>Cross-rate</strong><br><div>1 "+otherCurrencyCode+" = "+crossRate+" "+thisCurrencyCode+"</div></div>",d=new Ext.Window({id:"__crossrate__",title:"Currency cross-rate conversion",html:c,height:330,width:360});d.show(t),d.toFront()},validateMultiCurrencyPreEditions:function(t,e,n){var i="<div>You can add multi-currency functionality at any time. If you would like to test it out we advise you to do it in the demo company, accessible in <a href='#' onclick=\"parent.location.href='"+n+"Default.aspx'\">My Xero</a></div>",a="<div style='padding-bottom:10px;'><strong>Does your organisation use more than one currency?</strong></div>"+i+"<div style='border:3px solid #5fc02f;background-color:#fcfdff;color:#367c16;padding:6px 8px 8px 8px;line-height:150%;margin-top:10px;'>Multi-currency is free for you. <strong>You don't need to activate it now.</strong> As long as you are on this same pricing plan you will always have the option to use multi-currency for free.</div>";XERO.MsgBox.create(null,{html:a,title:"Currencies",buttons:[XERO.buttons.createButton({text:"Yes",type:"green",size:"medium",defaults:!0}),XERO.buttons.createButton({text:"No",type:"grey",size:"medium",cancel:!0})],handler:function(n,i){!0===i.cancel?Currency.closeUpgradePopup(e,t):!0===i.defaults&&(Ajax.SwitchMultiCurrencyOn(),-1==parent.location.href.indexOf("/Setup/CurrencyRates.aspx")?parent.location.href="/Setup/CurrencyRates.aspx":Windows.closeAll())}}).show()},upgradeToMultiCurrency:function(t,e,n,i,a,o){var r=a?"Currencies":"Upgrade",s="";s=a?"<div style='padding-bottom:10px;'><strong>Does your organisation use more than one currency?</strong></div><div style='padding-bottom:10px;'>You are currently trialling the "+i+" edition of Xero, if you would like to try Xero with multi-currency you can test it in the <a href='"+o+"Default.aspx'>demo organisation</a> or you can upgrade to "+n+" now</div>":"<div style='padding-bottom:10px;'>To do transactions in another currency you need to upgrade to the "+n+" edition of Xero</div>";var l="<div><strong> Going "+n+" will let you...</strong></div><br/><div class='upgrade'><em class='icons large-checkmark' style='margin-right:5px;'>&#160;</em><p>Send and receive sales invoices and bills in foreign currencies</p></div><div class='upgrade'><em class='icons large-checkmark' style='margin-right:5px;'>&#160;</em><p>Add and reconcile foreign currency bank accounts</p></div><div class='upgrade'><em class='icons large-checkmark' style='margin-right:5px;'>&#160;</em><p>Automatically record and report on your foreign currency gains and losses</p></div>",u=s+l,c="";c=e?"No, skip this step":"Cancel",XERO.MsgBox.create(null,{title:r,width:400,html:u,modal:!0,listeners:{destroy:function(){Currency.closeUpgradePopup(e,t)},scope:this},buttons:[XERO.buttons.createButton({text:"Upgrade Now...",type:"green",size:"medium",defaults:!0}),XERO.buttons.createButton({text:c,type:"grey",size:"medium",cancel:!0})],handler:function(n,i){!0===i.cancel?Currency.closeUpgradePopup(e,t):!0===i.defaults&&SubmitAction("Upgrade")}}).show()},closeUpgradePopup:function(t,e){null!=t&&1==t?SubmitAction("SetupWizard_Next"):null!=e&&""!=e?parent.location.href=e:Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().destroy()},onCurrencyIntellisense:function(t){var e=t.getToken().trim().toUpperCase(),n=!1;if(""==e)return t.localData;for(var i=[],a=t.localData.length,o="",r=0;r<a;r++)if(o=t.localData[r].value.toUpperCase(),(t.localData[r].data.keys.length>0||-1!=t.localData[r].key.indexOf("CURR/")&&"CURR/NON"!=t.localData[r].key)&&-1!=o.indexOf(e)&&(o==e&&(n=!0),i.push(t.localData[r]),n))return i;return i}}),XERO&&XERO.widget&&(XERO.widget.Currency={position:function(t,e){e.setPositioning(Ext.get(t).getPositioning()).set({style:{margin:"0"}}).set({style:{position:"absolute",margin:"2px 0 0 125px"}})}})},function(t,e){!function(){Ext.define("XERO.help.Prompt",{extend:"Ext.Component",renderTo:"xn_banner",bus:null,closeEl:null,closeHandler:null,afterRenderHandler:null,promptKey:null,bannerContainerEl:null,style:{height:"0",opacity:"0"},tpl:new Ext.XTemplate('<div class="notify bg-orange bigger">','<em class="message-icon"></em>','<tpl if="values.Closeable === true">','<a href="#" class="icons msg-close">&#160;</a>',"</tpl>",'<div class="message">','<p id="helpPromptMessage"><span>{Message}</span></p>',"</div>","</div>",{compiled:!0}),constructor:function(t){this.bus=XERO.bus,this.closeHandler=t.CloseHandler,this.afterRenderHandler=t.AfterRenderHandler,this.data={Message:t.Message,Closeable:t.Closeable},this.promptKey=t.PromptKey,this.callParent(arguments)},listeners:{afterrender:function(){var t=this;t.closeEl=t.el.child(".msg-close"),t.initEvents(),this.afterRenderHandler&&this.afterRenderHandler(),Ext.defer(t.animateShow,500,t)}},animateShow:function(){this.el.animate({height:{from:0,to:72}},.4,function(t){t.animate({opacity:{from:0,to:1}},.2)})},initEvents:function(){this.closeEl&&this.closeEl.on("click",this.onCloseClick,this,{preventDefault:!0})},onCloseClick:function(t){this.closePrompt()},closePrompt:function(){var t=!0;this.closeHandler&&!1===this.closeHandler()&&(t=!1),t&&this.destroy()}})}()},function(t,e){XERO.help.PagePrompts=XERO.help.PagePrompts||function(){function t(){var t;Ext.versions?XERO.url&&(h=XERO.url.promptsConfig):h=XERO.data.promptsConfig,h&&(t=h.loadPromptUrl)&&a(t)}function e(){Ext.fly("helpPromptMessage").on("click",n,this,{delegate:"a"})}function n(t,e){var n,a,o=e.getAttribute("data-action"),r=arguments;i(o),(a=e.getAttribute("data-click"))&&"function"==typeof(n=c[a])&&Ext.defer(function(){n.apply(this,r)},100,this)}function i(t){var e=d.promptKey;XERO.prompts.Tracking.track({prompt:e,action:t})}function a(t){Ext.Ajax.request({url:t,method:"GET",success:o,failure:r})}function o(t,e){if(t.responseText){var n=Ext.decode(t.responseText);n&&l(n)}}function r(t,e){XERO.MsgBox.alert("There was an error problem with page notifications, please contact support.","Uh oh!")}function s(t){d=XERO.ux.BannerMessages.create(Ext.String.format('<p id="helpPromptMessage"><span>{0}</span></p>',t.Message),"orange",!1,t.Closeable)}function l(t){Ext.versions?d=s(t):(t.CloseHandler=c[t.CloseHandler],t.AfterRenderHandler=c[t.AfterRenderHandler],d=new XERO.help.Prompt(t)),e()}function u(t){t=t||Ext.emptyFn,Ext.Ajax.request({method:"GET",url:h.hidePromptUrl,success:t,failure:r})}var c,d,h={};return c={hidePrompt:function(){i("CloseInAppPrompt"),u()},coaInit:function(){function t(){d.destroy()}XERO.bus.on("account:add",t),XERO.bus.on("account:edit",t)},balanceSheetClickYes:function(t,e){t.preventDefault(),d.closePrompt(),u(function(){window.location.reload()})},balanceSheetClickNo:function(t,e){var n=e.href;t.preventDefault(),d.closePrompt(),u(function(){window.location.href=n})},balanceSheetClickFYE:function(t,e){var n=e.href;t.preventDefault(),d.closePrompt(),u(function(){window.location.href=n})}},Ext.onReady(function(){t()}),{}}()},function(t,e){!function(){"use strict";function t(t,e){var n=t.textContent||t.innerText;return e=e||{},e.Class=t.className,e.Label=Ext.isEmpty(n)?t.className:n,e}function e(e,n){XERO.analytics.Analytics.trackLinks(Ext.query(".balance .xbtn",n),e,function(e){var n=Ext.query("#itemsToRecCount",e)[0];return t(e,{"Bank Account Action":"Reconcile","Reconcile Number of Items":n.textContent||n.innerText})}),XERO.analytics.Analytics.trackLinks(Ext.query(".activate .xbtn,.imports .xbtn",n),e,function(e){return t(e,{"Bank Account Action":"Get Bank Feed"})}),XERO.analytics.Analytics.trackLinks(Ext.query(".activate .manual",n),e,function(e){return t(e,{"Bank Account Action":"Import Statement"})}),XERO.analytics.Analytics.trackLinks(Ext.query(".bank-header .select a",n),e,function(e){return t(e,{"Bank Account Action":"Manage Menu"})})}function n(e){XERO.analytics.Analytics.trackLinks(Ext.query(".manage-account-menu-item > a, .manage-account-menu-column > a"),e,function(e){return t(e)})}Ext.define("XERO.analytics.BankAccounts",{singleton:!0,trackDashboardBankActivity:function(){XERO.analytics.Analytics.onAnalyticsReady(function(){XERO.analytics.Analytics.isTrial()&&e("Dashboard Box Click",Ext.query("#dashboardColumns")[0])},this)},trackBankRecActivity:function(e){XERO.analytics.Analytics.onAnalyticsReady(function(){if(XERO.analytics.Analytics.isTrial()){XERO.analytics.Analytics.trackLinks(".green-box .xbtn","Bank Reconciliation Click",function(n){return t(n,{"Bank Rec Action":"Get Bank Feed","Bank Account Type":e})}),XERO.analytics.Analytics.trackLinks(".gs-container a","Getting Started",function(n){return t(n,{"Getting Started Type":"Bank Reconciliation","Bank Rec Action":"Getting Started","Bank Account Type":e})}),XERO.analytics.Analytics.trackLinks("#ItemsToReconcile .rule a","Bank Reconciliation Click",function(n){return t(n,{"Bank Rec Action":"Create rule","Bank Account Type":e})}),XERO.analytics.Analytics.trackLinks("#ItemsToReconcile .tabs a","Bank Reconciliation Click",function(n){return t(n,{"Bank Rec Action":"Tab Change","Bank Account Type":e})})}n("Bank Rec: Manage Links")},this)},trackReconcileTo:function(t){XERO.analytics.Analytics.isTrial()&&(t["Bank Rec Action"]="Reconcile To",XERO.analytics.Analytics.track("Bank Reconciliation Click",t))},trackBankAccountsActivity:function(){XERO.analytics.Analytics.onAnalyticsReady(function(){if(XERO.analytics.Analytics.isTrial()){var i=Ext.query(".bank-accounts")[0];e("Bank Accounts Click",i),XERO.analytics.Analytics.trackLinks(Ext.query(".trackItem a, a.trackItem",i),"Bank Accounts Click",function(e){return t(e,{"Bank Account Action":"Bank Accounts Button Bar"})})}n("Bank Accounts: Manage Links")})},trackBankTransactionsActivity:function(){XERO.analytics.Analytics.onAnalyticsReady(function(){if(XERO.analytics.Analytics.isTrial()){var e=Ext.query(".bridge-upper");XERO.analytics.Analytics.trackLinks(Ext.query(".bank-summary .last-import a",e),"Bank Transactions Click",function(e){return t(e,{"Bank Transactions Action":"Summary Click"})}),XERO.analytics.Analytics.trackLinks(Ext.query(".bank-summary .select a",e),"Bank Transactions Click",function(e){return t(e,{"Bank Transactions Action":"Manage Menu"})}),XERO.analytics.Analytics.trackLinks(".green-box .xbtn","Bank Transactions Click",function(e){return t(e,{"Bank Transactions Action":"Get Bank Feed"})})}n("Bank Transactions: Manage Links")})}})}()},function(t,e){!function(){"use strict";Ext.define("XERO.fraudbuster.Messaging",{singleton:!0,highRiskEmailSend:function(){Ext.Ajax.request({url:"/Ajax/FraudBuster/ResendVerificationEmail",method:"POST",success:function(){Ext.get("riskyLoginMessage").toggleClass("x-hidden"),Ext.get("riskyLoginConfirmation").toggleClass("x-hidden")},failure:function(){Ext.get("riskyLoginMessage").toggleClass("x-hidden"),Ext.get("riskyLoginSendingEmailError").toggleClass("x-hidden")}})},highRiskEmailRetrySend:function(){Ext.Ajax.request({url:"/Ajax/FraudBuster/ResendVerificationEmail",method:"POST",success:function(){Ext.get("riskyLoginConfirmation").toggleClass("x-hidden"),Ext.get("riskyLoginSendingEmailError").toggleClass("x-hidden")},failure:function(){}})}})}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(78),n(73),n(62),n(343),n(74),n(75),n(76),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(82),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(83),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(84),n(389),n(390),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(446),n(447),n(448),n(449),n(85),n(86),n(450),n(39),n(87),n(451),n(452),n(453),n(454),n(455),n(456),n(457),n(458),n(459),n(460),n(88)},function(t,e){XERO.util.Precision={UNITAMOUNT:4}},function(t,e){window.Now=function(){return new Date},window.getDayInt=function(t){switch(t){case"Sunday":return SUNDAY;case"Monday":return MONDAY;case"Tuesday":return TUESDAY;case"Wednesday":return WEDNESDAY;case"Thursday":return THURSDAY;case"Friday":return FRIDAY;case"Saturday":return SATURDAY;default:throw"Invalid day index: "+t.toString()}},window.JANUARY=0,window.FEBRUARY=1,window.MARCH=2,window.APRIL=3,window.MAY=4,window.JUNE=5,window.JULY=6,window.AUGUST=7,window.SEPTEMBER=8,window.OCTOBER=9,window.NOVEMBER=10,window.DECEMBER=11,window.SUNDAY=0,window.MONDAY=1,window.TUESDAY=2,window.WEDNESDAY=3,window.THURSDAY=4,window.FRIDAY=5,window.SATURDAY=6,window.SECONDS_CF=1e3,window.MINUTES_CF=6e4,window.HOURS_CF=36e5,window.DAYS_CF=864e5,window.WEEKS_CF=6048e5,window.FORTNIGHTS_CF=12096e5,window.MONTHS_CF=2592e6,window.QUARTERS_CF=7776e6,window.YEARS_CF=315576e5,window.DECADES_CF=315576e6,window.CENTURIES_CF=315576e7,Date.prototype.subtractMilliseconds=function(t){return new Date((new Date).setTime(this.getTime()-t))},Date.prototype.subtractSeconds=function(t){return this.subtractMilliseconds(t*SECONDS_CF)},Date.prototype.subtractMinutes=function(t){return this.subtractMilliseconds(t*MINUTES_CF)},Date.prototype.subtractHours=function(t){return this.subtractMilliseconds(t*HOURS_CF)},Date.prototype.subtractDays=function(t){return this.subtractMilliseconds(t*DAYS_CF)},Date.prototype.subtractWeeks=function(t){return this.subtractMilliseconds(t*WEEKS_CF)},Date.prototype.subtractFortnights=function(t){return this.subtractMilliseconds(t*FORTNIGHTS_CF)},Date.prototype.subtractMonths=function(t){return this.subtractMilliseconds(t*MONTHS_CF)},Date.prototype.subtractYears=function(t){return this.subtractMilliseconds(t*YEARS_CF)},Date.prototype._addMilliseconds=function(t){return this.setTime(this.getTime()+t),this},Date.prototype._addSeconds=function(t){return this._addMilliseconds(t*SECONDS_CF)},Date.prototype._addMinutes=function(t){return this._addMilliseconds(t*MINUTES_CF)},Date.prototype._addHours=function(t){return this._addMilliseconds(t*HOURS_CF)},Date.prototype._addDays=function(t){return this._addMilliseconds(t*DAYS_CF)},Date.prototype._addWeeks=function(t){return this._addMilliseconds(t*WEEKS_CF)},Date.prototype._addFortnights=function(t){return this._addMilliseconds(t*FORTNIGHTS_CF)},Date.prototype._addMonths=function(t){return this._addMilliseconds(t*MONTHS_CF)},Date.prototype._addYears=function(t){return this._addMilliseconds(t*YEARS_CF)},Date.prototype._subtractMilliseconds=function(t){return this.setTime(this.getTime()-t),this},Date.prototype._subtractSeconds=function(t){return this._subtractMilliseconds(t*SECONDS_CF)},Date.prototype._subtractMinutes=function(t){return this._subtractMilliseconds(t*MINUTES_CF)},Date.prototype._subtractHours=function(t){return this._subtractMilliseconds(t*HOURS_CF)},Date.prototype._subtractDays=function(t){return this._subtractMilliseconds(t*DAYS_CF)},Date.prototype._subtractWeeks=function(t){return this._subtractMilliseconds(t*WEEKS_CF)},Date.prototype._subtractFortnights=function(t){return this._subtractMilliseconds(t*FORTNIGHTS_CF)},Date.prototype._subtractMonths=function(t){return this._subtractMilliseconds(t*MONTHS_CF)},Date.prototype._subtractYears=function(t){return this._subtractMilliseconds(t*YEARS_CF)},Date.prototype.getMonthName=function(){var t=0==arguments.length?this.getMonth():arguments[0];switch(t){case JANUARY:return"January";case FEBRUARY:return"February";case MARCH:return"March";case APRIL:return"April";case MAY:return"May";case JUNE:return"June";case JULY:return"July";case AUGUST:return"August";case SEPTEMBER:return"September";case OCTOBER:return"October";case NOVEMBER:return"November";case DECEMBER:return"December";default:throw"Invalid month index: "+t.toString()}},Date.prototype.getMonthAbbreviation=function(){var t=0==arguments.length?this.getMonth():arguments[0];switch(t){case JANUARY:return"Jan";case FEBRUARY:return"Feb";case MARCH:return"Mar";case APRIL:return"Apr";case MAY:return"May";case JUNE:return"Jun";case JULY:return"Jul";case AUGUST:return"Aug";case SEPTEMBER:return"Sep";case OCTOBER:return"Oct";case NOVEMBER:return"Nov";case DECEMBER:return"Dec";default:throw"Invalid month index: "+t.toString()}},Date.prototype.getDayName=function(){var t=0==arguments.length?this.getDay():arguments[0];switch(t){case SUNDAY:return"Sunday";case MONDAY:return"Monday";case TUESDAY:return"Tuesday";case WEDNESDAY:return"Wednesday";case THURSDAY:return"Thursday";case FRIDAY:return"Friday";case SATURDAY:return"Saturday";default:throw"Invalid day index: "+t.toString()}},Date.prototype.getDayAbbreviation=function(){var t=0==arguments.length?this.getDay():arguments[0];switch(t){case SUNDAY:return"Sun";case MONDAY:return"Mon";case TUESDAY:return"Tue";case WEDNESDAY:return"Wed";case THURSDAY:return"Thu";case FRIDAY:return"Fri";case SATURDAY:return"Sat";default:throw"Invalid day index: "+t.toString()}},Date.prototype.getCivilianHours=function(){return this.getHours()<12?this.getHours():this.getHours()-12},Date.prototype.getMeridiem=function(){return this.getHours()<12?"AM":"PM"},Date.prototype.to_s=Date.prototype.toString,Date.prototype.getDaysInMonth=function(){switch(this.getMonth()){case JANUARY:return 31;case FEBRUARY:return this.isLeapYear()?29:28;case MARCH:return 31;case APRIL:return 30;case MAY:return 31;case JUNE:return 30;case JULY:case AUGUST:return 31;case SEPTEMBER:return 30;case OCTOBER:return 31;case NOVEMBER:return 30;case DECEMBER:return 31}},Date.prototype.toString=function(){return 0==arguments.length||1<arguments.length?this.to_s():this.format(arguments[0].toString())},Date.prototype.isLeapYear=function(){return 0==this.getFullYear()%400||0!=this.getFullYear()%100&&0==this.getFullYear()%4},Date.prototype.zeroTime=function(){var t=this.clone();return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},Date.prototype.noon=function(){var t=this.clone();return t.setHours(12),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},Date.prototype.firstDayOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),1,12,0,0)},Date.prototype.lastDayOfMonth=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth(),12,0,0)},Date.prototype.clone=function(){var t=new Date;return t.setTime(this.getTime()),t},Date.yesterday=function(){return(new Date).noon().subtractDays(1)},Date.today=function(){return(new Date).noon()},Date.tomorrow=function(){return(new Date).noon().addDays(1)},Date.lastWeek=function(){return(new Date).noon().subtractWeeks(1)},Date.nextWeek=function(){return(new Date).noon().addWeeks(1)},Date.lastMonth=function(){return(new Date).noon().subtractMonths(1)},Date.nextFortnight=function(){return(new Date).noon().addFortnights(1)},Date.lastFortnight=function(){return(new Date).noon().subtractFortnights(1)},Date.nextMonth=function(){return(new Date).noon().addMonths(1)},Date.lastYear=function(){return(new Date).noon().subtractYears(1)},Date.nextYear=function(){return(new Date).noon().addYears(1)},Number.prototype.millisecondsFromNow=function(){return(new Date).addMilliseconds(this)},Number.prototype.millisecondFromNow=function(){return this.millisecondsFromNow()},Number.prototype.secondsFromNow=function(){return(new Date).addSeconds(this)},Number.prototype.secondFromNow=function(){return this.secondsFromNow()},Number.prototype.minutesFromNow=function(){return(new Date).addMinutes(this)},Number.prototype.minuteFromNow=function(){return this.minutesFromNow()},Number.prototype.daysFromNow=function(){return(new Date).addDays(this)},Number.prototype.dayFromNow=function(){return this.daysFromNow()},Number.prototype.weeksFromNow=function(){return(new Date).addWeeks(this)},Number.prototype.weekFromNow=function(){return this.weeksFromNow()},Number.prototype.fortnightsFromNow=function(){return(new Date).addFortnights(this)},Number.prototype.fortnightFromNow=function(){return this.fortnightsFromNow()},Number.prototype.monthsFromNow=function(){return(new Date).addMonths(this)},Number.prototype.monthFromNow=function(){return this.monthsFromNow()},Number.prototype.yearsFromNow=function(){return(new Date).addYears(this)},Number.prototype.yearFromNow=function(){return this.yearsFromNow()},Number.prototype.millisecondsAgo=function(){return(new Date).subtractMilliSeconds(this)},Number.prototype.millisecondAgo=function(){return this.millisecondsAgo()},Number.prototype.secondsAgo=function(){return(new Date).subtractSeconds(this)},Number.prototype.secondAgo=function(){return this.secondsAgo()},Number.prototype.minutesAgo=function(){return(new Date).subtractMinutes(this)},Number.prototype.minuteAgo=function(){return this.minutesAgo()},Number.prototype.hoursAgo=function(){return(new Date).subtractHours(this)},Number.prototype.hourAgo=function(){return this.hoursAgo()},Number.prototype.daysAgo=function(){return(new Date).subtractDays(this)},Number.prototype.dayAgo=function(){return this.daysAgo()},Number.prototype.weeksAgo=function(){return(new Date).subtractWeeks(this)},Number.prototype.weekAgo=function(){return this.weeksAgo()},Number.prototype.fortnightsAgo=function(){return(new Date).subtractFortnights(this)},Number.prototype.fortnightAgo=function(){return this.fortnightsAgo()},Number.prototype.monthsAgo=function(){return(new Date).subtractMonths(this)},Number.prototype.monthAgo=function(){return this.monthsAgo()},Number.prototype.yearsAgo=function(){return(new Date).subtractYears(this)},Number.prototype.yearAgo=function(){return this.yearsAgo()},window.TimeSpan=function(t){this.milliseconds=Math.abs(t),this.seconds=Math.round(this.milliseconds/SECONDS_CF),this.minutes=Math.round(this.milliseconds/MINUTES_CF),this.hours=Math.round(this.milliseconds/HOURS_CF),this.days=Math.round(this.milliseconds/DAYS_CF),this.weeks=Math.round(this.milliseconds/WEEKS_CF),this.fortnights=Math.round(this.milliseconds/FORTNIGHTS_CF),this.months=Math.round(this.milliseconds/MONTHS_CF),this.quarters=Math.round(this.milliseconds/QUARTERS_CF),this.years=Math.round(this.milliseconds/YEARS_CF),this.decades=Math.round(this.milliseconds/DECADES_CF),this.centuries=Math.round(this.milliseconds/CENTURIES_CF)},TimeSpan.prototype.toString=function(){return this.milliseconds.toString()}},function(t,e){XERO.util.calcGST=function(t,e,n){if(t=void 0==t.num?Decimal.FOUR(t):t,e=void 0==e.num?Decimal.FOUR(e):e,n){var i=(1e4*t.num/(e.num+100)).toString();if(".5"==i.substr(i.length-2)){var a=new Decimal;return Decimal.FOUR(a.subtract(t.num,(a.multiply(t.num,100)/(e.num+100)).toFixed(2)))}return Decimal.FOUR(t.num-(100*t.num/(100+e.num)).toFixed(2))}return Decimal.FOUR((t.num*e.num/100).toFixed(4))}},function(t,e){XERO.util.String={trim:function(t){return t.strip()},trimSpaces:function(t){var e=t,n=/(\s*)+/g;return e=e.replace(n,"")," "==e&&(e=""),e},trimAll:function(t,e){for(var n=0;n<e.length;n++)for(var i=e[n];-1!=(t=t.replace(i,"")).indexOf(i););return t},formatAsCommaNumber:function(t,e){var n="",i=null,a=new String(t);if("("!=a.charAt(0)&&"-"!=a.charAt(0)||(i="-"),"-"==(a=this.trimAll(a,["(",")",","])))return a;if(isNaN(a)||0===a.length)return"0";("-"==a.charAt(0)||"+"==a.charAt(0)&&!i)&&(i=a.charAt(0),a=a.substr(1,a.length-1));var o=null,r=a.lastIndexOf(".");for(-1!=r&&(o=a.substr(r,a.length-r),a=a.substr(0,r));a.length>3;)n=","+a.substr(a.length-3,3)+n,a=a.substr(0,a.length-3);return n=a+n,o&&(n+=o),e?"-"==i&&(n="("+n+")"):"+"!=i&&"-"!=i||(n=i+n),n},format:function(t,e){var n=function(t,e){var n=function(t){return"number"==typeof t?Number:"boolean"==typeof t?Boolean:"string"==typeof t?String:t.constructor}(t),i=n.prototype,a="string"!=typeof t?i?i.format||i.toString:t.format||t.toString:t.toString;return a?void 0===e||""==e?a.call(t):a.call(t,e):""};return 1==arguments.length?function(){return String.format.apply(null,[t].concat(Array.prototype.slice.call(arguments,0)))}:(2==arguments.length&&"object"!=typeof e&&"array"!=typeof e&&(e=[e]),arguments.length>2&&(e=Array.prototype.slice.call(arguments,1)),t=t.replace(/\{\{|\}\}|\{([^}: ]+?)(?::([^}]*?))?\}/g,function(t,i,a){return"{{"==t?"{":"}}"==t?"}":void 0!==e[i]&&null!==e[i]?n(e[i],a):""}))},htmlEncode:function(t){if(void 0==t||""==t)return"";var e=document.createTextNode(t),n=document.createElement("div");return n.appendChild(e),n.innerHTML},htmlDecode:function(t){if(void 0==t||""==t)return"";var e=document.createElement("div");return e.innerHTML=t,e.childNodes[0].nodeValue}},String.prototype.format=function(){return XERO.util.String.format(this,1==arguments.length?arguments[0]:arguments)}},function(t,e){void 0===Ext.util&&(Ext.util={}),Ext.util.base64={base64s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encode:function(t){if("function"==typeof btoa)return btoa(t);for(var e,n,i=this.base64s,a=0,o="";t.length>=a+3;)e=(255&t.charCodeAt(a++))<<16|(255&t.charCodeAt(a++))<<8|255&t.charCodeAt(a++),o+=i.charAt((16515072&e)>>18)+i.charAt((258048&e)>>12)+i.charAt((4032&e)>>6)+i.charAt(63&e);return t.length-a>0&&t.length-a<3&&(n=Boolean(t.length-a-1),e=(255&t.charCodeAt(a++))<<16|(n?(255&t.charCodeAt(a))<<8:0),o+=i.charAt((16515072&e)>>18)+i.charAt((258048&e)>>12)+(n?i.charAt((4032&e)>>6):"=")+"="),o},decode:function(t){if("function"==typeof atob)return atob(t);for(var e,n=this.base64s,i="",a=0;a<t.length;a+=4)e=(255&n.indexOf(t.charAt(a)))<<18|(255&n.indexOf(t.charAt(a+1)))<<12|(255&n.indexOf(t.charAt(a+2)))<<6|255&n.indexOf(t.charAt(a+3)),i+=String.fromCharCode((16711680&e)>>16,(65280&e)>>8,255&e);return 61==t.charCodeAt(a-2)?i.substring(0,i.length-2):61==t.charCodeAt(a-1)?i.substring(0,i.length-1):i}}},function(t,e){void 0===XERO.bus&&(XERO.bus=new Ext.util.Observable)},function(t,e){Ext.ns("XERO.util.HTMLString"),XERO.util.HTMLString=function(){function t(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function e(n,i){return e.isHTMLString(n)?n:this instanceof e?(n=n||"",void(this.value=!0===i?n:t(n))):new e(n,i)}return e.isHTMLString=function(t){return null!=t&&t.isHTMLString===e.prototype.isHTMLString},e.prototype.isHTMLString="afzav5udc0-1r3y2og6xog-1xpzc8wpmv4",e.safe=function(t){return new e(t,!0)},e.unsafe=function(t){return new e(t,!1)},e.prototype.toString=function(){return this.value},e.prototype.format=function(t){var n=this.value.replace(/\{(\d+)\}/g,function(n,i){return e.unsafe(t[+i])});return e.safe(n)},e.format=function(t){var n=[].slice.call(arguments,1);return e.safe(t).format(n)},e}()},function(t,e){Ext.ns("XERO.util.Dom"),XERO.util.Dom.findFirstFocusableFormElement=function(t){var e,n,i=null;for(t=t||document,n=t.querySelectorAll("input, select"),e=0;e<n.length&&(i=n[e],"hidden"===i.type);e++);return i},XERO.util.Dom.focusFirstFormElement=function(t){var e=XERO.util.Dom.findFirstFocusableFormElement(t);if(e)try{e.focus()}catch(t){}}},function(t,e){Ext.ns("XERO.util.IntellisenseComparators"),XERO.util.IntellisenseComparators.containsComparator=function(t,e){return-1!==e.indexOf(t)},XERO.util.IntellisenseComparators.startsWithComparator=function(t,e){return 0===e.indexOf(t)}},function(t,e){Ext.ns("XERO.util.Form"),XERO.util.Form.serialize=function(t,e){var n=Ext.get(t),i=e||"input",a=Ext.DomQuery.jsSelect(i,n.dom),o={};return Ext.each(a,function(t){o[t.id]=t.value}),o}},function(t,e){!function(){"use strict";window.XERO=XERO||{},window.XERO.util=XERO.util||{};var t,e=[];XERO.util.FrameLoader={init:function(e,n){if(e){var i=this;t=n||document.body,function(){e.on("frameloader:load",function(t,e,n){i.loadFrameHandler(t,e,n)})}()}},configIsValid:function(t){return!!(t&&t.id&&t.url)},loadFrameHandler:function(t,e,n){if(this.configIsValid(t)){var i=this.getFrame(t.id);i?n?n(i):e(i):(i=this.buildFrame(t),i.addEventListener("load",function(t){e&&e(t.target)}))}},getFrame:function(t){for(var n,i=0,a=e.length;i<a;i++)if(n=e[i],n.id===t)return n},buildFrame:function(n){var i={display:"none","background-color":"transparent",height:"100vh",width:"100vw",position:"absolute",top:"0",bottom:"0",left:"0",right:"0","z-index":2};n.style&&Object.keys(n.style).forEach(function(t){i[t]=n.style[t]});var a=document.createElement("iframe");return a.setAttribute("id",n.id),a.setAttribute("src",n.url),a.setAttribute("frameborder",0),a.setAttribute("border",0),a.setAttribute("scrolling","no"),a.setAttribute("marginheight",0),a.setAttribute("marginwidth",0),a.setAttribute("allowtransparency","true"),a.setAttribute("style",function(t){var e="";return Object.keys(t).forEach(function(n){e+=n+":"+t[n]+";"}),e}(i)),e.push({id:n.id,el:a}),t.appendChild(a),a}}}()},function(t,e){Ext.define("XERO.util.ElementInViewport",function(){function t(t){for(var e=t,n=0;e&&"body"!==e.tagName.toLowerCase();)n+=e.offsetTop,e=e.offsetParent;return n}function e(){var t=document.documentElement;return window.innerWidth?window.innerHeight:t&&!isNaN(t.clientHeight)?t.clientHeight:0}function n(){return window.pageYOffset?window.pageYOffset:Math.max(document.documentElement.scrollTop,document.body.scrollTop)}return{singleton:!0,isInViewPort:function(i){var a=e(),o=n();return t(i)<=a+o}}}())},function(module,exports){Object.extend(Ext.Window.DD.prototype,{startDrag:function(){var t=this.win;if(this.proxy=t.ghost(t.initialConfig.cls||null),!1!==t.constrain){var e=t.el.shadowOffset;this.constrainTo(t.container,{right:e,left:e,bottom:e})}else if(!1!==t.constrainHeader){var n=this.proxy.getSize();this.constrainTo(t.container,{right:-(n.width-this.headerOffsets[0]),bottom:-(n.height-this.headerOffsets[1])})}}},!0),Ext.apply(Ext.Element.prototype,{blindUp:function(t){var e=this.getFxEl();return t=t||{},e.queueFx(t,function(){this.clearOpacity(),this.clip();var n=this.getFxRestore(),i=this.dom.style,a=function(){t.useDisplay?e.setDisplayed(!1):e.hide(),e.clearOpacity(),e.setPositioning(n.pos),i.width=n.width,i.height=n.height,e.afterFx(t)};this.fxanim({height:{to:1},points:{by:[0,.5*this.getHeight()]}},t,"motion",.3,"easeIn",a)}),this}}),window.updateRowSelection=function(t){var e=t.parentNode.parentNode;t.checked?Element.addClassName(e,"selected"):Element.removeClassName(e,"selected")},window.hoverRow=function(t,e){""==t.className&&(t.className="off"),e?Element.hasClassName(t,"off")&&(Element.removeClassName(t,"off"),Element.addClassName(t,"on")):Element.hasClassName(t,"on")&&(Element.removeClassName(t,"on"),Element.addClassName(t,"off"))},window.XsltControls={},Object.extend(XsltControls,{createCalendar:function(t,e,n,i){alert("You're using the old date control. Don't. Talk to Craig")},createAutoCompleter:function(t,e){new XERO.widget.Autocompleter(t,"div"+t+"Completer",["ZZ"],{selector:function(t){return XsltControls.autoCompleteSelector(e,t)},frequency:0})},autoCompleteSelector:function(ajaxFunctionToCall,instance){var results=[];return eval("var res = "+ajaxFunctionToCall+"(instance.getToken());"),res.value.each(function(t,e){results[e]="<li>"+t+"</li>"}),"<ul>"+results.join("")+"</ul>"}})},function(t,e){XERO.util.EnterListener=function(t,e){this.submitButton=$(e),t=$(t),Event.observe(t,"keypress",this.fire.bind(this))},XERO.util.EnterListener.prototype={fire:function(t){switch(t.keyCode){case Event.KEY_RETURN:this.submitButton.click(),Event.stop(t)}}},XERO.util.AddTab=function(t,e,n){Ext.get(t).on("keypress",function(t){switch(t.getKey()){case 9:var i=t.shiftKey?n:e;Ext.get(i).focus(),Ext.EventObject.stopEvent()}},this)},XERO.util.Submit=function(t,e){this.button=Ext.get(e),Ext.get(t).on("keypress",this.fire,this)},XERO.util.Submit.prototype={fire:function(t,e){var n=t.getKey();if("A"==Ext.get(e).dom.tagName)return!1;13==n&&("A"==this.button.dom.tagName?this.button.dom.onclick():this.button.child("a").dom.onclick(),XERO.widget.Buttons.cache.get(this.button.dom.id).click())}},XERO.util.ExactField=function(t,e,n,i){this.el=Ext.get(t),this.hide=Ext.get(e),this.container=Ext.get(n),this.el.on("click",this.toggle,this),"amount"==i&&(this.amount=!0),"date"==i&&(this.date=!0),this.toggle()},XERO.util.ExactField.prototype={toggle:function(){this.el.dom.checked?(this.disable(),this.container.setStyle("display","none")):(this.enable(),this.container.setStyle("display","block"))},enable:function(){this.hide.dom.disabled=!1,this.amount&&Ext.fly("lbl_sb_txtMinAmount").update("Minimum Amount"),this.date&&Ext.fly("lbl_sb_dteStartDate").update("Start Date")},disable:function(){this.hide.dom.value="",this.hide.dom.disabled=!0,this.amount&&Ext.fly("lbl_sb_txtMinAmount").update("Amount"),this.date&&Ext.fly("lbl_sb_dteStartDate").update("Date")}},XERO.util.FileUpload=function(t){this.el=Ext.get(t),this.input=this.el.child("input.file"),this.text=this.el.child("div"),this.init(),this.input.on("change",this.init,this),this.input.on("mousemove",this.mousemove,this),this.input.on("mouseout",this.mouseout,this)},XERO.util.FileUpload.prototype={init:function(){var t=this.input.getValue();if(""==t)this.text.update("No file selected");else{try{t=t.substr(t.lastIndexOf("\\")+1)}catch(t){}t=Ext.util.Format.ellipsis(t,35),this.text.update(Ext.util.Format.htmlEncode(t))}},click:function(){this.input.dom.click()},mousemove:function(){this.el.addClass("over")},mouseout:function(){this.el.removeClass("over")}},XERO.util.createThrottled=function(t,e,n){function i(){t.apply(n||this,o),a=Date.now()}var a,o,r;return function(){var t=Date.now()-a;o=arguments,clearTimeout(r),!a||t>=e?i():r=setTimeout(i,e-t)}}},function(t,e){!function(){var t={autoCompleterRecord:Ext.data.Record.create([{name:"key"},{name:"value"},{name:"html"},{name:"data"},{name:"ignore"},{name:"hidden"}]),getSuperclassConstructorConfig:function(t){return{autoLoad:!0,data:t||[],reader:new Ext.data.JsonReader({id:"key"},this.autoCompleterRecord)}},getData:function(t){var e=this.getById(t);return e?e.data:null},createRecord:function(t,e,n,i,a,o){return new this.autoCompleterRecord({key:t,value:e,html:n,data:i,ignore:a,hidden:o||!1})},memoryFilter:function(t,e){e=Ext.util.Format.htmlEncode(e);var n=function(t,e){return t.set("html",XERO.util.emphasizeText(t.get("value"),e)),t.set("emphasised",!0),t},i=XERO.data.AutoCompleterStore.superclass.createFilterFn.call(this,t,e,!0,!1);return XERO.data.AutoCompleterStore.superclass.filterBy.call(this,function(t,a){return i?!0!==t.get("ignore")&&(!!i(t)&&(this.emphasisFilterResults&&n(t,XERO.util.escapeRegexSpecialCharacters(e)),!0)):(this.emphasisFilterResults&&(t.set("html",null),t.set("emphasised",!1)),!0)},this)}};XERO.data.AutoCompleterStore=function(e){this.autoCompleterRecord=t.autoCompleterRecord,XERO.data.AutoCompleterStore.superclass.constructor.call(this,t.getSuperclassConstructorConfig(e))},Ext.extend(XERO.data.AutoCompleterStore,Ext.data.Store,{emphasisFilterResults:!1,clearHtmlEmphasis:function(){this.data.items.forEach(function(t){!0!==t.get("ignore")&&(t.set("html",null),t.set("emphasised",!1))})},filter:function(e,n){return t.memoryFilter.call(this,e,n)},getData:t.getData,createRecord:t.createRecord}),XERO.data.InventoryAutoCompleterStore=function(e,n){this.totalItems=n,this.autoCompleterRecord=t.autoCompleterRecord,XERO.data.InventoryAutoCompleterStore.superclass.constructor.call(this,t.getSuperclassConstructorConfig(e))},Ext.extend(XERO.data.InventoryAutoCompleterStore,Ext.data.Store,{emphasisFilterResults:!1,filtered:!1,ajaxSearchLevel:6e3,ajaxSearchLimit:1e3,inventoryFilterEndPoint:"/Lookup/SearchPriceListItems",lastToken:null,setLoadingState:function(t){this.loadData([{key:"",html:"<div class='loading-indicator'>Finding items...</div>",data:Data.Dictionary,ignore:""}])},doAjaxSearch:function(t,e,n){this.lastToken=Ext.id();var i={invoiceTypeCode:Invoice.invoiceTypeCode,invoiceStatusCode:Invoice.invoiceData.Invoice.InvoiceStatusCode,isTemplate:Invoice.isRepeating,search:t,limit:this.ajaxSearchLimit,token:this.lastToken};Ext.Ajax.request({url:this.inventoryFilterEndPoint,method:"GET",success:e,failure:n,params:i,scope:this})},onAjaxSuccess:function(t,e){if(this.filtered&&e.params.token===this.lastToken){var n=this,i=JSON.parse(t.responseText),a=XERO.util.escapeRegexSpecialCharacters(e.params.search),o=i.map(function(t){return{data:new Data.Dictionary("",[["Description",t.Description],["AccountID",t.AccountID],["UnitAmount",t.UnitAmount],["GSTCode",t.TaxCode],["QuantityOnHand",t.QuantityOnHand],["IsTrackedAsInventory",t.IsTrackedAsInventory]]),html:n.emphasisFilterResults?XERO.util.emphasizeText(t.CodeName,a):null,ignore:"",key:t.PriceListItemID,value:t.CodeName}});this.data.createValueMatcher(Ext.util.Format.htmlEncode(e.params.search),!0,!1).test("(None)")&&o.unshift({data:new Data.Dictionary("",[]),html:n.emphasisFilterResults?XERO.util.emphasizeText("(None)",a):null,ignore:"",key:"",value:"(None)"}),this.loadData(o)}},onAjaxFailure:function(t){this.resetData()},filter:function(e,n){return n.length?(this.filtered=!0,this.totalItems<=this.ajaxSearchLevel?t.memoryFilter.call(this,e,n):(this.setLoadingState(n),void this.doAjaxSearch(n,this.onAjaxSuccess,this.onAjaxFailure))):(this.filtered=!1,void this.fireEvent("store:nofilter"))},getData:t.getData,createRecord:t.createRecord})}()},function(t,e){Ext.WindowMgr.zseed=2e4,window.Window=function(t,e){e=e||{},t||(t="window_"+(new Date).getTime()),Ext.WindowMgr.get(t)&&Ext.WindowMgr.get(t).close(),this._extWindow=XERO.Window.create(t,{cls:e.className||"",width:e.width||400,height:(e.height||150)+10,resizable:e.resizable||!0,maximizable:e.maximizable||!1,minimizable:e.minimizable||!1,x:e.left||null,y:e.top||null,title:e.title||null,closable:e.closable||!0,modal:e.modal||!0,html:"<div style='margin:1em;width:"+e.width+";text-align:center'><img src='/common/images/indicator.gif' /></div>"}),this._extWindow.show()},Window.prototype={_extWindow:null,_html:null,_loadScripts:!1,destroy:function(){this._extWindow.destory()},_onDestroy:function(t){},setCloseCallback:function(t){this.options.closeCallback=t},getContent:function(){return this._extWindow.body.dom.innerHTML},setHTMLContent:function(t,e){this._extWindow.setHtml(t,e)},getId:function(){return this._extWindow.id},setDestroyOnClose:function(){this._extWindow.autoDestroy=!0},setLocation:function(t,e){this._extWindow.setPosition(e,t)},getLocation:function(){var t=this._extWindow.getPosition(!0);return{left:t[0],top:t[1]}},getSize:function(){return{width:this._extWindow.width,height:this._extWindow.height}},setSize:function(t,e,n){this._extWindow.setSize(t,e)},updateHeight:function(){this.setSize(this._extWindow.width,this._extWindow.body.dom.scrollHeight)},updateWidth:function(){this.setSize(this._extWindow.body.dom.scrollWidth,this._extWindow.height)},toFront:function(){this._extWindow.toFront()},show:function(t,e){this._extWindow.show(),e&&this._extWindow.center()},_onRender:function(t){this.setHTMLContent(this._html,this._loadScripts)},showCenter:function(t){this.show(!1,!0)},hide:function(){this._extWindow.hide()},close:function(){this._extWindow.close()},setZIndex:function(t){},setTitle:function(t){this._extWindow.setTitle(t)}},window.Windows={close:function(t){Ext.WindowMgr.get(t)&&Ext.WindowMgr.get(t).close()},closeAll:function(){Ext.WindowMgr.each(function(t){try{t.close()}catch(t){}})},windows:Ext.WindowMgr},XERO.Window=Ext.extend(Ext.Window,{setHtml:function(t,e,n){!1!==e&&(e=!0),!0!==n&&(n=!1),this.isVisible()||this.width||n||this.setSize(this.maxWidth,150),this.body.update(t.stripScripts()),n||this.updateSize(),e&&t.evalScripts(),this.fireEvent("contentready")},updateSize:function(){var t=0,e=this.body.getWidth()+this.body.getMargins("lr"),n=this.getFrameWidth("lr"),i=this.body.getFrameWidth("lr");Ext.isIE&&t>0&&(t+=3),isNaN(this.maxWidth)&&(this.maxWidth=0),isNaN(this.minWidth)&&(this.minWidth=0);var a=Math.max(Math.min(this.width||t+e+n+i,this.maxWidth),Math.max(this.width||this.minWidth,0));this.setSize(a,"auto")},showCenter:function(t){this.center().show(t)},closeDialog:function(){!1!==this.fireEvent("beforeclose",this)&&this.hide(null,function(){this.fireEvent("close",this),this.destroy()},this)},enableButtons:function(){for(var t=0,e=this.buttons.length;t<e;t++){var n=this.buttons[t].el.select("button").first();if(n){n.parent().removeClass("disabled");var i=n.query("span")[0];try{i&&(i.style.display="",n.query("em")[0]&&n.select("em").first().remove())}catch(t){}n.dom.disabled&&(n.dom.disabled=!1)}}},disableButton:function(t,e){if((t=t.el.select("button").first())&&!t.parent("em.button").hasClass("disabled")&&(t.parent("em.button").addClass("disabled"),t.dom.disabled=!0,!0!==e)){var n=t.query("span")[0];try{if(n&&"none"!==n.style.display){var i='<em class="spinner" style="width:'+n.getWidth()+"px;height:"+n.getHeight()+'px;"><img src="/common/images/spinner.gif" alt="Loading..." /></em>';new Insertion.After(n,i),n.style.display="none"}}catch(t){}}},enableButton:function(t,e){if((t=t.el.select("button").first())&&t.parent("em.button").hasClass("disabled")&&(t.parent("em.button").removeClass("disabled"),t.dom.disabled=!1,!0!==e)){var n=t.query("span")[0];n&&(n.style.display="block");var i=t.query("em")[0];i&&(i.style.display="none")}}}),Object.extend(XERO.Window,{createAjax:function(t,e){var n=this.create(t,e);return n.setHtml('<div style="float:left;text-align:center;width:100%;margin:20px 0;"><img src="/common/images/indicator_blue.gif"/></div></div>',!0,e.fixSize),n.show(),n.setHeight(),n},create:function(t,e){t=t||"__win"+(new Date).getTime(),e=e||{};var n={focusFirstFormElement:!0};e=Ext.apply(n,e),Ext.WindowMgr.get(t)&&Ext.WindowMgr.get(t).hide();var i=new XERO.Window({id:t,autoCreate:!0,title:"&#160;",resizable:e.resizable||!1,constrain:!0,constrainHeader:!0,minimizable:!1,maximizable:!1,stateful:!1,modal:!0,shim:!0,width:e.width||400,height:e.height||160,minHeight:e.height||160,minWidth:e.width||400,plain:!1,footer:!0,footerCssClass:e.footerCssClass||null,closable:!0,ddGhost:!1,cls:e.cls||null,contentEl:e.contentEl||null,closeAction:!0===e.hideOnClose?"hide":"close",fixSize:e.fixSize||!1});e.listeners&&i.on(e.listeners),e.focusFirstFormElement&&i.on("contentready",function(){Ext.defer(XERO.util.Dom.focusFirstFormElement,100,null,[i.body.dom])});var a=e.buttons,o=null,r=null;if(a){for(var s,l=0,u=a.length;l<u;l++)e.handler&&!a[l].handler&&(a[l].handler=e.handler),s=i.addButton({text:a[l].text,template:a[l].template,defaults:a[l].defaults,cancel:a[l].cancel}),a[l].handler||(a[l].handler=function(t,e){t.hide(null,function(){t.fireEvent("close",t),t.destroy()},t)}),s.handler=a[l].handler.createCallback(i,{btn:s,cancel:!0===a[l].cancel,defaults:!0===a[l].defaults},e.scope,e.data),!0===a[l].defaults&&(o=s),!0===a[l].cancel&&(r=s);r&&(i.close=function(){r.handler(i,{btn:r,cancel:!0,defaults:!1})})}i.render(document.body);var c=i.mask;i.body.createChild({cls:"x-clear"}),i.setTitle(e.title||"&#160;");var d=!1!==e.closable;return i.tools.close.setDisplayed(d),e.html&&i.setHtml(e.html,!0,e.fixSize),i.proxyDrag=!0===e.proxyDrag,i.modal=!1!==e.modal,i.mask=!1!==e.modal&&c,o&&(i.focusEl=o),i.on("show",function(){!0===d?i.keyMap.enable():i.keyMap.disable()},i,{single:!0}),i},confirm:function(t,e,n,i,a,o,r,s,l,u,c){var d=this.create(null,{title:e,html:t,buttons:[XERO.buttons.createOK(i||"OK",a),XERO.buttons.createCancel(o||"Cancel",r)],fromEl:n,modal:!0,scope:s,data:l,listeners:u,width:c||400}),h=d.buttons[0];return h.on("click",function(){this.addClass("disabled"),this.disable()},h),d.show(),d},confirmSpin:function(t,e,n,i,a,o,r,s){var l='<div class="document forms in-popup"><p>'+e+'</p><div id="windowActions"> </div><div class="button-container"><div id="windowButtonSleeve"></div></div>',u=this.create("__popupSpin",{title:t,html:l,height:250,width:400,modal:!0,scope:r,data:s});return XERO.widget.Buttons.insert({id:"create01",size:"small",color:"gray",disable:"skip",text:a,onclick:o}),XERO.widget.Buttons.insert({id:"create02",size:"medium",color:"green",text:n,onclick:"function"!=typeof i?i:null}),u.show(),u.center(),"function"==typeof i&&Ext.get("create02").on("click",i),u},confirmMarkAsSent:function(t,e,n,i,a,o,r,s){var l='<div class="document forms in-popup"><p>'+e+'</p><div id="windowActions"> </div><div class="button-container"><div id="windowButtonSleeve"></div></div>',u=this.create("__popupSpin",{title:t,html:l,height:250,width:400,modal:!0,scope:r,data:s});return XERO.widget.Buttons.insert({id:"create01",size:"small",color:"gray",text:a,onclick:o}),XERO.widget.Buttons.insert({id:"create02",size:"small",color:"green",text:n,onclick:i}),u.show(),u.center(),u},alert:function(t,e,n){var i=this.create(null,{title:e,html:t,width:460,buttons:[XERO.buttons.createOK("OK")],fromEl:n,modal:!0});return i.show(),i},tip:function(t,e,n){var i=this.create(null,{title:e,html:t,fromEl:n,cls:"OG"});return i.show(),i},Video:{AspectRatios:{ASPECT_RATIO_4_3:{name:"4:3",ratio:.75,defaultWidth:640,defaultHeight:480},ASPECT_RATIO_16_9:{name:"16:9",ratio:.5625,defaultWidth:640,defaultHeight:360},ASPECT_RATIO_16_10:{name:"16:10",ratio:.625,defaultWidth:640,defaultHeight:400},asArray:function(){return[this.ASPECT_RATIO_4_3,this.ASPECT_RATIO_16_9,this.ASPECT_RATIO_16_10]}}},video:function(t,e,n,i,a){var o,r,s,l,u=XERO.Window.Video.AspectRatios;if(1===arguments.length&&Ext.isObject(t)?(s=t,l=String.format("https://player.vimeo.com/video/{0}?autoplay=1",s.videoId),o=s.windowCls||o,e=s.title,n=s.fromEl,i=s.aspectRatio||u.ASPECT_RATIO_16_9,a=s.height):(l=t,o="OG"),Ext.isString(i))for(var c=u.asArray(),d=0;d<c.length;d++){var h=c[d];if(h.name===i){i=h;break}}i=i||u.ASPECT_RATIO_4_3,a=a||i.defaultHeight,r=Math.round(a/i.ratio);var f='<iframe width="'+r+'" height="'+a+'" src="'+l+'" frameborder="0" allowfullscreen></iframe>',p=this.create(null,{title:e,cls:o,html:f,fromEl:n,width:r+33,height:a+72});return p.show(),p},movie:function(t,e,n,i,a,o){new XERO.ui.Media.Window({height:a,width:i,minHeight:a,minWidth:i,animateTarget:o,cls:"OG",title:t,mediaCfg:{mediaType:"SWF",url:e,controls:!0,start:!0,loop:!1,params:{allowscriptaccess:"sameDomain",quality:"high",flashVars:{xmlSrc:n}}}}).show()},pdf:function(t,e,n,i,a){new XERO.ui.Media.Window({height:i||500,width:n||500,minHeight:i||200,minWidth:n||200,animateTarget:a,title:e||"View PDF",autoScroll:!0,mediaCfg:{mediaType:"PDF",url:t}}).show()},media:function(t,e,n,i,a,o,r){new XERO.ui.Media.Window({height:o||500,width:a||500,minHeight:o||200,minWidth:a||200,animateTarget:r,autoScroll:!0,title:n||String.format("View {0}",t),mediaCfg:{mediaType:t,url:e}}).show()}}),XERO.buttons.WindowButton=Ext.extend(Ext.Button,{size:"",type:"",skip:!1,initComponent:function(){Ext.Button.superclass.initComponent.call(this),this.template=new Ext.XTemplate(String.format('<em unselectable="on" class="{0} {1} button {2}">',this.size,this.type,!0===this.skip?"skip":""),!0===this.skip?'<div class="skip">':"<div>",'<button type="button">','<span class="text">',this.icon?String.format('<em class="icons {0}">&#160;</em>',this.icon):"","{0}","</span>","</button>","</div>","</em>")},spin:function(){this.disable();var t=this.getEl().child("span");try{t&&"none"!==t.getStyle("display")&&(t.insertHtml("afterEnd",'<em class="spinner" style="width:'+t.getWidth()+"px;height:"+t.getHeight()+'px;"><img src="/common/images/spinner.gif" alt="Loading..." /></em>'),t.setStyle("display","none"))}catch(t){}}}),XERO.buttons.createButton=function(t){return{text:t.text,cancel:t.cancel,defaults:t.defaults,handler:t.handler,scope:t.scope,template:new Ext.XTemplate(String.format('<em unselectable="on" class="{0} {1} button">',t.size,t.type),"<div>",'<button type="button">','<span class="text">',"{0}","</span>","</button>","</div>","</em>")}},XERO.buttons.createOK=function(t,e,n){return XERO.buttons.createButton({text:t||"OK",type:"green",size:n&&n.size||"medium",icon:null,cancel:!1,defaults:!0,handler:e})},XERO.buttons.createSave=function(t,e){return XERO.buttons.createOK("Save",e)},XERO.buttons.createCancel=function(t,e){return XERO.buttons.createButton({text:t||"Cancel",type:"grey",size:"medium",icon:null,cancel:!0,defaults:!1,handler:e})},XERO.MsgBox=XERO.Window},function(module,exports){XERO.widget.AutocompleterBase=function(t,e,n){t=$(t),this.element=t,this.update=$(e),this.hasFocus=!1,this.changed=!1,this.active=!1,this.index=0,this.entryCount=0,this.setOptions?this.setOptions(n):this.options=n||{},this.options.paramName=this.options.paramName||this.element.name,this.options.tokens=this.options.tokens||[],this.options.frequency=this.options.frequency||.4,this.options.minChars=this.options.minChars||1,this.options.onShow=this.options.onShow||function(t,e){e.style.position&&"absolute"!=e.style.position||(e.style.position="absolute",Position.clone(t,e,{setHeight:!1,offsetTop:t.offsetHeight})),Effect.Appear(e,{duration:.15})},this.options.onHide=this.options.onHide||function(t,e){new Effect.Fade(e,{duration:.15})},"string"==typeof this.options.tokens&&(this.options.tokens=new Array(this.options.tokens)),this.observer=null,this.element.setAttribute("autocomplete","off"),Element.hide(this.update),Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this)),Event.observe(this.element,"keydown",this.onKeyDown.bindAsEventListener(this)),Event.observe(window,"beforeunload",function(){t.setAttribute("autocomplete","on")});var i=Ext.get(this.element),a=0==i.getWidth()?"auto":i.getWidth()+20;i.parent("div.dd")&&i.parent("div.dd").setWidth(a)},XERO.widget.AutocompleterBase.prototype={show:function(){"none"==Element.getStyle(this.update,"display")&&this.options.onShow(this.element,this.update),!this.iefix&&Prototype.Browser.IE&&"absolute"==Element.getStyle(this.update,"position")&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="about:blank" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.update.id+"_iefix")),this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height}),this.iefix.style.zIndex=1,this.update.style.zIndex=2,Element.show(this.iefix)},hide:function(){this.stopIndicator(),"none"!=Element.getStyle(this.update,"display")&&this.options.onHide(this.element,this.update),this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyDown:function(t){if(this.active)switch(t.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(t);case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(t);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void(Prototype.Browser.WebKit&&Event.stop(t));case Event.KEY_DOWN:return this.markNext(),this.render(),void(Prototype.Browser.WebKit&&Event.stop(t))}else if(t.keyCode==Event.KEY_TAB||t.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&0==t.keyCode)return;this.changed=!0,this.hasFocus=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},activate:function(){this.changed=!1,this.hasFocus=!0,this.getUpdatedChoices()},onHover:function(t){var e=Event.findElement(t,"LI");this.index!=e.autocompleteIndex&&(this.index=e.autocompleteIndex,this.render()),Event.stop(t)},onClick:function(t){var e=Event.findElement(t,"LI");this.index=e.autocompleteIndex,this.selectEntry(),this.hide()},onBlur:function(t){setTimeout(this.hide.bind(this),250),this.hasFocus=!1,this.active=!1},render:function(){if(this.entryCount>0){for(var t=0;t<this.entryCount;t++)this.index==t?Element.addClassName(this.getEntry(t),"selected"):Element.removeClassName(this.getEntry(t),"selected");this.hasFocus&&(this.show(),this.active=!0)}else this.active=!1,this.hide()},markPrevious:function(){this.index>0?this.index--:this.index=this.entryCount-1,this.getEntry(this.index).scrollIntoView(!0)},markNext:function(){this.index<this.entryCount-1?this.index++:this.index=0,this.getEntry(this.index).scrollIntoView(!1)},getEntry:function(t){return this.update.firstChild.childNodes[t]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=!1,this.updateElement(this.getCurrentEntry())},updateElement:function(t){if(this.options.updateElement)return void this.options.updateElement(t);var e="";if(this.options.select){var n=document.getElementsByClassName(this.options.select,t)||[];n.length>0&&(e=Element.collectTextNodes(n[0],this.options.select))}else e=Element.collectTextNodesIgnoreClass(t,"informal");var i=this.findLastToken();if(-1!=i){var a=this.element.value.substr(0,i+1),o=this.element.value.substr(i+1).match(/^\s+/);o&&(a+=o[0]),this.element.value=a+e}else this.element.value=e;this.element.focus(),this.options.afterUpdateElement&&this.options.afterUpdateElement(this.element,t)},updateChoices:function(t){if(!this.changed&&this.hasFocus){if(this.update.innerHTML=t,Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.down()),this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var e=0;e<this.entryCount;e++){var n=this.getEntry(e);if(null!=n.children&&n.children.length>0)for(var i=0;i<n.children.length;i++)n.children[i].autocompleteIndex=e,this.addObservers(n.children[i]);n.autocompleteIndex=e,this.addObservers(n)}}else this.entryCount=0;this.stopIndicator(),this.index=0,1==this.entryCount&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render()}},addObservers:function(t){Event.observe(t,"mouseover",this.onHover.bindAsEventListener(this)),Event.observe(t,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=!1,this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide())},getToken:function(){var t=this.findLastToken();if(-1!=t)var e=this.element.value.substr(t+1).replace(/^\s+/,"").replace(/\s+$/,"");else var e=this.element.value;return/\n/.test(e)?"":e},findLastToken:function(){for(var t=-1,e=0;e<this.options.tokens.length;e++){var n=this.element.value.lastIndexOf(this.options.tokens[e]);n>t&&(t=n)}return t}},XERO.widget.Autocompleter=function(t,e,n,i){XERO.widget.Autocompleter.superclass.constructor.call(this,t+"_value",e,i),this.keyElement=$(t),this.options.onShow=function(t,e){t=Ext.get(t),e=Ext.get(e),e.show(),e.setY(t.getY()+t.dom.clientHeight),e.setX(t.getX())},this.options.onHide=function(t,e){Element.hide(e)},this.update.style.height="200px",this.update.style.width=this.options.width||"200px",this.options.frequency=0,this.options.asynchronous=!0,this.options.onComplete=this.onComplete.bind(this),this.options.defaultParams=this.options.parameters||null,this.options.onIntellisense=this.options.onIntellisense||null,this.options.onAfterBlur=this.options.onAfterBlur||null,this.options.afterUpdateElement=this.options.afterUpdateElement||null,this.options.alwaysShowNoMatchesFound=this.options.alwaysShowNoMatchesFound||!1,this.options.noMatchesText=this.options.noMatchesText||"No Matches",this.options.entryClass=this.options.entryClass?this.options.entryClass.replace(/["'<>]/g,""):null,this.callback=n,this.data=null,this.masterData=null,this.toggled=!1,this.localData=this.options.data||null,this.local=this.options.local||null,this.allowInvalidInput=this.options.allowInvalidInput||!1,this.loaded=!1,this.current=null,this.selectedValue=this.options.selectedValue||null,this.lastIndex=0,this.cachedTokens=[],this.childNodeOffsets=null,this.noMatchesFoundDataItem={key:0,value:this.options.noMatchesText,html:"<div style='font-weight:bold;' class='"+this.options.entryClass+" no-matches-found'><h3>"+Ext.util.Format.htmlEncode(this.options.noMatchesText)+"</h3></div>"},this.local&&this.localData&&this.initLocal(),this.selectedValue&&this.setValue(this.selectedValue,!0,!0),this.element.value=this.element.value.unescapeHTML(),Event.observe(this.element,"focus",this.onFocus.bindAsEventListener(this)),Event.observe(document,"click",this.onDocumentClick.bindAsEventListener(this),!1)},Ext.extend(XERO.widget.Autocompleter,XERO.widget.AutocompleterBase,{onDocumentClick:function(t){this.visible||this.hide(),this.visible=!1},initLocal:function(){this.data=this.localData;var t=new StringBuilder;t.append("<div>");for(var e=0;e<this.data.length;e++)void 0===this.data[e].html||null==this.data[e].html?(t.append("<div>"),t.append(this.data[e].value),t.append("</div>")):t.append(this.data[e].html.unescapeHTML2());t.append("</div>"),this.update.innerHTML=t.toStr(),Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.firstChild),this.update.firstChild&&this.update.firstChild.childNodes?this.entryCount=this.update.firstChild.childNodes.length:this.entryCount=0},callbackCounter:0,onComplete:function(res,index){if(!index||index==this.callbackCounter){Object.contains(res,"__type")?this.data=eval(res.value):this.data=res;var html="",classAttribute="";if(this.options.entryClass&&(classAttribute=" class='"+this.options.entryClass+"'"),null!=this.data)for(var i=0;i<this.data.length;i++)void 0===this.data[i].html||null==this.data[i].html?html+="<div"+classAttribute+">"+this.data[i].value+"</div>":this.data[i]==this.noMatchesFoundDataItem?html+=this.data[i].html.unescapeHTML2():html+="<div"+classAttribute+">"+this.data[i].html.unescapeHTML2()+"</div>";this.updateChoices("<div>"+html+"</div>"),this.childNodeOffsets=[].map.call(this.update.childNodes[0].childNodes,function(t){return t.offsetTop})}},onCallBackComplete:function(res,index){if(!index||index==this.callbackCounter){(!this.localData||this.options.minChars>1)&&(this.localData=[]);var evalResultData=eval(res.value);if(Object.contains(res,"__type"))if(0==this.localData.length)this.localData=this.localData.concat(evalResultData);else for(var i=0,iLen=evalResultData.length;i<iLen;i++){for(var matchFound=!1,j=0,jLen=this.localData.length;j<jLen;j++)if(this.localData[j].key==evalResultData[i].key){"__type"in this.localData[j]||(this.localData[j]=evalResultData[i]),matchFound=!0;break}matchFound||this.localData.push(evalResultData[i])}else this.localData=this.localData.concat(res);this.localData.sortBy(function(t){var e=String(t).left(1);return null==e?0:e.charCodeAt()});var current=this.intellisense();this.options.onComplete(current)}},getUpdatedChoices:function(){if(this.local){this.toggled||this.hasFocus||this.options.onComplete(this.localData);var current=this.intellisense();this.options.onComplete(current)}else if(this.getToken().length==this.options.minChars&&(this.options.minChars>1||-1==this.cachedTokens.indexOf(this.getToken())))this.cachedTokens.push(this.getToken()),this.callbackCounter=this.callbackCounter+1,eval(this.callback+"(this.getToken(), function(res) { this.onCallBackComplete(res, "+this.callbackCounter+"); }.bind(this)); ");else{var current=this.intellisense();this.options.onComplete(current)}},cachedTokens:[],intellisense:function(){if(this.options.onIntellisense)return this.options.onIntellisense(this);if(!this.localData)return null;var t=this.options.searchComparator||XERO.util.IntellisenseComparators.startsWithComparator,e=this.getToken().trim().toUpperCase(),n=e.escapeHTML().trim().toUpperCase(),i=!1;if(""==e)return this.localData;for(var a=[],o="",r=this.localData.length,s=this.options.minChars>1,l=0;l<r;l++)o=this.localData[l].value.toUpperCase(),s?-1!=o.indexOf(e)&&(o==e&&!0,a.push(this.localData[l])):(i=t(n,o,this.localData[l]),(t(e,o,this.localData[l])||i)&&(o==e&&!0,a.push(this.localData[l])));return 0==a.length&&(e.length>=this.options.minChars&&this.options.minChars>1||this.options.alwaysShowNoMatchesFound)&&a.push(this.noMatchesFoundDataItem),a},onFocus:function(t){this.hasFocus=!0},onKeyDown:function(t){if(this.active)switch(t.keyCode){case Event.KEY_TAB:var e=!1;return 1==this.options.autoSelectItemOnTab&&(e=this.selectEntry()),this.hide(),this.active=!1,void(this.options.onTabKeyDown&&this.options.onTabKeyDown.call(this,t,e));case Event.KEY_RETURN:this.selectEntry(),Event.stop(t);case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(t);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void(navigator.appVersion.indexOf("AppleWebKit")>0&&Event.stop(t));case Event.KEY_DOWN:return this.allowInvalidInput||null!=this.keyElement.value&&0!=this.keyElement.value.length||(this.element.value=""),this.markNext(),this.render(),void(navigator.appVersion.indexOf("AppleWebKit")>0&&Event.stop(t))}else{if(t.keyCode==Event.KEY_RETURN)return;if(t.keyCode==Event.KEY_TAB||navigator.appVersion.indexOf("AppleWebKit")>0&&0==t.keyCode)return;this.setHeight(),this.local&&this.options.onComplete(this.localData)}this.changed=!0,this.hasFocus=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),100*this.options.frequency)},markPrevious:function(){this.lastIndex=this.index,this.index>0?this.index--:this.index=this.entryCount-1,this.updateScrollPosition(!0)},markNext:function(){this.lastIndex=this.index,this.index<this.entryCount-1?this.index++:this.index=0,this.updateScrollPosition(!1)},updateScrollPosition:function(){var t=this.childNodeOffsets[this.index]+2,e=this.update.getHeight()-2;0===this.index?this.update.scrollTop=0:t>=this.update.scrollTop+e?this.update.scrollTop=t:t<this.update.scrollTop&&(this.update.scrollTop=this.update.scrollTop-e)},getEntry:function(t){return this.update.firstChild.childNodes[t]},onHover:function(t){for(var e=Event.element(t);"B"===e.tagName||"I"===e.tagName;)e=e.parentElement;this.index!=e.autocompleteIndex&&(this.lastIndex=this.index,this.index=e.autocompleteIndex,this.render()),Event.stop(t)},onClick:function(t){for(var e=Event.element(t);"B"===e.tagName||"I"===e.tagName;)e=e.parentElement;this.index=e.autocompleteIndex,this.lastIndex=this.index,this.selectEntry(),this.hide()},selectEntry:function(){return!!this.toggled&&(this.active=!1,this.updateElement(this.data[this.index]),!0)},setValue:function(t,e,n){this.data&&0!=this.data.length||(this.data=this.localData);for(var i=0;i<this.data.length;i++)if(this.data[i].key==t)return void this.updateElement(this.data[i],e,n)},setValueBasedOnInput:function(t,e,n){for(var i=0;i<this.data.length;i++)if(this.data[i].value==t)return void this.updateElement(this.data[i],e,n)},updateElement:function(t,e,n){if((this.options.minChars>1||this.options.alwaysShowNoMatchesFound)&&(null==t||t==this.noMatchesFoundDataItem))return void(t=null);var i=t;if(this.current=i,this.options.updateElement&&!e)return void this.options.updateElement(t);var a=i.value,o=i.key,r=this.findLastToken();if(-1!=r){var s=this.element.value.substr(0,r+1),l=this.keyElement.value.substr(0,r+1),u=this.element.value.substr(r+1).match(/^\s+/),c=this.element.value.substr(r+1).match(/^\s+/);u&&(s+=u[0]),c&&(l+=c[0]),this.keyElement.value=l+o,null==this.keyElement.value||0==this.keyElement.value.length||"null"==this.keyElement.value?(this.keyElement.value="",this.element.value=""):this.element.value=s+a}else this.keyElement.value=o,null==this.keyElement.value||0==this.keyElement.value.length||"null"==this.keyElement.value?(this.keyElement.value="",this.element.value=""):this.element.value=a;if(this.element.value=this.element.value.unescapeHTML(),this.element.visible()&&!0!==n)try{"TemplateDropDown_value"!==this.element.id&&0!==this.element.id.indexOf("Currency_")&&this.element.focus()}catch(t){}this.options.afterUpdateElement&&!e&&this.options.afterUpdateElement(this,this.element,t)},toggle:function(t){this.local&&(this.data=this.localData),this.toggled?this.hide():(this.element.focus(),this.hasFocus=!0,this.options.onComplete(this.localData),this.show()),Event.stop(t)},clear:function(){this.keyElement.value=null,this.current=null},onObserverEvent:function(){if(this.clear(),this.changed=!1,this.local&&this.getToken().length<this.options.minChars)return void(Prototype.Browser.WebKit?setTimeout(this.getUpdatedChoices.bind(this),50):this.getUpdatedChoices());this.getToken().length>=this.options.minChars?(this.startIndicator(),this.getUpdatedChoices()):(this.active=!1,this.hide())},hide:function(){this.stopIndicator(),"none"!=Element.getStyle(this.update,"display")&&this.options.onHide(this.element,this.update),this.iefix&&Element.hide(this.iefix),this.toggled=!1,clearTimeout(this.observer)},show:function(){Ext.each(Ext.query(".autocomplete"),function(t){t!=this.update&&Ext.fly(t).setStyle("visibility","hidden")},this),"none"==Element.getStyle(this.update,"display")&&this.options.onShow(this.element,this.update),!this.iefix&&navigator.appVersion.indexOf("MSIE")>0&&navigator.userAgent.indexOf("Opera")<0&&"absolute"==Element.getStyle(this.update,"position")&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;margin-top:18px;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="about:blank" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.update.id+"_iefix")),this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50),this.toggled=!0},render:function(t){this.entryCount>0?(Element.removeClassName(this.getEntry(this.lastIndex),"selected"),Element.addClassName(this.getEntry(this.index),"selected"),this.hasFocus&&(this.show(),this.active=!0),this.setHeight()):(this.active=!1,this.hide())},setHeight:function(){this.update.offsetHeight<200?this.update.style.height="auto":this.update.style.height="200px"},resetData:function(){void 0!=this.masterData&&(this.localData=this.masterData.slice())},removeAt:function(t){void 0==this.masterData&&(this.masterData=this.localData.slice()),this.localData.splice(t,1)},onBlur:function(t){this.element.value=this.element.value,this.allowInvalidInput||null!=this.keyElement.value&&0!=this.keyElement.value.length&&"null"!=this.keyElement.value||(0!=this.element.value.trim().length?(this.setValueBasedOnInput(this.element.value,!1),null!=this.keyElement.value&&0!=this.keyElement.value.length&&"null"!=this.keyElement.value||(this.keyElement.value="",this.element.value="")):(this.keyElement.value="",this.element.value="")),"none"!=Element.getStyle(this.update,"display")&&this.options.onAfterBlur&&this.options.onAfterBlur(this)}})},function(t,e){XERO.widget.TokenizingAutocompleter=function(t,e,n,i){i.entryClass=i.entryClass||"entry",XERO.widget.TokenizingAutocompleter.superclass.constructor.call(this,t,e,n,i),this.options.tokensData?this.tokensData=[].concat(this.options.tokensData):this.tokensData=[],this.filterAutocompleterDataAlreadyInTokens=i.filterAutocompleterDataAlreadyInTokens||!1,this.enabled=i.enabled||!0,this.placeHolderText=null!=this.options.placeHolderText?this.options.placeHolderText:"Type here...",this.searchResultsXOffset=null!=this.options.searchResultsXOffset?this.options.searchResultsXOffset:-6,this.localDataNotFiltered=this.localData,this.afterUpdateTokens=this.options.afterUpdateTokens,this.initComponent(),this.options.onTabKeyDown=function(t,e){e&&Event.stop(t)}},Ext.extend(XERO.widget.TokenizingAutocompleter,XERO.widget.Autocompleter,{tokensData:[],filterAutocompleterDataAlreadyInTokens:!1,liContainingTextInput:null,liActiveToken:null,ulContainer:null,localDataNotFiltered:null,placeHolderText:null,afterUpdateTokens:null,searchResultsXOffset:null,enabled:!0,prevTokenIndex:-1,nextTokenIndex:-1,initComponent:function(){if(this.liContainingTextInput=Ext.get(this.element).wrap({tag:"li",cls:"input-token"}),this.ulContainer=this.liContainingTextInput.wrap({tag:"ul",cls:"tokenizing-autocompleter"}),this.element.setAttribute("placeholder",this.placeHolderText),this.element.setAttribute("tabindex",0),this.onTokensDataChanged(),this.setTokenIndexToEnd(),Ext.isGecko){for(var t=Event.observers.length-1;t>=0;t--){var e=Event.observers[t];if(e[0]==this.element&&"keydown"==e[1]){Event.stopObserving(this.element,"keydown",e[2]);break}}Event.observe(this.element,"keyup",this.onKeyDown.bindAsEventListener(this))}Event.observe(this.element,"keydown",this.onInputTextKeyDown.bindAsEventListener(this)),Event.observe(this.element,"focus",this.onInputTextFocus.bindAsEventListener(this)),Event.observe(this.element,"blur",this.onInputTextBlur.bindAsEventListener(this)),Event.observe(this.ulContainer.dom,"keydown",this.onUlContainerKeyDown.bindAsEventListener(this)),Event.observe(this.ulContainer.dom,"focus",this.onUlContainerFocus.bindAsEventListener(this)),Event.observe(this.ulContainer.dom,"blur",this.onUlContainerBlur.bindAsEventListener(this)),Event.observe(this.ulContainer.dom,"click",this.onUlContainerClick.bindAsEventListener(this));var n=this;Ext.get(this.ulContainer).on("click",function(t){n.onRemoveTokenClick.call(n,t)},null,{delegate:"span.remove"}).on("click",function(t){n.onTokenClick.call(n,t)},null,{delegate:"li.token"});var i=this.options.afterUpdateElement;this.options.afterUpdateElement=function(t,e,a){n.afterUpdateElement2.call(n,t,e,a),i&&i(t,e,a)};var a=this.options.onShow;this.options.onShow=function(t,e){a(t,e);var i=Ext.get(e),o=i.getX()+n.searchResultsXOffset;i.setX(o)}},getLocalDataItemByKey:function(t){var e=this.localData.filter(function(e){return e.key===t});return 1==e.length?e[0]:null},onTokensDataChanged:function(){if(this.filterLocalData(),this.renderTokens(),this.afterUpdateTokens){var t=[].concat(this.tokensData);this.afterUpdateTokens(this,this.element,t)}this.toggled&&this.options.onShow(this.element,this.update)},renderTokens:function(){this.liActiveToken=null;for(var t=null;null!=(t=this.liContainingTextInput.prev());)t.remove();new Ext.XTemplate(['<tpl for=".">','<li class="token">','<input type="hidden" name='+this.keyElement.id+'_token" value="{key}">',"<em>{value}</em>",'<span class="remove"></span>',"</li>","</tpl>"]).insertBefore(this.liContainingTextInput,this.tokensData)},renderActiveToken:function(){var t=this.liContainingTextInput.prev();if(t){do{!this.liActiveToken||t.dom!=this.liActiveToken&&t.dom!=this.liActiveToken.dom?t.removeClass("active"):(t.addClass("active"),this.hide())}while(null!=(t=t.prev()));this.liActiveToken&&(this.prevTokenIndex=this.getTokenIndex(this.liActiveToken)-1,this.nextTokenIndex=this.getTokenIndex(this.liActiveToken)+1)}},getTokenIndex:function(t){return t instanceof Ext.Element&&(t=t.dom),this.turnObjToArray(t.parentElement.childNodes).indexOf(t)},getActiveTokenIndex:function(){return this.liActiveToken?this.getTokenIndex(this.liActiveToken):-1},setActiveToken:function(t){if("number"==typeof t){var e=t;if(!(e>=0&&e<this.tokensData.length))return this.clearActiveToken(),void this.element.focus();this.liActiveToken=new Ext.Element(this.ulContainer.dom.childNodes[e])}else this.liActiveToken=t;this.renderActiveToken()},clearActiveToken:function(){this.liActiveToken=null,this.setTokenIndexToEnd(),this.renderActiveToken()},prevActiveToken:function(){-1!=this.prevTokenIndex&&this.setActiveToken(this.prevTokenIndex)},nextActiveToken:function(){this.setActiveToken(this.nextTokenIndex)},setTokenIndexToEnd:function(){this.prevTokenIndex=this.tokensData.length-1,this.nextTokenIndex=this.tokensData.length},filterLocalData:function(){this.filterAutocompleterDataAlreadyInTokens&&(this.localData=this.localDataNotFiltered.filter(function(t){return!this.tokensDataContainsKey(t.key)},this))},tokensDataContainsKey:function(t){return this.tokensData.some(function(e){return e.key===t})},addTokenDataItem:function(t){var e=!1;this.filterAutocompleterDataAlreadyInTokens?this.tokensDataContainsKey(t.key)||(this.tokensData.push(t),e=!0):(this.tokensData.push(t),e=!0),e&&(this.setTokenIndexToEnd(),this.onTokensDataChanged())},removeTokensDataItem:function(t){this.tokensData.splice(t,1),this.prevTokenIndex>=this.tokensData.length&&this.setTokenIndexToEnd(),this.onTokensDataChanged()},clearTokensData:function(t){this.tokensData=[],this.onTokensDataChanged()},getTokensDataKeys:function(){return this.tokensData.map(function(t){return t.key})},enable:function(){this.enabled||(this.ulContainer.removeClass("disabled"),this.element.setAttribute("placeholder",this.placeHolderText),this.enabled=!0)},disable:function(){this.enabled&&(this.ulContainer.addClass("disabled"),this.element.setAttribute("placeholder",""),this.enabled=!1)},focus:function(){this.element.focus()},turnObjToArray:function(t){return[].map.call(t,function(t){return t})},onInputTextKeyDown:function(t){if(this.enabled){if(""==this.element.value)switch(t.keyCode){case Event.KEY_LEFT:case Event.KEY_BACKSPACE:this.hide(),this.prevActiveToken(),t.keyCode===Event.KEY_BACKSPACE&&this.onRemoveToken(this.liActiveToken),this.ulContainer.set({tabindex:0}),this.ulContainer.focus(),Event.stop(t)}t.keyCode==Event.KEY_RETURN&&Event.stop(t)}},onInputTextFocus:function(t){this.enabled&&(this.ulContainer.addClass("active"),this.clearActiveToken())},onInputTextBlur:function(){this.enabled&&this.ulContainer.removeClass("active")},onUlContainerKeyDown:function(t){if(this.enabled&&t.target!=this.element)switch(t.keyCode){case Event.KEY_LEFT:this.prevActiveToken();break;case Event.KEY_RIGHT:this.nextActiveToken();break;case Event.KEY_DELETE:this.liActiveToken&&this.onRemoveToken(this.liActiveToken);break;case Event.KEY_BACKSPACE:this.liActiveToken||this.prevActiveToken(),this.onRemoveToken(this.liActiveToken);break;default:t.keyCode>=48&&t.keyCode<=90&&(this.clearActiveToken(),this.element.focus(),Ext.isGecko||this.onKeyDown(t))}},onUlContainerClick:function(t){this.enabled&&t.target==this.ulContainer.dom&&this.element.focus()},onUlContainerFocus:function(t){this.enabled&&this.ulContainer.addClass("active")},onUlContainerBlur:function(t){this.enabled&&(this.ulContainer.removeClass("active"),this.ulContainer.set({tabindex:-1}),this.clearActiveToken())},onTokenClick:function(t){this.enabled&&(t.target.className.indexOf("remove")>=0||(this.ulContainer.set({tabindex:0}),this.ulContainer.focus(),this.setActiveToken(t.getTarget("li")),Event.stop(t)))},onRemoveTokenClick:function(t){if(this.enabled){var e=t.getTarget("li");this.onRemoveToken(e),Event.stop(t)}},onRemoveToken:function(t){var e=-1;"number"==typeof t?e=t:(t instanceof Ext.Element||t instanceof Node)&&(e=this.getTokenIndex(t));var n=this.getActiveTokenIndex();this.removeTokensDataItem(e),n>e&&n--,this.setActiveToken(n)},afterUpdateElement2:function(t,e,n){e.value="",this.addTokenDataItem(n),e.focus()}})},function(t,e){XERO.widget.USStatesTokenizingAutocompleter=function(t,e,n,i){i.data=[{key:"AL",value:"Alabama"},{key:"AK",value:"Alaska"},{key:"AZ",value:"Arizona"},{key:"AR",value:"Arkansas"},{key:"CA",value:"California"},{key:"CO",value:"Colorado"},{key:"CT",value:"Connecticut"},{key:"DC",value:"Washington, D.C"},{key:"DE",value:"Delaware"},{key:"FL",value:"Florida"},{key:"GA",value:"Georgia"},{key:"HI",value:"Hawaii"},{key:"ID",value:"Idaho"},{key:"IL",value:"Illinois"},{key:"IN",value:"Indiana"},{key:"IA",value:"Iowa"},{key:"KS",value:"Kansas"},{key:"KY",value:"Kentucky"},{key:"LA",value:"Louisiana"},{key:"ME",value:"Maine"},{key:"MD",value:"Maryland"},{key:"MA",value:"Massachusetts"},{key:"MI",value:"Michigan"},{key:"MN",value:"Minnesota"},{key:"MS",value:"Mississippi"},{key:"MO",value:"Missouri"},{key:"MT",value:"Montana"},{key:"NE",value:"Nebraska"},{key:"NV",value:"Nevada"},{key:"NH",value:"New Hampshire"},{key:"NJ",value:"New Jersey"},{key:"NM",value:"New Mexico"},{key:"NY",value:"New York"},{key:"NC",value:"North Carolina"},{key:"ND",value:"North Dakota"},{key:"OH",value:"Ohio"},{key:"OK",value:"Oklahoma"},{key:"OR",value:"Oregon"},{key:"PA",value:"Pennsylvania"},{key:"RI",value:"Rhode Island"},{key:"SC",value:"South Carolina"},{key:"SD",value:"South Dakota"},{key:"TN",value:"Tennessee"},{key:"TX",value:"Texas"},{key:"UT",value:"Utah"},{key:"VT",value:"Vermont"},{key:"VA",value:"Virginia"},{key:"WA",value:"Washington"},{key:"WV",value:"West Virginia"},{key:"WI",value:"Wisconsin"},{key:"WY",value:"Wyoming"}].sort(function(t,e){return t.value<e.value?-1:t.value>e.value?1:0}),XERO.widget.USStatesTokenizingAutocompleter.superclass.constructor.call(this,t,e,n,i)},Ext.extend(XERO.widget.USStatesTokenizingAutocompleter,XERO.widget.TokenizingAutocompleter,{getUSState:function(t){var e=this.localData.filter(function(e){return e.key===t});return 1==e.length?e[0]:null}})},function(t,e){Ext.define("XERO.widget.contacts.AutoCompleter",{extend:"Ext.form.ComboBox",width:150,addToGlobals:!0,cls:"autocompleter",listClass:"autocompleter-contacts",useFakeInput:!0,showNewContactOption:!0,selectionHistory:[],defaultEmptyStoreData:null,hideTrigger:!0,initComponent:function(){var t=this,e=t.getId();e&&(t.id=Ext.String.format("{0}_value",e),t.configId=e),t.newContactText||(t.newContactText="+ New Contact");var n=Ext.get(Ext.String.format("{0}_newIndicator",e));n&&(t.newIndicator=new XERO.NewIndicator({renderTo:n,listeners:{show:function(){this.container.addClass("x-new-indicator-showing")},hide:function(){this.container.removeClass("x-new-indicator-showing")}}})),Ext.fly(Ext.String.format("{0}_fake",t.id))&&Ext.fly(Ext.String.format("{0}_fake",t.id)).remove(),Ext.apply(t,{valueField:"ContactID",displayField:"Name",mode:t.defaultEmptyStoreData?"local":"remote",loadingText:"Finding contacts...",queryParam:"search",selectOnFocus:!1,lazyRender:!0,minChars:1,itemSelector:"div.search-item",hideMode:"display",listWidth:200}),t.buildStore(),t.buildResultsTpl(),t.defaultEmptyStoreData&&this.addDefaultEmptyStoreDataEvents(),t.callParent(arguments),t.useFakeInput&&t.on("render",function(){t.getEl()&&(t.fakeValueField=new Ext.form.Hidden({id:e,name:e,renderTo:t.getEl().parent()}),t.element=t.getEl(),t.placeholder&&(t.element.dom.placeholder=t.placeholder),Ext.isEmpty(t.value)&&!Ext.isEmpty(t.rawValue)&&t.setRawValue(t.rawValue))}),t.on("beforeselect",t.onBeforeSelect,t),window.autocompleter=t,!0===t.addToGlobals&&Globals.add(Ext.String.format("{0}_completer",e),t)},addDefaultEmptyStoreDataEvents:function(){var t=this;this.on("keyUp",function(t,e){var n=e.getKey();t.getRawValue().length||"local"!==this.mode||n!==e.DOWN||t.select(t.selectedIndex)}),this.on("afterrender",function(){t.addFocusEvent()})},addFocusEvent:function(){this.on("focus",function(){0===this.getValue().length&&"remote"===this.mode&&this.setToLocal()},this)},loadDefaultStoreData:function(t){t&&this.store.suspendEvents(),this.store.loadData(this.defaultEmptyStoreData),t&&this.store.resumeEvents()},onBeforeSelect:function(t,e){return this.selectionHistory.push({value:e.get(t.valueField),display:e.get(t.displayField)}),!0},onSelect:function(t,e){var n=this;!1!==n.fireEvent("beforeselect",n,t,e)&&(n.setValue(t.data[n.valueField||n.displayField]),n.collapse(),n.fireEvent("select",n,t,e),n.lastQuery=t.get(n.displayField),n.fakeValueField&&n.fakeValueField.setValue(t.get(n.valueField)),n.fireOldStyleAfterUpdateHandler(t,e))},onBlur:function(t,e){this.wrap&&this.wrap.removeClass(this.wrapFocusClass);var n=this.selectionHistory[this.selectionHistory.length-1];!e.value.length&&n&&n.value.length&&this.selectionHistory.push({value:e.value,display:e.value})},validateBlur:function(){return!1},stepBack:function(t,e){t=t||1;var n=this.selectionHistory.length;if(!(t>n)){var i=this.selectionHistory,a=i[n-(t+(n>1?1:0))];this.setValue(a.value),this.setRawValue(a.display),this.fakeValueField&&this.fakeValueField.setValue(a.value),e||this.selectionHistory.splice(-1,t)}},getPrevious:function(){if(this.selectionHistory.length){var t=this.selectionHistory,e=t[t.length-2];return{display:e.display,value:e.value}}},fireOldStyleAfterUpdateHandler:function(t,e){var n=this,i={key:t.get(n.valueField),value:t.get(n.displayField),data:t.data};""===i.key&&n.newIndicator?n.newIndicator.show():n.newIndicator&&n.newIndicator.hide(),i.data=Ext.apply(i.data,{getValue:function(t){return this[t]}}),n.fireEvent("afterupdate",n,n.getEl(),i)},onKeyUp:function(t){var e=t.getKey();!1===this.editable||!0===this.readOnly||e!=t.BACKSPACE&&e!=t.DELETE&&t.isSpecialKey()||(this.lastKey=e,this.dqTask.delay(this.queryDelay)),this.el.dom.value.length||"local"===this.mode?this.el.dom.value.length&&this.setToRemote():this.setToLocal(),Ext.form.ComboBox.superclass.onKeyUp.call(this,t)},setToLocal:function(){this.defaultEmptyStoreData&&(this.mode="local",this.autoSelect=!1,this.loadDefaultStoreData(),this.view.clearSelections(),this.repositionList&&this.repositionList())},setToRemote:function(){this.defaultEmptyStoreData&&(this.mode="remote",this.autoSelect=!0)},buildResultsTpl:function(){var t=this;t.tpl=new Ext.XTemplate('<div class="search-list">','<tpl for=".">','<tpl if="values.DefaultStoreValue">','<div class="search-item">','<span class="search-item-name search-item-name-only">{values.Name}</span>',"</div>","</tpl>",'<tpl if="!values.DefaultStoreValue">','<tpl if="this.isValidString(values.ContactName) || this.isValidString(values.EmailAddress)">','<div class="search-item">','<tpl if="this.isValidString(values.AccountNumber)">','<span class="search-item-name">{[ this.boldQueryMatch(values.Name) ]} ({[ this.boldQueryMatch(Ext.util.Format.ellipsis(values.AccountNumber, 20)) ]})</span>',"</tpl>",'<tpl if="!this.isValidString(values.AccountNumber)">','<span class="search-item-name">{[ this.boldQueryMatch(values.Name) ]}</span>',"</tpl>",'<tpl if="this.isValidString(values.ContactName) && this.isValidString(values.EmailAddress)">','<span class="search-item-name">{[ this.boldQueryMatch(values.ContactName) ]}, {[ this.boldQueryMatch(values.EmailAddress) ]}</span>',"</tpl>",'<tpl if="!this.isValidString(values.ContactName) || !this.isValidString(values.EmailAddress)">','<span class="search-item-name">{[ this.boldQueryMatch(values.ContactName) ]}{[ this.boldQueryMatch(values.EmailAddress) ]}</span>',"</tpl>","</div>","</tpl>",'<tpl if="!this.isValidString(values.ContactName) && !this.isValidString(values.EmailAddress) && this.isValidString(values.ContactID)">','<div class="search-item">','<tpl if="this.isValidString(values.AccountNumber)">','<span class="search-item-name search-item-name-only">{[ this.boldQueryMatch(values.Name) ]} ({[ this.boldQueryMatch(Ext.util.Format.ellipsis(values.AccountNumber, 20)) ]})</span>',"</tpl>",'<tpl if="!this.isValidString(values.AccountNumber)">','<span class="search-item-name search-item-name-only">{[ this.boldQueryMatch(values.Name) ]}</span>',"</tpl>","</div>","</tpl>",'<tpl if="!this.isValidString(values.ContactID) && this.showNewContactOption">','<div class="search-item">',"<span>"+t.newContactText+"</span>","</div>","</tpl>","</tpl>","</tpl>","</div>",{showNewContactOption:t.showNewContactOption,compiled:!0,isValidString:function(t){return/\S/.test(t)},boldQueryMatch:function(e){var n=t.store.highlightRx;return n?Ext.util.Format.htmlEncode(e).replace(n,'<strong class="query-match">$1</strong>'):e}})},buildStore:function(){var t=this,e={},n={};if(t.queryDelay=100,t.store=new Ext.data.Store({highlightRx:null,reader:new Ext.data.JsonReader({idProperty:"ContactID"},[{name:"ContactID"},{name:"Name"},{name:"ContactName",useNull:!0},{name:"AccountNumber",useNull:!0},{name:"EmailAddress",useNull:!0},{name:"ARGSTCode",useNull:!0},{name:"APGSTCode",useNull:!0},{name:"ContactDefaultCurrency",useNull:!0},{name:"OrganisationTemplate",useNull:!0},{name:"Discount",useNull:!0},{name:"ContactDefaultBillDueDate",useNull:!0},{name:"ContactDefaultBillDueType",useNull:!0},{name:"ContactDefaultBillDueTypeDisplay",useNull:!0},{name:"ContactDefaultInvoiceDueDate",useNull:!0},{name:"ContactDefaultInvoiceDueType",useNull:!0},{name:"ContactDefaultInvoiceDueTypeDisplay",useNull:!0},{name:"DefaultAPContactAccountType",useNull:!0},{name:"DefaultARContactAccountType",useNull:!0},{name:"DefaultARTrackingCategories",useNull:!0},{name:"DefaultAPTrackingCategories",useNull:!0},{name:"DefaultTaxSales",useNull:!0},{name:"DefaultTaxBills",useNull:!0},{name:"DefaultStoreValue",useNull:!0}]),testValues:function(t,e){var n;for(n=0,len=t.length;n<len;n++)if(t[n].length>0&&e.test(t[n]))return!0;return!1},trimEmail:function(t){var e,n;return(e=t.indexOf("@"))>=0&&(n=t.indexOf(".",e+1))>=0?t.substring(0,n):""},rxEscape:function(t,e){var n,i,a;if(t=t.replace(/([ #$()*+.?[\\^{|])/g,"\\$&"),e){n=this.getAccentEquivalence();for(i in n)a=1===i.length?"["+i+n[i]+"]":"(?:"+[i].concat(n[i].split("")).join("|")+")",t=t.replace(new RegExp(a,"gi"),a)}return t},getAccentEquivalence:function(){return{a:"",c:"",d:"",e:"",f:"",i:"",n:"",o:"",s:"",t:"",u:"",y:"",z:"",ae:"",oe:"",ss:"",tm:""}},anyAccent:null,initNormalisers:function(){var t,e="",n=this.getAccentEquivalence();for(t in n)this.normalisers[t]=new RegExp("["+n[t]+"]","gi"),e+=n[t];this.anyAccent=new RegExp("["+e+"]","i")},normalisers:{},normalise:function(t){var e;if(t&&(t=t.toLowerCase(),this.anyAccent.test(t)))for(e in this.normalisers)t=t.replace(this.normalisers[e],e);return t},filterSortLoad:function(e,i,a){var o,r,s,l=0,u=t.getRawValue().toLowerCase(),c=e.normalise(u),d=e.rxEscape(c.substring(0,100),!1),h=!1;for(e.highlightRx=new RegExp("((?:"+Ext.util.Format.htmlEncode(e.rxEscape(u,!0))+")+)((?:(?!\\w*;))+)","gi"),a&&a.filter&&(r=new RegExp(d,"i"),i=i.filter(function(t){var n=t.shadow;return e.testValues([n.Name,n.AccountNumber,n.ContactName,n.EmailAddress],r)})),a&&a.sort&&(s=new RegExp("(?:(?:^| )'|(?:^|[ @#$&.,:;/\\+=~!?\"|()[}{}<>]))"+d,"i"),i=i.map(function(t){var n=t.shadow;return n.Rank=e.testValues([n.Name+" "+n.AccountNumber+" "+n.ContactName+" "+n.RankEmailAddress],s),t}).sort(function(t,e){return t.shadow.Rank&&!e.shadow.Rank?-1:!t.shadow.Rank&&e.shadow.Rank?1:t.shadow.Name<e.shadow.Name?-1:t.shadow.Name>e.shadow.Name?1:0})),a&&a.newCacheKey&&(n[a.newCacheKey]=i.map(function(t){return t.ContactID})),o=0,len=i.length;o<len;o++){var f=i[o];if(0===f.shadow.Name.indexOf(c)){h||f.shadow.Name!==c||(h=!0),l=o;break}}a&&a.addDefault&&!h&&t.showNewContactOption&&i.push({Name:t.getRawValue()}),e.dataLoaded=!0,e.loadData(i),t.selectedIndex=l-1,t.selectNext()},listeners:{beforeload:function(a){var o,r,s,l=a.normalise(t.getRawValue().substring(0,100),!0);if(a.dataLoaded=!1,/\S/.test(t.getRawValue())){for(i=l.length;i>=1;i--)if(o=l.substring(0,i),Ext.isArray(n[o])){r=n[o].map(function(t){return e[t]}),s=l.length===o.length?{filter:!1,sort:!1,addDefault:!0}:{filter:!0,sort:!0,addDefault:!0,newCacheKey:l};break}}else r=[],s={filter:!1,sort:!1,addDefault:!1};if(Ext.isArray(r))return a.filterSortLoad(a,r,s),!1;t.minChars>0&&(t.minChars=0,t.queryDelay=0)},datachanged:function(n){if(!n.dataLoaded)return a=n.data.items.map(function(i){var a=i.data;return a.Name=t.decodeHtml(a.Name),a.ContactName=t.decodeHtml(a.ContactName),a.EmailAddress=t.decodeHtml(a.EmailAddress),a.AccountNumber=t.decodeHtml(a.AccountNumber),a.shadow={Name:n.normalise(a.Name),ContactName:n.normalise(a.ContactName),EmailAddress:n.normalise(a.EmailAddress),RankEmailAddress:n.trimEmail(n.normalise(a.EmailAddress)),AccountNumber:n.normalise(a.AccountNumber)},e[a.ContactID]=a,a}),n.filterSortLoad(n,a,{filter:!1,sort:!0,addDefault:!0,newCacheKey:n.normalise(t.getRawValue().substring(0,100),!0)}),!1},load:function(t){return!1}},proxy:new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/ajax/contacts/find",listeners:{beforeload:function(e,n){n[t.queryParam].length>100&&(n[t.queryParam]=n[t.queryParam].substring(0,100))}}})}),t.store.initNormalisers(),!1===Ext.isEmpty(t.value)){var a={ContactID:t.value,Name:t.rawValue,ContactName:"",EmailAddress:"",AccountNumber:""},o=new t.store.recordType(a,t.value);t.store.insert(0,o)}t.defaultEmptyStoreData&&t.loadDefaultStoreData(!0)},setValue:function(t){var e=this,n=t;if(e.valueField){var i=e.findRecord(e.valueField,t);i?n=i.data[e.displayField]:Ext.isDefined(e.valueNotFoundText)&&(n=e.valueNotFoundText)}return n=e.decodeHtml(n),e.lastSelectionText=n,e.hiddenField&&(e.hiddenField.value=Ext.value(t,"")),XERO.widget.contacts.AutoCompleter.superclass.setValue.call(e,n),e.value=t,e},decodeHtml:function(t){return Ext.util.Format.htmlDecode(t.replace(/&#(\d+);/g,function(t,e){try{return String.fromCharCode(e)}catch(e){return t}}))},encodeHtml:function(t){return Ext.util.Format.htmlEncode(t)},listeners:{show:function(){this.lastQuery=this.getRawValue(),this.getValue().length&&this.el.dom.select()},beforequery:function(t){return Ext.EventObject.keyCode!=Ext.EventObject.DOWN||this.isExpanded()?this.lastQuery!==t.query&&void 0:(this.lastQuery+=" ",!0)}},matchesPreviousSelection:function(t){var e=this.selectionHistory;return e.length>1&&t==e[e.length-2].value}}),function(){Ext.ns("XERO.NewIndicator"),XERO.NewIndicator=Ext.extend(Ext.BoxComponent,{html:"NEW",cls:"x-new-indicator",hidden:!0,hideMode:"display"})}()},function(t,e){Ext.define("XERO.widget.projects.AutoCompleter",{extend:"Ext.form.ComboBox",width:150,addToGlobals:!0,cls:"autocompleter",listClass:"autocompleter-contacts",useFakeInput:!0,showNewContactOption:!0,selectionHistory:[],defaultEmptyStoreData:null,hideTrigger:!0,initComponent:function(){var t=this,e=t.getId();e&&(t.id=Ext.String.format("{0}_value",e),t.configId=e),t.newContactText||(t.newContactText="+ New Contact");var n=Ext.get(Ext.String.format("{0}_newIndicator",e));n&&(t.newIndicator=new XERO.NewIndicator({renderTo:n,listeners:{show:function(){this.container.addClass("x-new-indicator-showing")},hide:function(){this.container.removeClass("x-new-indicator-showing")}}})),Ext.fly(Ext.String.format("{0}_fake",t.id))&&Ext.fly(Ext.String.format("{0}_fake",t.id)).remove(),Ext.apply(t,{valueField:"ContactID",displayField:"Name",mode:t.defaultEmptyStoreData?"local":"remote",loadingText:PROJECTS.isProjectsUser?"Finding...":"Finding customers...",queryParam:"term",selectOnFocus:!1,lazyRender:!0,minChars:1,itemSelector:"div.search-item",hideMode:"display",listWidth:200}),t.buildStore(),t.buildResultsTpl(),t.defaultEmptyStoreData&&this.addDefaultEmptyStoreDataEvents(),t.callParent(arguments),t.useFakeInput&&t.on("render",function(){t.getEl()&&(t.fakeValueField=new Ext.form.Hidden({id:e,name:e,renderTo:t.getEl().parent()}),t.element=t.getEl(),t.placeholder&&(t.element.dom.placeholder=t.placeholder),Ext.isEmpty(t.value)&&!Ext.isEmpty(t.rawValue)&&t.setRawValue(t.rawValue))}),t.on("beforeselect",t.onBeforeSelect,t),window.autocompleter=t,!0===t.addToGlobals&&Globals.add(Ext.String.format("{0}_completer",e),t)},addDefaultEmptyStoreDataEvents:function(){var t=this;this.on("keyUp",function(t,e){var n=e.getKey();t.getRawValue().length||"local"!==this.mode||n!==e.DOWN||t.select(t.selectedIndex)}),this.on("afterrender",function(){t.addFocusEvent()})},addFocusEvent:function(){this.on("focus",function(){0===this.getValue().length&&"remote"===this.mode&&this.setToLocal()},this)},loadDefaultStoreData:function(t){t&&this.store.suspendEvents(),this.store.loadData(this.defaultEmptyStoreData),t&&this.store.resumeEvents()},onBeforeSelect:function(t,e){return this.selectionHistory.push({value:e.get(t.valueField),display:e.get(t.displayField)}),!0},onSelect:function(t,e){var n=this;!1!==n.fireEvent("beforeselect",n,t,e)&&(n.setValue(t.data[n.valueField||n.displayField]),n.collapse(),n.fireEvent("select",n,t,e),n.lastQuery=t.get(n.displayField),n.fakeValueField&&n.fakeValueField.setValue(t.get(n.valueField)),n.fireOldStyleAfterUpdateHandler(t,e))},onBlur:function(t,e){this.wrap&&this.wrap.removeClass(this.wrapFocusClass);var n=this.selectionHistory[this.selectionHistory.length-1];!e.value.length&&n&&n.value.length&&this.selectionHistory.push({value:e.value,display:e.value})},validateBlur:function(){return!1},stepBack:function(t,e){t=t||1;var n=this.selectionHistory.length;if(!(t>n)){var i=this.selectionHistory,a=i[n-(t+(n>1?1:0))];this.setValue(a.value),this.setRawValue(a.display),this.fakeValueField&&this.fakeValueField.setValue(a.value),e||this.selectionHistory.splice(-1,t)}},getPrevious:function(){if(this.selectionHistory.length){var t=this.selectionHistory,e=t[t.length-2];return{display:e.display,value:e.value}}},fireOldStyleAfterUpdateHandler:function(t,e){var n=this,i={key:t.get(n.valueField),value:t.get(n.displayField),data:t.data};""===i.key&&n.newIndicator?n.newIndicator.show():n.newIndicator&&n.newIndicator.hide(),i.data=Ext.apply(i.data,{getValue:function(t){return this[t]}}),n.fireEvent("afterupdate",n,n.getEl(),i)},onKeyUp:function(t){var e=t.getKey();!1===this.editable||!0===this.readOnly||e!=t.BACKSPACE&&e!=t.DELETE&&t.isSpecialKey()||(this.lastKey=e,this.dqTask.delay(this.queryDelay)),this.el.dom.value.length||"local"===this.mode?this.el.dom.value.length&&this.setToRemote():this.setToLocal(),Ext.form.ComboBox.superclass.onKeyUp.call(this,t)},setToLocal:function(){this.defaultEmptyStoreData&&(this.mode="local",this.autoSelect=!1,this.loadDefaultStoreData(),this.view.clearSelections(),this.repositionList&&this.repositionList())},setToRemote:function(){this.defaultEmptyStoreData&&(this.mode="remote",this.autoSelect=!0)},buildResultsTpl:function(){var t=this;t.tpl=new Ext.XTemplate('<div class="search-list">',"<tpl if=\"this.contacts().length &gt; 0 && this.contacts()[0].Name !== 'Decide customer later' \">",'<div class="autocompleter-section-heading">Customers</div>',"</tpl>",'<tpl for="this.contacts()">','<tpl if="values.DefaultStoreValue">','<div class="search-item">','<span class="search-item-name search-item-name-only">{values.Name}{values}</span>',"</div>","</tpl>",'<tpl if="!values.DefaultStoreValue">','<tpl if="this.isValidString(values.ContactName) || this.isValidString(values.EmailAddress) && !values.ProjectID">','<div class="search-item">','<tpl if="this.isValidString(values.AccountNumber)">','<span class="search-item-name">{[ this.boldQueryMatch(values.Name) ]} ({[ this.boldQueryMatch(Ext.util.Format.ellipsis(values.AccountNumber, 20)) ]})</span>',"</tpl>",'<tpl if="!this.isValidString(values.AccountNumber)">','<span class="search-item-name">{[ this.boldQueryMatch(values.Name) ]}</span>',"</tpl>",'<tpl if="this.isValidString(values.ContactName) && this.isValidString(values.EmailAddress)">','<span class="search-item-name">{[ this.boldQueryMatch(values.ContactName) ]}, {[ this.boldQueryMatch(values.EmailAddress) ]}</span>',"</tpl>",'<tpl if="!this.isValidString(values.ContactName) || !this.isValidString(values.EmailAddress)">','<span class="search-item-name">{[ this.boldQueryMatch(values.ContactName) ]}{[ this.boldQueryMatch(values.EmailAddress) ]}</span>',"</tpl>","</div>","</tpl>",'<tpl if="!this.isValidString(values.ContactName) && !this.isValidString(values.EmailAddress) && this.isValidString(values.ContactID) && !values.ProjectID">','<div class="search-item">','<tpl if="this.isValidString(values.AccountNumber)">','<span class="search-item-name search-item-name-only">{[ this.boldQueryMatch(values.Name) ]} ({[ this.boldQueryMatch(Ext.util.Format.ellipsis(values.AccountNumber, 20)) ]})</span>',"</tpl>",'<tpl if="!this.isValidString(values.AccountNumber)">','<span class="search-item-name search-item-name-only">{[ this.boldQueryMatch(values.Name) ]}</span>',"</tpl>","</div>","</tpl>",'<tpl if="!this.isValidString(values.ContactID) && this.showNewContactOption">','<div class="search-item">',"<span>"+t.newContactText+"</span>","</div>","</tpl>","</tpl>","</tpl>",'<tpl if="this.projects().length &gt; 0">','<div class="autocompleter-section-heading">Projects - In progress</div>',"</tpl>",'<tpl for="this.projects()">','<div class="search-item">','<span class="search-item-name search-item-name-only">{[ this.boldQueryMatch(values.ProjectName) ]}</span>','<span class="search-item-name search-item-project-contact">{[ this.boldQueryMatch(values.Name) ]}</span>',"</div>","</tpl>","</div>",{contacts:function(){return t.store.data.filterBy(function(t){return""===t.data.ProjectID}).items.map(function(t){return t.data})},projects:function(){return t.store.data.filterBy(function(t){return""!==t.data.ProjectID}).items.map(function(t){return t.data})},showNewContactOption:t.showNewContactOption,compiled:!0,isValidString:function(t){return/\S/.test(t)},boldQueryMatch:function(e){var n=t.store.highlightRx;return n?Ext.util.Format.htmlEncode(e).replace(n,'<strong class="query-match">$1</strong>'):e}})},buildStore:function(){var t=this,e={},n={};if(t.queryDelay=100,t.store=new Ext.data.Store({highlightRx:null,reader:new Ext.data.JsonReader({idProperty:"ProjectID"},[{name:"ContactID"},{name:"Name"},{name:"ProjectID",useNull:!0},{name:"ProjectName",useNull:!0},{name:"ContactName",useNull:!0},{name:"AccountNumber",useNull:!0},{name:"EmailAddress",useNull:!0},{name:"ARGSTCode",useNull:!0},{name:"APGSTCode",useNull:!0},{name:"ContactDefaultCurrency",useNull:!0},{name:"OrganisationTemplate",useNull:!0},{name:"Discount",useNull:!0},{name:"ContactDefaultBillDueDate",useNull:!0},{name:"ContactDefaultBillDueType",useNull:!0},{name:"ContactDefaultBillDueTypeDisplay",useNull:!0},{name:"ContactDefaultInvoiceDueDate",useNull:!0},{name:"ContactDefaultInvoiceDueType",useNull:!0},{name:"ContactDefaultInvoiceDueTypeDisplay",useNull:!0},{name:"DefaultAPContactAccountType",useNull:!0},{name:"DefaultARContactAccountType",useNull:!0},{name:"DefaultARTrackingCategories",useNull:!0},{name:"DefaultAPTrackingCategories",useNull:!0},{name:"DefaultTaxSales",useNull:!0},{name:"DefaultTaxBills",useNull:!0},{name:"DefaultStoreValue",useNull:!0}]),testValues:function(t,e){var n;for(n=0,len=t.length;n<len;n++)if(t[n].length>0&&e.test(t[n]))return!0;return!1},trimEmail:function(t){var e,n;return(e=t.indexOf("@"))>=0&&(n=t.indexOf(".",e+1))>=0?t.substring(0,n):""},rxEscape:function(t,e){var n,i,a;if(t=t.replace(/([ #$()*+.?[\\^{|])/g,"\\$&"),e){n=this.getAccentEquivalence();for(i in n)a=1===i.length?"["+i+n[i]+"]":"(?:"+[i].concat(n[i].split("")).join("|")+")",t=t.replace(new RegExp(a,"gi"),a)}return t},getAccentEquivalence:function(){return{a:"",c:"",d:"",e:"",f:"",i:"",n:"",o:"",s:"",t:"",u:"",y:"",z:"",ae:"",oe:"",ss:"",tm:""}},anyAccent:null,initNormalisers:function(){var t,e="",n=this.getAccentEquivalence();for(t in n)this.normalisers[t]=new RegExp("["+n[t]+"]","gi"),e+=n[t];this.anyAccent=new RegExp("["+e+"]","i")},normalisers:{},normalise:function(t){var e;if(t&&(t=t.toLowerCase(),this.anyAccent.test(t)))for(e in this.normalisers)t=t.replace(this.normalisers[e],e);return t},filterSortLoad:function(e,i,a){var o,r,s,l=0,u=t.getRawValue().toLowerCase(),c=e.normalise(u),d=e.rxEscape(c.substring(0,100),!1),h=!1,f=[];for(e.highlightRx=new RegExp("((?:"+Ext.util.Format.htmlEncode(e.rxEscape(u,!0))+")+)((?:(?!\\w*;))+)","gi"),a&&a.filter&&(r=new RegExp(d,"i"),i=i.filter(function(t){var n=t.shadow;return e.testValues([n.Name,n.AccountNumber,n.ContactName,n.EmailAddress],r)})),i=i.filter(function(t){return""===t.ProjectID||(f.push(t),!1)}),a&&a.sort&&(s=new RegExp("(?:(?:^| )'|(?:^|[ @#$&.,:;/\\+=~!?\"|()[}{}<>]))"+d,"i"),i=i.map(function(t){var n=t.shadow;return n.ProjectID?(f.push(t),!1):(n.Rank=e.testValues([n.Name+" "+n.AccountNumber+" "+n.ContactName+" "+n.RankEmailAddress],s),t)}).sort(function(t,e){return t.shadow.Rank&&!e.shadow.Rank?-1:!t.shadow.Rank&&e.shadow.Rank?1:t.shadow.Name<e.shadow.Name?-1:t.shadow.Name>e.shadow.Name?1:0})),a&&a.newCacheKey&&(n[a.newCacheKey]=i.map(function(t){return t.ContactID})),o=0,len=i.length;o<len;o++){var p=i[o];if(0===p.shadow.Name.indexOf(c)){h||p.shadow.Name!==c||(h=!0),l=o;break}}a&&a.addDefault&&!h&&t.showNewContactOption&&i.push({Name:t.getRawValue()}),e.dataLoaded=!0;for(var o=0;o<f.length;o++)i.push(f[o]);e.loadData(i),t.selectedIndex=l-1,t.selectNext()},listeners:{beforeload:function(e){e.normalise(t.getRawValue().substring(0,100),!0);if(e.dataLoaded=!1,Ext.isArray(void 0))return e.filterSortLoad(e,void 0,void 0),!1;t.minChars>0&&(t.minChars=0,t.queryDelay=0)},datachanged:function(n){if(!n.dataLoaded)return i=n.data.items.map(function(i){var a=i.data;return a.Name=t.decodeHtml(a.Name),a.ContactName=t.decodeHtml(a.ContactName),a.EmailAddress=t.decodeHtml(a.EmailAddress),a.AccountNumber=t.decodeHtml(a.AccountNumber),a.shadow={Name:n.normalise(a.Name),ContactName:n.normalise(a.ContactName),EmailAddress:n.normalise(a.EmailAddress),RankEmailAddress:n.trimEmail(n.normalise(a.EmailAddress)),AccountNumber:n.normalise(a.AccountNumber)},e[a.ContactID]=a,a}),n.filterSortLoad(n,i,{filter:!1,sort:!0,addDefault:!0,newCacheKey:n.normalise(t.getRawValue().substring(0,100),!0)}),!1},load:function(t){return!1}},proxy:new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/ajax/projects/projectslookup",listeners:{beforeload:function(e,n){n[t.queryParam].length>100&&(n[t.queryParam]=n[t.queryParam].substring(0,100))}}})}),t.store.initNormalisers(),!1===Ext.isEmpty(t.value)){var i={ContactID:t.value,Name:t.rawValue,ContactName:"",EmailAddress:"",AccountNumber:""},a=new t.store.recordType(i,t.value);t.store.insert(0,a)}t.defaultEmptyStoreData&&t.loadDefaultStoreData(!0)},setValue:function(t){var e=this,n=t;if(e.valueField){var i=e.findRecord(e.valueField,t);i?n=i.data[e.displayField]:Ext.isDefined(e.valueNotFoundText)&&(n=e.valueNotFoundText)}n=e.decodeHtml(n),e.lastSelectionText=n,e.hiddenField&&(e.hiddenField.value=Ext.value(t,""));var a=e.store.data.items[e.selectedIndex];return a&&""!==a.data.ProjectName&&""!==t&&(n=a.data.ProjectName),XERO.widget.contacts.AutoCompleter.superclass.setValue.call(e,n),e.value=t,e},decodeHtml:function(t){return Ext.util.Format.htmlDecode(t.replace(/&#(\d+);/g,function(t,e){try{return String.fromCharCode(e)}catch(e){return t}}))},encodeHtml:function(t){return Ext.util.Format.htmlEncode(t)},listeners:{show:function(){this.lastQuery=this.getRawValue(),this.getValue().length&&this.el.dom.select()},beforequery:function(t){return Ext.EventObject.keyCode!=Ext.EventObject.DOWN||this.isExpanded()?this.lastQuery!==t.query&&void 0:(this.lastQuery+=" ",!0)}},matchesPreviousSelection:function(t){var e=this.selectionHistory;return e.length>1&&t==e[e.length-2].value}}),function(){Ext.ns("XERO.NewIndicator"),XERO.NewIndicator=Ext.extend(Ext.BoxComponent,{html:"NEW",cls:"x-new-indicator",hidden:!0,hideMode:"display"})}()},function(t,e){!function(){var t=Date,e=t.prototype,n=XERO.globalization.CultureInfo,i=function(t,e){return e||(e=2),("000"+t).slice(-1*e)};e.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},e.setTimeToNow=function(){var t=new Date;return this.setHours(t.getHours()),this.setMinutes(t.getMinutes()),this.setSeconds(t.getSeconds()),this.setMilliseconds(t.getMilliseconds()),this},t.today=function(){return(new Date).clearTime()},t.compare=function(t,e){if(isNaN(t)||isNaN(e))throw new Error(t+" - "+e);if(t instanceof Date&&e instanceof Date)return t<e?-1:t>e?1:0;throw new TypeError(t+" - "+e)},t.equals=function(t,e){return 0===t.compareTo(e)},t.getDayNumberFromName=function(t){for(var e=n.dayNames,i=n.abbreviatedDayNames,a=n.shortestDayNames,o=t.toLowerCase(),r=0;r<e.length;r++)if(e[r].toLowerCase()==o||i[r].toLowerCase()==o||a[r].toLowerCase()==o)return r;return-1},t.getMonthNumberFromName=function(t){for(var e=n.monthNames,i=n.abbreviatedMonthNames,a=t.toLowerCase(),o=0;o<e.length;o++)if(e[o].toLowerCase()==a||i[o].toLowerCase()==a)return o;return-1},t.isLeapYear=function(t){return t%4==0&&t%100!=0||t%400==0},t.getDaysInMonth=function(e,n){return[31,t.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][n]},t.getTimezoneAbbreviation=function(t){for(var e=n.timezones,i=0;i<e.length;i++)if(e[i].offset===t)return e[i].name;return null},t.getTimezoneOffset=function(t){for(var e=n.timezones,i=0;i<e.length;i++)if(e[i].name===t.toUpperCase())return e[i].offset;return null},e.clone=function(){return new Date(this.getTime())},e.compareTo=function(t){return Date.compare(this,t)},e.equals=function(t){return Date.equals(this,t||new Date)},e.between=function(t,e){return this.getTime()>=t.getTime()&&this.getTime()<=e.getTime()},e.isAfter=function(t){return 1===this.compareTo(t||new Date)},e.isBefore=function(t){return-1===this.compareTo(t||new Date)},e.isToday=e.isSameDay=function(t){return this.clone().clearTime().equals((t||new Date).clone().clearTime())},e.addMilliseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+1*t),this},e.addSeconds=function(t){return this.addMilliseconds(1e3*t)},e.addMinutes=function(t){return this.addMilliseconds(6e4*t)},e.addHours=function(t){return this.addMilliseconds(36e5*t)},e.addDays=function(t){return this.setDate(this.getDate()+1*t),this},e.addWeeks=function(t){return this.addDays(7*t)},e.addMonths=function(e){var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*e),this.setDate(Math.min(n,t.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},e.addYears=function(t){return this.addMonths(12*t)},e.add=function(t){if("number"==typeof t)return this._orient=t,this;var e=t;return e.milliseconds&&this.addMilliseconds(e.milliseconds),e.seconds&&this.addSeconds(e.seconds),e.minutes&&this.addMinutes(e.minutes),e.hours&&this.addHours(e.hours),e.weeks&&this.addWeeks(e.weeks),e.months&&this.addMonths(e.months),e.years&&this.addYears(e.years),e.days&&this.addDays(e.days),this};var a,o,r;e.getWeek=function(){var t,e,n,i,s,l,u,c,d,h;return a=a||this.getFullYear(),o=o||this.getMonth()+1,r=r||this.getDate(),o<=2?(t=a-1,e=(t/4|0)-(t/100|0)+(t/400|0),n=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0),d=e-n,s=0,l=r-1+31*(o-1)):(t=a,e=(t/4|0)-(t/100|0)+(t/400|0),n=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0),d=e-n,s=d+1,l=r+(153*(o-3)+2)/5+58+d),u=(t+e)%7,i=(l+u-s)%7,c=l+3-i|0,h=c<0?53-((u-d)/5|0):c>364+d?1:1+(c/7|0),a=o=r=null,h},e.getISOWeek=function(){return a=this.getUTCFullYear(),o=this.getUTCMonth()+1,r=this.getUTCDate(),i(this.getWeek())},e.setWeek=function(t){return this.moveToDayOfWeek(1).addWeeks(t-this.getWeek())};var s=function(t,e,n,i){if(void 0===t)return!1;if("number"!=typeof t)throw new TypeError(t+" is not a Number.");if(t<e||t>n)throw new RangeError(t+" is not a valid value for "+i+".");return!0};t.validateMillisecond=function(t){return s(t,0,999,"millisecond")},t.validateSecond=function(t){return s(t,0,59,"second")},t.validateMinute=function(t){return s(t,0,59,"minute")},t.validateHour=function(t){return s(t,0,23,"hour")},t.validateDay=function(e,n,i){return s(e,1,t.getDaysInMonth(n,i),"day")},t.validateMonth=function(t){return s(t,0,11,"month")},t.validateYear=function(t){return s(t,0,9999,"year")},e.set=function(e){return t.validateMillisecond(e.millisecond)&&this.addMilliseconds(e.millisecond-this.getMilliseconds()),t.validateSecond(e.second)&&this.addSeconds(e.second-this.getSeconds()),t.validateMinute(e.minute)&&this.addMinutes(e.minute-this.getMinutes()),t.validateHour(e.hour)&&this.addHours(e.hour-this.getHours()),t.validateMonth(e.month)&&this.addMonths(e.month-this.getMonth()),t.validateYear(e.year)&&this.addYears(e.year-this.getFullYear()),t.validateDay(e.day,this.getFullYear(),this.getMonth())&&this.addDays(e.day-this.getDate()),e.timezone&&this.setTimezone(e.timezone),e.timezoneOffset&&this.setTimezoneOffset(e.timezoneOffset),e.week&&s(e.week,0,53,"week")&&this.setWeek(e.week),this},e.moveToFirstDayOfMonth=function(){return this.set({day:1})},e.moveToLastDayOfMonth=function(){return this.set({day:t.getDaysInMonth(this.getFullYear(),this.getMonth())})},e.moveToNthOccurrence=function(t,e){var n=0;if(e>0)n=e-1;else if(-1===e)return this.moveToLastDayOfMonth(),this.getDay()!==t&&this.moveToDayOfWeek(t,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(t,1).addWeeks(n)},e.moveToDayOfWeek=function(t,e){var n=(t-this.getDay()+7*(e||1))%7;return this.addDays(0===n?n+=7*(e||1):n)},e.moveToMonth=function(t,e){var n=(t-this.getMonth()+12*(e||1))%12;return this.addMonths(0===n?n+=12*(e||1):n)},e.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},e.getTimezone=function(){return t.getTimezoneAbbreviation(this.getUTCOffset())},e.setTimezoneOffset=function(t){var e=this.getTimezoneOffset(),n=-6*Number(t)/10;return this.addMinutes(n-e)},e.setTimezone=function(e){return this.setTimezoneOffset(t.getTimezoneOffset(e))},e.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},e.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset()},e.getUTCOffset=function(){var t,e=-10*this.getTimezoneOffset()/6;return e<0?(t=(e-1e4).toString(),t.charAt(0)+t.substr(2)):(t=(e+1e4).toString(),"+"+t.substr(1))},e.getElapsed=function(t){return(t||new Date)-this},e.toISOString||(e.toISOString=function(){function t(t){return t<10?"0"+t:t}return'"'+this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+'Z"'}),e._toString=e.toString,e.toString=function(t){var e=this;if(t&&1==t.length){var a=n.formatPatterns;switch(e.t=e.toString,t){case"d":return e.t(a.shortDate);case"D":return e.t(a.longDate);case"F":return e.t(a.fullDateTime);case"m":return e.t(a.monthDay);case"r":return e.t(a.rfc1123);case"s":return e.t(a.sortableDateTime);case"t":return e.t(a.shortTime);case"T":return e.t(a.longTime);case"u":return e.t(a.universalSortableDateTime);case"y":return e.t(a.yearMonth)}}var o=function(t){switch(1*t){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return t?t.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(t){if("\\"===t.charAt(0))return t.replace("\\","");switch(e.h=e.getHours,t){case"hh":return i(e.h()<13?0===e.h()?12:e.h():e.h()-12);case"h":return e.h()<13?0===e.h()?12:e.h():e.h()-12;case"HH":return i(e.h());case"H":return e.h();case"mm":return i(e.getMinutes());case"m":return e.getMinutes();case"ss":return i(e.getSeconds());case"s":return e.getSeconds();case"yyyy":return i(e.getFullYear(),4);case"yy":return i(e.getFullYear());case"dddd":return n.dayNames[e.getDay()];case"ddd":return n.abbreviatedDayNames[e.getDay()];case"dd":return i(e.getDate());case"d":return e.getDate();case"MMMM":return n.monthNames[e.getMonth()];case"MMM":return n.abbreviatedMonthNames[e.getMonth()];case"MM":return i(e.getMonth()+1);case"M":return e.getMonth()+1;case"t":return e.h()<12?n.amDesignator.substring(0,1):n.pmDesignator.substring(0,1);case"tt":return e.h()<12?n.amDesignator:n.pmDesignator;case"S":return o(e.getDate());default:return t}}):this._toString()}}()},function(t,e){!function(){var t=Date,e=t.prototype,n=XERO.globalization.CultureInfo,i=Number.prototype;e._orient=1,e._nth=null,e._is=!1,e._same=!1,e._isSecond=!1,i._dateElement="day",e.next=function(){return this._orient=1,this},t.next=function(){return t.today().next()},e.last=e.prev=e.previous=function(){return this._orient=-1,this},t.last=t.prev=t.previous=function(){return t.today().last()},e.is=function(){return this._is=!0,this},e.same=function(){return this._same=!0,this._isSecond=!1,this},e.today=function(){return this.same().day()},e.weekday=function(){return!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},e.at=function(e){return"string"==typeof e?t.parse(this.toString("d")+" "+e):this.set(e)},i.fromNow=i.after=function(t){var e={};return e[this._dateElement]=this,(t?t.clone():new Date).add(e)},i.ago=i.before=function(t){var e={};return e[this._dateElement]=-1*this,(t?t.clone():new Date).add(e)};var a,o="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),r="january february march april may june july august september october november december".split(/\s/),s="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),l="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),u="final first second third fourth fifth".split(/\s/);e.toObject=function(){for(var t={},e=0;e<s.length;e++)t[s[e].toLowerCase()]=this["get"+l[e]]();return t},t.fromObject=function(t){return t.week=null,Date.today().set(t)};for(var c=0;c<o.length;c++)t[o[c].toUpperCase()]=t[o[c].toUpperCase().substring(0,3)]=c,t[o[c]]=t[o[c].substring(0,3)]=function(e){return function(){var i=t.today(),a=e-i.getDay();return 0===e&&1===n.firstDayOfWeek&&0!==i.getDay()&&(a+=7),i.addDays(a)}}(c),e[o[c]]=e[o[c].substring(0,3)]=function(e){return function(){if(this._is)return this._is=!1,this.getDay()==e;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var i=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(e,n),this>i)throw new RangeError(t.getDayName(e)+" does not occur "+n+" times in the month of "+t.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(e,this._orient)}}(c);for(var d=0;d<r.length;d++)t[r[d].toUpperCase()]=t[r[d].toUpperCase().substring(0,3)]=d,t[r[d]]=t[r[d].substring(0,3)]=function(e){return function(){return t.today().set({month:e,day:1})}}(d),e[r[d]]=e[r[d].substring(0,3)]=function(t){return function(){return this._is?(this._is=!1,this.getMonth()===t):this.moveToMonth(t,this._orient)}}(d);for(var h=function(t){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var e=this.toObject(),n=(arguments[0]||new Date).toObject(),i="",a=t.toLowerCase(),o=s.length-1;o>-1;o--){if(i=s[o].toLowerCase(),e[i]!=n[i])return!1;if(a==i)break}return!0}return"s"!=t.substring(t.length-1)&&(t+="s"),this["add"+t](this._orient)}},f=0;f<s.length;f++)a=s[f].toLowerCase(),e[a]=e[a+"s"]=h(s[f]),i[a]=i[a+"s"]=function(t){return function(){return this._dateElement=t,this}}(a);e._ss=h("Second");for(var p=function(t){return function(e){return this._same?this._ss(arguments[0]):e||0===e?this.moveToNthOccurrence(e,t):(this._nth=t,2!==t||void 0!==e&&null!==e?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},m=0;m<u.length;m++)e[u[m]]=p(0===m?-1:m)}()},function(t,e){!function(){Date.Parsing={Exception:function(t){this.message="Parse error at '"+t.substring(0,10)+" ...'"}};for(var t=Date.Parsing,e=t.Operators={rtoken:function(e){return function(n){var i=n.match(e);if(i)return[i[0],n.substring(i[0].length)];throw new t.Exception(n)}},token:function(t){return function(t){return e.rtoken(new RegExp("^s*"+t+"s*"))(t)}},stoken:function(t){return e.rtoken(new RegExp("^"+t))},until:function(t){return function(e){for(var n=[],i=null;e.length;){try{i=t.call(this,e)}catch(t){n.push(i[0]),e=i[1];continue}break}return[n,e]}},many:function(t){return function(e){for(var n=[],i=null;e.length;){try{i=t.call(this,e)}catch(t){return[n,e]}n.push(i[0]),e=i[1]}return[n,e]}},optional:function(t){return function(e){var n=null;try{n=t.call(this,e)}catch(t){return[null,e]}return[n[0],n[1]]}},not:function(e){return function(n){try{e.call(this,n)}catch(t){return[null,n]}throw new t.Exception(n)}},ignore:function(t){return t?function(e){var n=null;return n=t.call(this,e),[null,n[1]]}:null},product:function(){for(var t=arguments[0],n=Array.prototype.slice.call(arguments,1),i=[],a=0;a<t.length;a++)i.push(e.each(t[a],n));return i},cache:function(e){var n={},i=null;return function(a){try{i=n[a]=n[a]||e.call(this,a)}catch(t){i=n[a]=t}if(i instanceof t.Exception)throw i;return i}},any:function(){var e=arguments;return function(n){for(var i=null,a=0;a<e.length;a++)if(null!=e[a]){try{i=e[a].call(this,n)}catch(t){i=null}if(i)return i}throw new t.Exception(n)}},each:function(){var e=arguments;return function(n){for(var i=[],a=null,o=0;o<e.length;o++)if(null!=e[o]){try{a=e[o].call(this,n)}catch(e){throw new t.Exception(n)}i.push(a[0]),n=a[1]}return[i,n]}},all:function(){var t=arguments,e=e;return e.each(e.optional(t))},sequence:function(n,i,a){return i=i||e.rtoken(/^\s*/),a=a||null,1==n.length?n[0]:function(e){for(var o=null,r=null,s=[],l=0;l<n.length;l++){try{o=n[l].call(this,e)}catch(t){break}s.push(o[0]);try{r=i.call(this,o[1])}catch(t){r=null;break}e=r[1]}if(!o)throw new t.Exception(e);if(r)throw new t.Exception(r[1]);if(a)try{o=a.call(this,o[1])}catch(e){throw new t.Exception(o[1])}return[s,o?o[1]:e]}},between:function(t,n,i){i=i||t;var a=e.each(e.ignore(t),n,e.ignore(i));return function(t){var e=a.call(this,t);return[[e[0][0],r[0][2]],e[1]]}},list:function(t,n,i){return n=n||e.rtoken(/^\s*/),i=i||null,t instanceof Array?e.each(e.product(t.slice(0,-1),e.ignore(n)),t.slice(-1),e.ignore(i)):e.each(e.many(e.each(t,e.ignore(n))),px,e.ignore(i))},set:function(n,i,a){return i=i||e.rtoken(/^\s*/),a=a||null,function(o){for(var r=null,s=null,l=null,u=null,c=[[],o],d=!1,h=0;h<n.length;h++){l=null,s=null,r=null,d=1==n.length;try{r=n[h].call(this,o)}catch(t){continue}if(u=[[r[0]],r[1]],r[1].length>0&&!d)try{l=i.call(this,r[1])}catch(t){d=!0}else d=!0;if(d||0!==l[1].length||(d=!0),!d){for(var f=[],p=0;p<n.length;p++)h!=p&&f.push(n[p]);s=e.set(f,i).call(this,l[1]),s[0].length>0&&(u[0]=u[0].concat(s[0]),u[1]=s[1])}if(u[1].length<c[1].length&&(c=u),0===c[1].length)break}if(0===c[0].length)return c;if(a){try{l=a.call(this,c[1])}catch(e){throw new t.Exception(c[1])}c[1]=l[1]}return c}},forward:function(t,e){return function(n){return t[e].call(this,n)}},replace:function(t,e){return function(n){var i=t.call(this,n);return[e,i[1]]}},process:function(t,e){return function(n){var i=t.call(this,n);return[e.call(this,i[0]),i[1]]}},min:function(e,n){return function(i){var a=n.call(this,i);if(a[0].length<e)throw new t.Exception(i);return a}}},n="optional not ignore cache".split(/\s/),i=0;i<n.length;i++)e[n[i]]=function(t){return function(){var e=null,n=[];if(arguments.length>1?e=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(e=arguments[0]),!e)return t.apply(null,arguments);for(var i=0,a=e.shift();i<a.length;i++)return e.unshift(a[i]),n.push(t.apply(null,e)),e.shift(),n}}(e[n[i]]);for(var a="each any all".split(/\s/),o=0;o<a.length;o++)e[a[o]]=function(t){return function(){return arguments[0]instanceof Array?t.apply(null,arguments[0]):t.apply(null,arguments)}}(e[a[o]])}(),function(){var t=Date,e=(t.prototype,XERO.globalization.CultureInfo),n=function(t){for(var e=[],i=0;i<t.length;i++)t[i]instanceof Array?e=e.concat(n(t[i])):t[i]&&e.push(t[i]);return e};t.Grammar={},t.Translator={hour:function(t){return function(){this.hour=Number(t)}},minute:function(t){return function(){this.minute=Number(t)}},second:function(t){return function(){this.second=Number(t)}},meridian:function(t){return function(){this.meridian=t.slice(0,1).toLowerCase()}},timezone:function(t){return function(){var e=t.replace(/[^\d\+\-]/g,"");e.length?this.timezoneOffset=Number(e):this.timezone=t.toLowerCase()}},day:function(t){var e=t[0];return function(){this.day=Number(e.match(/\d+/)[0])}},month:function(t){return function(){this.month=3==t.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(t)/4:Number(t)-1}},year:function(t){return function(){var n=Number(t);this.year=t.length>2?n:n+(n+2e3<e.twoDigitYearMax?2e3:1900)}},rday:function(t){return function(){switch(t){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(e){e=e instanceof Array?e:[e];for(var n=0;n<e.length;n++)e[n]&&e[n].call(this);var i=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear()),this.month||0===this.month||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>t.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var a=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?a.set({timezone:this.timezone}):this.timezoneOffset&&a.set({timezoneOffset:this.timezoneOffset}),a},finish:function(e){if(e=e instanceof Array?n(e):[e],0===e.length)return null;for(var i=0;i<e.length;i++)"function"==typeof e[i]&&e[i].call(this);var a=t.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(a=new Date);var o,r,s,l=!!(this.days&&null!==this.days||this.orient||this.operator);if(s="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||a.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,l=!0),!l&&this.weekday&&!this.day&&!this.days){var u=Date[this.weekday]();this.day=u.getDate(),this.month||(this.month=u.getMonth()),this.year=u.getFullYear()}if(l&&this.weekday&&"month"!=this.unit&&(this.unit="day",o=t.getDayNumberFromName(this.weekday)-a.getDay(),r=7,this.days=o?(o+s*r)%r:s*r),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(a.set({day:1*this.value}),l||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,l=!0),l&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",o=this.month-a.getMonth(),r=12,this.months=o?(o+s*r)%r:s*r,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*s:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*s),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){var u=Date[this.weekday]();this.day=u.getDate(),u.getMonth()!==a.getMonth()&&(this.month=u.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(l&&this.timezone&&this.day&&this.days&&(this.day=this.days),l?a.add(this):a.set(this)):Date.today().setWeek(this.value)}};var i,a=t.Parsing.Operators,o=t.Grammar,r=t.Translator;o.datePartDelimiter=a.rtoken(/^([\s\-\.\,\/\x27]+)/),o.timePartDelimiter=a.stoken(":"),o.whiteSpace=a.rtoken(/^\s*/),o.generalDelimiter=a.rtoken(/^(([\s\,]|at|@|on)+)/);var s={};o.ctoken=function(t){var n=s[t];if(!n){for(var i=e.regexPatterns,o=t.split(/\s+/),r=[],l=0;l<o.length;l++)r.push(a.replace(a.rtoken(i[o[l]]),o[l]));n=s[t]=a.any.apply(null,r)}return n},o.ctoken2=function(t){return a.rtoken(e.regexPatterns[t])},o.h=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),r.hour)),o.hh=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2])/),r.hour)),o.H=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),r.hour)),o.HH=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3])/),r.hour)),o.m=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),r.minute)),o.mm=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),r.minute)),o.s=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),r.second)),o.ss=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),r.second)),o.hms=a.cache(a.sequence([o.H,o.m,o.s],o.timePartDelimiter)),o.t=a.cache(a.process(o.ctoken2("shortMeridian"),r.meridian)),o.tt=a.cache(a.process(o.ctoken2("longMeridian"),r.meridian)),o.z=a.cache(a.process(a.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),r.timezone)),o.zz=a.cache(a.process(a.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),r.timezone)),o.zzz=a.cache(a.process(o.ctoken2("timezone"),r.timezone)),o.timeSuffix=a.each(a.ignore(o.whiteSpace),a.set([o.tt,o.zzz])),o.time=a.each(a.optional(a.ignore(a.stoken("T"))),o.hms,o.timeSuffix),o.d=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1]|\d)/),a.optional(o.ctoken2("ordinalSuffix"))),r.day)),o.dd=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1])/),a.optional(o.ctoken2("ordinalSuffix"))),r.day)),o.ddd=o.dddd=a.cache(a.process(o.ctoken("sun mon tue wed thu fri sat"),function(t){return function(){this.weekday=t}})),o.M=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d|\d)/),r.month)),o.MM=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d)/),r.month)),o.MMM=o.MMMM=a.cache(a.process(o.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),r.month)),o.y=a.cache(a.process(a.rtoken(/^(\d\d?)/),r.year)),o.yy=a.cache(a.process(a.rtoken(/^(\d\d)/),r.year)),o.yyy=a.cache(a.process(a.rtoken(/^(\d\d?\d?\d?)/),r.year)),o.yyyy=a.cache(a.process(a.rtoken(/^(\d\d\d\d)/),r.year)),i=function(){return a.each(a.any.apply(null,arguments),a.not(o.ctoken2("timeContext")))},o.day=i(o.d,o.dd),o.month=i(o.M,o.MMM),o.year=i(o.yyyy,o.yy),o.orientation=a.process(o.ctoken("past future"),function(t){return function(){this.orient=t}}),o.operator=a.process(o.ctoken("add subtract"),function(t){return function(){this.operator=t}}),o.rday=a.process(o.ctoken("yesterday tomorrow today now"),r.rday),o.unit=a.process(o.ctoken("second minute hour day week month year"),function(t){return function(){this.unit=t}}),o.value=a.process(a.rtoken(/^\d\d?(st|nd|rd|th)?/),function(t){return function(){this.value=t.replace(/\D/g,"")}}),o.expression=a.set([o.rday,o.operator,o.value,o.unit,o.orientation,o.ddd,o.MMM]),i=function(){return a.set(arguments,o.datePartDelimiter)},o.mdy=i(o.ddd,o.month,o.day,o.year),o.ymd=i(o.ddd,o.year,o.month,o.day),o.dmy=i(o.ddd,o.day,o.month,o.year),o.date=function(t){return(o[e.dateElementOrder]||o.mdy).call(this,t)},o.format=a.process(a.many(a.any(a.process(a.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(e){if(o[e])return o[e];throw t.Parsing.Exception(e)}),a.process(a.rtoken(/^[^dMyhHmstz]+/),function(t){return a.ignore(a.stoken(t))}))),function(t){return a.process(a.each.apply(null,t),r.finishExact)});var l={},u=function(t){return l[t]=l[t]||o.format(t)[0]};o.formats=function(t){if(t instanceof Array){for(var e=[],n=0;n<t.length;n++)e.push(u(t[n]));return a.any.apply(null,e)}return u(t)},o._formats=o.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),o._start=a.process(a.set([o.date,o.time,o.expression],o.generalDelimiter,o.whiteSpace),r.finish),o.start=function(t){try{var e=o._formats.call({},t);if(0===e[1].length)return e}catch(t){}return o._start.call({},t)},t._parse=t.parse,t.parse=function(e){var n=null;if(!e)return null;if(e instanceof Date)return e;try{n=t.Grammar.start.call({},e.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(t){return null}return 0===n[1].length?n[0]:null},t.getParseFunction=function(e){var n=t.Grammar.formats(e);return function(t){var e=null;try{e=n.call({},t)}catch(t){return null}return 0===e[1].length?e[0]:null}},t.parseExact=function(e,n){return t.getParseFunction(n)(e)}}()},function(t,e){!function(){var t=Date,e=t.prototype,n=(XERO.globalization.CultureInfo,[]),i=function(t,e){return e||(e=2),("000"+t).slice(-1*e)};t.normalizeFormat=function(t){n=[];(new Date).$format(t);return n.join("")},t.strftime=function(t,e){return new Date(1e3*e).$format(t)},t.strtotime=function(e){var n=t.parse(e);return n.addMinutes(-1*n.getTimezoneOffset()),Math.round(t.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())/1e3)},e.$format=function(e){var a,o=this,r=function(t){return n.push(t),o.toString(t)};return e?e.replace(/(%|\\)?.|%%/g,function(e){if("\\"===e.charAt(0)||"%%"===e.substring(0,2))return e.replace("\\","").replace("%%","%");switch(e){case"d":case"%d":return r("dd");case"D":case"%a":return r("ddd");case"j":case"%e":return r("d");case"l":case"%A":return r("dddd");case"N":case"%u":return o.getDay()+1;case"S":return r("S");case"w":case"%w":return o.getDay();case"z":return o.getOrdinalNumber();case"%j":return i(o.getOrdinalNumber(),3);case"%U":var s=o.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),l=o.clone().addDays(1).moveToDayOfWeek(0,-1);return l<s?"00":i((l.getOrdinalNumber()-s.getOrdinalNumber())/7+1);case"W":case"%V":return o.getISOWeek();case"%W":return i(o.getWeek());case"F":case"%B":return r("MMMM");case"m":case"%m":return r("MM");case"M":case"%b":case"%h":return r("MMM");case"n":return r("M");case"t":return t.getDaysInMonth(o.getFullYear(),o.getMonth());case"L":return t.isLeapYear(o.getFullYear())?1:0;case"o":case"%G":return o.setWeek(o.getISOWeek()).toString("yyyy");case"%g":return o.$format("%G").slice(-2);case"Y":case"%Y":return r("yyyy");case"y":case"%y":return r("yy");case"a":case"%p":return r("tt").toLowerCase();case"A":return r("tt").toUpperCase();case"g":case"%I":return r("h");case"G":return r("H");case"h":return r("hh");case"H":case"%H":return r("HH");case"i":case"%M":return r("mm");case"s":case"%S":return r("ss");case"u":return i(o.getMilliseconds(),3);case"I":return o.isDaylightSavingTime()?1:0;case"O":return o.getUTCOffset();case"P":return a=o.getUTCOffset(),a.substring(0,a.length-2)+":"+a.substring(a.length-2);case"e":case"T":case"%z":case"%Z":return o.getTimezone();case"Z":return-60*o.getTimezoneOffset();case"B":var u=new Date;return Math.floor((3600*u.getHours()+60*u.getMinutes()+u.getSeconds()+60*(u.getTimezoneOffset()+60))/86.4);case"c":return o.toISOString().replace(/\"/g,"");case"U":return t.strtotime("now");case"%c":return r("d")+" "+r("t");case"%C":return Math.floor(o.getFullYear()/100+1);case"%D":return r("MM/dd/yy");case"%n":return"\\n";case"%t":return"\\t";case"%r":return r("hh:mm tt");case"%R":return r("H:mm");case"%T":return r("H:mm:ss");case"%x":return r("d");case"%X":return r("t");default:return n.push(e),e}}):this._toString()},e.format||(e.format=e.$format)}()},function(t,e){window.TimeSpan=function(t,e,n,i,a){for(var o="days hours minutes seconds milliseconds".split(/\s+/),r=0;r<o.length;r++){var s=o[r],l=s.slice(0,1).toUpperCase()+s.slice(1);TimeSpan.prototype[s]=0,TimeSpan.prototype["get"+l]=function(t){return function(){return this[t]}}(s),TimeSpan.prototype["set"+l]=function(t){return function(e){return this[t]=e,this}}(s)}if(4==arguments.length)this.setDays(t),this.setHours(e),this.setMinutes(n),this.setSeconds(i);else if(5==arguments.length)this.setDays(t),this.setHours(e),this.setMinutes(n),this.setSeconds(i),this.setMilliseconds(a);else if(1==arguments.length&&"number"==typeof t){var u=t<0?-1:1;this.setMilliseconds(Math.abs(t)),this.setDays(Math.floor(this.getMilliseconds()/864e5)*u),this.setMilliseconds(this.getMilliseconds()%864e5),this.setHours(Math.floor(this.getMilliseconds()/36e5)*u),this.setMilliseconds(this.getMilliseconds()%36e5),this.setMinutes(Math.floor(this.getMilliseconds()/6e4)*u),this.setMilliseconds(this.getMilliseconds()%6e4),this.setSeconds(Math.floor(this.getMilliseconds()/1e3)*u),this.setMilliseconds(this.getMilliseconds()%1e3),this.setMilliseconds(this.getMilliseconds()*u)}return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(t){var e,n=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return e=null===t?new Date(1970,1,1,0,0,0):new Date(1970,1,1,t.getHours(),t.getMinutes(),t.getSeconds()),n<e?-1:n>e?1:0},this.equals=function(t){return 0===this.compareTo(t)},this.add=function(t){return null===t?this:this.addSeconds(t.getTotalMilliseconds()/1e3)},this.subtract=function(t){return null===t?this:this.addSeconds(-t.getTotalMilliseconds()/1e3)},this.addDays=function(t){return new TimeSpan(this.getTotalMilliseconds()+864e5*t)},this.addHours=function(t){return new TimeSpan(this.getTotalMilliseconds()+36e5*t)},this.addMinutes=function(t){return new TimeSpan(this.getTotalMilliseconds()+6e4*t)},this.addSeconds=function(t){return new TimeSpan(this.getTotalMilliseconds()+1e3*t)},this.addMilliseconds=function(t){return new TimeSpan(this.getTotalMilliseconds()+t)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?XERO.globalization.CultureInfo.amDesignator:XERO.globalization.CultureInfo.pmDesignator},this.toString=function(t){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(t){return t.toString().length<2?"0"+t:t};var e=this;return t?t.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(t){switch(t){case"d":return e.getDays();case"dd":return e.p(e.getDays());case"H":return e.getHours();case"HH":return e.p(e.getHours());case"h":return e.get12HourHour();case"hh":return e.p(e.get12HourHour());case"m":return e.getMinutes();case"mm":return e.p(e.getMinutes());case"s":return e.getSeconds();case"ss":return e.p(e.getSeconds());case"t":return(e.getHours()<12?XERO.globalization.CultureInfo.amDesignator:XERO.globalization.CultureInfo.pmDesignator).substring(0,1);case"tt":return e.getHours()<12?XERO.globalization.CultureInfo.amDesignator:XERO.globalization.CultureInfo.pmDesignator}}):this._toString()},this},Date.prototype.getTimeOfDay=function(){return new TimeSpan(0,this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},window.TimePeriod=function(t,e,n,i,a,o,r){for(var s="years months days hours minutes seconds milliseconds".split(/\s+/),l=0;l<s.length;l++){var u=s[l],c=u.slice(0,1).toUpperCase()+u.slice(1);TimePeriod.prototype[u]=0,TimePeriod.prototype["get"+c]=function(t){return function(){return this[t]}}(u),TimePeriod.prototype["set"+c]=function(t){return function(e){return this[t]=e,this}}(u)}if(7==arguments.length)this.years=t,this.months=e,this.setDays(n),this.setHours(i),this.setMinutes(a),this.setSeconds(o),this.setMilliseconds(r);else if(2==arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var d=t.clone(),h=e.clone(),f=d.clone(),p=d>h?-1:1;if(this.years=h.getFullYear()-d.getFullYear(),f.addYears(this.years),1==p?f>h&&0!==this.years&&this.years--:f<h&&0!==this.years&&this.years++,d.addYears(this.years),1==p)for(;d<h&&d.clone().addDays(Date.getDaysInMonth(d.getYear(),d.getMonth()))<h;)d.addMonths(1),this.months++;else for(;d>h&&d.clone().addDays(-d.getDaysInMonth())>h;)d.addMonths(-1),this.months--;var m=h-d;if(0!==m){var g=new TimeSpan(m);this.setDays(g.getDays()),this.setHours(g.getHours()),this.setMinutes(g.getMinutes()),this.setSeconds(g.getSeconds()),this.setMilliseconds(g.getMilliseconds())}}return this}},function(t,e){Ext.ns("XERO"),Ext.ns("XERO.widget"),XERO.widget.DateField=Ext.extend(Ext.form.DateField,{format:"d MMM yyyy",clearable:!1,zIndex:25e3,controlID:null,initComponent:function(){if(XERO.widget.DateField.superclass.initComponent.call(this),this.transform){var t=Ext.getDom(this.transform);this.hiddenName||(this.hiddenName=t.name),t.name=Ext.id(),this.value instanceof Date&&(this.value=new Date(this.value.setHours(this.value.getHours()+12))),this.lazyRender?Ext.removeNode(t):(this.target=!0,this.el=Ext.DomHelper.insertBefore(t,this.getAutoCreate()),this.render(this.el.parentNode,t),Ext.removeNode(t))}this.on({blur:function(t){if(!(t.getValue()instanceof Date))if(t.clearable)t.setRawValue("");else{var e=Date.parse(t.formatDate(new Date));t.setRawValue(t.formatDate(new Date)),t.fireEvent("change",t,e)}this.date_tip&&this.date_tip.hide()},change:function(t,e){!0!==t.defaultToTodaySetting&&!1!==t.defaultToTodaySetting||XERO.bus.fireEvent("setToDateCustomFormValue",e)},scope:this})},onRender:function(t,e){XERO.widget.DateField.superclass.onRender.call(this,t,e),this.el.parent(".x-form-field-wrap").setStyle({float:"left"}),t.setStyle({float:"left",clear:"both"}),this.el.show();var n=this.getEl().up("div.date");n||(n=this.getEl().up("div.field")),n&&(n=n.down("label"))&&(this.date_tip=Ext.DomHelper.append(n,{tag:"a",cls:"icons date-tip",html:"&#160;",href:"javascript:"},!0),this.date_tip.hide(),this.date_tip.on("click",function(t){OrangeGirlTips.show(this.date_tip.dom,"OG_Glossary_DateShortcuts"),this.date_tip.hide()},this))},getAutoCreate:function(){var t=Ext.isObject(this.autoCreate)?this.autoCreate:Ext.apply({},this.defaultAutoCreate);return this.id&&!t.id&&(t.id=this.id),this.id&&!t.name&&(t.name=this.name||this.id),t},parseDate:function(t){if(!(t instanceof Date)){var e=Ext.get(this.id);if(e.hasClass("ARAPDueDate")&&t.charAt(0).match(/[\+\*\-]/)&&t.substring(1).length>0){var n=Ext.fly(e.dom.parentElement.parentElement.getAttribute("parentInvoiceDateId")).getValue();if(n.length>0){for(var i=1;i<=t.length&&!isNaN(t.charAt(i));)i++;var a=t.substring(1,i),o=new Date(n);if(o=new Date(o.setHours(o.getHours()+12)),"+"==t.charAt(0))t.substring(i).trim().match(/^y(ears?)?$/)?t=new Date(o.getFullYear()+parseInt(a),o.getMonth(),o.getDate()).toDateString():t.substring(i).trim().match(/^m(onths?)?$/)?t=new Date(o.getFullYear(),o.getMonth()+parseInt(a),o.getDate()).toDateString():t.substring(i).trim().match(/^w(eeks?)?$/)?t=new Date(o.getFullYear(),o.getMonth(),o.getDate()+7*parseInt(a)).toDateString():(0==t.substring(i).trim().length||t.substring(i).trim().match(/^d(ays?)?$/))&&(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()+parseInt(a)).toDateString());else if("-"==t.charAt(0))t.substring(i).trim().match(/^y(ears?)?$/)?t=new Date(o.getFullYear()-parseInt(a),o.getMonth(),o.getDate()).toDateString():t.substring(i).trim().match(/^m(onths?)?$/)?t=new Date(o.getFullYear(),o.getMonth()-parseInt(a),o.getDate()).toDateString():t.substring(i).trim().match(/^w(eeks?)?$/)?t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-7*parseInt(a)).toDateString():(0==t.substring(i).trim().length||t.substring(i).trim().match(/^d(ays?)?$/))&&(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-parseInt(a)).toDateString());else{var r=new Date(o.getFullYear(),o.getMonth()+1,1),s=r.getLastDateOfMonth().getDate();s<a&&(a=s),t=new Date(o.getFullYear(),o.getMonth()+1,parseInt(a)).toDateString()}}return this.addTwelveHoursForDaylightSavings(t)}}return!t||t instanceof Date?t:this.addTwelveHoursForDaylightSavings(t)},addTwelveHoursForDaylightSavings:function(t){var e,n=Date.parse(t);return n?(e=n.getTime()+432e5,new Date(e)):this.formatDate(new Date)},formatDate:function(t){return d=t&&t instanceof Date?t.toString(this.format):t,d},validateValue:function(t){if(t=this.formatDate(t),!XERO.widget.DateField.superclass.validateValue.call(this,t))return!1;if(t.length<1)return!0;var e=t;if(!(t=this.parseDate(t)))return this.markInvalid(String.format(this.invalidText,e,this.format)),!1;var n=t.getTime();if(this.minValue&&n<this.minValue.getTime())return this.markInvalid(String.format(this.minText,this.formatDate(this.minValue))),!1;if(this.maxValue&&n>this.maxValue.getTime())return this.markInvalid(String.format(this.maxText,this.formatDate(this.maxValue))),!1;if(this.disabledDays)for(var i=t.getDay(),a=0;a<this.disabledDays.length;a++)if(i===this.disabledDays[a])return this.markInvalid(this.disabledDaysText),!1;var o=this.formatDate(t);return!this.disabledDatesRE||!this.disabledDatesRE.test(o)||(this.markInvalid(String.format(this.disabledDatesText,o)),!1)},setValue:function(t){var e=this.formatDate(this.parseDate(t));XERO.widget.DateField.superclass.setValue.call(this,e)},menuActive:!1,mimicBlur:function(t){if(this.date_tip&&t.target===this.date_tip.dom)return!1;this.isDestroyed||this.wrap.contains(t.target)||!this.validateBlur(t)||this.triggerBlur()},onSelect:function(t,e){this.setValue(e),this.startValue=e,this.fireEvent("change",this,e),this.date_tip&&this.date_tip.hide(),this.menu.hide()},createSafariNormalizedTodayDate:function(){var t=(new Date).clearTime();return t.setHours(t.getHours()+12),t},onTriggerClick:function(){var t=Ext.fly(this.id).hasClass("ARAPDueDate");this.disabled||(null==this.menu&&(this.menu=new Ext.menu.DateMenu({hideOnClick:!1,focusOnSelect:!1,zIndex:this.zIndex})),this.onFocus(),Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,showButton:t,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,dateField:this,defaultToTodaySetting:this.defaultToTodaySetting,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))}),this.menu.picker.setValue(this.getValue()||this.createSafariNormalizedTodayDate()),this.menu.show(this.el,"tl-bl?"),this.date_tip&&this.date_tip.show(),this.menuEvents("on"))},checkTab:function(t,e){e.getKey()!=e.TAB&&e.getKey()!=e.ENTER||this.triggerBlur()}}),Ext.override(Ext.DatePicker,{format:"d MMM yyyy",monthYearText:"",setValue:function(t){this.value;this.value=t.clone(),this.el&&this.update(this.value)},renderDefaultToTodayRow:function(t){return t.push('<tr class="default-to-today-row"><td colspan="3" class="x-date-left"><label class="default-to-today-clickable"><input type="checkbox" class="default-to-today-check"/>&nbsp;Default to today\'s date</label></td></tr>')},getDefaultToTodayCheckBox:function(t){return"checkbox"==Ext.get(t).dom.type?Ext.get(t):null},initDefaultToToday:function(){var t=XERO.bus,e=this.el.select(".default-to-today-row").first(),n=e.select(".default-to-today-clickable").first(),i=e.select(".default-to-today-check").first();n.on("click",function(e,n){if(!(i=this.getDefaultToTodayCheckBox(n)))return void e.stopPropagation();var a=i.dom.checked;Ajax.SaveDefaultToTodaySetting(a,function(t){}),t.fireEvent("setToDateDefaultFormValue",a),this.dateField.startValue=this.dateField.getValue(),this.dateField.menu.hide(),this.dateField.defaultToTodaySetting=a},this),i.dom.checked=this.defaultToTodaySetting||!1;var a=e.setVisibilityMode(Ext.Element.DISPLAY);a.hide(),t.fireEvent("updateDefaultToTodaySettingVisibility",a)},onRender:function(t,e){var n=[];n.push('<table cellspacing="0">'),this.renderDefaultToTodayRow(n),n.push('<td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>'),n.push('<tr><tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>');for(var i=(this.dayNames,0);i<7;i++){var a=this.startDay+i;a>6&&(a-=7),n.push("<th><span>",XERO.globalization.CultureInfo.firstLetterDayNames[a],"</span></th>")}n[n.length]="</tr></thead><tbody><tr>";for(var i=0;i<42;i++)i%7==0&&0!=i&&(n[n.length]="</tr><tr>"),n[n.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>';n.push("</tr></tbody></table></td></tr>",this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':"","</table>"),this.showButton&&n.push('<table id="Payment-Terms-Reset"><tr><td class="x-payment-terms"><a href="#">Reset to default Due Date</a></td></tr></table>'),n.push('<div class="x-date-mp"></div>');var o=document.createElement("div");o.className="x-date-picker",o.innerHTML=n.join(""),t.dom.insertBefore(o,e),this.el=Ext.get(o),this.eventEl=Ext.get(o.firstChild),this.initDefaultToToday(),this.leftClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:!0,stopDefault:!0}),this.rightClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:!0,stopDefault:!0}),this.showButton&&(this.paymenttermsbtn=new Ext.util.ClickRepeater(this.el.child("td.x-payment-terms a"),{handler:Invoice.resetDefaultDueDate,scope:this,preventDefault:!0,stopDefault:!0}));var r=XERO.util.createThrottled(this.handleMouseWheel,200,this);this.eventEl.on("mousewheel",function(t){t.preventDefault(),r(t)}),this.monthPicker=this.el.down("div.x-date-mp"),this.monthPicker.enableDisplayMode("block");new Ext.KeyNav(this.eventEl,{left:function(t){t.ctrlKey?this.showPrevMonth():this.update(this.activeDate.clone().addDays(-1))},right:function(t){t.ctrlKey?this.showNextMonth():this.update(this.activeDate.clone().addDays(1))},up:function(t){t.ctrlKey?this.showNextYear():this.update(this.activeDate.clone().addDays(-7))},down:function(t){t.ctrlKey?this.showPrevYear():this.update(this.activeDate.clone().addDays(7))},pageUp:function(t){this.showNextMonth()},pageDown:function(t){this.showPrevMonth()},enter:function(t){return t.stopPropagation(),!0},scope:this});if(this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"}),this.el.unselectable(),this.cells=this.el.select("table.x-date-inner tbody td"),this.textNodes=this.el.query("table.x-date-inner tbody span"),this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",!0)}),this.mbtn.on("click",this.showMonthPicker,this),this.mbtn.el.child(this.mbtn.menuClassTarget).addClass("x-btn-with-menu"),this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var s=Date.today().toString(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",!0),text:String.format(this.todayText,s),tooltip:String.format(this.todayTip,s),handler:this.selectToday,scope:this})}Ext.isIE&&this.el.repaint(),this.update(this.value)},showPrevMonth:function(t){this.update(this.activeDate.clone().addMonths(-1))},showNextMonth:function(t){this.update(this.activeDate.clone().addMonths(1))},showPrevYear:function(){this.update(this.activeDate.clone().addYears(-1))},showNextYear:function(){this.update(this.activeDate.clone().addYears(1))},selectToday:function(){this.setValue(Date.today()),this.fireEvent("select",this,this.value)},update:function(t,e){var n=this.activeDate;if(this.activeDate=t.clone(),!e&&n&&this.el&&n.getMonth()==t.getMonth()&&n.getFullYear()==t.getFullYear())return this.cells.removeClass("x-date-selected"),void this.cells.each(function(e){var n=new Date(e.dom.firstChild.dateValue);if(n.getDate()===t.getDate()&&n.getMonth()===t.getMonth())return e.addClass("x-date-selected"),setTimeout(function(){try{e.dom.firstChild.focus()}catch(t){}},50),!1});var i=t.getDaysInMonth(),a=t.clone().moveToFirstDayOfMonth(),o=a.getDay()-this.startDay;o<=this.startDay&&(o+=7);var r=t.clone().addMonths(-1),s=r.getDaysInMonth()-o,l=this.cells.elements,u=this.textNodes;i+=o;var c=new Date(r.getFullYear(),r.getMonth(),s).clearTime(),d=Date.today().getTime(),h=t.getTime(),f=this.minDate?this.minDate.clearTime():Number.NEGATIVE_INFINITY,p=this.maxDate?this.maxDate.clearTime():Number.POSITIVE_INFINITY,m=this.disabledDatesRE,g=this.disabledDatesText,v=!!this.disabledDays&&this.disabledDays.join(""),y=this.disabledDaysText,E=this.format;if(this.showToday){var x=(new Date).clearTime(),w=x<f||x>p||m&&E&&m.test(x.toString(E))||v&&-1!=v.indexOf(x.getDay());this.todayBtn.setDisabled(w),this.todayKeyListener[w?"disable":"enable"]()}for(var b=function(t,e){e.title="";var n=c.getTime()+432e5;if(e.firstChild.dateValue=n,n==d&&(e.className+=" x-date-today",e.title=t.todayText),n==h&&(e.className+=" x-date-selected",setTimeout(function(){try{e.firstChild.focus()}catch(t){}},50)),n<f)return e.className=" x-date-disabled",void(e.title=t.minText);if(n>p)return e.className=" x-date-disabled",void(e.title=t.maxText);if(v&&-1!=v.indexOf(c.getDay())&&(e.title=y,e.className=" x-date-disabled"),m&&E){var i=c.toString(E);m.test(i)&&(e.title=g.replace("%0",i),e.className=" x-date-disabled")}},C=0;C<o;C++)u[C].innerHTML=++s,c.setDate(c.getDate()+1),l[C].className="x-date-prevday",b(this,l[C]);for(;C<i;C++){var A=C-o+1;u[C].innerHTML=A,c.setDate(c.getDate()+1),l[C].className="x-date-active",b(this,l[C])}for(var k=0;C<42;C++)u[C].innerHTML=++k,c.setDate(c.getDate()+1),l[C].className="x-date-nextday",b(this,l[C]);if(this.mbtn.setText(this.monthNames[t.getMonth()]+" "+t.getFullYear()),!this.internalRender){var T=this.el.dom.firstChild,R=T.offsetWidth;this.el.setWidth(R+this.el.getBorderWidth("lr")),Ext.fly(T).setWidth(R),this.internalRender=!0,Ext.isOpera&&!this.secondPass&&(T.rows[0].cells[1].style.width=R-(T.rows[0].cells[0].offsetWidth+T.rows[0].cells[2].offsetWidth)+"px",this.secondPass=!0,this.update.defer(10,this,[t]))}}}),XERO.widget.DateField.createSimpleCalendar=function(t,e,n){n=n||{};var i;return n.listeners?i=n.listeners:n.onChange&&(i.change=n.onChange),new XERO.widget.DateField({id:t,transform:n.transform,style:n.style||"",value:e?new Date(e):null,triggerClass:n.linkClass||"",preventMark:!0,validationEvent:!1,selectOnFocus:!0,hideLabel:!0,rendered:!0,listeners:i})},Ext.reg("xero-datefield",XERO.widget.DateField)},function(t,e){window.InputValidator=function(t,e,n,i,a,o,r,s,l){this.element=$(t),this.decimalPlaces=void 0==e?2:e,this.allowNegative=void 0!=i&&i,this.allowDecimal=void 0==n||n,this.allowCommas=void 0==a||a,this.formatAsDecimal=void 0==o||o,this.forceNegative=void 0!=r&&r,this.formatEmpty=void 0==s||s,this.selectOnfocus=void 0!=l&&l,this.formatAsDecimal&&(this.element.onblur=this.formatNumber.bindAsEventListener(this)),this.element.onkeyup=this.extractNumber.bindAsEventListener(this),this.element.onblur=this.extractNumber.bindAsEventListener(this),this.element.onkeypress=this.validateDecimal.bindAsEventListener(this)},InputValidator.prototype={formatNumber:function(t){if(""!=this.element.value&&this.formatEmpty){var e=new Decimal(this.element.value);this.forceNegative&&e.num>0&&(e=new Decimal(-1*e.num)),e.setPlaces(this.decimalPlaces),this.element.value=e.toFormatted(null,2)}},extractNumber:function(t){var e=this.element.value,n="[0-9]*";if(this.decimalPlaces>0?n+="\\.?[0-9]{0,"+this.decimalPlaces+"}":this.decimalPlaces<0&&(n+="\\.?[0-9]*"),n=this.allowNegative?"^-?"+n:"^"+n,n+="$",new RegExp(n).test(e))return!0;var i="[^0-9"+(0!=this.decimalPlaces?".":"")+(this.allowNegative?"-":"")+"]",a=new RegExp(i,"g");if(e=e.replace(a,""),this.allowNegative){var o=e.length>0&&"-"==e.charAt(0),r=/-/g;e=e.replace(r,""),o&&(e="-"+e)}if(0!=this.decimalPlaces){var s=/\./g,l=s.exec(e);if(null!=l){var u=e.substring(l.index+l[0].length);u=u.replace(s,""),u=this.decimalPlaces>0?u.substring(0,this.decimalPlaces):u,e=e.substring(0,l.index)+"."+u}}this.element.value=e},validateDecimal:function(t){t=t||window.event;var e=t.which||t.keyCode,n=t.ctrlKey||t.metaKey,i=String.fromCharCode(e),a=/\d/;if(isNaN(e)||8==e||9==e||n||46==e&&"."!=i)return!0;if(this.isArrowKey(e))return!0;var o=!!this.allowNegative&&("-"==i&&-1==this.element.value.indexOf("-")),r=!!this.allowDecimal&&("."==i&&-1==this.element.value.indexOf(".")),s=!!this.allowDecimal&&("."==i&&this.selectOnfocus&&!(1==this.element.value.length&&0==this.element.value.indexOf(".")));return o||r||a.test(i)||s},isArrowKey:function(t){return t>=37&&t<=40}},XERO.widget.InputValidator=InputValidator,window.KeyPressPatternValidator=function(t,e){this.element=$(t),this.pattern=e,this.element.onkeypress=this.validatePattern.bindAsEventListener(this)},KeyPressPatternValidator.prototype={validatePattern:function(t){t=t||window.event;var e=t.which||t.keyCode,n=t.ctrlKey||t.metaKey,i=String.fromCharCode(e);return!(!isNaN(e)&&8!=e&&9!=e&&46!=e&&!n)||this.pattern.test(i)}},XERO.widget.KeyPressPatternValidator=KeyPressPatternValidator,window.SignificantFigureValidator=function(t,e,n){this.element=$(t),this.sigFigs=void 0==e?6:e,this.selectOnfocus=void 0!=n&&n,this.formatSigFigs=function(t){var e=parseFloat(t).toPrecision(this.sigFigs);return"NaN"==e?"":-1!=e.indexOf("e")?parseFloat(e):e},this.validateSigFigs=function(t){var e=t.toString();return e.length<=this.sigFigs||(e=e.replace(/^0*[.]?0*/g,"").replace(/[.]?0*$/,""),e.length<=this.sigFigs)},this.element.onblur=this.formatNumber.bindAsEventListener(this),this.element.onkeyup=this.extractNumber.bindAsEventListener(this),this.element.onkeypress=this.validateDecimal.bindAsEventListener(this)},SignificantFigureValidator.prototype={formatNumber:function(t){""!=this.element.value&&(this.element.value=this.formatSigFigs(this.element.value))},extractNumber:function(t){var e=this.element.value;if(new RegExp("^[0-9]*\\.?[0-9]*$").test(e)&&this.validateSigFigs(e))return!0;this.element.value=this.formatSigFigs(e)},validateDecimal:function(t){t=t||window.event;var e=t.which||t.keyCode,n=t.ctrlKey||t.metaKey,i=String.fromCharCode(e),a=/\d/;if(isNaN(e)||8==e||9==e||n)return!0;var o="."==i&&-1==this.element.value.indexOf("."),r="."==i&&this.selectOnfocus&&!(1==this.element.value.length&&0==this.element.value.indexOf("."));return o||a.test(i)||r}},XERO.widget.SignificantFigureValidator=SignificantFigureValidator},function(t,e){FXSummaryTips=Object.extend(OrangeGirlTips,{_showFXTooltip:function(t,e,n,i,a,o){this.element=t,FXSummaryTips.options.width=450,FXSummaryTips.showTimer=null,FXSummaryTips.hideTimer&&clearTimeout(FXSummaryTips.hideTimer);var r=Position.cumulativeOffset(t),s={width:37,height:13},l=r[0]>550?-280:FXSummaryTips.options.shiftX;this.tooltipWindow&&this.tooltipWindow.close(),this.tooltipWindow=new Ext.Window({title:"Foreign Currency Conversions",id:"__fxsummarytips_tooltip__",cls:"FXSummary",html:"<div style='margin:1em;width:350;text-align:center'><img src='../common/images/indicator_blue.gif' /></div>"}),this.tooltipWindow.setPosition(r[0]+l,r[1]+s.height+FXSummaryTips.options.shiftY),this.tooltipWindow.setHeight(FXSummaryTips.options.height),this.tooltipWindow.setWidth(FXSummaryTips.options.width),this.tooltipWindow.show(this.element),this.tooltipWindow.toFront(),Ajax.GetFXSummary(n,i,a,o,FXSummaryTips._onFXTipComplete.bind(this))},showTip:function(t,e,n,i,a,o){FXSummaryTips._showFXTooltip(t,e,n,i,a,o)},_onFXTipComplete:function(t){var e=t.value,n=new StringBuilder;e&&e.Result?(n.append("<div>"),n.append(e.Result),n.append("</div>")):(n.append("<div style='margin:1em;width:350'>"),n.append("The tip for this section is currently unavailable."),n.append("</div>")),this.tooltipWindow.body.update(n.toStr()),new Ext.util.DelayedTask(function(){this.tooltipWindow.setHeight(this.tooltipWindow.el.child(".forms").getHeight()+30+this.tooltipWindow.el.child(".x-window-tl").getHeight())},this).delay(200)}})},function(t,e){XERO.widget.Button=function(t){if(this.element=null,this.originalOnClick=null,this._clickEventListener=null,this.options=Object.extend({onClickDisplaySpinner:!0,onClickDisableAllOtherButtons:!0,spinnerImg:"/common/images/spinner.gif"},arguments[1]||{}),(t=$(t))&&(this.element=$(t).descendants()[0],this.element&&("A"==this.element.tagName||"BUTTON"==this.element.tagName)&&this.element.parentNode)){var e=(Element.hasClassName(this.element.parentNode,"doNotDisable"),Element.hasClassName(this.element.parentNode,"doNotDisableOthers")),n=Element.hasClassName(this.element.parentNode,"noSpinner");e&&(this.options.onClickDisplaySpinner=this.options.onClickDisableAllOtherButtons=!1),n&&(this.options.onClickDisplaySpinner=!1),e||(this._clickEventListener=this._onClick.bindAsEventListener(this),Event.observe(this.element,"click",this._clickEventListener),this.element.onclick&&(this.originalOnClick=this.element.onclick,this.element.onclick=null)),XERO.__buttons.push(this),this.element.widget=this;(new Image).src=this.options.spinnerImg}},XERO.widget.Button.prototype={enable:function(){this.element&&this.element.parentNode&&this.isDisabled()&&Element.removeClassName(this.element.parentNode,"disabled")},disable:function(){this.element&&this.element.parentNode&&(this.isDisabled()||Element.addClassName(this.element.parentNode,"disabled"))},isDisabled:function(){return!(!this.element||!this.element.parentNode)&&(!!this.element.parentNode&&Element.hasClassName(this.element.parentNode,"disabled"))},showSpinner:function(){var t=this.element.getElementsByTagName("span")[0];try{if(t&&"none"!=t.style.display){var e='<em class="spinner" style="width:'+t.getWidth()+"px;height:"+t.getHeight()+'px;"><img src="'+this.options.spinnerImg+'" alt="Loading..." /></em>';new Insertion.After(t,e),t.style.display="none",this.hasSpinner=!0}}catch(t){}},hideSpinner:function(){var t=this.element.getElementsByTagName("span")[0];try{t&&"none"==t.style.display&&(t.style.display="",$(this.element.getElementsByTagName("em")[0]).remove(),this.hasSpinner=!1)}catch(t){}},_onClick:function(t){var e;if(e=null==t.which?t.button<2?"LEFT":4==t.button?"MIDDLE":"RIGHT":t.which<2?"LEFT":2==t.which?"MIDDLE":"RIGHT",this.isDisabled()||"LEFT"!=e)return void Event.stop(t);!this.options.onClickDisableAllOtherButtons||t.ctrlKey||t.shiftKey||XERO.widget.Button.disableAll(),!this.options.onClickDisplaySpinner||t.ctrlKey||t.shiftKey||this.showSpinner(),setTimeout(function(){this.originalOnClick&&this.originalOnClick.apply(this.element)}.bind(this),0)}},XERO.widget.Button.attachButtonEvents=function(t){for(var e=0;e<XERO.__buttons.length;e++){var n=XERO.__buttons[e];n&&n.element&&Event.stopObserving(n.element,"click",n._clickEventListener),n=null}XERO.__buttons=[];var i;i=t?$(t).getElementsByClassName("button"):$$(".button");for(var e=0;e<i.length;e++)"DL"==i[e].tagName?void 0!=XERO.widget.MultiButton&&new XERO.widget.MultiButton(i[e]):new XERO.widget.Button(i[e])},XERO.widget.Button.disableAll=function(t){if(XERO.__buttons)for(var e=0;e<XERO.__buttons.length;e++){var n=XERO.__buttons[e];if(n.element){var i=Element.hasClassName(n.element.parentNode,"doNotDisable");n==t||i||(n.wasDisabled=Element.hasClassName(n.element.parentNode,"disabled"),n.wasDisabled||n.disable())}}},XERO.widget.Button.undoDisableAll=function(t){if(XERO.__buttons)for(var e=0;e<XERO.__buttons.length;e++){var n=XERO.__buttons[e];n.wasDisabled||n.enable()}},XERO.widget.Button.removeSpinners=function(){if(XERO.__buttons)for(var t=0;t<XERO.__buttons.length;t++){var e=XERO.__buttons[t];e.hasSpinner&&e.hideSpinner()}},XERO.__buttons=[]},function(t,e){XERO.widget.MultiButton=function(t){if(t&&!t.hasAttribute("data-ddlist-processed")){this.elm=$(t),this.elm.setAttribute("data-ddlist-processed","true"),XERO.widget.MultiButton.superclass.constructor.call(this,null),this.Controls={},this._clickEventListener=this._onClickDropDown.bindAsEventListener(this),this._ddClickEventListener=this._onDDClickDropDown.bindAsEventListener(this);var e=this.elm.getElementsByTagName("DD");if(this.Controls.dropDownContainer=e.length>0?e[0]:$("dl-menu"),!this.Controls.dropDownContainer)return!1;if(Element.hide(this.Controls.dropDownContainer),this._sizeDropDown(this.elm),Event.observe(this.Controls.dropDownContainer,"click",this._ddClickEventListener),this.Controls.dropDownTrigger=this.elm.getElementsByClassName("dropDown")[0],!this.Controls.dropDownTrigger)return!1;Event.observe(this.Controls.dropDownTrigger,"click",this._onClickDropDown.bindAsEventListener(this));var n=this.elm.getElementsByTagName("DT")[0],i=n.getElementsByTagName("A");if(this.doNotDisable=n.parentNode.hasClassName("doNotDisable"),1===i.length)this.element=n.getElementsByTagName("SPAN")[0],this.element&&Event.observe(this.element,"click",this._onClickDropDown.bindAsEventListener(this));else{var a=n.parentNode.hasClassName("disableOthers"),o=n.parentNode.hasClassName("showSpinner");this.options.onClickDisplaySpinner=this.options.onClickDisableAllOtherButtons=!1,a&&(this.options.onClickDisplaySpinner=this.options.onClickDisableAllOtherButtons=!0),o&&(this.options.onClickDisplaySpinner=!0),(a||o)&&(this.element=n.getElementsByTagName("A")[0],this.element.onclick&&(this.originalOnClick=this.element.onclick,this.element.onclick=null),this._clickEventListener=this._onClick.bindAsEventListener(this),Event.observe(this.element,"click",this._clickEventListener))}XERO.__buttons.push(this)}},Ext.extend(XERO.widget.MultiButton,XERO.widget.Button,{_sizeDropDown:function(){if(null==$("dl-menu")){var t=Ext.get(this.elm).getWidth()-6,e=Ext.get(this.Controls.dropDownContainer).getWidth(),n=t;t<e&&(n=e);Ext.get(this.Controls.dropDownContainer).hasClass("ignorewidth")||(this.Controls.dropDownContainer.style.width=n+"px")}},_onClickDropDown:function(t){Event.element(t).blur(),this.isDisabled()?Event.stop(t):(this.toggle(t),Event.stop(t))},_onDDClickDropDown:function(t){this.toggle(t),this.doNotDisable||this.disable()},toggle:function(t){this._sizeDropDown(),Element.visible(this.Controls.dropDownContainer)?this.hide(t):this.show(t)},show:function(t){Element.addClassName(this.Controls.dropDownTrigger,"dropDownOpen"),this.Controls.dropDownContainer._originalHeight=this.Controls.dropDownContainer._originalWidth="auto",window.navigator.vendor&&-1!=window.navigator.vendor.indexOf("Apple")&&Position.relativize(this.Controls.dropDownContainer),Element.show(this.Controls.dropDownContainer),XERO.widget.currentlyOpenWidget&&XERO.widget.currentlyOpenWidget!=this&&XERO.widget.currentlyOpenWidget.hide(t),XERO.widget.currentlyOpenWidget=this,this._boundPageClickListener=this._pageClick.bindAsEventListener(this),Event.observe(document,"click",this._boundPageClickListener)},hide:function(t){Element.removeClassName(this.Controls.dropDownTrigger,"dropDownOpen"),Element.hide(this.Controls.dropDownContainer),Event.stopObserving(document,"click",this._boundPageClickListener),XERO.widget.currentlyOpenWidget=null},_pageClick:function(t){if(Element.visible(this.Controls.dropDownContainer)){var e=t.clientX,n=t.clientY;Position.within(this.Controls.dropDownContainer,e,n)||this.hide(t,!1)}}})},function(t,e){XERO.widget.MainMenu={currentMenu:null,showDropDown:!1,refreshPageAfterTimedOutLogin:!1,init:function(){Event.observe(document.body,"click",this.deselectMenu.bind(this));for(var t=$$("#mainMenu a.dropdown"),e=0;e<t.length;e++){var n=t[e];Event.observe(n,"click",this.selectMenu.bind(this)),Event.observe(n,"mousemove",this.hoverSelectMenu.bind(this))}},selectMenu:function(t){var e=Event.element(t),n="SPAN"==e.tagName?e.parentNode:e,i=n.parentNode;if(i==this.currentMenu)return this.deselectMenu(),void Event.stop(t);this.currentMenu&&(i.className="selected hover"==i.className?"selected":""),i.className="selected"==i.className?"selected hover":"hover",this.currentMenu=i,this.showDropDown=!0,n.blur(),Event.stop(t)},deselectMenu:function(t){this.showDropDown=!1,this.currentMenu&&(this.currentMenu.className="selected hover"==this.currentMenu.className?"selected":"",this.currentMenu=null)},hoverSelectMenu:function(t){var e=Event.element(t),n="SPAN"==e.tagName?e.parentNode:e,i=n.parentNode;1==this.showDropDown&&"levelOne dropdown"==n.className&&this.currentMenu!=i&&(this.deselectMenu(t),this.selectMenu(t))},setRefreshPageAfterTimedOutLogin:function(t){this.refreshPageAfterTimedOutLogin=t},timedOutLogin:function(t){Ajax.Login($F("timedOutUserName"),$F("timedOutPassword"),function(e){e.error?(Windows.closeAll(),parent.location.href=t+"/Login/Login.aspx?logout=true"):(Windows.closeAll(),this.refreshPageAfterTimedOutLogin&&(location.href=location.href))})},logOut:function(){window.location="/logout"},sendIssue:function(){if($F("issueTrackerBody").isNullOrEmpty(!0)){for(var t=document.getElementsByName("issueType"),e="broken",n=0;t.length>n;n++)1==t[n].checked&&(e=t[n].id);1==Ajax.LogIssue(e,$F("issueTrackerBody")).value?(XERO.MsgBox.alert("Thanks &ndash; your issue has been submitted to the Xero<br/>Team. A record of the issue will be emailed to you soon.","Issue Submitted"),$("issueTrackerBody").value="",XERO.widget.MainMenu.currentlyOpenWindow.destroy()):XERO.MsgBox.alert("There was a problem while submitting your feedback.  Please try again","Issue Could Not Be Submitted")}else XERO.MsgBox.alert("Sorry &ndash; please enter the details of this issue.","Issue Submitted")},sendSuggestion:function(){if($F("issueTrackerBody").isNullOrEmpty(!0)){1==Ajax.LogIssue(issueType,$F("issueTrackerBody")).value?(XERO.MsgBox.alert("Thanks &ndash; your suggestion has been submitted to the Xero<br/>Team.","Suggestion Submitted"),$("issueTrackerBody").value="",XERO.widget.MainMenu.currentlyOpenWindow.destroy()):XERO.MsgBox.alert("There was a problem while submitting your suggestion.  Please try again","Suggestion Could Not Be Submitted")}else XERO.MsgBox.alert("Sorry &ndash; please enter your suggestion.","Suggestion Submitted")},currentlyOpenWindow:null,createAjaxWindow:function(t,e,n,i){this.currentlyOpenWindow=XERO.MsgBox.createAjax(t,{title:e,height:i,width:n})},getAskMyAccountantHtml:function(){var t="us"==Ext.get("HelpRegion").getValue(),e=t?"Ask my advisor":"Ask my adviser";return XERO.widget.MainMenu.createAjaxWindow("AskMyAccountantWindow",e,350,370),Ajax.GetAskMyAccountantHtml(XERO.widget.MainMenu.getDialogHtml_Callback),!1},getContactSupportHtml:function(t){return XERO.widget.MainMenu.createAjaxWindow("ContactSupportWindow","Contact Support",460,460),Ajax.GetContactSupportHtml(t,XERO.widget.MainMenu.getDialogHtml_Callback),!1},getContactSalesHtml:function(){return XERO.widget.MainMenu.createAjaxWindow("ContactSales","Make a suggestion",350,370),Ajax.GetContactSalesHtml(XERO.widget.MainMenu.getDialogHtml_Callback),!1},getDialogHtml_Callback:function(t){var e=t.value;if(!e)return void XERO.widget.MainMenu.currentlyOpenWindow.destroy();XERO.widget.MainMenu.currentlyOpenWindow.setHtml(e.Result),XERO.widget.MainMenu.currentlyOpenWindow.center()},askMyAccountant:function(){Ajax.AskMyAccountant(Form.serializeToCollection($("frmAskMyAccountant")),XERO.widget.MainMenu.askMyAccountant_Callback)},askMyAccountant_Callback:function(t){if(!t.value)return void XERO.widget.MainMenu.currentlyOpenWindow.destroy();XERO.widget.MainMenu.currentlyOpenWindow.setHtml('<p>Your question was successfully sent to your accountant.</p><div style="margin-top:10px;"><a class="xbtn blue large xx-pad" href="javascript:" onclick="Ext.WindowMgr.getActive().destroy();">OK</a></div>'),XERO.widget.MainMenu.currentlyOpenWindow.center(),Ext.WindowMgr.getActive().syncShadow()}},XERO.widget.Menu=function(t){el=Ext.get(t),this.dl=el.parent("dl.list"),this.dt=el,this.dt.hasClass("link")||(this.dd=this.dt.next("dd"),this.dl.hasClass("anchor-right")&&(Ext.IE?this.dd.anchorTo(this.dt,"bl",[-95,3]):this.dd.anchorTo(this.dt,"bl",[-110,3])),(this.dl.hasClass("wide")||this.dl.hasClass("wide-bank"))&&(Ext.IE?this.dd.anchorTo(this.dt,"bl",[-295,1]):this.dd.anchorTo(this.dt,"bl",[-310,1]))),this.dt.child("div/div")?(this.button=this.dt.child("div"),this.split=this.dt.child("div/div"),this.history=this.button.dom.innerHTML,this.split.on({click:{fn:this.click,scope:this},mouseover:{fn:this.over,scope:this},mouseout:{fn:this.out,scope:this}}),this.dl.hasClass("skip")||(this.button.on("click",this.spin,this,{delegate:"a",stopEvent:!1}),this.dd.on("click",this.spin,this))):this.dt.child("div")?(this.button=this.dt.child("div"),this.history=this.button.dom.innerHTML,this.button.on({click:{fn:this.click,scope:this},mouseover:{fn:this.over,scope:this},mouseout:{fn:this.out,scope:this}}),this.dl.hasClass("skip")||this.dd.on("click",this.spin,this)):(this.dt.on({mouseover:{fn:this.over,scope:this},mouseout:{fn:this.out,scope:this}}),this.dt.hasClass("link")||this.dt.on("click",this.click,this))},XERO.widget.Menu.prototype={history:null,open:function(){var t=this.dt.parent();if(!t.hasClass("js-moreButton")||!t.hasClass("disabled")){if(this.dt.addClass("opened"),this.dd){if(this.dl.hasClass("anchor-right")){if(this.dl.hasClass("wide")||this.dl.hasClass("wide-bank")){var e=!!document.querySelector(".dashboard");e?this.dd.alignTo(this.dt,"tl-bl",[-390,5]):this.dd.alignTo(this.dt,"tr-br",[20,5])}}else this.getAnchor(),this.dd.setXY([this.X,this.Y]),this.dd.hasClass("autoSetWidth")&&this.dd.setWidth(this.dt.getWidth()-1);this.dd.show()}this.activate()}},close:function(t,e){this.dt.removeClass("opened"),this.dd&&this.dd.hide(),this.deactivate()},over:function(){menus=XERO.widget.Menus,menus.active&&(menus.active.close(),this.open()),this.dt.addClass("hover")},out:function(){this.dt.removeClass("hover")},click:function(){menus=XERO.widget.Menus,menus.active==this?this.close():(this.open(),Ext.EventObject.stopEvent())},disable:function(){this.dl.addClass("disabled")},enable:function(){this.dl.removeClass("disabled"),this.dl.hasClass("spin")&&(this.dl.removeClass("spin"),this.dl.setStyle("width",""),this.button.update(this.history))},activate:function(){XERO.widget.Menus.active=this},deactivate:function(){XERO.widget.Menus.active=null},spin:function(t,e){return t&&e&&"A"!=e.tagName?(Ext.EventObject.stopEvent(),!1):(!t||!e||"A"!=e.tagName||!Ext.fly(e).hasClass("exclude")&&!Ext.fly(e).hasClass("skip"))&&(!(t&&e&&Ext.fly(e).parent(".skip"))&&(width=this.dl.getWidth(),this.dl.setWidth(width),this.dl.addClass("spin"),this.button.update('<em style="width:'+width+'px">&#160;</em>'),this.close(),XERO.widget.Buttons&&XERO.widget.Buttons.disable(),XERO.widget.Menus&&XERO.widget.Menus.disable(),void(Ext.isIE&&this.split&&"A"==e.tagName&&(link=Ext.fly(e),null==link.getAttribute("onclick")&&(window.location=link.dom.href)))))},getAnchor:function(){anchor=this.dt.getAnchorXY("bl"),this.X=Math.round(anchor[0]),this.Y=Math.round(anchor[1])}},XERO.widget.HeaderMenu=function(t){this.el=Ext.get(t),this.list=this.el.child("ul"),this.btn=this.el.child("a"),this.btn.on("click",this.click,this),this.el.on({mouseover:this.over,mouseout:this.out,scope:this})},XERO.widget.HeaderMenu.prototype={history:null,open:function(){this.list&&this.list.show(),this.activate()},close:function(t,e){this.list&&this.list.hide(),this.deactivate()},over:function(){menus=XERO.widget.Menus,menus.active&&(menus.active.close(),this.open())},enable:function(){},out:function(){},click:function(){menus=XERO.widget.Menus,menus.active==this?this.close():(this.open(),this.el.hasClass("link")||Ext.EventObject.stopEvent())},activate:function(){XERO.widget.Menus.active=this},deactivate:function(){XERO.widget.Menus.active=null}},XERO.widget.Menus={active:null,dt:null,dd:null,cache:new Ext.util.MixedCollection,disable:function(){this.cache.each(function(t){t.dl&&!t.dl.hasClass("doNotDisable")&&t.disable()})},enable:function(){this.cache.each(function(t){t.enable()})},closeAll:function(){this.cache.each(function(t){t.close()})}},XERO.widget.StaticButtonMenu=function(){return XERO.widget.Menu.apply(this,arguments)},Ext.extend(XERO.widget.StaticButtonMenu,XERO.widget.Menu),XERO.widget.StaticButtonMenu.prototype.spin=function(){},XERO.widget.StaticButtonMenu.prototype.enable=function(){},XERO.widget.StaticButtonMenu.prototype.disable=function(){},Ext.onReady(function(){function t(t){new XERO.help.AskAQuestion(Ext.fly("HelpCentreUrl").getValue(),Ext.fly("HelpRegion").getValue(),t,Ext.fly("SecureHelpCentreUrl").getValue())}function e(){XERO.widget.MainMenu.getAskMyAccountantHtml()}function n(){XERO.widget.MainMenu.getContactSupportHtml()}function i(){window.location="/logout"}XERO.bus&&(XERO.bus.on("askquestion:showrequest",t),XERO.bus.on("contactsupport:showrequest",n),XERO.bus.on("logout",i),XERO.bus.on("askaccountant:showrequest",e)),Ext.get(document.body).on("click",function(t,e){if(e&&e.id&&e.id.startsWith("__askAQuestion"))return void Ext.EventObject.stopEvent();var n=XERO.widget.Menus.active;n&&n.close()},this);var a=function(){var t=Ext.fly("__askAQuestionTextBox").getValue();0!=t.trim().length&&(new XERO.help.AskAQuestion(Ext.fly("HelpCentreUrl").getValue(),Ext.fly("HelpRegion").getValue(),t,Ext.fly("SecureHelpCentreUrl").getValue()),Ext.fly("__askAQuestionTextBox").dom.value="",XERO.widget.Menus.closeAll())};Ext.fly("__askAQuestionTextBox")&&(Ext.fly("__askAQuestionTextBox").on(Ext.isSafari?"keydown":"keypress",function(t){t.getKey()==t.ENTER&&a()}),Ext.fly("__askAQuestionTrigger").on({click:a,stopEvent:!0}))})},function(t,e){XERO.widget.BankAccountField=function(t){this.options=Object.extend({accountType:XERO.widget.BankAccountField.accountTypes.NZ_BANK_ACCOUNT,showValidationMessage:!0},arguments[1]||{}),this.options.accountType=this.options.accountType.toUpperCase(),this.setAccountType(this.options.accountType),this.controls={},this.controls.input=$(t),this.controls.input.widget=this,this.onBlurFormatBankAccountNumber=this.formatBankAccountNumber.bindAsEventListener(this),Event.observe(t,"blur",this.onBlurFormatBankAccountNumber)},XERO.widget.BankAccountField.prototype={DELIMITER:"-",setAccountType:function(t){"NZ"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.NZ_BANK_ACCOUNT:"CC"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.CREDIT_CARD:"MAESTRO"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.MAESTRO:"GB"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.UK_BANK_ACCOUNT:"GBCC"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.UK_CREDIT_CARD:"AU"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.AU_BANK_ACCOUNT:"AUCC"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.AU_CREDIT_CARD:"GLOBAL"==t?this.options.accountType=XERO.widget.BankAccountField.accountTypes.GLOBAL_BANK_ACCOUNT:"GLOBALCC"==t&&(this.options.accountType=XERO.widget.BankAccountField.accountTypes.GLOBAL_CREDIT_CARD)},formatBankAccountNumber:function(t){var e=new String(this.controls.input.value);e=this._sanitise(e);var n="";if(""!=e){var i;i=this.options.accountType.sectionLengths;for(var a="",o=0,r=0;r<i.length;r++){var s=r==i.length-1,l=i[r],u=e.substr(o,l);a+=u,u.length==l?s||(a+=this.DELIMITER):(s&&u.length==l-1&&"NZ"==this.options.accountType.type&&(a=a.replace(/(\S{16})/,"$10"),n="A zero has been added to your account<br/>number to convert your suffix to 3 digits.<br/>Please ensure it is correct before continuing."),r=i.length),o=a.length-r-1}this.controls.input.value=a,this._clearError(),e.length<this.options.accountType.minLength||e.length>this.options.accountType.maxLength?""==e&&(this.controls.input.value="",this._clearError()):""!=n&&this._raiseErrorWithMessage(n),"undefined"!=typeof MyXero&&"NZ"==this.options.accountType.type&&(e.length>=this.options.accountType.minLength||e.length<=this.options.accountType.maxLength)&&Ajax.UpdateBankDetails(e,MyXero.updateBankDetailsCallback)}},_raiseErrorWithMessage:function(t){if(!this.controls.input.hasClassName("fieldWithErrors")&&(this.controls.input.addClassName("fieldWithErrors"),this.options.showValidationMessage)){var e='<div class="validationError" id="bankAccountFieldError" style="float:left;clear:both;"><div style="margin-top:4px;">'+t+"</div></div>";new Insertion.After(this.controls.input,e)}},_raiseError:function(){this._raiseErrorWithMessage(this.options.accountType.errorMessage)},_clearError:function(){this.controls.input.hasClassName("fieldWithErrors")&&(this.controls.input.removeClassName("fieldWithErrors"),$("bankAccountFieldError")&&$("bankAccountFieldError").remove())},_sanitise:function(t){return this.options.accountType==XERO.widget.BankAccountField.accountTypes.GLOBAL_BANK_ACCOUNT||this.options.accountType==XERO.widget.BankAccountField.accountTypes.GLOBAL_CREDIT_CARD?t:t=t.replace(/[^\d]+/g,"")}},XERO.widget.BankAccountField.accountTypes={CREDIT_CARD:{type:"CC",maxLength:16,minLength:16,sectionLengths:[4,4,4,4],errorMessage:"That credit card number is invalid.<br/>The correct format is: <b>XXXX-XXXX-XXXX-XXXX</b>"},MAESTRO:{type:"MAESTRO",maxLength:19,minLength:16,sectionLengths:[19],errorMessage:"That maestro number is invalid.<br/>Your card number should be between 16 and 19 numbers long</b>"},NZ_BANK_ACCOUNT:{type:"NZ",maxLength:16,minLength:15,sectionLengths:[2,4,7,3],errorMessage:"That bank account number is invalid.<br/>The correct format is: <b>XX-XXXX-XXXXXXX-XXX</b>"},UK_BANK_ACCOUNT:{type:"GB",maxLength:16,minLength:14,sectionLengths:[2,2,2,10],errorMessage:"That bank account number is invalid.<br/>The correct format is: <b>XX-XX-XX-XXXXXXXXX</b>"},UK_CREDIT_CARD:{type:"GBCC",maxLength:16,minLength:16,sectionLengths:[4,4,4,4],errorMessage:"That credit card number is invalid.<br/>The correct format is: <b>XXXX-XXXX-XXXX-XXXX</b>"},AU_BANK_ACCOUNT:{type:"AU",maxLength:16,minLength:12,sectionLengths:[3,3,10],errorMessage:"Your account number must be between 12 and 16 numbers long"},AU_CREDIT_CARD:{type:"AUCC",maxLength:16,minLength:16,sectionLengths:[4,4,4,4],errorMessage:"Your credit card number must be between 12 and 16 numbers long"},GLOBAL_BANK_ACCOUNT:{type:"GLOBAL",maxLength:20,minLength:0,sectionLengths:[20],errorMessage:"Your account number must be less than 20 characters long"},GLOBAL_CREDIT_CARD:{type:"GLOBALCC",maxLength:20,minLength:0,sectionLengths:[20],errorMessage:"Your account number must be less than 20 characters long"}}},function(t,e){XERO.User={popupDeleteUser:function(t){var e="<p>Are you sure you want to delete this user?</p>"+(t?'<p class="email-text"><input id="sendEmailCheckbox" type="checkbox" name="SendEmail" value="SendEmail" checked/><label for="sendEmailCheckBox"> Send email to this user advising of change</label></p>':"")+'<div style="margin-top:20px;" class="button-container"><a id="popupDeleteUser" href="javascript:" onclick="XERO.setup.User.submitDeleteUser();" class="xbtn red delete large xx-pad" style="margin-right:7px;">Delete User</a><a id="popupCancelUser" href="javascript:" onclick="XERO.User.closePopupDeleteUser(); return false;" class="xbtn large gray x-pad doNotDisableOthers">Cancel</a></div>';new XERO.Window({autoCreate:!0,resizable:!1,title:"Delete user",constrain:!0,constrainHeader:!0,modal:!0,shim:!0,width:300,plain:!1,footer:!1,closable:!1,html:e}).show(),XERO.widget.Buttons.cache.add("popupDeleteUser",new XERO.widget.XButton("popupDeleteUser")),XERO.widget.Buttons.cache.add("popupCancelUser",new XERO.widget.XButton("popupCancelUser"))},closePopupDeleteUser:function(){XERO.widget.Buttons.cache.removeKey("popupDeleteUser"),XERO.widget.Buttons.cache.removeKey("popupCancelUser"),Ext.WindowMgr.getActive().destroy()},openPopupChangeRole:function(){XERO.widget.Buttons.cache.add("popupChangeRole",new XERO.widget.XButton("popupChangeRole")),XERO.widget.Buttons.cache.add("popupCancel",new XERO.widget.XButton("popupCancel"))},closePopupChangeRole:function(){XERO.widget.Buttons.cache.removeKey("popupChangeRole"),XERO.widget.Buttons.cache.removeKey("popupCancel"),Ext.WindowMgr.getActive().destroy()}},XERO.widget.XButton=function(t){if(this.el=Ext.get(t),!this.el.hasClass("exclude")){var e=this.el;if(this.a=this.el.dom.innerHTML,this.link=e.getAttribute("href"),this.action=e.getAttribute("onclick"),this.action&&"string"!=typeof this.action)if(this.action=this.action.toString(),Ext.isIE9){var n=this.action.length-26;this.action=this.action.substr(25,n)}else{var n=this.action.length-21;this.action=this.action.substr(20,n)}0==e.getWidth()&&e.hasClass("x-pad")?e.setWidth(100):0==e.getWidth()?e.setWidth("auto"):-1===document.body.className.indexOf("bridge")&&e.setWidth(e.getWidth()),e.hasClass("plain")||e.on("click",this.click,this)}},XERO.widget.XButton.prototype={click:function(){return el=this.el,el.hasClass("disabled")?void Ext.EventObject.stopEvent():el.hasClass("onlyDisableMe")?(this.spin(),void Ext.EventObject.stopEvent()):(el.hasClass("skip")||el.hasClass("doNotDisableOthers")||(XERO.widget.Buttons.clicked=el,new Ext.util.DelayedTask(function(){XERO.widget.Buttons.disable()}).delay(0),new Ext.util.DelayedTask(function(){XERO.widget.Menus.disable()}).delay(0)),el.hasClass("doNotDisableOthers")&&(XERO.widget.Buttons.clicked=el),void(el.hasClass("continueEvent")||this.link&&"#"!=this.link&&"javascript:"!=this.link&&(window.location=this.link)))},spin:function(){el=this.el,el.addClass("spin"),this.disable()},stop:function(){el=this.el,el.removeClass("spin")},enable:function(){el=this.el,el.removeClass("disabled"),el.removeClass("spin"),this.link&&""!=this.link&&el.set({href:this.link}),!Ext.isIE7&&this.action&&""!=this.action&&el.set({onclick:this.action})},disable:function(){el=this.el,el.addClass("disabled"),this.link&&""!=this.link&&el.set({href:"#"}),!Ext.isIE7&&this.action&&""!=this.action&&el.set({onclick:"return false;"})}},XERO.widget.Buttons={active:!1,clicked:null,cache:new Ext.util.MixedCollection,disable:function(){if(cache=this.cache,null!=this.clicked&&"object"==typeof this.clicked&&this.clicked.hasClass("doNotDisableOthers"))qi=cache.get(this.clicked.id),qi.spin();else for(var t=0;t<cache.length;t++)qi=cache.items[t],qi.el==this.clicked&&qi.el.hasClass("doNotDisable")||(qi.el==this.clicked?qi.spin():qi.el&&!qi.el.hasClass("exclude")&&qi.disable());null==this.clicked&&(this.clicked=!0)},enable:function(){cache=this.cache;for(var t=0;t<cache.length;t++)cache.items[t].enable();this.clicked&&(this.clicked=null),XERO.widget.Menus.enable()},insert:function(t,e){e||(e="windowButtonSleeve"),button=this.create(t),Ext.fly(button).dom.template.insertAfter(e),XERO.widget.Buttons.cache.add(button.id,new XERO.widget.Button(button.id))},create:function(t){return{id:t.id,size:t.size,color:t.color,icon:t.icon,text:t.text,disable:t.disable,onclick:t.onclick,template:t.template||XERO.widget.Buttons.template(t)}},template:function(t){return new Ext.Template(String.format('<div id="{0}" class="{1} {2} {3} button">',t.id,t.disable||"",t.size,t.color),String.format("<a href='javascript:' onclick='{0}; return false;'>",t.onclick||"Windows.closeAll()"),String.format('<em class="{0}"> </em>',t.icon||"none"),'<span class="text">',String.format("{0}",t.text),"</span>","</a>","</div>")},refresh:function(){XERO.widget.Menus.cache.clear(),XERO.widget.Buttons.cache.clear();for(var t=Ext.query(".button"),e=Ext.query("a.xbtn"),n=0;n<t.length;n++)XERO.widget.Buttons.cache.add(t[n].id||"btn"+n,new XERO.widget.Button(t[n]));for(var n=0;n<e.length;n++)Ext.fly(e[n]).hasClass("exclude")||XERO.widget.Buttons.cache.add(e[n].id||"xBtn"+n,new XERO.widget.XButton(e[n]));for(var i=Ext.query("dl.list/dt"),a=Ext.query("ul.list > li"),o=Ext.query("ul.user > li.list"),n=0;n<i.length;n++)XERO.widget.Menus.cache.add(i[n].id||"list"+n,new XERO.widget.Menu(i[n]));for(var n=0;n<a.length;n++)XERO.widget.Menus.cache.add(a[n].id||"new_list"+n,new XERO.widget.HeaderMenu(a[n]));for(var n=0;n<o.length;n++)XERO.widget.Menus.cache.add(o[n].id||"user_list"+n,new XERO.widget.HeaderMenu(o[n]))}},XERO.widget.Messages={cache:new Ext.util.MixedCollection,getElement:function(t){var e=this.cache.get(t);return void 0!==e?e.el:Ext.get(t)},toggle:function(t){var e=XERO.widget.Messages.cache.get(t);e.visible?e.close():e.open()},show:function(t){var e=this.getElement(t);e&&e.show()},hide:function(t){var e=this.getElement(t);e&&e.hide()},more:function(t){var e=this.getElement(t);e&&e.addClass("show-more")},less:function(t){var e=this.getElement(t);e&&e.removeClass("show-more")},confirm:function(t,e,n,i,a){a||(a=null),i||(i=!1),1==i&&new Ext.util.DelayedTask(function(){XERO.widget.Buttons&&XERO.widget.Buttons.enable()},this).delay(500),p="Are you sure you want to "+e+" this "+n+"?",XERO.MsgBox.confirm(p,"Confirm",null,"OK",function(){a?SubmitAction(t,a):SubmitAction(t)},"Cancel")},confirmSpin:function(t,e,n,i,a,o){o||(o=null),a||(a=!1),1==a&&new Ext.util.DelayedTask(function(){XERO.widget.Buttons&&XERO.widget.Buttons.enable()},this).delay(150),p="Are you sure you want to "+n+" this "+i+"?",o?XERO.MsgBox.confirmSpin(t,p,"OK",'SubmitAction("'+e+'","'+o+'")',"Cancel"):XERO.MsgBox.confirmSpin(t,p,"OK",'SubmitAction("'+e+'")',"Cancel")},confirmButtons:function(t,e,n,i,a,o,r){a||(a=null),i||(i=!1),1==i&&new Ext.util.DelayedTask(function(){XERO.widget.Buttons&&XERO.widget.Buttons.enable()},this).delay(500),o||(o="OK"),r||(r="Cancel"),p="Are you sure you want to "+e+" this "+n+"?",XERO.MsgBox.confirm(p,"Confirm",null,o,function(){a?SubmitAction(t,a):SubmitAction(t)},r)},confirmMessage:function(t,e,n,i,a,o){a||(a=null),i||(i=!1),1==i&&new Ext.util.DelayedTask(function(){XERO.widget.Buttons&&XERO.widget.Buttons.enable()},this).delay(500),p="Are you sure you want to "+e+" this "+n+"? "+o,XERO.MsgBox.confirm(p,"Confirm",null,"OK",function(){a?SubmitAction(t,a):SubmitAction(t)},"Cancel")}},XERO.widget.Message=function(t){this.el=Ext.get(t),this.shadow=this.el.next("div.shadow"),this.p=this.el.child("div.message/p"),this.a=this.el.child("a.msg-close"),this.a&&this.a.on("click",this.click,this)},XERO.widget.Message.prototype={click:function(){this.el.fadeOut({duration:.25,useDisplay:!0}),this.shadow&&this.shadow.fadeOut({duration:.25,useDisplay:!0})},show:function(){this.shadow&&this.shadow.show(),this.el.show()},hide:function(){this.el.setStyle("display","none"),this.shadow&&this.shadow.setStyle("display","none")}},XERO.widget.Feeling=function(t){this.el=Ext.get(t),this.choices={},this.choices.el=this.el.child("div.choices"),this.choices.feelings=this.choices.el.query("a"),this.choices.el.on("click",this.click,this),this.el.hasClass("popup")||(this.fieldset=this.el.child("fieldset"),this.comments=this.fieldset.child("textarea"),this.success=this.el.child("div.success"),this.getFeeling())},XERO.widget.Feeling.prototype={click:function(t,e){Ext.EventObject.preventDefault(),XERO.widget.Thermometers.setFeelings(e.className),Ajax.SetUserFeeling(this.feeling),this.fieldset&&this.addComments()},addComments:function(){this.fieldset.show(),this.comments.focus()},setFeeling:function(t){this.removeFeeling(),this.feeling=t,this.choices.el.addClass(this.feeling)},removeFeeling:function(){elm=this.choices.feelings;for(var t=0;t<elm.length;t++)this.choices.el.removeClass(elm[t].className);this.feeling=null},getFeeling:function(){return elm=this.choices.el,elm.hasClass("indifferent")&&(this.feeling="indifferent"),elm.hasClass("good")&&(this.feeling="good"),elm.hasClass("bad")&&(this.feeling="bad"),this.feeling}},XERO.widget.Thermometers={cache:new Ext.util.MixedCollection,setFeelings:function(t){this.cache.each(function(e){e.setFeeling(t)})},send:function(t,e){Ext.EventObject.stopEvent(),elm=this.cache.get(t),elm&&(elm.fieldset.fadeOut({duration:.1,useDisplay:!0}),comments=elm.comments.dom.value,1==e&&""!=Ext.util.Format.trim(comments)&&(res=Ajax.LogIssueWithFeeling(comments,elm.feeling),res.error||(elm.comments.dom.value="",setTimeout(function(){elm.success.fadeIn({duration:.1,useDisplay:!0})},200),setTimeout(function(){elm.success.fadeOut({duration:.5,useDisplay:!0})},1e3))))}},XERO.widget.Support={},XERO.widget.Contact=function(t){this.el=Ext.get(t),this.message={},this.message.el=this.el.child("div.notify"),this.message.text=this.message.el.child("p"),this.textarea=this.el.child("textarea"),this.subjectText=this.el.child("input#issueTrackerSubject"),this.button=this.el.child("a.green"),this.urgent=this.el.child("input#urgent")},XERO.widget.Contact.prototype={validate:function(){this.comments=Ext.util.Format.trim(this.textarea.getValue()),this.subject=Ext.util.Format.trim(this.subjectText.getValue()),this.subject||this.comments?this.send():(this.message.el.setStyle("display",""),this.message.text.update("Please enter at least a subject."),Ext.fly("issueTrackerSubject").focus())},enable:function(){this.button&&this.button.removeClass(["gray","disabled"])},disable:function(){this.button&&this.button.addClass(["gray","disabled"])},send:function(){this.disable(),res=Ajax.LogIssue("",this.subject,this.comments),res.value?(Windows.closeAll(),XERO.MsgBox.alert("Thanks &ndash; your issue has been submitted to the Xero Team. A record of the issue will be emailed to you soon.","Issue Submitted")):(this.enable(),this.message.el.setStyle("display",""),this.message.text.update("There was a problem while submitting your feedback. Please try again."),this.textarea.focus())}},XERO.widget.Support={cache:new Ext.util.MixedCollection},XERO.widget.OrgLimits=Class.create(),Object.extend(XERO.widget.OrgLimits,{cache:new Ext.util.MixedCollection,createAjaxWindow:function(t,e,n,i,a){XERO.MsgBox.createAjax(t,{fromEl:a,title:e,modal:!0,height:i,width:n,scope:Currency})},checkOrgLimits:function(t){if("STATEMENTLINE"!=t){var e;"undefined"!=typeof config&&null!=config?null!=config.invoiceData.Invoice&&(e=config.invoiceData.Invoice.CleanInvoiceID):e=$F("CleanInvoiceID"),this.cache.each(function(t){t._id==e&&t.isOrgLimitReached()})}}}),Object.extend(XERO.widget.OrgLimits.prototype,{_id:null,_approveBttn:null,_disabledApproveBttn:null,_dateElem:null,_message:null,_invoiceTypeCode:"",_originalDate:null,initialize:function(t,e,n,i,a,o,r){this._id=t,this._approveBttn=Ext.get(e),this._disabledApproveBttn=Ext.get(n),this._dateElem=Ext.get(i),this._message=Ext.get(a),this._invoiceTypeCode=o,this._message.setVisibilityMode(Ext.Element.DISPLAY),null!=this._approveBttn&&null!=this._disabledApproveBttn&&(this._approveBttn.setVisibilityMode(Ext.Element.DISPLAY),this._disabledApproveBttn.setVisibilityMode(Ext.Element.DISPLAY)),r&&null!=this._dateElem&&(this._originalDate=this._dateElem.getValue());var s=this._message.child("a#showLimitsLink");$(s).dom.onclick=this.getOrganisationLimitsHtml.bindAsEventListener(this)},disableApprove:function(){null!=this._approveBttn&&this._approveBttn.setStyle("display","none"),null!=this._disabledApproveBttn&&this._disabledApproveBttn.show()},enableApprove:function(){null!=this._approveBttn&&null!=this._disabledApproveBttn&&(this._approveBttn.show(),this._disabledApproveBttn.setStyle("display","none"))},isOrgLimitReached:function(){var t="";if(null!=this._dateElem&&(t=this._dateElem.getValue()),null!=this._originalDate){var e=new Date(t),n=new Date(this._originalDate);e.getMonth()!=n.getMonth()?Ajax.IsOrgLimitReached(this._invoiceTypeCode,t,this.isOrgLimitReachedCallback.bindAsEventListener(this)):(this._message.hide(),this.enableApprove())}else Ajax.IsOrgLimitReached(this._invoiceTypeCode,t,this.isOrgLimitReachedCallback.bindAsEventListener(this))},isOrgLimitReachedCallback:function(t){var e=t.value;if(e.IsValid){!0===e.Data.getValue("IsLimitReached")&&null!=this._message?(this._message.show(),this.disableApprove()):(this._message.hide(),this.enableApprove())}else this._message.hide(),this.enableApprove()},getOrganisationLimitsHtml:function(){var t="";null!=this._dateElem&&(t=this._dateElem.getValue()),title="Invoice limit reached","STATEMENTLINE"==this._invoiceTypeCode?title="Transaction limit reached":"INVOICETYPE/ACCPAY"==this._invoiceTypeCode&&(title="Bill limit reached"),XERO.widget.OrgLimits.createAjaxWindow("LimitsWindow",title,410,470,null),Ajax.GetOrganisationLimitsHtml(this._invoiceTypeCode,t,this.getOrganisationLimitsHtmlCallback.bindAsEventListener(this))},getOrganisationLimitsHtmlCallback:function(t){var e=t.value;if(!e)return void(null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().destroy());if(e.IsValid){Ext.WindowMgr.getActive().setHtml(e.Result);var n=Ext.get("getTokenLink");null!=n&&(n.dom.onclick=function(){this.requestGraceToken()}.bindAsEventListener(this))}else Ext.WindowMgr.getActive().setHtml("<div style='color:#ff0000'>Fail Whale!</div>")},requestGraceToken:function(){Ajax.RequestGraceToken(this._invoiceTypeCode,this.requestGraceTokenCallback.bindAsEventListener(this))},requestGraceTokenCallback:function(t){var e=t.value;if(e&&e.IsValid){this._message.hide(),this.enableApprove(),Windows.closeAll();var n=e.Data.getValue("message");""!=n&&($("sentMessageContents").update(n),$("sentMessage").show(),$("sentMessageShadow").show(),$("msg")&&$("msg").hide())}else XERO.MsgBox.alert("Could not request an extension token.<br/>Please try again or contact Xero Support.")}}),XERO.widget.OrgLimits.getBankRecOrganisationLimitsHtml=function(t,e){null!=e&&""!=e||(e="Transaction limit reached"),XERO.MsgBox.createAjax("LimitsWindow",{title:e,modal:!0,height:470,width:370,scope:this}),Ajax.GetOrganisationLimitsHtml("STATEMENTLINE",t,XERO.widget.OrgLimits.getBankRecOrganisationLimitsHtmlCallback)},XERO.widget.OrgLimits.getBankRecOrganisationLimitsHtmlCallback=function(t){var e=t.value;if(!e)return void(null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().destroy());if(e.IsValid){Ext.WindowMgr.getActive().setHtml(e.Result);var n=Ext.get("getTokenLink");null!=n&&(n.dom.onclick=XERO.widget.OrgLimits.requestGraceToken)}else Ext.WindowMgr.getActive().setHtml("<div style='color:#ff0000'>Fail Whale!</div>")},XERO.widget.OrgLimits.requestGraceToken=function(){Ajax.RequestGraceToken("STATEMENTLINE",XERO.widget.OrgLimits.requestGraceTokenCallback)},XERO.widget.OrgLimits.requestGraceTokenCallback=function(t){var e=t.value;e&&e.IsValid?Windows.closeAll():XERO.MsgBox.alert("Could not request an extension token.<br/>Please try again or contact Xero Support.")},XERO.widget.Template={},XERO.widget.Template.ar_expected_date={save:function(t,e,n,i){var a=Ext.fly("NewNote").getValue(),o=Ext.fly("ExpectedDate").getValue();Ajax.SaveFollowUpPanel(t,a,o,function(i){if(null==i.error){if(cell=Ext.get("ExpectedPayDate"+t),cell&&""!=o&&(cell.update(o),cell.setStyle("display","block"),nextCell=cell.next("span.dummyText"),nextCell&&nextCell.remove()),cell&&(overdueDate=Ext.fly(cell.parent("a.add-options")),overdueDate.hasClass("overdueDate")&&overdueDate.removeClass("overdueDate")),$("archiveHistoryListing")||$("showHistoryLink")){var a=i.value;2==a.length&&($("latestNote").innerHTML="<strong>"+a[0]+"</strong><br/>"+a[1]),"email"!=n&&"print"!=n&&"statement"!=n&&(Element.visible("archiveHistoryListing")&&Element.hide("archiveHistoryListing"),Element.visible("showHistoryLink")&&Element.hide("showHistoryLink"),setTimeout(function(){XERO.ui.HistoryAndNotes.showArchiveHistory(),Ext.get("hideHistoryLink").show()},1200))}"email"==n?XERO.widget.Template.ar_expected_date.destroy("email"):XERO.widget.Template.ar_expected_date.destroy("save"),"view"==n&&(location.href="View.aspx?invoiceID="+t),"email"==n&&cell&&(location.href="View.aspx?action=email&invoiceID="+t),"email"!=n||cell||setTimeout(function(){Invoice.openInvoiceEmailWindow(e,t,!1,!1,"Invoice")},1200),"print"==n&&InvoicePrinting.PrintSingleInvoice(t,!1),"statement"==n&&(location.href="ViewStatement.aspx?statementContactID="+e)}})},create:function(t,e){if(XERO.widget.Template.ar_expected_date.destroy("cancel"),1==e){invoice=Ext.get(t).parent("tr"),invoice.setStyle("background-color","#f7f7f7"),theads=invoice.parent("tbody").prev("thead").query("td"),invoiceID=invoice.id.substr(2);for(var n=0;n<theads.length;n++)elm=Ext.fly(theads[n]),elm.setWidth(elm.getWidth());invoice.addClass("adding-options"),Ext.DomHelper.insertAfter(invoice,{tag:"tr",id:"expected_form",cls:"add-options",children:[{tag:"td",id:"form_content",colspan:invoice.query("td").length,html:'<div class="form"><fieldset class="waiting">&#160;</fieldset></div>'}]})}else peanuts=Ext.query("div.invoiceID"),invoiceID=peanuts[0].id,Ext.DomHelper.insertBefore("archiveHistoryListing",{tag:"table",id:"expected_form",children:[{tag:"tr",cls:"add-options",children:[{tag:"td",id:"form_content",html:'<div class="form"><fieldset class="waiting">&#160;</fieldset></div>'}]}]});Ajax.GetFollowUpPanel(invoiceID,function(t){data=XERO.widget.Template.ar_expected_date.data(t,invoiceID),Ext.get("form_content").update(data),XERO.widget.DateField.createSimpleCalendar("ExpectedDate",t.value.Data.getValue("ExpectedPayDate"),{transform:"ExpectedDate"}),new XERO.widget.MultiButton("menu00")})},destroy:function(t){elm=Ext.get("expected_form"),calendar=Ext.get("ExpectedDate_container"),calendar&&(calendar.remove(),Globals.remove("ExpectedDate")),elm&&(tr=Ext.get(elm.prev("tr")),"cancel"==t?(elm.remove(),tr&&tr.setStyle("background-color","#FFFFFF")):(currentRow=Ext.get("form_content"),elm.setHeight(elm.getHeight()),currentRow.setHeight(elm.getHeight()),elm.setStyle("background-color","#daefcc"),currentRow.setStyle("background-color","#daefcc"),currentRow.update('<div class="form"><fieldset class="successfullySaved">&#160;</fieldset></div>'),setTimeout(function(){elm.fadeOut({endOpacity:0,duration:.25,useDisplay:!0,remove:!0}),tr&&tr.setStyle("background-color","#FFFFFF")},750)))},data:function(t,e){contactID=t.value.Data.getValue("ContactID");var n=t.value.Data,i="";return(n.getValue("ContactFirstName")||n.getValue("ContactLastName"))&&(i=n.getValue("ContactFirstName")+" "+n.getValue("ContactLastName")),data='<div class="form"><fieldset><div class="field read"><label><strong><a href="/Contacts/View/'+contactID+'">'+t.value.Data.getValue("ContactName")+"</a></strong></label>"+(""!=i?"<span>Contact Person: "+i+"</span>":"")+(""!=t.value.Data.getValue("ContactPhone")?"<span>Phone: "+t.value.Data.getValue("ContactPhone")+"</span>":"")+(""!=t.value.Data.getValue("ContactMobile")?"<span>Mobile: "+t.value.Data.getValue("ContactMobile")+"</span>":"")+(""!=t.value.Data.getValue("ContactDDI")?"<span>DDI: "+t.value.Data.getValue("ContactDDI")+"</span>":"")+'</div><div class="field textarea"><label>Notes</label><textarea id="NewNote"></textarea>',""!=t.value.Data.getValue("LastNote")&&(data+='<span class="tip">Previous note from '+t.value.Data.getValue("LastNoteDate")+'</span><span class="tip black">'+t.value.Data.getValue("LastNote")+"</span>"),data+='</div><div class="field"><label>Expected Payment Date</label><div class="controls"><div class="datePicker"><input value="'+t.value.Data.getValue("ExpectedPayDate")+'" tabindex="" style="width:75px;" class="field" autocomplete="off" name="ExpectedDate" id="ExpectedDate"/></div></div></div><div class="secondaryButtons multiblue"><dl id="menu00" class="large button doNotDisable doNotDisableOthers"><dt><a href="#" class="words" onclick="XERO.widget.Template.ar_expected_date.save(\''+e+"', '"+contactID+'\', \'close\'); return false;" style="width:105px;"><span>Save</span></a><a href="#" class="dropDown"><span class="icons white-arrow">&#160;</span></a></dt><dd><ul><li><a href="#" onclick="XERO.widget.Template.ar_expected_date.save(\''+e+"', '"+contactID+"', 'close'); return false;\">Save &amp; Close</a></li>",$("ExpectedPayDate"+e)?data+='<li><a href="#" onclick="XERO.widget.Template.ar_expected_date.save(\''+e+"', '"+contactID+"', 'view'); return false;\">Save &amp; View Invoice</a></li>":data+='<li><a href="#" onclick="XERO.widget.Template.ar_expected_date.save(\''+e+"', '"+contactID+"', 'email'); return false;\">Save &amp; Email Invoice</a></li>",data+='<li><a href="#" onclick="XERO.widget.Template.ar_expected_date.save(\''+e+"', '"+contactID+"', 'print'); return false;\">Save &amp; Print Invoice</a></li><li><a href=\"#\" onclick=\"XERO.widget.Template.ar_expected_date.save('"+e+"', '"+contactID+'\', \'statement\'); return false;">Save &amp; Send Statement</a></li></ul></dd></dl></div><div class="field cancel">or <a href="#" onclick="XERO.widget.Template.ar_expected_date.destroy(\'cancel\'); return false;">Cancel</a></div></fieldset></div>',data}},Ext.override(Ext.EventObjectImpl,{getTarget:function(t,e,n){var i;try{i=t?Ext.fly(this.target).findParent(t,e,n):this.target}catch(t){i=this.target}return i}}),XERO.widget.Template.PlannedBatch={init:function(){dp=XERO.widget.Template.PlannedBatch,min=new Date("1/1/2005"),Ext.get("ap-calendar")||(div=Ext.DomHelper.append(document.body,{tag:"div",id:"ap-calendar"}),calendar=Ext.get("ap-calendar"),calendar.setStyle("position","absolute"),calendar.setStyle("float","left")),dp.cal=new Ext.DatePicker({showToday:!1,renderTo:"ap-calendar",minDate:min,listeners:{select:dp.select}}),dp.cal.hide()},active:null,shade:new Ext.Shadow,cache:new Ext.util.MixedCollection,select:function(t,e){dp=XERO.widget.Template.PlannedBatch,dp.cal.hide(),dp.shade.hide(),dp.active.date=e,dp.active.save()}},XERO.widget.Template.PlannedBatch.Date=function(t){this.el=Ext.get(t),this.el.child("a").on("click",this.open,this),body=Ext.get(document.body),body.on("click",function(t,e){e&&"BUTTON"!=e.tagName&&"I"!=e.tagName&&this.close()},this)},XERO.widget.Template.PlannedBatch.Date.prototype={date:null,open:function(){var t=XERO.widget.Tables.getItems(this.el.dom);t&&0!=t.length&&(XERO.widget.Template.Planned.active&&XERO.widget.Template.Planned.active.close(),dp=XERO.widget.Template.PlannedBatch,dp.active=this,this.date&&dp.cal.setValue(this.date),Ext.fly("ap-calendar").anchorTo(this.el,"bl"),dp.cal.show(),dp.shade.show("ap-calendar"),Ext.EventObject.stopEvent())},close:function(){dp=XERO.widget.Template.PlannedBatch,dp.cal.hide(),dp.shade.hide(),months=Ext.query("div.x-date-mp"),Ext.fly(months[0]).hide()},updateStyle:function(t){t.el.child("a.date").child("span").update(text),t.el.hasClass("st-add")&&(t.el.removeClass("st-add"),t.el.addClass("st-change")),t.el.removeClass("st-spin"),t.date=this.date,t.orig=t.date;var e=t.el.parent("td");today=Date.today().format("Y-m-d"),t.orig.format("Y-m-d")<today?e.hasClass("red")||e.addClass("red"):e.hasClass("red")&&e.removeClass("red")},updatePaymentSchedule:function(t){var e=t.Result;$("PlannedPayments")&&null!=e&&""!=e&&(schedule=$("PlannedPayments"),Ext.isIE&&"none"==schedule.style.display&&(task=new Ext.util.DelayedTask(function(){schedule.update(e)}),task.delay(500)),schedule.show(),schedule.update(e))},saveManyCallback:function(t){var e=t.value;if(e.IsValid){var n=Ext.fly(Ext.query("table.standard")[0]).select('tr[class~="selected"]');for(o=0;o<n.getCount();o++)if(n.item(o).child("div.pd")){var i=XERO.widget.Template.Planned.cache.get(n.item(o).child("div.pd").id);this.updateStyle(i)}this.updatePaymentSchedule(e),XERO.widget.Template.Planned.cache.clear();var a=Ext.query("div.pd");if(a[0]){for(var o=0;o<a.length;o++)a[o].id="ap"+o,XERO.widget.Template.Planned.cache.add(a[o].id||"ap"+o,new XERO.widget.Template.Planned.Date(a[o]));XERO.widget.Template.Planned.init()}}else{XERO.MsgBox.alert("We're having a problem saving the Planned Date. Please try again in a few minutes.","Planned Date"),this.el.removeClass("st-spin"),this.date=this.orig;var r="us"==Ext.get("HelpRegion").getValue();text=this.date.format(r?"M j, Y":"j M Y"),this.el.child("a.date").child("span").update(text)}},save:function(){if(this.date!=this.orig){var t="us"==Ext.get("HelpRegion").getValue();text=this.date.format(t?"M j, Y":"j M Y");var e=Ext.fly(Ext.query("table.standard")[0]).select('tr[class~="selected"]');if(e.getCount()>0){var n=new Array;for(i=0;i<e.getCount();i++){var a=XERO.widget.Template.Planned,o=e.item(i).child("div.pd");if(null!=o){var r=a.cache.get(o.id);null==r&&(a.cache.add(o.id,new XERO.widget.Template.Planned.Date(o)),r=a.cache.get(o.id)),r.el.addClass("st-spin");var s=e.item(i).child("input").getAttribute("value");n.push(s)}}Ajax.SaveManyFollowUpPanel(n,"",text,this.saveManyCallback.bindAsEventListener(this))}}}},XERO.widget.Template.Planned={init:function(){dp=XERO.widget.Template.Planned,min=new Date("1/1/2005"),Ext.get("ap-calendar")||(div=Ext.DomHelper.append(document.body,{tag:"div",id:"ap-calendar"}),calendar=Ext.get("ap-calendar"),calendar.setStyle("position","absolute"),calendar.setStyle("float","left")),dp.cal=new Ext.DatePicker({showToday:!1,renderTo:"ap-calendar",minDate:min,listeners:{select:dp.select}}),dp.cal.hide()},active:null,shade:new Ext.Shadow,cache:new Ext.util.MixedCollection,select:function(t,e){dp=XERO.widget.Template.Planned,dp.cal.hide(),dp.shade.hide(),dp.active.date=e,dp.active.save()}},XERO.widget.Template.Planned.Date=function(t){this.el=Ext.get(t);var e=this.el.child("a.date");if(e.on("click",this.open,this),this.el.child("span.icons")&&this.el.child("span.icons").on("click",this.open,this),this.el.hasClass("st-change")){this.el.on("mouseover",this.show,this),this.el.on("mouseout",this.hide,this),cd=Ext.util.Format.trim(e.child("span").dom.innerHTML);var n="us"==Ext.get("HelpRegion").getValue();cd=Date.parseDate(cd,n?"M j, Y":"j M Y"),this.orig=cd,this.date=cd,this.el.child("a.plus").on("click",this.nudgeUp,this),this.el.child("a.minus").on("click",this.nudgeDown,this),this.el.child("a.del").removeAllListeners(),this.el.child("a.del").on("click",this.deleteDate,this)}body=Ext.get(document.body),body.on("click",function(t,e){e&&"BUTTON"!=e.tagName&&"I"!=e.tagName&&this.close()},this)},XERO.widget.Template.Planned.Date.prototype={date:null,show:function(){this.el.addClass("ctrls")},hide:function(){this.el.removeClass("ctrls"),this.date!=this.orig&&this.save},open:function(){XERO.widget.Template.PlannedBatch.active&&XERO.widget.Template.PlannedBatch.active.close(),dp=XERO.widget.Template.Planned,dp.active=this,this.date&&dp.cal.setValue(this.date),Ext.fly("ap-calendar").anchorTo(this.el,"bl"),dp.cal.show(),dp.shade.show("ap-calendar"),Ext.EventObject.stopEvent()},close:function(){dp=XERO.widget.Template.Planned,dp.cal.hide(),dp.shade.hide(),months=Ext.query("div.x-date-mp"),Ext.fly(months[0]).hide()},nudgeUp:function(){this.close();var t=new Date(this.date);this.date=t.setDate(t.getDate()+1);var e="us"==Ext.get("HelpRegion").getValue();text=new Date(this.date).format(e?"M j, Y":"j M Y"),this.el.child("a.date").child("span").update(text),Ext.EventObject.stopEvent(),this.save()},nudgeDown:function(){this.close();var t=new Date(this.date);this.date=t.setDate(t.getDate()-1);var e="us"==Ext.get("HelpRegion").getValue();text=new Date(this.date).format(e?"M j, Y":"j M Y"),this.el.child("a.date").child("span").update(text),Ext.EventObject.stopEvent(),this.save()},deleteDate:function(){this.close(),this.date=null,text="",this.el.child("a.date").child("span").update(text),Ext.EventObject.stopEvent(),this.save()},saveCallback:function(t){var e=t.value,n=this.el.child("a.date");if(e.IsValid){""===text?(n.child("span").update("<span>Add Date</span>"),this.el.removeClass("st-change"),this.el.addClass("st-add"),this.el.parent("td").removeClass("red")):n.child("span").update(text),this.el.hasClass("st-add")&&(this.el.removeClass("st-add"),this.el.addClass("st-change"),dp.cache.add(this.el.dom.id,new dp.Date(this.el.dom.id))),this.el.removeClass("st-spin"),""===text?(n.child("span").update("Add date"),this.el.removeClass("st-change"),this.el.addClass("st-add"),this.el.parent("td").removeClass("red")):(n.child("span").update(text),this.el.hasClass("st-add")&&(this.el.removeClass("st-add"),this.el.addClass("st-change"),dp.cache.add(this.el.dom.id,new dp.Date(this.el.dom.id))),this.orig=this.date,td=this.el.parent("td"),today=Date.today().format("Y-m-d"),new Date(this.orig).format("Y-m-d")<today?td.hasClass("red")||td.addClass("red"):td.hasClass("red")&&td.removeClass("red"));var i=e.Result;$("PlannedPayments")&&null!=i&&(schedule=$("PlannedPayments"),Ext.isIE&&"none"==schedule.style.display&&(task=new Ext.util.DelayedTask(function(){schedule.update(i)}),task.delay(500)),schedule.show(),schedule.update(i))}else{XERO.MsgBox.alert("We're having a problem saving the Planned Date. Please try again in a few minutes.","Planned Date"),this.el.removeClass("st-spin"),this.date=this.orig;var a="us"==Ext.get("HelpRegion").getValue();text=new Date(this.date).format(a?"M j, Y":"j M Y"),n.child("span").update(text)}},save:function(){if(this.date!=this.orig){dp=XERO.widget.Template.Planned,invoiceID=this.el.parent("tr").child("input").dom.value,this.el.addClass("st-spin");var t="us"==Ext.get("HelpRegion").getValue();null!==this.date?text=new Date(this.date).format(t?"M j, Y":"j M Y"):text="",Ajax.SaveFollowUpPanel(invoiceID,"",text,this.saveCallback.bindAsEventListener(this))}}},Ext.apply(Ext.util.Format,{money:function(t){t=Math.round(100*(t-0))/100,t=t==Math.floor(t)?t+".00":10*t==Math.floor(10*t)?t+"0":t,t=String(t);for(var e=t.split("."),n=e[0],i=e[1]?"."+e[1]:".00",a=/(\d+)(\d{3})/;a.test(n);)n=n.replace(a,"$1,$2");return t=n+i,"-"==t.charAt(0)?"("+t.substr(1)+")":t}}),XERO.widget.Template.Account={},XERO.widget.Template.Account.Balance={active:null,cache:new Ext.util.MixedCollection,update:function(t,e,n,i){i||(i=!1),popup=XERO.MsgBox,html="Are you sure you want to "+e.toLowerCase()+" this item?",popup.confirm(html,"Confirm",null,"OK",function(){1==i&&(Windows.closeAll(),setTimeout(function(){document.body.style.cursor="default"},1e3)),SubmitAction(t,n)},"Cancel")},calculate:function(){for(var t=0;t<this.cache.length;t++)this.cache.items[t].calculate(),1==this.cache.items[t].balanced&&(null==this.active?this.active=1:this.active=this.active+1);this.active==this.cache.length?Ext.fly("continue").setStyle("display","block"):(Ext.fly("btn-next").addClass(["disabled","gray"]),Ext.fly("btn-back")&&(Ext.fly("btn-back").addClass("blue"),Ext.fly("btn-back").removeClass("gray")))}},XERO.widget.Template.Account.Balance.Currency=function(t){this.el=Ext.get(t),this.icon=this.el.child("em.add"),this.dl={},this.dl.el=this.el.child("dl"),this.dl.subtotal=this.el.child("dl/dd.subtotal"),this.dl.dt=this.el.child("dl/dt.balance"),this.dl.dd=this.el.child("dl/dd.balance"),state=this.dl.el.getStyle("display"),"none"==state&&(this.active=!0),this.table=this.el.next("table.standard"),this.total={},this.total.el=this.table.next("div.total"),this.subtotal={},this.subtotal.el=this.total.el.child("div.subtotal/span"),this.subtotal.num=new Decimal(this.subtotal.el.dom.innerHTML).num,this.goal={},this.goal.el=this.total.el.child("div.goal/span"),this.goal.num=new Decimal(this.goal.el.dom.innerHTML).num,this.bottomline={},this.bottomline.el=this.total.el.child("div.bottom-line"),this.bottomline.label=this.total.el.child("div.bottom-line/label"),this.bottomline.span=this.total.el.child("div.bottom-line/span"),this.bottomline.msg=this.total.el.child("div.joined"),this.el.on("click",this.toggle,this)},XERO.widget.Template.Account.Balance.Currency.prototype={active:!1,balanced:!1,toggle:function(){this.active?(this.active=!1,this.icon.removeClass("subtract"),this.close()):(this.active=!0,this.icon.addClass("subtract"),this.open())},open:function(){this.table.setStyle("display",""),this.total.el.setStyle("display",""),this.dl.el.setStyle("display","none")},close:function(){this.table.setStyle("display","none"),this.total.el.setStyle("display","none"),this.dl.el.setStyle("display","")},calculate:function(){total=Ext.util.Format.money(this.goal.num-this.subtotal.num),this.dl.subtotal.update(Ext.util.Format.money(this.subtotal.num)),this.dl.dd.update(total),this.bottomline.span.update(total),0==total&&(this.balanced=!0,this.dl.dt.addClass("balanced"),this.dl.dd.addClass("balanced"),this.dl.dt.update('<em class="icons round-checkmark">&#160;</em> Matched'),this.dl.dd.update(""),this.bottomline.el.addClass("green"),this.bottomline.el.removeClass("red"),this.bottomline.label.update('<em class="icons round-checkmark">&#160;</em> Matched'),this.bottomline.span.update(""),this.bottomline.msg.setStyle("display","none"))}},Ext.onReady(function(){var t=Ext.query("div.pd");if(t[0]){for(var e=0;e<t.length;e++)t[e].id="ap"+e,XERO.widget.Template.Planned.cache.add(t[e].id||"ap"+e,new XERO.widget.Template.Planned.Date(t[e]));XERO.widget.Template.Planned.init()}var n=Ext.query("div.balanceCurrency");if(n[0]){for(var e=0;e<n.length;e++)XERO.widget.Template.Account.Balance.cache.add(n[e].id||"ib"+e,new XERO.widget.Template.Account.Balance.Currency(n[e]));XERO.widget.Template.Account.Balance.calculate()}}),window.Batch={},Object.extend(Batch,{dateTabs:null,initTabs:function(t,e,n){Batch.dateTabs=new Ext.TabPanel({renderTo:"dateTabs",cls:"batch-dates",resizeTabs:!0,minTabWidth:115,tabWidth:135,enableTabScroll:!0,width:927,defaults:{autoScroll:!0},listeners:{tabChange:function(t,e){var i=Ext.fly(Ext.query("div.action-bar")[0]);i&&i.setStyle("display","none");var a=Ext.fly(Ext.query("table.standard")[0]);a&&a.setStyle("display","none");var o=Ext.fly(Ext.query("div.paginate")[0]);o&&o.setStyle("display","none");var r=Ext.fly(Ext.query("div.paginate")[0]);r&&r.next("div.shadow").setStyle("display","none");var s=Ext.fly(Ext.query("h2.summary")[0]);s&&s.update("Loading, please wait..."),n(t,e),document.body.style.cursor="wait"}},items:t}),Batch.dateTabs.suspendEvents(),Batch.dateTabs.setActiveTab(e),Batch.dateTabs.resumeEvents()},onTabChange:function(t,e){url="Search.aspx?invoiceStatus=INVOICESTATUS%2fAUTHORISED&startDate="+e.id+"&endDate="+e.id+"&dateWithin=planned&isTabChange=true","ALL"==e.id?window.location="Search.aspx?invoiceStatus=INVOICESTATUS%2fAUTHORISED&isTabChange=true":window.location=url}}),XERO.keys=[],XERO.keys.push({key:"O",text:"Show and hide fast keys",fn:function(){Ext.fly("fastKeys")&&Ext.fly("fastKeys").toggle()}}),XERO.keys.push({key:"D",text:"Go to your Dashboard",fn:function(){parent.location="/Dashboard"}}),XERO.widget.Template.Messages={showMessage:function(t,e){var n=Ext.get("messageDiv"),i=Ext.get("ajaxMessageHolder"),a=Ext.get("closeError");i.removeClass("notify bg-green bigger"),i.removeClass("notify bg-orange bigger"),i.removeClass("notify bg-red bigger"),"confirm"==e?(i.addClass("notify bg-green bigger"),a&&a.show()):"error"==e?(i.addClass("notify bg-red bigger"),a&&a.setStyle("display","none")):(i.addClass("notify bg-orange bigger"),a&&a.show()),n.dom.innerHTML=t,i.show(),Ext.fly("moreErrors")&&(Ext.fly("moreErrors").on("click",function(){return XERO.widget.Messages.more("messageDiv"),!1}),Ext.fly("lessErrors").on("click",function(){return XERO.widget.Messages.less("messageDiv"),!1}))},hideAnyMessages:function(){Ext.fly("ajaxMessageHolder").setStyle("display","none")},buildSingleErrorMessage:function(t){return String.format("<p>{0}</p><ul><li>{1}</li></ul>","An error occurred for the following reason: ",t)},buildErrorMessage:function(t){var e="";if("string"==typeof t)return this.buildSingleErrorMessage(t);if(1==t.length)return this.buildSingleErrorMessage(t[0]);for(var n=0,i=t.length;n<i;n++)e+="<li>"+t[n]+"</li>";return String.format("<p>{0}</p><ul>{1}</ul>",t.length+" errors occurred for the following reasons: ",e)}}},function(t,e){XERO.widget.ImageViewer=Ext.extend(Ext.Window,{fileId:null,imageHeight:0,imageWidth:0,modal:!0,closeAction:"hide",initComponent:function(){this.bodyCfg={tag:"div",children:[{tag:"img",cls:"attachedImage",style:"display:none",height:this.imageHeight,width:this.imageWidth,src:this.src},{tag:"div",style:"text-align:center;width:100%;margin:20px 0;",cls:"loadingImage",html:'<img src="/common/images/indicator_blue.gif" />'},{tag:"div",cls:"upload-actions",html:'<a class="download-attachment xbtn large blue" href="javascript:">Download</a> <a class="xbtn large gray" href="javascript:" onclick="Ext.WindowMgr.getActive().hide();">Close</a>'}]},XERO.widget.ImageViewer.superclass.initComponent.apply(this,arguments)},onRender:function(){XERO.widget.ImageViewer.superclass.onRender.apply(this,arguments),this.body.on("click",function(t){if(t.getTarget("a.download-attachment")){var e=String.format("/GetFile.ashx?{0}",Ext.urlEncode({fi:this.fileId,ft:"FILETYPE/LOGO",dl:!0}));location.href=e}},this),this.getEl().child(".attachedImage").on("load",this.resizeImage,this)},resizeImage:function(t,e){var n=Ext.get(e),i=Ext.WindowMgr.getActive(),a=this.getEl().child(".loadingImage");a&&a.remove(),n.fadeIn(),i.center(),setTimeout(function(){Ext.WindowMgr.getActive().center(),Ext.WindowMgr.getActive().syncShadow()},5)},setSrc:function(t){this.body.dom.src=t},initEvents:function(){XERO.widget.ImageViewer.superclass.initEvents.apply(this,arguments),this.resizer&&(this.resizer.preserveRatio=!0)}})},function(t,e){XERO.ns("XERO.widget"),XERO.widget.CustomTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(t){XERO.widget.CustomTreeNodeUI.superclass.constructor.call(this,t)},customBeforeContent:function(t){return""},customInnerContent:function(t){return""},customNodeClass:function(t){return""},afterRender:function(t,e,n){},deleteNode:function(){this.node.remove(!0)},getCustomDDHandles:function(){return[]},customTitleRenderer:function(t){return t.text},renderElements:function(t,e,n,i){this.indentMarkup=t.parentNode?t.parentNode.ui.getChildIndent():"";var a,o=Ext.isBoolean(e.checked),r=e.href?e.href:Ext.isGecko?"":"#",s=this.customInnerContent(t),l=this.customBeforeContent(t),u=this.customNodeClass(t),c=['<li class="x-tree-node ',u,'"><div ext:tree-node-id="',t.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',e.cls,'" unselectable="on">','<div class="x-tree-node-indent">',this.indentMarkup,"</div>",'<div class="node-group">','<div class="tree-node-before-content">',l,"</div>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',e.icon||this.emptyIcon,'" class="x-tree-node-icon',e.icon?" x-tree-node-inline-icon":"",e.iconCls?" "+e.iconCls:"",'" unselectable="on" />',o?'<input class="x-tree-node-cb" type="checkbox" '+(e.checked?'checked="checked" />':"/>"):"",'<span class="tree-node-note-number"></span>','<a hidefocus="on" class="x-tree-node-anchor" href="',r,'" tabIndex="1" ',e.hrefTarget?' target="'+e.hrefTarget+'"':"",'><span unselectable="on">',this.customTitleRenderer(t),"</span></a>",s,"</div>","</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");!0!==i&&t.nextSibling&&(a=t.nextSibling.ui.getEl())?this.wrap=Ext.DomHelper.insertHtml("beforeBegin",a,c):this.wrap=Ext.DomHelper.insertHtml("beforeEnd",n,c),this.elNode=this.wrap.childNodes[0],this.ctNode=this.wrap.childNodes[1];var d=this.elNode.childNodes,h=0;this.indentNode=d[h++],this.contentNode=d[h++],h=0,d=this.contentNode.childNodes,this.beforeContentNode=d[h++],this.ecNode=d[h++],this.iconNode=d[h++],o&&(this.checkbox=d[h++],this.checkbox.defaultChecked=this.checkbox.checked),this.numberNode=d[h++],this.anchor=d[h++],this.textNode=this.anchor.firstChild,this.afterRender(t,d,h)},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode].concat(this.getCustomDDHandles())},onCheckChange:function(t,e){var n=this.checkbox.checked;this.checkbox.defaultChecked=n,this.node.attributes.checked=n,!0!==e&&this.fireEvent("checkchange",this.node,n,t)},toggleCheck:function(t,e){var n=this.checkbox;n&&(n.checked=void 0===t?!n.checked:t,this.onCheckChange(null,e))},addDropHints:function(t,e){var n=e.getHeight()+"px";switch(t){case"below":case"append":this.elNode.style.marginBottom=n;break;case"above":this.elNode.style.marginTop=n}},removeDropHints:function(){this.elNode.style.marginTop="",this.elNode.style.marginBottom=""},appendDDGhost:function(t,e,n){if(e&&e.parentNode){e.getUI();this.configureProxy(t)}else this.configureProxy(t);Ext.fly(this.elNode).parent().hide()},nodeGhost:new Ext.XTemplate(['<div id="node-dd-ghost">',"{content}","</div>"],{compiled:!0}),configureProxy:function(t){var e=Ext.get(t);e.update(XERO.widget.CustomTreeNodeUI.prototype.nodeGhost.apply({content:this.getGhostContent()}));var n=e.prev(".x-dd-drop-icon")||e.next(".x-dd-drop-icon");n&&(n.remove(),e.insertSibling("<em class='icons drag'> </em>","before"))},getGhostContent:function(){return""}})},function(t,e){XERO.widget.Counter=function(t,e){return this.field=t,this.counter=e,this.numbers=this.counter.child("div"),this.charText=this.counter.child("span"),this.field.on("keyup",this.countMe,this),this},XERO.widget.Counter.prototype={countMe:function(t,e){if(null!=e.value.length){var n=2500-e.value.length;e.value.length>2500?(this.counter.addClass("characterCountError"),this.counter.addClass("displayCounter"),n=n.toString().replace("-",""),this.numbers.update(n+"&nbsp;"),this.charText.update("too many")):e.value.length>=2e3?(this.counter.addClass("displayCounter"),this.numbers.update(n+"&nbsp;"),this.charText.update("left"),this.counter.removeClass("characterCountError")):this.counter.removeClass("displayCounter")}},resetCount:function(){this.counter.child("div").update("2000&nbsp;")}}},function(t,e){XERO.ns("XERO.ux"),function(){var t=[];XERO.toaster={show:function(e){var n={type:"info",handler:null,closable:!0,hideIn:2e4},e=e||{};e=Ext.isString(e)?Ext.apply(n,{msg:e}):Ext.apply(n,e);var i=new XERO.ux.HoverMessage(e);return XERO.toaster.closeAll(),t.push(i),0!==e.hideIn&&Ext.defer(function(){i&&!1===i.isDestroyed&&i.close()},e.hideIn),i},hideAll:function(){Ext.each(t,function(t){t&&t.close(!0)})},closeAll:function(){Ext.each(t,function(t){t&&t.close(!0)})}}}(),XERO.ux.HoverMessage=Ext.extend(Ext.Component,{destroyOnClose:!0,cls:"hover-message",type:"gray",msg:"",handler:null,msgTpl:'<div class="x-hover-message {0}"><div class="message">{1} {2}</div>{3}</div>',closable:!0,target:null,isDestroyed:!1,offsetTop:10,animate:!0,initComponent:function(){var t,e=this,n=!1;null!=e.getTarget()?(t=Ext.isString(e.getTarget())?Ext.ComponentQuery.query(e.getTarget())[0]:e.getTarget(),t.down("header")&&(n=!0),t=(t.getEl?t.getEl():t)||t):t=Ext.getBody(),Ext.apply(e,{cls:"x-hover",html:e.getHtmlForMessage(),renderTo:t}),e.addEvents("undo"),XERO.ux.HoverMessage.superclass.initComponent.call(e),e.on("afterrender",function(){var t=e.getEl(),i=e.container.getX()+(e.container.getWidth()-t.getWidth())/2;e.yPos?yPos=e.yPos:e.yPos||e.getTarget()?yPos=!0===n?e.container.getY()+40:e.container.getY()+(e.offsetTop||10):yPos=e.container.getY()+128,t&&(!1!==e.animate?t.fadeIn({duration:.4}).setX(i).setY(yPos):t.show(),Ext.EventManager.onWindowResize(e.handleWindowResize,e),t.on("click",function(t){t.getTarget("a.undo")&&(t.stopEvent(),e.fireEvent("undo",e),e.handler&&e.handler.call(e,e),e.close()),t.getTarget("a.close")&&(t.stopEvent(),e.close()),t.getTarget("a[data-type=event]")&&(t.stopEvent(),e.fireEvent(Ext.fly(t.getTarget("a[data-type=event]")).getAttribute("data-event"),e),e.close())}))}),e.on("destroy",e.onDestroy,e)},getTarget:function(){return this.target},handleWindowResize:function(){var t=this,e=t.getEl();e&&e.setX(t.container.getX()+(t.container.getWidth()-e.getWidth())/2)},getHtmlForMessage:function(){var t=this;return Ext.String.format(t.msgTpl,t.type,t.msg,t.handler||t.events&&t.events.undo?'<a href="#" class="undo">Undo</a>':"",t.closable?'<a class="close" href="#"></a>':"")},setMsg:function(t){var e,n=this,i=n.type;return Ext.isString(t)?e=t:(e=t.msg,i=t.type||n.type),n.msg=e,n.type=i,n.getEl().update(n.getHtmlForMessage()),n},close:function(t){var e=this,n=this.getEl();return n&&!0!==t?n&&n.dom&&n.fadeOut({duration:.4,callback:function(){!0===e.destroyOnClose?e.destroy():e.hide()},scope:e}):e.destroy(),e},onDestroy:function(){this.isDestroyed=!0,Ext.EventManager.removeResizeListener(this.handleWindowResize,this),XERO.ux.HoverMessage.superclass.onDestroy.apply(this,arguments)}})},function(t,e){XERO.ns("XERO.ux"),function(){var t=[];XERO.toasterXui={show:function(e){var n={closable:!0,hideIn:2e4},e=e||{};e=Ext.isString(e)?Ext.apply(n,{msg:e}):Ext.apply(n,e);var i=new XERO.ux.HoverMessageXui(e);return XERO.toasterXui.closeAll(),t.push(i),0!==e.hideIn&&Ext.defer(function(){i&&!1===i.isDestroyed&&i.close()},e.hideIn),i},hideAll:function(){Ext.each(t,function(t){t&&t.close(!0)})},closeAll:function(){Ext.each(t,function(t){t&&t.close(!0)})}}}(),XERO.ux.HoverMessageXui=Ext.extend(Ext.Component,{clsToast:"",clsMessage:"",destroyOnClose:!0,msg:"",msgTpl:'<div class="xui-container"><div class="xui-toastwrapper"><div class="xui-toast xui-toast-layout {2}" role="status"><button type="button" class="xui-button xui-button-icon xui-toast--close close" title="Close" aria-label="Close"><svg width="12" height="12" x="0" y="0" focusable="false" class="xui-icon" viewbox="0 0 12 12"><path d="M6 4.5L10.5 0 12 1.5 7.5 6l4.5 4.5-1.5 1.5L6 7.5 1.5 12 0 10.5 4.5 6 0 1.5 1.5 0 6 4.5z" class="undefined"></path></svg></button><div class="xui-toast--message {3}">{0}</div>{1}</div></div></div>',closable:!0,actionText:"",actionTpl:'<div class="xui-toast--actions"><button type="button" class="xui-button xui-actions--primary xui-button-borderless-main xui-button-small action">{0}</button></div>',isDestroyed:!1,animate:!0,initComponent:function(){var t,e=this;null!=e.getTarget()?(t=Ext.isString(e.getTarget())?Ext.ComponentQuery.query(e.getTarget())[0]:e.getTarget(),t.down("header")&&!0,t=(t.getEl?t.getEl():t)||t):t=Ext.getBody(),Ext.apply(e,{html:e.getHtmlForMessage(),renderTo:t}),e.addEvents("action"),XERO.ux.HoverMessageXui.superclass.initComponent.call(e),e.on("afterrender",function(){var t=e.getEl();t&&(!1!==e.animate?t.fadeIn({duration:.4}):t.show(),t.on("click",function(t){t.getTarget("button.action")&&(t.stopEvent(),e.fireEvent("action",e),e.handler&&e.handler.call(e,e),e.close()),t.getTarget("button.close")&&(t.stopEvent(),e.close())}))}),e.on("destroy",e.onDestroy,e)},getTarget:function(){return this.target},getHtmlForMessage:function(){var t=this;return Ext.String.format(t.msgTpl,t.msg,t.actionText?Ext.String.format(t.actionTpl,t.actionText):"",t.clsToast,t.clsMessage)},close:function(t){var e=this,n=this.getEl();return n&&!0!==t?n&&n.dom&&n.fadeOut({duration:.4,callback:function(){!0===e.destroyOnClose?e.destroy():e.hide()},scope:e}):e.destroy(),e},onDestroy:function(){this.isDestroyed=!0,XERO.ux.HoverMessageXui.superclass.onDestroy.apply(this,arguments)}})},function(t,e){!function(){"use strict";function t(t){return[new XERO.buttons.WindowButton({text:"Download Form",handler:function(){t.triggerDownload()},type:"green",size:"medium"}),new XERO.buttons.WindowButton({text:"Close",handler:function(){t.close()},type:"grey",size:"medium"})]}Ext.define("XERO.widget.BankFeedForm",{extend:"XERO.Window",title:"Complete the Form",cls:"bankfeedModal",width:370,autoHeight:!0,modal:!0,constructor:function e(n){this.buttons=t(this),this.callParentStrict(e,arguments)},tpl:new Ext.XTemplate('<div class="bankfeedModal">','<div class="bankfeedModal--row bankfeedModal--headingRow">',"Download, sign and send us the form","</div>",'<div class="bankfeedModal--row bankfeedModal--row-highlighted">','<p class="bgIcon bgIcon-email"><em>Email</em><br />bankfeeds@xero.com</p>',"</div>",'<div class="bankfeedModal--row">','<p class="bankfeedModal--clause" >It can take up to 10 business days for your bank to<br />be connected. We&apos;ll email you when it&apos;s sorted.</p>','<tpl if="this.hasManualUploadlink(values)">','<p class="bankfeedModal-clause"><a href="{manualUploadUrl}" class="icon-arrow manualUpload">Upload your transactions in the meantime<span class="icon icon-arrow-right"></span></a></p>',"</tpl>","</div>",'<a href="{pdfDownloadLink}" class="x-hidden downloadLink" {[this.getDownloadAttribute(values)]}>Download</a>',"</div>",{compiled:!0,getDownloadAttribute:function(t){return Ext.isIE||Ext.isSafari?'target="_blank"':'download="XERO bank feed authorisation form - '+t.bankName+'.pdf"'},hasManualUploadlink:function(t){return!Ext.isEmpty(t.manualUploadUrl)}}),listeners:{afterrender:function(){if(this.downloadLink=this.el.child(".downloadLink"),XERO.analytics.Analytics.isTrial()){XERO.analytics.Analytics.trackLinks(".manualUpload","Bank feed setup",{Action:"Manual Upload",Modal:"Form"}),this.on({"bankfeedform:download":function(){XERO.analytics.Analytics.track("Bank feed setup",{Action:"Download Form",Modal:"Form"})},close:function(){XERO.analytics.Analytics.track("Bank feed setup",{Action:"Close",Modal:"Form"})}})}}},triggerDownload:function(){this.downloadLink.dom.click(),this.fireEvent("bankfeedform:download",this)}})}()},function(t,e){!function(){"use strict";function t(t){return[new XERO.buttons.WindowButton({text:"Continue",handler:function(){t.fireEvent("bankfeedinstructions:continue",t),t.suspendEvents(),t.close(),t.resumeEvents()},type:"green",size:"medium"}),new XERO.buttons.WindowButton({text:"Not now",handler:function(){t.close()},type:"grey",size:"medium"})]}Ext.define("XERO.widget.BankFeedInstructions",{extend:"XERO.MsgBox",title:"Connect your Bank Feed",width:370,autoHeight:!0,cls:"bankfeedModal",modal:!0,draggable:!1,constructor:function e(n){this.buttons=t(this),this.callParentStrict(e,arguments)},tpl:new Ext.XTemplate('<div class="bankfeedModal">','<div class="bankfeedModal--row bankfeedModal--headingRow">',"Now, get your bank transactions<br />fed into Xero automatically","</div>",'<div class="bankfeedModal--row bankfeedModal--row-highlighted">',"<p>We can connect to these account types<br />",'<ul class="supportedAccountsList">','<tpl for="accountList">','<li class="supportedAccountsList--account">{[values]}</li>',"</tpl>","</ul>","</div>",'<tpl if="this.hasManualUploadlink(values)">','<div class="bankfeedModal--row">','<p class="bankfeedModal--clause" >Don&apos;t see your account type? <a href="{manualUploadUrl}" class="manualUpload">Upload your transactions<span class="icon icon-arrow-right"></span></a></p>',"</div>","</tpl>","</div>",{compiled:!0,hasManualUploadlink:function(t){return!Ext.isEmpty(t.manualUploadUrl)}}),listeners:{afterrender:function(){if(XERO.analytics.Analytics.isTrial()){XERO.analytics.Analytics.trackLinks(".manualUpload","Bank feed setup",{Action:"Manual Upload",Modal:"Instructions"}),this.on({"bankfeedinstructions:continue":function(){XERO.analytics.Analytics.track("Bank feed setup",{Action:"Continue",Modal:"Instructions"})},close:function(){XERO.analytics.Analytics.track("Bank feed setup",{Action:"Close",Modal:"Instructions"})}})}}}})}()},function(t,e){!function(){var t=function(t,e){var n=t&&Ext.isObject(t)?{}:t;if(n&&Ext.isObject(n))for(var i in t)null===t[i]||void 0===t[i]||(n[i]=t[i]);return e?n&&Ext.isObject(n)?Ext.urlEncode(n):encodeURI(n):n};Ext.ns("Ext.ux.plugin"),XERO.ui.Media=function(t){this.toString=this.asMarkup,Ext.apply(this,t||{}),this.initMedia()};var e=XERO.ui.Media,n=/4$/i;if(parseFloat(Ext.version)<2.1)throw"XERO.ui.Media and sub-classes are not License-Compatible with your Ext release.";XERO.ui.Media.prototype={hasVisModeFix:!!Ext.ux.plugin.VisibilityMode,mediaObject:null,mediaCfg:null,mediaVersion:null,requiredVersion:null,unsupportedText:null,hideMode:Ext.isIE?"display":"nosize",animCollapse:Ext.enableFx&&Ext.isIE,animFloat:Ext.enableFx&&Ext.isIE,autoScroll:!0,bodyStyle:{position:"relative"},initMedia:function(){},disableCaching:!1,_maxPoll:200,getMediaType:function(t){return e.mediaTypes[t]},assert:function(t,e){return t="function"==typeof t?t.call(t.scope||null):t,Ext.value(t,e)},assertId:function(t,e){return t||(t=e||Ext.id()),t},prepareURL:function(t,e){var n=t?t.split("#"):[""];if(t&&(e=void 0===e?this.disableCaching:e)){var i=n[0];if(!/_dc=/i.test(i)){var a="_dc="+(new Date).getTime();-1!==i.indexOf("?")?i+="&"+a:i+="?"+a,n[0]=i}}return n.length>1?n.join("#"):n[0]},prepareMedia:function(e,n,i,a){if(!(e=e||this.mediaCfg))return"";var o=Ext.apply({url:!1,autoSize:!1},e);if(o.url=this.prepareURL(this.assert(o.url,!1),o.disableCaching),o.mediaType){var r,s,l=Ext.Element.prototype,u=Ext.apply({},this.getMediaType(this.assert(o.mediaType,!1))||!1),c=t(Ext.apply(u.params||{},o.params||{}));for(var d in c)c.hasOwnProperty(d)&&(o.children||(o.children=[]),s=this.assert(c[d],null),s&&(s=t(s,!1!==o.encodeParams)),r={tag:"param",name:d,value:s},r.value==d&&delete r.value,s&&o.children.push(r));delete u.params;var h=this.assert(o.unsupportedText||this.unsupportedText||u.unsupportedText,null);if(h&&(o.children||(o.children=[]),o.children.push(h)),o.style&&"object"!=typeof o.style)throw"Style must be JSON formatted";return o.style=this.assert(Ext.apply(u.style||{},o.style||{}),{}),delete u.style,o.height=this.assert(i||o.height||u.height||o.style.height,null),o.width=this.assert(n||o.width||u.width||o.style.width,null),o=Ext.apply({tag:"object"},o,u),(o.height||o.autoSize)&&Ext.apply(o.style,{height:(Ext.Element.addUnits||l.addUnits).call(this.mediaEl,o.autoSize?"100%":o.height,l.defaultUnit||"px")}),(o.width||o.autoSize)&&Ext.apply(o.style,{width:(Ext.Element.addUnits||l.addUnits).call(this.mediaEl,o.autoSize?"100%":o.width,l.defaultUnit||"px")}),o.id=this.assertId(o.id),o.name=this.assertId(o.name,o.id),o._macros={url:o.url||"",height:/%$/.test(o.height)?o.height:parseInt(o.height,10)||null,width:/%$/.test(o.width)?o.width:parseInt(o.width,10)||null,scripting:this.assert(o.scripting,!1),controls:this.assert(o.controls,!1),scale:this.assert(o.scale,1),status:this.assert(o.status,!1),start:this.assert(o.start,!1),loop:this.assert(o.loop,!1),volume:this.assert(o.volume,20),id:o.id},delete o.url,delete o.mediaType,delete o.controls,delete o.status,delete o.start,delete o.loop,delete o.scale,delete o.scripting,delete o.volume,delete o.autoSize,delete o.autoScale,delete o.params,delete o.unsupportedText,delete o.renderOnResize,delete o.disableCaching,delete o.listeners,delete o.height,delete o.width,delete o.encodeParams,o}var h=this.assert(o.unsupportedText||this.unsupportedText||u.unsupportedText,null);return h=h?Ext.DomHelper.markup(h):null,String.format(h||"Media Configuration/Plugin Error"," "," ")},asMarkup:function(t){return this.mediaMarkup(this.prepareMedia(t))},mediaMarkup:function(t){if(t=t||this.mediaCfg){var e=t._macros;delete t._macros;var n=Ext.DomHelper.markup(t);if(e){var i,a;for(a in e)null!==(i=e[a])&&(n=n.replace(new RegExp("((%40|@)"+a+")","g"),i+""))}return n}},setMask:function(t){var e;(e=this.mediaMask)&&(e.el||(e=this.mediaMask=new Ext.ux.IntelliMask(t,e)),e.el.addClass("x-media-mask"))},refreshMedia:function(t){return this.mediaCfg&&this.renderMedia(null,t),this},renderMedia:function(t,e,n,i,a){if(!Ext.isReady)return void Ext.onReady(this.renderMedia.createDelegate(this,Array.prototype.slice.call(arguments,0)));var o=this.mediaCfg=t||this.mediaCfg;e=Ext.get(this.lastCt||e||(this.mediaObject?this.mediaObject.dom.parentNode:null)),this.onBeforeMedia.call(this,o,e,n,i,a),e&&(this.lastCt=e,o&&(o=this.prepareMedia(o,i,a,e))&&(this.setMask(e),this.mediaMask&&this.autoMask&&this.mediaMask.show(),this.clearMedia().writeMedia(o,e,n||"afterbegin"))),this.onAfterMedia(e)},writeMedia:function(t,e,n){var i=Ext.get(e);i&&(n?Ext.DomHelper.insertHtml(n,i.dom,this.mediaMarkup(t)):i.update(this.mediaMarkup(t)))},clearMedia:function(){var t;return Ext.isReady&&(t=this.mediaObject)&&t.remove(!0,!0),this.mediaObject=null,this},resizeMedia:function(t,e,n){var i=this.mediaCfg;i&&this.boxReady&&i.renderOnResize&&(e||n)&&arguments.length>3&&(!this.mediaObject||i.renderOnResize)&&this.refreshMedia(this[this.mediaEl])},onBeforeMedia:function(t,e,n,i,a){var o,r=t||this.mediaCfg;if(r&&(o=this.getMediaType(r.mediaType))){r.autoSize=r.autoSize||!0===o.autoSize;var s;r.autoSize&&(s=Ext.isReady?Ext.get(this[this.mediaEl]||this.lastCt||e):null)&&(r.height=this.autoHeight?null:s.getHeight(!0),r.width=this.autoWidth?null:s.getWidth(!0))}this.assert(r.height,a),this.assert(r.width,i),t=r},onMediaLoad:function(t){t&&"load"==t.type&&(this.fireEvent("mediaload",this,this.mediaObject),this.mediaMask&&this.autoMask&&this.mediaMask.hide())},onAfterMedia:function(t){var e;if(this.mediaCfg&&t&&(e=this.mediaObject=new(this.elementClass||XERO.ui.Media.Element)(t.child(".x-media",!0)))&&e.dom){e.ownerCt=this;var n;(n=this.mediaCfg.listeners||null)&&e.on(n),this.fireEvent("mediarender",this,this.mediaObject),"OBJECT"!==e.dom.tagName?e.on({load:this.onMediaLoad,scope:this,single:!0}):(this._countPoll=0,this.pollReadyState(this.onMediaLoad.createDelegate(this,[{type:"load"}],0)))}(this.autoWidth||this.autoHeight)&&this.syncSize()},pollReadyState:function(t,e){var i=this.getInterface();i&&"readyState"in i&&((e||n).test(i.readyState)?t():arguments.callee.defer(10,this,arguments))},getInterface:function(){return this.mediaObject?this.mediaObject.dom||null:null},detectVersion:Ext.emptyFn,autoMask:!1};var i={init:function(){this.getId=function(){return this.id||(this.id="media-comp"+ ++Ext.Component.AUTO_ID)},this.html=this.contentEl=this.items=null,"nosize"==this.hideMode&&(this.hasVisModeFix?new Ext.ux.plugin.VisibilityMode({elements:["bwrap","mediaEl"],hideMode:"nosize"}).init(this):this.hideMode="display"),this.initMedia(),this.toString=this.asMarkup,this.addEvents("mediarender","mediaload"),this.mediaCfg.renderOnResize&&this.on("resize",this.resizeMedia,this)},afterRender:function(t){this.setMask(this[this.mediaEl]||t),i.setAutoScroll.call(this),this.mediaCfg.renderOnResize||this.renderMedia(this.mediaCfg,this[this.mediaEl]||t)},beforeDestroy:function(){this.clearMedia(),Ext.destroy(this.mediaMask,this.loadMask),this.lastCt=this.mediaObject=this.renderTo=this.applyTo=this.mediaMask=this.loadMask=null},setAutoScroll:function(){this.rendered},getContentTarget:function(){return this[this.mediaEl]}};/**
    * @class XERO.ui.Media.Component
    * @extends Ext.BoxComponent
    * @version 2.1
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @base XERO.ui.Media
    * @constructor
    * @param {Object} config The config object
    */
XERO.ui.Media.Component=Ext.extend(Ext.BoxComponent,{ctype:"XERO.ui.Media.Component",mediaEl:"el",autoScroll:!0,autoEl:{tag:"div",style:{overflow:"hidden",display:"block",position:"relative"}},cls:"x-media-comp",mediaClass:XERO.ui.Media,constructor:function(t){Ext.apply(this,t,this.mediaClass.prototype),e.Component.superclass.constructor.apply(this,arguments)},initComponent:function(){e.Component.superclass.initComponent.apply(this,arguments),i.init.apply(this,arguments)},afterRender:function(t){e.Component.superclass.afterRender.apply(this,arguments),i.afterRender.apply(this,arguments)},beforeDestroy:function(){i.beforeDestroy.apply(this,arguments),this.rendered&&e.Component.superclass.beforeDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn,getContentTarget:i.getContentTarget,setAutoScroll:i.setAutoScroll}),Ext.reg("uxmedia",XERO.ui.Media.Component),Ext.reg("media",XERO.ui.Media.Component),/**
    * @class XERO.ui.Media.Panel
    * @extends Ext.Panel
    * @version 2.1
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @constructor
    * @base XERO.ui.Media
    * @param {Object} config The config object
    */
XERO.ui.Media.Panel=Ext.extend(Ext.Panel,{cls:"x-media-panel",ctype:"XERO.ui.Media.Panel",autoScroll:!1,mediaEl:"body",mediaClass:XERO.ui.Media,constructor:function(t){Ext.apply(this,this.mediaClass.prototype),e.Panel.superclass.constructor.apply(this,arguments)},initComponent:function(){e.Panel.superclass.initComponent.apply(this,arguments),i.init.apply(this,arguments)},afterRender:function(t){e.Panel.superclass.afterRender.apply(this,arguments),i.afterRender.apply(this,arguments)},beforeDestroy:function(){i.beforeDestroy.apply(this,arguments),this.rendered&&e.Panel.superclass.beforeDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn,getContentTarget:i.getContentTarget,setAutoScroll:i.setAutoScroll}),Ext.reg("mediapanel",XERO.ui.Media.Panel),/**
    * @class XERO.ui.Media.Portlet
    * @extends XERO.ui.Media.Panel
    * @version 2.1
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @constructor
    * @param {Object} config The config object
    */
XERO.ui.Media.Portlet=Ext.extend(XERO.ui.Media.Panel,{anchor:"100%",frame:!0,collapseEl:"bwrap",collapsible:!0,draggable:!0,autoWidth:!0,ctype:"XERO.ui.Media.Portlet",cls:"x-portlet x-media-portlet"}),Ext.reg("mediaportlet",XERO.ui.Media.Portlet),/**
    * @class XERO.ui.Media.Window
    * @extends Ext.Window
    * @version 1.0
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @constructor
    * @base XERO.ui.Media
    * @param {Object} config The config object
    */
XERO.ui.Media.Window=Ext.extend(Ext.Window,{constructor:function(){Ext.applyIf(this,this.mediaClass.prototype),e.Window.superclass.constructor.apply(this,arguments)},cls:"x-media-window",autoScroll:!1,ctype:"XERO.ui.Media.Window",mediaClass:XERO.ui.Media,mediaEl:"body",initComponent:function(){e.Window.superclass.initComponent.apply(this,arguments),i.init.apply(this,arguments)},afterRender:function(){e.Window.superclass.afterRender.apply(this,arguments),i.afterRender.apply(this,arguments)},beforeDestroy:function(){i.beforeDestroy.apply(this,arguments),this.rendered&&e.Window.superclass.beforeDestroy.apply(this,arguments)},doAutoLoad:Ext.emptyFn,getContentTarget:i.getContentTarget,setAutoScroll:i.setAutoScroll}),Ext.reg("mediawindow",e.Window),Ext.ns("Ext.capabilities"),Ext.ns("XERO.ui.Media.plugin");var a=Ext.capabilities.hasAudio||(Ext.capabilities.hasAudio=function(){var t,e,n=!!document.createElement("audio").canPlayType,i=!Ext.isIE&&"Audio"in window&&"undefined"!=typeof Audio?new Audio:{},a=!!(n||"canPlayType"in i)&&{tag:n,object:"play"in i},o={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/x-wav",basic:"audio/basic",aif:"audio/x-aiff"};if(a&&"canPlayType"in i)for(e in o)a[e]="no"!=(t=i.canPlayType(o[e]))&&""!=t;return a}());Ext.iterate||Ext.apply(Ext,{iterate:function(t,e,n){if(!Ext.isEmpty(t)){if(Ext.isIterable(t))return void Ext.each(t,e,n);if(Ext.isObject(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e.call(n||t,i,t[i]))return}},isIterable:function(t){return!(!Ext.isArray(t)&&!t.callee)||(!!/NodeList|HTMLCollection/.test(toString.call(t))||(t.nextNode||t.item)&&Ext.isNumber(t.length))},isObject:function(t){return t&&"object"==typeof t}}),/**
    * @class XERO.ui.Media.plugin.AudioEvents
    * @extends XERO.ui.Media.Component
    * @version 1.0
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @constructor
    * @param {Object} config The config object
    */
XERO.ui.Media.plugin.AudioEvents=Ext.extend(XERO.ui.Media.Component,{autoEl:{tag:"div"},cls:"x-hide-offsets",disableCaching:!1,audioEvents:{},volume:.5,ptype:"audioevents",initComponent:function(){this.mediaCfg||(this.mediaCfg={mediaType:"WAV",start:!0,url:""}),XERO.ui.Media.plugin.AudioEvents.superclass.initComponent.apply(this,arguments),this.addEvents("beforeaudio"),this.setVolume(this.volume)},init:function(t){if(this.rendered||this.render(Ext.getBody()),t.dom||t.ctype){var e=this;Ext.iterate(this.audioEvents||{},function(n){t.events&&!t.events[n]||(Ext.applyIf(t,{audioPlugin:e,audioListeners:{},removeAudioListener:function(t){t&&this.audioListeners[t]&&(this.removeListener&&this.removeListener(t,this.audioListeners[t],this),delete this.audioListeners[t])},removeAudioListeners:function(){var t=[];Ext.iterate(this.audioListeners,function(e){t.push(e)}),Ext.iterate(t,this.removeAudioListener,this)},addAudioListener:function(t){this.audioListeners[t]&&this.removeAudioListener(t),this.addListener&&this.addListener(t,this.audioListeners[t]=function(){this.audioPlugin.onEvent(this,t)},this)},enableAudio:function(){this.audioPlugin&&this.audioPlugin.enable()},disableAudio:function(){this.audioPlugin&&this.audioPlugin.disable()},setVolume:function(t){this.audioPlugin&&this.audioPlugin.setVolume(t)}}),t.addAudioListener(n))},this)}},setVolume:function(t){var e=this.audioObject,n=Math.max(Math.min(parseFloat(t)||0,1),0);return this.mediaCfg&&(this.mediaCfg.volume=100*n),this.volume=n,e&&(e.volume=n),this},onEvent:function(t,e){if(!this.disabled&&this.audioEvents&&this.audioEvents[e]&&!1!==this.fireEvent("beforeaudio",this,t,e))if(this.mediaCfg.url=this.audioEvents[e],a.object)this.audioObject&&this.audioObject.stop&&this.audioObject.stop(),(this.audioObject=new Audio(this.mediaCfg.url||""))&&(this.setVolume(this.volume),this.audioObject.play&&this.audioObject.play());else{var n=this.getInterface();n&&(n.object?(n=n.object,"Open"in n&&n.Open(this.mediaCfg.url||""),"Play"in n&&n.Play()):this.refreshMedia())}}}),Ext.preg&&Ext.preg("audioevents",XERO.ui.Media.plugin.AudioEvents),Ext.onReady(function(){var t=Ext.util.CSS,e=[];t.getRule(".x-media",!0)||e.push(".x-media{width:100%;height:100%;outline:none;overflow:hidden;}"),t.getRule(".x-media-mask")||e.push(".x-media-mask{width:100%;height:100%;overflow:hidden;position:relative;zoom:1;}"),t.getRule(".x-media-img")||e.push(".x-media-img{background-color:transparent;width:auto;height:auto;position:relative;}"),t.getRule(".x-masked-relative")||e.push(".x-masked-relative{position:relative!important;}"),e.length&&(t.createStyleSheet(e.join("")),t.refreshCache())}),Ext.override(Ext.Element,{mask:function(t,e){return"static"==this.getStyle("position")&&this.addClass("x-masked-relative"),this._mask||(this._mask=Ext.DomHelper.append(this.dom,{cls:"ext-el-mask"},!0)),this.select("iframe,frame,object,embed").elements.length||this.addClass("x-masked"),this._mask.setDisplayed(!0),"string"==typeof t&&(this._maskMsg||(this._maskMsg=Ext.DomHelper.append(this.dom,{style:"visibility:hidden",cls:e?"ext-el-mask-msg "+e:"ext-el-mask-msg",cn:{tag:"div",html:t}},!0)),this._maskMsg.center(this).setVisible(!0)),!Ext.isIE||Ext.isIE7&&Ext.isStrict||"auto"!=this.getStyle("height")||this._mask.setSize(void 0,this.getHeight()),this._mask},unmask:function(t){this._maskMsg&&(this._maskMsg.setVisible(!1),!1!==t&&(this._maskMsg.remove(!0),delete this._maskMsg)),this._mask&&(this._mask.setDisplayed(!1),!1!==t&&(this._mask.remove(!0),delete this._mask)),this.removeClass(["x-masked","x-masked-relative"])},remove:function(t,e){this.dom&&(this.unmask(!0),this.removeAllListeners(),t&&this.cleanse(!0,e),Ext.removeNode(this.dom),this.dom=null)},cleanse:function(t,e){if(this.isCleansed&&!0!==t)return this;for(var n,i=this.dom,a=i.firstChild;i&&a;)n=a.nextSibling,e&&Ext.fly(a,"_cleanser").cleanse(t,e),Ext.removeNode(a),a=n;return delete Ext.Element._flyweights._cleanser,this.isCleansed=!0,this}}),/**
    * @class XERO.ui.Media.Element
    * @extends Ext.Element
    * @version 2.1
    * @author Doug Hendricks. doug[always-At]theactivegroup.com
    * @copyright 2007-2009, Active Group, Inc.  All rights reserved.
    * @donate <a target="tag_donate" href="http://donate.theactivegroup.com"><img border="0" src="http://www.paypal.com/en_US/i/btn/x-click-butcc-donate.gif" border="0" alt="Make a donation to support ongoing development"></a>
    * @license <a href="http://www.gnu.org/licenses/gpl.html">GPL 3.0</a>
    * @constructor
    */
XERO.ui.Media.Element=Ext.extend(Ext.Element,{constructor:function(t){if(!t)return null;var e="string"==typeof t?d.getElementById(t):t.dom||t;if(!e)return null;this.dom=e,this.id=e.id||Ext.id(e),Ext.Element.cache||(Ext.Element.cache={}),Ext.Element.cache[this.id]=this},mask:function(t,e){return this.maskEl||(this.maskEl=this.parent(".x-media-mask")||this.parent()),this.maskEl.mask.apply(this.maskEl,arguments)},unmask:function(t){this.maskEl&&(this.maskEl.unmask(t),this.maskEl=null)}}),XERO.ui.Media.prototype.elementClass=XERO.ui.Media.Element,Ext.ux.IntelliMask=function(t,e){Ext.apply(this,e),this.el=Ext.get(t)},Ext.ux.IntelliMask.prototype={removeMask:!1,msg:"Loading Media...",msgCls:"x-mask-loading",zIndex:null,disabled:!1,active:!1,autoHide:!1,disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},show:function(t,e,n,i){var a={},o=this.autoHide;if(i=parseInt(i,10)||20,"object"==typeof t&&(a=t,t=a.msg,e=a.msgCls,n=a.fn,o=void 0!==a.autoHide?a.autoHide:o,i=a.fnDelay||i),this.active||this.disabled||!this.el)i=0;else{this.el.mask(t||this.msg,e||this.msgCls);this.active=!!this.el._mask,this.active&&this.zIndex&&(this.el._mask.setStyle("z-index",this.zIndex),this.el._maskMsg&&this.el._maskMsg.setStyle("z-index",this.zIndex+1))}return"function"==typeof n?n.defer(i,a.scope||null):i=0,o&&(o=parseInt(o,10)||2e3)&&this.hide.defer(o+(i||0),this),this.active?{mask:this.el._mask,maskMsg:this.el._maskMsg}:null},hide:function(t){return this.el&&this.el.unmask(t||this.removeMask),this.active=!1,this},destroy:function(){this.hide(!0),this.el=null}},XERO.ui.Media.mediaTypes={WAV:Ext.apply({tag:"object",cls:"x-media x-media-wav",data:"@url",type:"audio/x-wav",loop:!1,params:{filename:"@url",displaysize:0,autostart:"@start",showControls:"@controls",showStatusBar:!1,showaudiocontrols:"@controls",stretchToFit:!1,Volume:"@volume",PlayCount:1}},Ext.isIE?{classid:"CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95",codebase:"http"+(Ext.isSecure?"s":"")+"://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701",type:"application/x-oleobject"}:{src:"@url"}),PDF:Ext.apply({tag:"object",cls:"x-media x-media-pdf",type:"application/pdf",data:"@url",autoSize:!0,params:{src:"@url"}},!!Ext.isIE&&{classid:"CLSID:CA8A9780-280D-11CF-A24D-444553540000"}),PDFFRAME:{tag:"iframe",cls:"x-media x-media-pdf-frame",frameBorder:0,style:{"z-index":2},src:"@url",autoSize:!0},WMV:Ext.apply({tag:"object",cls:"x-media x-media-wmv",type:"application/x-mplayer2",data:"@url",autoSize:!0,params:{filename:"@url",displaysize:0,autostart:"@start",showControls:"@controls",showStatusBar:"@status",showaudiocontrols:!0,stretchToFit:!0,Volume:"@volume",PlayCount:1}},Ext.isIE?{classid:"CLSID:22d6f312-b0f6-11d0-94ab-0080c74c7e95",codebase:"http"+(Ext.isSecure?"s":"")+"://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701",type:"application/x-oleobject"}:{src:"@url"}),APPLET:{tag:"object",cls:"x-media x-media-applet",type:"application/x-java-applet",unsupportedText:{tag:"p",html:"Java is not installed/enabled."},params:{url:"@url",archive:"",code:""}},"AUDIO-OGG":{tag:"audio",controls:"@controls",src:"@url"},"VIDEO-OGG":{tag:"video",controls:"@controls",src:"@url"},SWF:Ext.apply({tag:"object",cls:"x-media x-media-swf",type:"application/x-shockwave-flash",scripting:"sameDomain",standby:"Loading..",loop:!0,start:!1,unsupportedText:{cn:["The Adobe Flash Player is required.",{tag:"br"},{tag:"a",cn:[{tag:"img",src:"http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"}],href:"http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",target:"_flash"}]},params:{movie:"@url",menu:"@controls",play:"@start",quality:"high",allowscriptaccess:"@scripting",allownetworking:"all",allowfullScreen:!1,bgcolor:"#FFFFFF",wmode:"opaque",loop:"@loop"}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+(Ext.isSecure?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"}:{data:"@url"}),SCRIBD:Ext.apply({tag:"object",cls:"x-media x-media-scribd",type:"application/x-shockwave-flash",scripting:"always",standby:"Loading..",loop:!0,start:!1,unsupportedText:{cn:["The Adobe Flash Player is required.",{tag:"br"},{tag:"a",cn:[{tag:"img",src:"http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"}],href:"http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",target:"_flash"}]},params:{movie:"@url",menu:"@controls",play:"@start",quality:"high",menu:!0,scale:"showall",salign:" ",allowscriptaccess:"@scripting",allownetworking:"all",allowfullScreen:!0,bgcolor:"#FFFFFF",wmode:"opaque",loop:"@loop"}},Ext.isIE?{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+(Ext.isSecure?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0"}:{data:"@url"}),JWP:Ext.apply({tag:"object",cls:"x-media x-media-swf x-media-flv",type:"application/x-shockwave-flash",data:"@url",loop:!1,start:!1,boundExternals:["sendEvent","addModelListener","addControllerListener","addViewListener","getConfig","getPlaylist"],params:{movie:"@url",flashVars:{autostart:"@start",repeat:"@loop",height:"@height",width:"@width",id:"@id"}}},!!Ext.isIE&&{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",codebase:"http"+(Ext.isSecure?"s":"")+"://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0"}),QT:Ext.apply({tag:"object",cls:"x-media x-media-quicktime",type:"video/quicktime",style:{position:"relative","z-index":1,behavior:"url(#qt_event_source)"},scale:"aspect",unsupportedText:'<a href="http://www.apple.com/quicktime/download/">Get QuickTime</a>',scripting:!0,volume:"50%",data:"@url",params:{src:Ext.isIE?"@url":null,href:"http://quicktime.com",target:"_blank",autoplay:"@start",targetcache:!0,cache:!0,wmode:"opaque",controller:"@controls",enablejavascript:"@scripting",loop:"@loop",scale:"@scale",volume:"@volume",QTSRC:"@url"}},Ext.isIE?{classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",codebase:"http"+(Ext.isSecure?"s":"")+"://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"}:{PLUGINSPAGE:"http://www.apple.com/quicktime/download/"}),QTEVENTS:{tag:"object",id:"qt_event_source",cls:"x-media x-media-qtevents",type:"video/quicktime",params:{},classid:"clsid:CB927D12-4FF7-4a9e-A169-56E4B8A75598",codebase:"http"+(Ext.isSecure?"s":"")+"://www.apple.com/qtactivex/qtplugin.cab#version=7,2,1,0"},WPMP3:Ext.apply({tag:"object",cls:"x-media x-media-audio x-media-wordpress",type:"application/x-shockwave-flash",data:"@url",start:!0,loop:!1,boundExternals:["open","close","setVolume","load"],params:{movie:"@url",width:"@width",flashVars:{autostart:"@start",controller:"@controls",enablejavascript:"@scripting",loop:"@loop",scale:"@scale",initialvolume:"@volume",width:"@width",encode:"no",soundFile:""}}},!!Ext.isIE&&{classid:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}),REAL:Ext.apply({tag:"object",cls:"x-media x-media-real",type:"audio/x-pn-realaudio-plugin",data:"@url",controls:"all",start:-1,standby:"Loading Real Media Player components...",params:{src:"@url",autostart:"@start",center:!1,maintainaspect:!0,prefetch:!1,controller:"@controls",controls:"@controls",volume:"@volume",loop:"@loop",numloop:null,shuffle:!1,console:"_master",backgroundcolor:"#000000"}},!!Ext.isIE&&{classid:"clsid:CFCDAA03-8BE4-11CF-B84B-0020AFBBCCFA"}),SVG:{tag:"object",cls:"x-media x-media-img x-media-svg",type:"image/svg+xml",data:"@url",params:{src:"@url"}},GIF:{tag:"img",cls:"x-media x-media-img x-media-gif",src:"@url"},TIFF:{tag:"object",type:"image/tiff",cls:"x-media x-media-img x-media-tiff",data:"@url"},JPEG:{tag:"img",cls:"x-media x-media-img x-media-jpeg",src:"@url"},JP2:{tag:"object",cls:"x-media x-media-img x-media-jp2",type:Ext.isIE?"image/jpeg2000-image":"image/jp2",data:"@url"},PNG:{tag:"img",cls:"x-media x-media-img x-media-png",src:"@url"},HTM:{tag:"iframe",cls:"x-media x-media-html",frameBorder:0,autoSize:!0,style:{overflow:"auto","z-index":2},src:"@url"},TXT:{tag:"object",cls:"x-media x-media-text",type:"text/plain",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},RTF:{tag:"object",cls:"x-media x-media-rtf",type:"application/rtf",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},JS:{tag:"object",cls:"x-media x-media-js",type:"text/javascript",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},CSS:{tag:"object",cls:"x-media x-media-css",type:"text/css",style:{overflow:"auto",width:"100%",height:"100%"},data:"@url"},SILVERLIGHT:{tag:"object",cls:"x-media x-media-silverlight",type:"application/ag-plugin",data:"@url",params:{MinRuntimeVersion:"1.0",source:"@url"}},SILVERLIGHT2:{tag:"object",cls:"x-media x-media-silverlight",type:"application/x-silverlight-2",data:"data:application/x-silverlight,",params:{MinRuntimeVersion:"2.0"},unsupportedText:'<a href="http://go2.microsoft.com/fwlink/?LinkID=114576&v=2.0"><img style="border-width: 0pt;" alt="Get Microsoft Silverlight" src="http://go2.microsoft.com/fwlink/?LinkID=108181"/></a>'},XML:{tag:"iframe",cls:"x-media x-media-xml",style:{overflow:"auto"},src:"@url"},VLC:Ext.apply({tag:"object",cls:"x-media x-media-vlc",type:"application/x-google-vlc-plugin",pluginspage:"http://www.videolan.org",events:!0,start:!1,params:{Src:"@url",MRL:"@url",autoplay:"@start",ShowDisplay:"@controls",Volume:"@volume",Autoloop:"@loop"}},Ext.isIE?{classid:"clsid:9BE31822-FDAD-461B-AD51-BE1D1C159921",CODEBASE:"http"+(Ext.isSecure?"s":"")+"://downloads.videolan.org/pub/videolan/vlc/latest/win32/axvlc.cab"}:{target:"@url"}),ODT:Ext.apply({tag:"object",cls:"x-media x-media-odt",type:"application/vnd.oasis.opendocument.text",data:"@url",params:{src:"@url"}},!!Ext.isIE&&{classid:"clsid:67F2A879-82D5-4A6D-8CC5-FFB3C114B69D"}),ODS:Ext.apply({tag:"object",cls:"x-media x-media-odt",type:"application/vnd.oasis.opendocument.spreadsheet",data:"@url",params:{src:"@url"}},!!Ext.isIE&&{classid:"clsid:67F2A879-82D5-4A6D-8CC5-FFB3C114B69D"}),IMPRESS:Ext.apply({tag:"object",cls:"x-media x-media-sxi",start:!1,type:"application/vnd.sun.xml.impress",data:"@url",params:{wmode:"transparent",src:Ext.isIE?"@url":null}},Ext.isIE?{classid:"clsid:67F2A879-82D5-4A6D-8CC5-FFB3C114B69D"}:{data:"@url"})},Ext.provide&&Ext.provide("uxmedia"),Ext.applyIf(Array.prototype,{map:function(t,e){var n=this.length;if("function"!=typeof t)throw new TypeError;for(var i=new Array(n),a=0;a<n;a++)a in this&&(i[a]=t.call(e||this,this[a],a,this));return i}}),XERO.ui.MediaComponent=XERO.ui.Media.Component,XERO.ui.MediaPanel=XERO.ui.Media.Panel,XERO.ui.MediaPortlet=XERO.ui.Media.Portlet,XERO.ui.MediaWindow=XERO.ui.Media.Window}()},function(t,e){XERO.ui.HistoryAndNotes={showAddNote:function(){Element.toggle("AddNote"),Element.visible("AddNote")&&$("HistoryNote").focus(),Element.scrollTo("AddNote")},showArchiveHistory:function(){Element.visible("archiveHistoryListing")?Element.hide("archiveHistoryListing"):(Element.show("historyLoadingIndicator"),Ajax.GetHistoryHtml($F("HistoryReferenceID"),this.getHistoryHtml_Callback))},getHistoryHtml_Callback:function(t){Ext.get("archiveHistoryListing").update(t.value),Element.hide("historyLoadingIndicator"),Element.toggle("archiveHistoryListing"),$("archiveHistoryListing").scrollIntoView();var e=Ext.query("table#Notes/tbody/tr").length;$("hideHistoryLink").innerHTML="Hide History ("+e+" change"+(1!=e?"s":"")+")",$("showHistoryLink").innerHTML="Show History ("+e+" change"+(1!=e?"s":"")+")"},saveNote:function(){var t=0!=$F("HistoryNote").length;void 0!==window.Invoice&&window.Invoice&&window.Invoice.creditNoteType&&t?Ajax.SaveNoteWithType($F("HistoryReferenceID"),$F("HistoryNote"),Invoice.creditNoteType,this.saveNote_Callback.bind(this)):void 0!==window.Credit&&window.Credit&&window.Credit.lastInvoiceType?Ajax.SaveNoteWithType($F("HistoryReferenceID"),$F("HistoryNote"),window.Credit.lastInvoiceType,this.saveNote_Callback.bind(this)):t&&Ajax.SaveNote($F("HistoryReferenceID"),$F("HistoryNote"),this.saveNote_Callback.bind(this))},saveInvoiceNote:function(){0!=$F("HistoryNote").length&&Ajax.SaveNote($F("HistoryReferenceID"),$F("HistoryNote"),$F("ExpectedDate"),this.saveNote_Callback.bind(this))},cancelNote:function(){$("HistoryNote").value="",Element.hide("AddNote"),XERO.widget.Template.Messages.hideAnyMessages()},saveNote_Callback:function(t){if(t.value.IsValid){var e=t.value.Data.getValue("Result");$("latestNote").innerHTML="<b>"+e[0]+"</b><br/>"+e[1],$("HistoryNote").value="",Element.hide("AddNote"),Element.visible("archiveHistoryListing")&&Element.hide("archiveHistoryListing"),Element.visible("showHistoryLink")&&Element.hide("showHistoryLink"),$("hideHistoryLink").show(),this.showArchiveHistory(),XERO.widget.Template.Messages.hideAnyMessages();var n=Ext.get("counter");n&&n.hasClass("displayCounter")&&n.removeClass("displayCounter")}else{var i=XERO.widget.Template.Messages.buildErrorMessage(t.value.Result.toString());XERO.widget.Template.Messages.showMessage(i,"error")}},toggleHideShow:function(t){return t.match(/Show/)?t.replace(/Show/,"Hide"):t.replace(/Hide/,"Show")},onEmailIFrameLoaded:function(t){var e=Ext.get(t),n=e.getAttribute("data-id")||"",i=e.getAttribute("data-historyid")||"",a=e.getAttribute("data-emailtype"),o=e.dom.contentDocument,r=o.body;Ext.fly(r).getHeight()>1500?e.setHeight(1500):e.setHeight(Ext.fly(r).getHeight()+50);for(var s=o.querySelectorAll("img[src*=cid]"),l=0;l<s.length;l++)s[l].src=Ext.String.format("{0}//{1}/Contacts/{5}/GetInlineImageFromHistory?emailId={2}&historyId={3}&contentId={4}",parent.location.protocol,parent.location.host,n,i,s[l].src.replace("cid:",""),"HISTORYTYPE/EMAIL/OUTLOOK"==a?"Office365":"Gmail");Ext.fly(r).on("click",function(t,e){t.stopEvent();var n=t.getTarget("a");n&&parent.window.open(n.href)})}},window.HistoryAndNotes=XERO.ui.HistoryAndNotes,Ext.onReady(function(){$("__historyAndNotes")&&(Event.observe("showHistoryLink","click",function(t){$("showHistoryLink").hide(),$("hideHistoryLink").show(),Event.stop(t)}),Event.observe("hideHistoryLink","click",function(t){$("hideHistoryLink").hide(),$("showHistoryLink").show(),Event.stop(t)}))}),Ext.onReady(function(){var t=new Ext.XTemplate('<tpl if="IsInListing === true">','<tr id="{TableId}" class="xoHistoryNote default" style="display:none;">','<td colspan="4" style="padding: 0;">','<table class="standard items history-recode">',"</tpl>",'<tpl if="IsInListing === false">','<table id="{TableId}" class="standard items latest history-recode" style="display:none;">',"</tpl>","<thead>","<tr>","<td>Item Code</td>","<td>Description</td>","<td>Quantity</td>","<td>Unit Price</td>","<td>Disc %</td>","<td>Account</td>","<td>Tax Rate</td>","{[this.addTrackingHeaders(values)]}",'<td class="amount right">Amount {Currency}</td>',"</tr>","</thead>","<tbody>",'<tpl for="LineItems">','<tr class="default">',"<td>{ItemCode}</td>","<td>{Description}</td>",'<td>{Quantity:number("0.00")}</td>','<td>{UnitAmount:number("0,000.00")}</td>','<td>{Discount:number("0.00")}</td>',"<td>{AccountName}</td>","<td>{TaxName}</td>","{[this.addTracking(parent, values)]}",'<td class="right">{LineAmount:number("0,000.00")}</td>',"</tr>","</tpl>","</tbody>","</table>",'<tpl if="IsInListing === true">',"</td></tr>","</tpl>",{compiled:!0,addTrackingHeaders:function(t){var e=[];return Ext.each(t.TrackingCategories,function(t){e.push(Ext.String.format("<td>{0}</td>",t.Name))}),e.join("")},addTracking:function(t,e){var n=[];return Ext.each(t.TrackingCategories,function(t){n.push(Ext.String.format("<td>{0}</td>",e["TrackingItem"+t.Order+"Name"]))}),n.join("")}});Ext.getDoc().on("click",function(e,n,i){if(e.getTarget("a.show-recoded-lineitems")||e.getTarget("a.x_show-recoded-lineitems")){e.stopEvent();var a=Ext.fly(n).getAttribute("id"),o=a.replace(/x_lineitems-/gi,"").replace(/lineitems-/gi,""),r=Ext.fly(n).parent("div.last"),s=r?a.replace(/lineitems-/gi,"table_last_"):a.replace(/lineitems-/gi,"table_"),l=Ext.get(s);if(l||Ext.Ajax.request({url:Ext.String.format("/Ajax/History/GetAdditionalData/{0}",o),method:"GET",callback:function(e,i,a){var o=Ext.decode(a.responseText),u=Ext.fly(n);r?(o=Ext.apply(o,{TableId:s,IsInListing:!1}),l=t.append(Ext.fly(n).parent("div.last"),o,!0)):(o=Ext.apply(o,{TableId:s,IsInListing:!0}),l=t.insertAfter(Ext.fly(n).parent("tr.xoHistoryNote"),o,!0)),u.update(HistoryAndNotes.toggleHideShow(u.dom.innerHTML)),l.setDisplayed(r?"table":"table-row")}}),l){var u=Ext.fly(n);u.update(HistoryAndNotes.toggleHideShow(u.dom.innerHTML)),l.isVisible()?l.setDisplayed("none"):l.setDisplayed(r?"table":"table-row")}}},{delegate:"a"}),Ext.getDoc().on("click",function(t,e,n){if(t.getTarget("a.show-email")||t.getTarget("a.x_show-email")){t.stopEvent();var i=Ext.get(e),a=i.getAttribute("data-id"),o=i.getAttribute("data-type"),r=!!i.parent("div.last"),s=Ext.String.format("{0}_{1}",r?"container_last_":"container_",a),l=Ext.get(s),u=[];if(!l){!0===r?u.push(Ext.String.format('<div id="{0}" style="display:none;">',s)):(u.push(Ext.String.format('<tr id="{0}" class="xoHistoryNote default" style="display:none;">',s)),u.push('<td colspan="4" style="padding: 0;">'));var c=Ext.String.format("/Contacts/{0}/GetMessageFromHistory?id={1}","HISTORYTYPE/EMAIL/OUTLOOK"==o?"Office365":"Gmail",a);u.push(Ext.String.format('<iframe src="{0}" width="100%" height="100%" frameborder="0" scrolling="false" onload="XERO.ui.HistoryAndNotes.onEmailIFrameLoaded(this);" data-historyid="{1}" data-emailtype="{2}"></iframe>',c,a,o)),!0===r?(u.push("</div>"),l=i.parent("div.last").insertHtml("beforeEnd",u.join(""),!0)):(u.push("</td></tr>"),l=i.parent("tr.xoHistoryNote").insertHtml("afterEnd",u.join(""),!0))}l&&(i.update(HistoryAndNotes.toggleHideShow(i.dom.innerHTML)),l.isVisible()?l.setDisplayed("none"):l.setDisplayed(r?"block":"table-row"))}},{delegate:"a"})})},function(t,e){XERO.ns("XERO.help"),XERO.help.Analytics=function(){var t={all:"UA-3776042-15",int:"UA-3776042-16",nz:"UA-3776042-17",au:"UA-3776042-18",uk:"UA-3776042-19"};return{isTracking:!1,localTracker:null,allTracker:null,isInitiated:!1,init:function(){if("object"==typeof _gat&&!this.isInitiated)try{this.allTracker=_gat._getTracker(t.all),this.allTracker._setDomainName(".xero.com"),this.allTracker._initData(),this.isTracking=!0,this.isInitiated=!0}catch(t){}},trackPageView:function(t){this.isInitiated||this.init(),this.isTracking&&(this.allTracker&&this.allTracker._trackPageview(t),this.localTracker&&this.localTracker._trackPageview(t))},trackEvent:function(t,e,n){return this.isInitiated||this.init(),!!this.isTracking&&(this.allTracker&&this.allTracker._trackEvent(t,e,n),this.localTracker&&this.localTracker._trackEvent(t,e,n),!0)},gotoPage:function(t){return this.trackEvent("XEROAPP",t,location.href)},search:function(t){return this.trackEvent("XEROAPP","SEARCH",t)}}}()},function(t,e){XERO.widget.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){XERO.widget.SearchField.superclass.initComponent.call(this),this.on("specialkey",function(t,e){e.getKey()==e.ENTER&&this.onTrigger2Click()},this)},validationEvent:!1,validateOnBlur:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:!0,width:180,hasSearch:!1,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var t={start:0};this.store.baseParams=this.store.baseParams||{},this.store.baseParams[this.paramName]="",this.store.reload({params:t}),this.triggers[0].hide(),this.hasSearch=!1}},onTrigger2Click:function(){var t=this.getRawValue();if(t.length<1)return void this.onTrigger1Click();var e={start:0};this.store.baseParams=this.store.baseParams||{},this.store.baseParams[this.paramName]=t,this.store.reload({params:e}),this.hasSearch=!0,this.triggers[0].show()}})},function(t,e){XERO.help.AskAQuestion=function(t,e,n,i){XERO.help.Analytics.init();var a=new Ext.util.MixedCollection;a.add(a.getCount(),String.format("START: {0}",new Date)),i||(i=t);var o=i;i.endsWith(e+"/")?o+="apisearch/":o=String.format("{0}{1}/apisearch/",i,e);var r=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:o}),reader:new Ext.data.JsonReader({root:"Rows",id:"Name"},[{name:"Rank"},{name:"Name"},{name:"Path"},{name:"Url"},{name:"Type"},{name:"Heading"},{name:"Abstract"}]),listeners:{load:function(t,e,n){a.add(a.getCount(),String.format("SEARCH: {0}",n.params.search)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","SEARCH",n.params.search)}}}),s=new Ext.XTemplate('<h2 style="border-bottom: 1px solid #C9DAF4!important;">Top results</h2>','<tpl for=".">','<div class="search-item" style="float:left;padding:8px;padding-right:0px;margin-bottom:5px;{[xindex % 2 === 0 ? "" : "background-color:#F6F9FD;"]}">','<div class="search-item-left">{#}.</div>','<div class="search-item-right" style="width:380px;">','<a class="search-item-link" href="'+t+'#{Name}" target="_blank">{Heading}</a></h3>',"<p>{Abstract}</p>","</div>","</div>","</tpl>"),l=new Ext.XTemplate('<span class="separator"> </span>',String.format('<h2 style="padding-top:10px;">{0}</h2>',XERO.lang.Support.DidTheseAnswersHelp.Title),'<div style="padding-bottom:10px">','<img src="/common/images/green-arrow.gif" style=""/>',String.format('<a class="search-item-link question" href="#">{0}</a>',XERO.lang.Support.DidTheseAnswersHelp.Yes),"</div>",'<div style="padding-bottom:10px">','<img src="/common/images/green-arrow.gif" style=""/>',String.format('<a class="search-item-link question" href="#">{0}</a>',XERO.lang.Support.DidTheseAnswersHelp.NoHelpCentre),"</div>","<div>",'<img src="/common/images/green-arrow.gif" style=""/>',String.format('<a class="search-item-link question" href="#">{0}</a>',XERO.lang.Support.DidTheseAnswersHelp.NoSupport),"</div>"),u=new XERO.widget.SearchField({cls:"xero-search-box",paramName:"search",store:r,width:420,value:n}),c=new Ext.Window({title:"Xero Support - Find help",closable:!0,width:460,height:550,cls:"QA",layout:"fit",listeners:{beforeclose:function(){a.add(a.getCount(),String.format("END: {0}",new Date)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","TRACE",Ext.encode(a.map))}},items:new Ext.Panel({border:!1,items:[{xtype:"label",text:"Your search:",style:"margin-bottom:7px;display:block;"},u,new Ext.Panel({height:300,cls:"xero-search-results top-list",autoScroll:!0,border:!1,items:new Ext.DataView({tpl:s,store:r,deferEmptyText:!0,loadingText:"Finding help ...",emptyText:String.format('{0}<div style="margin-top:10px;"><img src="/common/images/green-arrow.gif" style=""/><a class="search-item-link no-answers send-to-contact-support" style="margin-left: 4px; font-size: 14px; font-weight:bold; font-family:Arial;" href="#">{1}</a></div><div style="margin-top:10px;"><img src="/common/images/green-arrow.gif" style=""/><a class="search-item-link no-answers go-to-help-centre" style="margin-left: 4px; font-size: 14px; font-weight:bold; font-family:Arial;" href="#">{2}</a></div>',XERO.lang.Support.NoAnswerFound,XERO.lang.Support.SendQuestionToSupport,XERO.lang.Support.GotoHelpCentre),itemSelector:"a.search-item-link",listeners:{click:function(e,n,i,o){if(Ext.fly(o.getTarget()).is("a.no-answers")){var r=u.getValue();o.stopEvent(),c.close(),Ext.fly(o.getTarget()).is("a.send-to-contact-support")?(a.add(a.getCount(),String.format("NORESULTS-SENDTOSUPPORT: {0}",r)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","NORESULTS-SENDTOSUPPORT",r),XERO.widget.MainMenu.getContactSupportHtml(r)):(a.add(a.getCount(),String.format("NORESULTS-GOTOHELPCENTREFORMORE: {0}",r)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","NORESULTS-GOTOHELPCENTREFORMORE",r),window.open(t))}else i.href&&(a.add(a.getCount(),String.format("GOTOHELPPAGE: {0}",i.href)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","GOTOHELPPAGE",i.href))}}})}),new Ext.Panel({border:!1,cls:"xero-search-results",items:new Ext.DataView({tpl:l,store:r,itemSelector:"a.search-item-link",listeners:{click:function(e,n,i,o){var r=u.getValue();switch(n){case 0:a.add(a.getCount(),String.format("SEARCH-HELPED: {0}",r)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","SEARCH-HELPED",r),c.close();break;case 1:a.add(a.getCount(),String.format("SEARCH-GOTOHELPCENTREFORMORE: {0}",r)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","SEARCH-GOTOHELPCENTREFORMORE",r),window.open(String.format("{0}?search={1}",t,r));break;case 2:a.add(a.getCount(),String.format("SEARCH-SENDTOSUPPORT: {0}",r)),XERO.help.Analytics.trackEvent("XEROAPPSEARCH","SEARCH-SENDTOSUPPORT",r),c.close(),XERO.widget.MainMenu.getContactSupportHtml(r)}o.stopEvent()}}})})]})});c.show(),u.onTrigger2Click()}},function(t,e){window.ChartOfAccounts={},Object.extend(ChartOfAccounts,{currentlyOpenWindow:"",xeroVersionCode:null,isSquare:!1,init:function(){var t=Ext.get("ShowReportingNameLink");t&&t.dom.addEventListener("click",ChartOfAccounts.showReportingName);var e=window.location.search.slice(1).split("=");"undefined"!==e&&"UpdateSquare"===e[0]&&"1"===e[1]&&(this.isSquare=!0)},setXeroVersionCode:function(t){this.xeroVersionCode=t},setIsWizard:function(t){this._isWizard=t},getIsWizard:function(){return this._isWizard},setTrackUsage:function(t){this.trackUsage=void 0===t?XERO.analytics.Analytics.isTrial():t,this.resetTrackUsage()},resetTrackUsage:function(){this.trackUsageTimestamp=this.trackUsage?Date.now():null},getTitle:function(t,e){var n="Bank Account";return"BANKTYPE/CREDITCARD"==t?n="Credit Card Account":"BANKTYPE/PAYPAL"==t&&(n="PayPal Account"),e?"Add "+n:"Edit "+n},createAjaxWindow:function(t,e,n,i){i||(i="auto");var a=window.location.search.slice(1).split("=");"undefined"!==a&&"UpdateSquare"===a[0]&&"1"===a[1]&&(this.isSquare=!0);XERO.MsgBox.createAjax(t,{modal:!0,title:e,width:n,height:i,closable:!this.isSquare,listeners:{destroy:ChartOfAccounts.clearCompleters,scope:ChartOfAccounts}})},createCenteredAjaxWindow:function(t,e,n,i){i||(i="auto"),XERO.MsgBox.createAjax(t,{modal:!0,title:e,width:n,height:i,closable:!this.isSquare,listeners:{destroy:ChartOfAccounts.clearCompleters,scope:ChartOfAccounts}}).center()},closeAddBankAccount:function(){return this.isSquare&&XERO.widget.Template.Messages.showMessage("Your Xero and Square accounts cannot be integrated without a Bank Account. Please add your Bank Account below to complete the process.","error",!1),Windows.closeAll(),!1},addPayPalBankAccount:function(t){return this.initBankAccountForm("add"),ChartOfAccounts.createAjaxWindow("AddBankAccountWindow","Add PayPal Account",370,200),Ajax.GetAddPayPalBankAccountHtml(t,ChartOfAccounts.getAddBankAccountHtml_Callback),!1},addCreditCardBankAccount:function(t){return this.initBankAccountForm("add"),ChartOfAccounts.createAjaxWindow("AddBankAccountWindow","Add Credit Card Account",370,200),Ajax.GetAddCreditCardBankAccountHtml(t,ChartOfAccounts.getAddBankAccountHtml_Callback),!1},addBankAccount:function(t){return this.initBankAccountForm("add"),ChartOfAccounts.createAjaxWindow("AddBankAccountWindow","Add Bank Account",370,200),Ajax.GetAddBankAccountHtml_1(t,ChartOfAccounts.getAddBankAccountHtml_Callback),!1},initBankAccountForm:function(t){switch(t){case"add":this._busEventsAdded||(XERO.bus.on("chartofaccounts:bankfeedstatusupdate",this.onBankFeedStatusUpdate,this),this._busEventsAdded=!0),this.setTrackUsage(),this.isBankAccountAddMode=!0;break;case"edit":this.setTrackUsage(!1),this.isBankAccountAddMode=!1}},getCallback:function(t){var e=t.value,n=new Ext.util.DelayedTask(function(){XERO.widget.Buttons&&(XERO.widget.Buttons.enable(),XERO.util.enableButtons(),XERO.widget.Buttons.refresh())});if(!e)return null!=Ext.WindowMgr.getActive()&&Ext.WindowMgr.getActive().destroy(),void n.delay(100);n.delay(100),Ext.WindowMgr.getActive().setHtml(e.Result),Ext.WindowMgr.getActive().center()},getAddBankAccountHtml_Callback:function(t){var e=t.value,n=Ext.WindowMgr.getActive();if(!e||!e.IsValid)return n&&n.destroy(),!1;new Ext.util.DelayedTask(function(){ChartOfAccounts.removePopupButtons(),ChartOfAccounts.addPopupButtons()}).delay(500),n.setHtml(e.Result),n.center()},addPopupButtons:function(){Ext.fly("popupSave")&&XERO.widget.Buttons.cache.add("popupSave",new XERO.widget.XButton("popupSave")),Ext.fly("popupOK")&&XERO.widget.Buttons.cache.add("popupOK",new XERO.widget.XButton("popupOK")),Ext.fly("popupCancel")&&XERO.widget.Buttons.cache.add("popupCancel",new XERO.widget.XButton("popupCancel"))},removePopupButtons:function(){Ext.fly("popupSave")&&XERO.widget.Buttons.cache.removeKey("popupSave"),Ext.fly("popupOK")&&XERO.widget.Buttons.cache.removeKey("popupOK"),Ext.fly("popupCancel")&&XERO.widget.Buttons.cache.removeKey("popupCancel")},getEditAccountHtml:function(t){ChartOfAccounts.createAjaxWindow("AddBankAccountWindow","Edit Account Details",700,700),Ajax.GetEditAccountHtml(t,ChartOfAccounts.getEditAccountHtml_Callback)},getEditBankAccountHtml:function(t,e){XERO.widget.currentlyOpenWidget&&XERO.widget.currentlyOpenWidget.hide(),this.initBankAccountForm("edit"),ChartOfAccounts.createAjaxWindow("AddBankAccountWindow","Edit Bank Account Details",400,400),Ajax.GetEditBankAccountHtml(t,e,ChartOfAccounts.getEditBankAccountHtml_Callback)},getEditAccountHtml_Callback:function(t){var e=t.value,n=Ext.WindowMgr.getActive();if(!e||!e.IsValid)return n&&n.destroy(),!1;new Ext.util.DelayedTask(function(){ChartOfAccounts.removePopupButtons(),ChartOfAccounts.addPopupButtons()}).delay(500),n.setHtml(e.Result),Ext.WindowMgr.getActive().center(),ChartOfAccounts.attachButtonEvents()},attachButtonEvents:function(){var t=$("btnUpdate"),e=$("btnCancel");t&&new XERO.widget.Button(t.parentNode),e&&new XERO.widget.Button(e.parentNode)},getEditBankAccountHtml_Callback:function(t){var e=t.value,n=Ext.WindowMgr.getActive();if(!e||!e.IsValid)return n&&n.destroy(),!1;new Ext.util.DelayedTask(function(){ChartOfAccounts.removePopupButtons(),ChartOfAccounts.addPopupButtons()}).delay(500),n.setHtml(e.Result),Ext.WindowMgr.getActive().center()},editAccount:function(t){Ajax.EditAccount(t,Form.serializeToCollection($("frmAddAccount")),function(t){XERO.widget.Button.undoDisableAll(),ChartOfAccounts.saveAccount_Callback(t)}.bindAsEventListener(this))},saveAccount:function(t){ChartOfAccounts.editAccount(t)},saveAccount_Callback:function(t){var e=t.value,n=Ext.WindowMgr.getActive();if(!e)return Windows.closeAll(),!1;e.IsValid?(Windows.closeAll(),e.Data.getValue("UpdateRequired")&&$("PageContents").replace(e.Result),XERO.bus.fireEvent("account:edit")):(n.setHtml(e.Result),ChartOfAccounts.attachButtonEvents())},saveBankAccount:function(t,e){Ajax.SaveBankAccount(t,e,Form.serializeToCollection($("frmAddBankAccount")),ChartOfAccounts.saveBankAccount_Callback)},saveBankAccount_Callback:function(t){var e=t.value;if(e){var n=Ext.WindowMgr.getActive(),i=0,a=XERO.util.Form.serialize("frmAddBankAccount"),o=ChartOfAccounts.isBankAccountAddMode&&e.IsValid?ChartOfAccounts.getFeedPromptConfig(a,e.Data.getValue("AccountId")):null;if(ChartOfAccounts.trackUsage){var r=Date.now()-ChartOfAccounts.trackUsageTimestamp;ChartOfAccounts.resetTrackUsage();var s={IsValid:e.IsValid,BankType:a.BankType,Duration:r,HasFeed:ChartOfAccounts.getFeedAvailable(),HasFeedPrompt:o&&ChartOfAccounts.getFeedAvailable()};XERO.analytics.Analytics.track("New Bank Account Submit",s),i=e.Data.getValue("Redirect")?300:0}e.IsValid?(Windows.closeAll(),e.Data.getValue("UpdateRequired")&&Ext.get("PageContents").update(e.Result,!0),o&&ChartOfAccounts.getFeedAvailable()?ChartOfAccounts.showFeedPrompt({bankfeedCfg:o,redirectUrl:e.Data.getValue("RedirectURL"),redirectDelayMs:i}):ChartOfAccounts.isSquare?ChartOfAccounts.onModalClose("/Dashboard/SquareBankAccountComplete",i):ChartOfAccounts.onModalClose(e.Data.getValue("RedirectURL"),i)):(new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable(),ChartOfAccounts.removePopupButtons(),ChartOfAccounts.addPopupButtons()}).delay(100),new Ext.util.DelayedTask(function(){if(XERO.widget.Messages)for(var t=Ext.query("div.document/div.notify"),e=0;e<t.length;e++)XERO.widget.Messages.cache.add(t[e].id||"message"+e,new XERO.widget.Message(t[e]))}).delay(100),ChartOfAccounts.destroyAddAcountCompleters(),n.isContentUpdating=!0,n.on("contentready",function(){n.isContentUpdating=!1}),n.setHtml(e.Result))}},onModalClose:function(t,e){t?new Ext.util.DelayedTask(function(){XERO.widget.Buttons.disable(),document.location=t}).delay(e):(new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(100),new Ext.util.DelayedTask(function(){XERO.widget.Buttons.refresh()}).delay(100))},getFeedPromptConfig:function(t,e){var n,i=this.getBankFeedCfgIdx(t);return i>-1&&(n=this.bankfeedConfigStore[i],this.getIsWizard()||(n.manualUploadUrl=String.format("/Bank/Import.aspx?accountID={0}",e))),n},getBankFeedCfgIdx:function(t){return Ext.isEmpty(t.AddAccount_BankNames_value)?-1:Ext.each(this.bankfeedConfigStore,function(e){if(t.AddAccount_BankNames_value.indexOf(e.bankName)>-1)return!1})},bankfeedConfigStore:[{bankName:"St George",helpSectionUrl:"https://help.xero.com/au/StGeorgeFeed",pdfDownloadLink:"https://help.xero.com/help/AU/stgeorgefeed-0fdcd3fb.pdf",accountList:["Current","Portfolio Loan","Credit Card"]},{bankName:"Bank of Melbourne",helpSectionUrl:"https://help.xero.com/au/BankofMelbourneFeed",pdfDownloadLink:"https://help.xero.com/help/AU/bankofmelbournefeed-50a05196.pdf",accountList:["Current","Portfolio Loan","Credit Card"]}],showFeedPrompt:function(t){new XERO.widget.BankFeedInstructions({data:t.bankfeedCfg}).show().on({close:function(e){ChartOfAccounts.onModalClose(t.redirectUrl,t.redirectDelayMs)},"bankfeedinstructions:continue":function(e){new XERO.widget.BankFeedForm({data:t.bankfeedCfg}).show().on("close",function(e){ChartOfAccounts.onModalClose(t.redirectUrl,t.redirectDelayMs)})}})},onBankFeedStatusUpdate:function(t){if(this.isBankAccountAddMode){if(Ext.get("frmAddBankAccount")&&Ext.fly("popupSave")){var e=XERO.util.Form.serialize("frmAddBankAccount"),n=ChartOfAccounts.getFeedAvailable()&&ChartOfAccounts.getBankFeedCfgIdx(e)>-1?"Next":"Save";Ext.fly("popupSave").update(n)}}},setFeedAvailable:function(t){this._hasFeedAvailable=t},getFeedAvailable:function(){return this._hasFeedAvailable},clearCompleters:function(){return Globals.remove("AddAccount_AccountType_completer"),Globals.remove("AddAccount_GST_completer"),Globals.remove("AddAccount_BankNames_completer"),XERO.widget.Buttons&&XERO.widget.Buttons.enable(),!0},showReportingName:function(){Ext.get("AddReportingName").dom.hide(),Ext.get("ReportingName").dom.show()},showOrHideReportingName:function(){var t=Ext.get("AddAccount_ReportingName");t&&(t.getValue()?this.showReportingName():Ext.get("ReportingName").dom.hide())},accountCodeChanged:function(t,e){var n=document.getElementById(t),i=n.value.trim();n.value=i;var a,o=Ext.get("CodeComment");if(""!=i){var r=Ajax.AccountCodeChanged_2(i,e),s=r.value;if(!s)return;a=s.Result,o.show()}else o.hide(),a="";o.update(a)},insertSeparator:function(t,e,n){for(var i="",a=t.substring(0,6),o=0;o<a.length;o++)o>0&&o%n==0&&(i+=e),i+=a.charAt(o);return i},onBSBAccountNumberEntering:function(){var t=$("AddAccount_BSBNumber");if(!(t.value.length<=3)&&t.value.indexOf("-")<=0&&"-"!=t.value.charAt(3)){var e=this.insertSeparator(t.value,"-",3);t.value=e}},onSortCodeAccountNumberEntering:function(){var t=$("AddAccount_SortCodeNumber");if(!(t.value.length<=2)){var e=t.value.replace(/-/g,"");e.length>6&&(e=e.substr(0,6));var n=this.insertSeparator(e,"-",2);t.value=n}},onBankAccountAfterUpdate:function(){var t=$("AddAccount_AccountNumber").value;t=t.replace(/[^\d]+/g,"");for(var e=new Array(2,4,7,3),n="",i=0,a=0;a<e.length;a++){var o=a==e.length-1,r=e[a],s="";if(s=o?t.substr(i):t.substr(i,r),s.length<r){o||s.length==r-1&&(n+="0"),n+=s,$("AddAccount_AccountNumber").value=n;break}o?(s.length==r-1&&(n+="0"),n+=s):(n+=s,n+="-"),i=n.length-a-1}$("AddAccount_AccountNumber").value=n},destroyAddAcountCompleters:function(){Globals.remove("AddAccount_Country_completer"),Globals.remove("AddAccount_Currency_completer")},getAccountDisplayHtml:function(t,e,n){Ajax.GetAccountDisplayHtml(t,n,e,ChartOfAccounts.getAccountDisplayHtml_Callback)},addBankAccountField:function(t){$("Country"+t)&&$("Country"+t).show(),$("Currency"+t)&&$("Currency"+t).show(),$("NumberTip"+t)&&$("NumberTip"+t).update("");var e=$("Bank"+t);e&&("00-0000-0000000-000"!=e.value&&"00-00-00-000000000"!=e.value&&"000-000-000000000"!=e.value&&"0000000000000000"!=e.value||(e.style.color="#AAA"),e.setAttribute("maxLength","20"),e.style.width="140px",e.onkeyup=null,e.onkeypress=null,e.show())},addCreditCardAccountField:function(t){$("Country"+t)&&$("Country"+t).hide(),$("Currency"+t)&&$("Currency"+t).show(),$("NumberTip"+t)&&$("NumberTip"+t).update("Enter the last 4 digits");var e=$("Bank"+t);if(e){if(e.style.width="30px",e.style.color="#000",new InputValidator(e,4,!1,!1,!1,!1,!1,!1),""!=e.value){var n=e.value.right(4);(-1!=n.indexOf("-")||-1!=n.indexOf(".")||isNaN(n))&&(n="0000"),"0000"==n&&(e.style.color="#AAA"),e.value=n}e.setAttribute("maxLength","4"),e.show()}},addPaypalField:function(t){$("Country"+t)&&$("Country"+t).hide(),$("Currency"+t)&&$("Currency"+t).show(),$("Bank"+t).hide(),$("NumberTip"+t)&&$("NumberTip"+t).update("")},removeBankAccountField:function(t){$("Country"+t)&&$("Country"+t).hide(),$("Currency"+t)&&$("Currency"+t).hide(),$("Bank"+t).hide(),$("NumberTip"+t)&&$("NumberTip"+t).update("")},getAccountDisplayHtml_Callback:function(t){var e=t.value;if(e){Windows.windows.each(function(t){"AccountDisplay"==t.getId()&&t.destroy()});XERO.MsgBox.create("AccountDisplay",{title:"Import Results",modal:!0,width:930,height:300,html:e.Result}).showCenter(!0)}},displayBalances:function(){var t=Ext.get("MYOBImport"),e=Ext.get("XeroImport");t&&1==t.dom.checked||e&&1==e.dom.checked?($("importBalancesQuestion").show(),1==$("YesBalance").checked?$("importBalancesDate").show():$("importBalancesDate").hide()):($("importBalancesQuestion").hide(),$("importBalancesDate").hide())},reImport:function(){SubmitAction("ReImport")},continueImport:function(){SubmitAction("Import")},calculatedImportDate:function(){var t=new Date;t.setFullYear($("YearDropDown").value,$("MonthDropDown").value-1,1),t=t.subtractDays(1),$("importDate").update(t.getDate()+" "+t.getMonthAbbreviation()+" "+t.getFullYear())},getImportErrorsHtml:function(){Windows.windows.each(function(t){"ImportErrors"==t.getId()&&t.destroy()}),XERO.MsgBox.create("ImportErrors",{title:"Errors and changes in your imported Chart of Accounts",modal:!0,width:930,height:300,html:$("errorContents").innerHTML}).showCenter(!0)},checkBankControlValue:function(t){"00-0000-0000000-000"!=$("Bank"+t).value&&"00-00-00-000000000"!=$("Bank"+t).value&&"000-000-000000000"!=$("Bank"+t).value&&"0000000000000000"!=$("Bank"+t).value&&"0000"!=$("Bank"+t).value||($("Bank"+t).value="",$("Bank"+t).style.color="#000")},closeConfirm:function(){Windows.closeAll()},ConfirmSave:function(){for(var t=document.getElementsByTagName("input"),e=0,n=0;n<t.length;n++){var i=t[n];i.id.startsWith("AccountType")&&("ACCTTYPE/BANK"!=i.value&&"BANKTYPE/CREDITCARD"!=i.value&&"BANKTYPE/PAYPAL"!=i.value||e++)}if(e>0)SubmitAction("Save");else{Windows.windows.each(function(t){"ConfrimBank"==t.getId()&&t.destroy()});var a=new Window("ConfrimBank",{className:"BlueDialog",destroyOnClose:!0,resizable:!1,minimizable:!1,maximizable:!1,destroyOnClose:!0,showEffect:Element.show,hideEffect:Element.hide});a.setDestroyOnClose(),a.setTitle("No Bank Accounts Added"),a.setSize(335,130),a.setHTMLContent($("noBankAccountsAdded").innerHTML),a.showCenter(!0)}},downloadCOA:function(){setTimeout(ChartOfAccounts.setCursorToNormal,1e3),SubmitAction("DownloadCOA")},setCursorToNormal:function(){document.body.style.cursor="default"},onAddBankAccountCurrencyAfterUpdate:function(t,e,n){var i="VERSION/AU"==ChartOfAccounts.xeroVersionCode||"VERSION/AUONRAMP"==ChartOfAccounts.xeroVersionCode,a="VERSION/UK"==ChartOfAccounts.xeroVersionCode||"VERSION/UKONRAMP"==ChartOfAccounts.xeroVersionCode;if(i||a){if("BANKTYPE/BANK"==Ext.get("BankType").getValue()&&null!=t&&null!=n){var o=i?Ext.get("auAccountNumber"):Ext.get("ukAccountNumber"),r=Ext.get("accountNumber");o.setVisibilityMode(Ext.Element.DISPLAY),r.setVisibilityMode(Ext.Element.DISPLAY),i&&"CURR/AUD"==n.key||a&&"CURR/GBP"==n.key?(o.show(),r.hide()):(r.show(),o.hide())}}},onSearchKeyPress:function(t){t.keyCode==Event.KEY_RETURN&&(SubmitAction("Search"),Event.stop(t))},getUpdateTaxRateHtml:function(){if(0!=BulkAction.countSelectedItems("chartOfAccounts",!0))return ChartOfAccounts.createAjaxWindow("UpdateTaxRateWindow","Change Tax Rate",259,200),Ajax.GetUpdateTaxRateHtml(ChartOfAccounts.getTaxRateHtmlCallback),!1},getTaxRateHtmlCallback:function(t){var e=t.value,n=Ext.WindowMgr.getActive();if(!e||!e.IsValid)return n&&n.destroy(),!1;n.setHtml(e.Result),n.center()},updateTaxRate:function(){SubmitAction("UpdateSelectedItems",$F("UpdateTax_TaxRate"))},updatePayPal:function(){Ext.fly("AddAccount_ActivateFeed")&&Ext.fly("AddAccount_ActivateFeed").dom.checked?Ext.fly("pp02")&&Ext.fly("pp02").set({style:{display:""}}):Ext.fly("pp02")&&Ext.fly("pp02").set({style:{display:"none"}}),ChartOfAccounts.onCurrentActiveWindowSizeUpdate()},configurePayPalExport:function(t){t?Ext.fly("pp01")&&(Ext.fly("pp01").set({style:{display:"none"}}),Ext.fly("pp02").set({style:{display:"none"}}),Ext.fly("AddAccount_ActivateFeed").dom.checked=""):Ext.fly("pp01")&&Ext.fly("pp01").set({style:{display:""}})},configureAccountNumberField:function(t){$(t)&&($(t).setAttribute("maxLength","20"),$(t).style.width="200px",$(t).onkeyup=null,$(t).onkeypress=null)},toggleVisiblity:function(t,e){$(t)&&(e?$(t).show():$(t).hide())},onCurrentActiveWindowSizeUpdate:function(){var t=Ext.WindowMgr.getActive();null!=t&&t.syncShadow()},onConfirmCountryAfterUpdate:function(t,e,n){var i=t.element.id.replace("Country","Currency").replace("_value","")+"_completer",a=Globals.getValue(i);null!=a&&a.setValue(n.data.getValue("CurrencyCode")),ChartOfAccounts.onCurrentActiveWindowSizeUpdate(),e.focus()},onConfirmAccountAfterUpdate:function(t,e,n){var i=n.data.getValue("AccountID");"ACCTTYPE/BANK"==n.key?ChartOfAccounts.addBankAccountField(i):"BANKTYPE/CREDITCARD"==n.key?ChartOfAccounts.addCreditCardAccountField(i):"BANKTYPE/PAYPAL"==n.key?ChartOfAccounts.addPaypalField(i):"ACCTTYPE/CURRENT"!=n.key&&"ACCTTYPE/CURRLIAB"!=n.value||ChartOfAccounts.removeBankAccountField(i)},replaceHTMLCharacterInBrandingDropDown:function(){"&nbsp;"==$F("ThemeDropDown_value")&&($("ThemeDropDown_value").value=" ")},updateBankLogin:function(t,e,n){null==e&&(e=""),Ajax.UpdateFeedLogin(t,e,ChartOfAccounts.activateBankFeedsCallback)},activateBankFeeds:function(t,e){null==e&&(e=""),Ajax.ActivateBankFeeds(t,e,ChartOfAccounts.activateBankFeedsCallback)},activateStripeBankFeeds:function(t,e){null==e&&(e=""),ChartOfAccounts.createCenteredAjaxWindow("ActivateBankFeedPopup","Activate Bank Feed...",400,400),Ajax.GetActivateStripeBankFeedHtml(t,e,this.getCallback)},activateBankFeedsCallback:function(t){var e=t.value;if(!e)return void(XERO.widget.Buttons&&XERO.widget.Buttons.enable());if(e.IsValid){var n=e.Data.getValue("RedirectUrl");null!=n&&""!=n&&(document.location=n);var i=e.Data.getValue("Title");null!=i&&""!=i||(i="Error"),XERO.MsgBox.create("BankServices",{height:0,width:0,title:i,modal:!0,html:e.Result});var a=document.getElementById("frmBankCredentials");null!=a&&a.submit()}else{var i=e.Data.getValue("Title");""==i&&(i="Could not connect"),XERO.MsgBox.alert(e.Result,i),XERO.widget.Buttons&&XERO.widget.Buttons.enable()}},getBankFeedErrorHtml:function(t,e,n){this.createAjaxWindow("BankFeedError",t,400,400),Ajax.GetBankFeedErrorHtml(e,n,this.getCallback)},demoOrgYodleeFeedsWarning:function(t){XERO.MsgBox.create(null,{title:"Bank Feeds",width:400,html:"<div><p>Xero supports bank feeds from thousands of financial institutions including the bank you've chosen.</p><br/><p>To receive bank feeds for an account at this bank, set up your business on Xero now.</p></div>",modal:!0,buttons:[XERO.buttons.createButton({id:"btnGetXero",text:"Get Xero...",type:"green",size:"medium",defaults:!0}),XERO.buttons.createButton({text:"Cancel",type:"grey",size:"medium",cancel:!0})],handler:function(e,n){!0===n.cancel?(Windows.closeAll(),XERO.widget.Buttons.enable()):!0===n.defaults&&(parent.location.href=t)}}).show()},saveBankNameAndActivateBankFeed:function(t){var e=Ext.fly("BankNames").getValue();""!=e&&"null"!=e||(e=Ext.fly("BankFeedID").getValue()),""==e||""==$("BankNames_value").value?""==$("BankNames_value").value?(XERO.MsgBox.alert("You haven't entered a bank name.","No Bank Name"),XERO.util.enableButtons()):ChartOfAccounts.bankNotRecognizedHtml($("BankNames_value").value):(null==t&&(t=""),Ajax.SaveAndActivateBankFeed(e,t,ChartOfAccounts.activateBankFeedsCallback))},checkingInProgress:!1,checkBankFeedName:function(t,e,n){if(!ChartOfAccounts.checkingInProgress){ChartOfAccounts.checkingInProgress=!0;var i="";null!=t&&null!=t.current&&(i=t.current.key),""==i&&Ext.fly("BankFeedID")&&""!=Ext.fly("BankFeedID").dom.value&&(i=Ext.fly("BankFeedID").dom.value,t.current=new Object,t.current.key=i,Ext.fly("BankFeedID").dom.value="");var a="";if(null!=e&&(a=e.value,""==i&&null!=t&&null!=t.localData&&t.localData.each(function(t){t.value==a&&(i=t.key)})),""==i||""==a){var o=Ext.get("feedStatus");o&&(o.removeClass("available"),o.removeClass("not-available"),$("feedStatusMessageBody").update(""),""==a?$("feedStatusMessage").update(XERO.lang.BankFeeds.Available):($("feedStatusMessage").update(String.format(XERO.lang.BankFeeds.BankNotRecognised,a.escapeHTML())),Ext.get("nextStepMessage")&&(Ext.get("nextStepMessage").hide(),Ext.select("#AuthorizeFeed a span").update("Done")))),ChartOfAccounts.checkingInProgress=!1}else{var r=Ext.WindowMgr.getActive();r.isContentUpdating?r.on("contentready",function(){ChartOfAccounts.doCheckBankFeedIsEnabledForAutomation(i)},this,{single:!0}):ChartOfAccounts.doCheckBankFeedIsEnabledForAutomation(i)}}},doCheckBankFeedIsEnabledForAutomation:function(t){var e=null,n=Ext.get("AddAccount_Currency");void 0!=n&&(e=n.getValue()),Ajax.CheckBankFeedIsEnabledForAutomation(t,e,ChartOfAccounts.displayBankFeedStatus)},mainUrlClicked:function(){new Ext.util.DelayedTask(function(){$("feedStatusMessageBody").update("Not the page you were expecting? <br /> -Try searching again<br /> -We might not support your account type. <a href='javascript:void(0)' onClick='Windows.closeAll();XERO.bus.fireEvent(\"ticketdialog:showrequest\")'>Contact support</a>")}).delay(200)},displayBankFeedStatus:function(t){var e=t.value,n=!1;if(!e)return void(XERO.widget.Buttons&&XERO.widget.Buttons.enable());if(e.IsValid){var i=Ext.get("feedStatus"),a=e.Data.getValue("isEnabled"),o=e.Data.getValue("isAvailable"),r=e.Data.getValue("isCurrencySupported"),s=e.Data.getValue("isBeta"),l=e.Data.getValue("mainUrl");i&&(o?a&&r&&!s?(i.addClass("available"),i.removeClass("not-available"),$("feedStatusMessage").update("Bank feeds are available"),l?$("feedStatusMessageBody").update("Not sure if it's correct? <a tabindex='-1' href='"+l+"' target='_blank' onclick='ChartOfAccounts.mainUrlClicked()'>Check the bank's home page</a>"):$("feedStatusMessageBody").update(""),Ext.get("nextStepMessage")&&(Ext.get("nextStepMessage").show(),Ext.select("#AuthorizeFeed a span").update("Next")),n=!0):(i.removeClass("available"),i.addClass("not-available"),$("feedStatusMessageBody").update(""),r?s&&a?$("feedStatusMessage").update("A bank feed for this bank is currently in development. We will notify you via the Bank Account Dashboard when the feed provider (Yodlee) makes this available."):$("feedStatusMessage").update("Feeds for this bank aren't available yet.<br/> We'll notify you once they become available."):$("feedStatusMessage").update("Feeds for this bank aren't available in your<br />chosen currency."),Ext.get("nextStepMessage")&&(Ext.get("nextStepMessage").hide(),Ext.select("#AuthorizeFeed a span").update("Done"))):(i.removeClass("available"),i.addClass("not-available"),$("feedStatusMessage").update("Feeds for this bank aren't available."),Ext.get("nextStepMessage")&&(Ext.get("nextStepMessage").hide(),Ext.select("#AuthorizeFeed a span").update("Done"))))}ChartOfAccounts.checkingInProgress=!1,ChartOfAccounts.setFeedAvailable(n),XERO.bus.fireEvent("chartofaccounts:bankfeedstatusupdate",this)},bankNotRecognizedHtml:function(t){ChartOfAccounts.createCenteredAjaxWindow("BankNotRecognizedPopup","Bank not recognised...",400,400),Ajax.GetBankNotRecognizedHtml_1(t,this.getCallback)},deactivateBankFeedHtml:function(t,e,n){var i="PartnerBankFeed"==e?"Disconnect Bank Feed":"Deactivate Bank Feed...";ChartOfAccounts.createCenteredAjaxWindow("DeactivateBankFeedPopup",i,400,400),Ajax.GetDeactivateBankFeedHtml_1(t,e,n,this.getCallback)},onFeedStartDateAfterUpdate:function(){Ext.fly("ChooseADate").dom.checked="checked",Ext.fly("AddBankFeed_ImportHistoricData").dom.value="0"},activeRefreshBankAccountId:null,activeRefreshIsMfa:!1,activeRefreshPopup:null,activeRefreshPopupTemplate:null,completedNotificationId:null,generateMfaRefreshPopupTemplate:function(t){var e='<h3 style="font-size: 15px; font-weight: bold; color: #666;"><img src="/common/images/indicator.gif" style="position:relative; top: 2px; margin-right: 5px;" /> Connecting to your bank</h3>';return e+='<p style="padding:10px 29px;">Your bank may require additional information to refresh your bank feed<br /><br /></p>',e+='<div class="button-container"><a class="xbtn gray large x-pad" onclick="ChartOfAccounts.cancelMfaRefresh(\''+t+"');ChartOfAccounts.activeRefreshPopup.close();XERO.util.enableButtons();\">Cancel</a></div>"},mfaChallenge:function(t){Ajax.GetMFAChallenge(t,ChartOfAccounts.completedNotificationId,ChartOfAccounts.activeRefreshBankAccountId,ChartOfAccounts.activeRefreshIsMfa,ChartOfAccounts.mfaChallenge_callback)},mfaChallenge_callback:function(t){var e=t.value;if(!e)return void(XERO.widget.Buttons&&XERO.widget.Buttons.enable());if(e.IsValid){var n=e.Data.getValue("RedirectUrl");null!=n&&""!=n&&(document.location=n);var i=e.Data.getValue("Title");null!=i&&""!=i||(i="Error"),XERO.MsgBox.create("BankServices",{height:0,width:0,title:i,modal:!0,html:e.Result});var a=document.getElementById("frmBankCredentials");null!=a&&a.submit()}else{var i=e.Data.getValue("Title");""==i&&(i="Could not connect"),XERO.MsgBox.alert(e.Result,i),XERO.widget.Buttons&&XERO.widget.Buttons.enable()}},refreshYodleeV11BankFeed:function(t,e,n,i,a){n?i?(ChartOfAccounts.activeRefreshBankAccountId=t,ChartOfAccounts.activeRefreshIsMfa=!0,ChartOfAccounts.activeRefreshPopup=XERO.MsgBox.create("BankServices",{height:200,width:300,title:"Refresh bank feed",modal:!0,html:'<p style="text-align:center"><img src="/common/images/indicator.gif" /></p>'}),ChartOfAccounts.activeRefreshPopup.show(),Ajax.RefreshMfaFeed(t,e,ChartOfAccounts.refreshBankFeed_callback)):window.location.href=a:SubmitAction("RefreshBankFeed",[t,e])},refreshBankFeed:function(t,e,n){n?(ChartOfAccounts.activeRefreshBankAccountId=t,ChartOfAccounts.activeRefreshIsMfa=!0,ChartOfAccounts.activeRefreshPopup=XERO.MsgBox.create("BankServices",{height:200,width:300,title:"Refresh bank feed",modal:!0,html:'<p style="text-align:center"><img src="/common/images/indicator.gif" /></p>'}),ChartOfAccounts.activeRefreshPopup.show(),Ajax.RefreshMfaFeed(t,e,ChartOfAccounts.refreshBankFeed_callback)):SubmitAction("RefreshBankFeed",[t,e])},showMfaRefreshPopupAfterChallenge:function(t,e){ChartOfAccounts.completedNotificationId=e,ChartOfAccounts.activeRefreshPopup=XERO.MsgBox.create("BankServices",{height:200,width:300,title:"Refresh bank feed",modal:!0,html:""}),ChartOfAccounts.activeRefreshPopup.show(),ChartOfAccounts.activeRefreshPopup.setHtml(ChartOfAccounts.generateMfaRefreshPopupTemplate(e)),ChartOfAccounts.activeRefreshIsMfa=!0,ChartOfAccounts.createMfaPoll(5e3,e),ChartOfAccounts.createRefreshPoll(5e3)},refreshBankFeed_callback:function(t){ChartOfAccounts.activeRefreshPopup.setHtml(ChartOfAccounts.generateMfaRefreshPopupTemplate(t.value.Data.getValue("notificationId"))),ChartOfAccounts.createMfaPoll(5e3,t.value.Data.getValue("notificationId")),ChartOfAccounts.createYodleePoll(t.value.Data.getValue("notificationId"),5e3,t.value.Data.getValue("successMessageSubject"),t.value.Data.getValue("redirectUrl"),t.value.Data.getValue("timeoutExceededMessageSubject"),t.value.Data.getValue("otherFailureMessageSubject"),t.value.Data.getValue("credentialsFailureMessageSubject"))},cancelMfaRefresh:function(t){Ajax.CancelMfaRefresh(t)},createMfaPoll:function(t,e){ChartOfAccounts.completedNotificationId=e,notifications.pollForMessageByType(0,"SiteHookupActiveMfaRefreshId","MfaChallenge",t,function(t){notifications.ajax.markInboxMessageAsRead(t.InboxMessage.NotificationId,{callback:function(){ChartOfAccounts.mfaChallenge(t.InboxMessage.NotificationId)}})})},createRefreshPoll:function(t){notifications.pollForMessageByType(1,"YodleeToken","Success",t,function(t){notifications.ajax.markInboxMessageAsRead(t.InboxMessage.NotificationId,{callback:function(){window.location="/Bank/BankAccounts.aspx"}})}),notifications.pollForMessageByType(2,"YodleeToken","CredentialsFailure",t,function(t){notifications.ajax.getInboxMessage(t.InboxMessage.NotificationId,{callback:function(t){XERO.MsgBox.create(null,{title:"Could not connect to your bank",width:360,html:t.InboxMessage.Message,buttons:[XERO.buttons.createOK()],handler:function(t,e){window.location="/Bank/BankAccounts.aspx"}}).show(),notifications.ajax.markInboxMessageAsRead(t.InboxMessage.NotificationId)}})})},createYodleePoll:function(t,e,n,i,a,o,r){notifications.pollForMessage("YodleeToken",t,e,function(t){switch(t.InboxMessage.Subject){case n:notifications.ajax.markInboxMessageAsRead(t.InboxMessage.NotificationId,{callback:function(){window.location=i}});break;case a:case o:case r:notifications.ajax.getInboxMessage(t.InboxMessage.NotificationId,{callback:function(t){XERO.MsgBox.create(null,{title:"Could not connect to your bank",width:360,html:t.InboxMessage.Message,buttons:[XERO.buttons.createOK()],handler:function(t,e){window.location="/Bank/BankAccounts.aspx"}}).show(),notifications.ajax.markInboxMessageAsRead(t.InboxMessage.NotificationId)}})}})},toggleRefreshInfo:function(){var t,e;t=Ext.get("MFA_AllowNonOwnerRefresh"),e=Ext.get("MFA_RefreshWarning"),"on"===t.dom.getValue()?e.dom.show():e.dom.hide()}})},function(t,e){AjaxPro.csrfTokenName="__RequestVerificationToken",AjaxPro.csrfHeaderName="X-CSRFToken","undefined"==typeof Ajax&&(Ajax={}),Ajax_class=function(){},Object.extend(Ajax_class.prototype,Object.extend(new AjaxPro.AjaxClass,{AccountCodeChanged_1:function(t){return this.invoke("AccountCodeChanged_1",[t],this.AccountCodeChanged_1.getArguments().slice(1))},AccountCodeChanged_2:function(t,e){return this.invoke("AccountCodeChanged_2",[t,e],this.AccountCodeChanged_2.getArguments().slice(2))},ActivateBankFeeds:function(t,e){return this.invoke("ActivateBankFeeds",[t,e],this.ActivateBankFeeds.getArguments().slice(2))},ActivateTrackingCategory:function(t,e){return this.invoke("ActivateTrackingCategory",[t,e],this.ActivateTrackingCategory.getArguments().slice(2))},ActivateTrackingItem:function(t,e){return this.invoke("ActivateTrackingItem",[t,e],this.ActivateTrackingItem.getArguments().slice(2))},AddCategory:function(){return this.invoke("AddCategory",[],this.AddCategory.getArguments())},AddItem:function(t,e,n,i){return this.invoke("AddItem",[t,e,n,i],this.AddItem.getArguments().slice(4))},AddNote:function(t,e,n,i){return this.invoke("AddNote",[t,e,n,i],this.AddNote.getArguments().slice(4))},AddToReport:function(t,e){return this.invoke("AddToReport",[t,e],this.AddToReport.getArguments().slice(2))},ApplyFavLayoutOptions:function(t,e,n){return this.invoke("ApplyFavLayoutOptions",[t,e,n],this.ApplyFavLayoutOptions.getArguments().slice(3))},ApplySelectedLayout:function(t,e){return this.invoke("ApplySelectedLayout",[t,e],this.ApplySelectedLayout.getArguments().slice(2))},ApproveReceipts:function(t,e){return this.invoke("ApproveReceipts",[t,e],this.ApproveReceipts.getArguments().slice(2))},ArchiveDeletedTrackingItem:function(t,e){return this.invoke("ArchiveDeletedTrackingItem",[t,e],this.ArchiveDeletedTrackingItem.getArguments().slice(2))},ArchiveTrackingCategory:function(t,e,n,i){return this.invoke("ArchiveTrackingCategory",[t,e,n,i],this.ArchiveTrackingCategory.getArguments().slice(4))},ArchiveTrackingItem:function(t,e,n,i){return this.invoke("ArchiveTrackingItem",[t,e,n,i],this.ArchiveTrackingItem.getArguments().slice(4))},AskMyAccountant:function(t){return this.invoke("AskMyAccountant",[t],this.AskMyAccountant.getArguments().slice(1))},CancelMfaRefresh:function(t){return this.invoke("CancelMfaRefresh",[t],this.CancelMfaRefresh.getArguments().slice(1))},CancelPrintJob:function(t){return this.invoke("CancelPrintJob",[t],this.CancelPrintJob.getArguments().slice(1))},ChangeDateFormat:function(t){return this.invoke("ChangeDateFormat",[t],this.ChangeDateFormat.getArguments().slice(1))},CheckBankFeedIsEnabledForAutomation:function(t,e){return this.invoke("CheckBankFeedIsEnabledForAutomation",[t,e],this.CheckBankFeedIsEnabledForAutomation.getArguments().slice(2))},CheckBulkPrintingInvoiceTypes:function(t){return this.invoke("CheckBulkPrintingInvoiceTypes",[t],this.CheckBulkPrintingInvoiceTypes.getArguments().slice(1))},CheckCanDeleteTransaction:function(t){return this.invoke("CheckCanDeleteTransaction",[t],this.CheckCanDeleteTransaction.getArguments().slice(1))},CheckChangesOnInvoiceForSalesTaxLookup:function(t,e,n){return this.invoke("CheckChangesOnInvoiceForSalesTaxLookup",[t,e,n],this.CheckChangesOnInvoiceForSalesTaxLookup.getArguments().slice(3))},CheckEmailTemplatePlaceholders:function(t){return this.invoke("CheckEmailTemplatePlaceholders",[t],this.CheckEmailTemplatePlaceholders.getArguments().slice(1))},CheckForExistingRepeatTransaction:function(t,e,n,i){return this.invoke("CheckForExistingRepeatTransaction",[t,e,n,i],this.CheckForExistingRepeatTransaction.getArguments().slice(4))},CheckForPaidToAndReferenceConflict:function(t,e,n,i){return this.invoke("CheckForPaidToAndReferenceConflict",[t,e,n,i],this.CheckForPaidToAndReferenceConflict.getArguments().slice(4))},CheckNZTaxRatesBeforeBulkApprove:function(t){return this.invoke("CheckNZTaxRatesBeforeBulkApprove",[t],this.CheckNZTaxRatesBeforeBulkApprove.getArguments().slice(1))},CheckPurchaseOrdersToLink:function(t){return this.invoke("CheckPurchaseOrdersToLink",[t],this.CheckPurchaseOrdersToLink.getArguments().slice(1))},CheckRepeatTXEmailTemplatePlaceholders:function(t,e,n,i){return this.invoke("CheckRepeatTXEmailTemplatePlaceholders",[t,e,n,i],this.CheckRepeatTXEmailTemplatePlaceholders.getArguments().slice(4))},CheckStatementEmailTemplatePlaceholders:function(t){return this.invoke("CheckStatementEmailTemplatePlaceholders",[t],this.CheckStatementEmailTemplatePlaceholders.getArguments().slice(1))},CheckStatementUnpopulatedTemplatePlaceholders:function(t,e,n){return this.invoke("CheckStatementUnpopulatedTemplatePlaceholders",[t,e,n],this.CheckStatementUnpopulatedTemplatePlaceholders.getArguments().slice(3))},CheckUnpopulatedTemplatePlaceholders:function(t){return this.invoke("CheckUnpopulatedTemplatePlaceholders",[t],this.CheckUnpopulatedTemplatePlaceholders.getArguments().slice(1))},CheckWagePayablesSystemAccountCodeIsUnique:function(t){return this.invoke("CheckWagePayablesSystemAccountCodeIsUnique",[t],this.CheckWagePayablesSystemAccountCodeIsUnique.getArguments().slice(1))},CloseNotification:function(t,e){return this.invoke("CloseNotification",[t,e],this.CloseNotification.getArguments().slice(2))},CreatePopupHtml:function(t,e,n,i){return this.invoke("CreatePopupHtml",[t,e,n,i],this.CreatePopupHtml.getArguments().slice(4))},DeclineReceipts:function(t,e){return this.invoke("DeclineReceipts",[t,e],this.DeclineReceipts.getArguments().slice(2))},DeleteBudget:function(t){return this.invoke("DeleteBudget",[t],this.DeleteBudget.getArguments().slice(1))},DeleteCategory:function(t){return this.invoke("DeleteCategory",[t],this.DeleteCategory.getArguments().slice(1))},DeleteContact:function(t,e){return this.invoke("DeleteContact",[t,e],this.DeleteContact.getArguments().slice(2))},DeleteContacts:function(t){return this.invoke("DeleteContacts",[t],this.DeleteContacts.getArguments().slice(1))},DeleteFreetext:function(t,e){return this.invoke("DeleteFreetext",[t,e],this.DeleteFreetext.getArguments().slice(2))},DeleteGroup_1:function(t){return this.invoke("DeleteGroup_1",[t],this.DeleteGroup_1.getArguments().slice(1))},DeleteGroup_3:function(t,e,n){return this.invoke("DeleteGroup_3",[t,e,n],this.DeleteGroup_3.getArguments().slice(3))},DeleteInformationMessage:function(t){return this.invoke("DeleteInformationMessage",[t],this.DeleteInformationMessage.getArguments().slice(1))},DeleteInvoice:function(t){return this.invoke("DeleteInvoice",[t],this.DeleteInvoice.getArguments().slice(1))},DeleteItem:function(t){return this.invoke("DeleteItem",[t],this.DeleteItem.getArguments().slice(1))},DeleteLogo:function(t){return this.invoke("DeleteLogo",[t],this.DeleteLogo.getArguments().slice(1))},DeleteNote:function(t,e){return this.invoke("DeleteNote",[t,e],this.DeleteNote.getArguments().slice(2))},DeleteReceipt:function(t,e){return this.invoke("DeleteReceipt",[t,e],this.DeleteReceipt.getArguments().slice(2))},DeleteReceipts:function(t,e){return this.invoke("DeleteReceipts",[t,e],this.DeleteReceipts.getArguments().slice(2))},DeleteReportField:function(t){return this.invoke("DeleteReportField",[t],this.DeleteReportField.getArguments().slice(1))},DeleteReportLayout:function(t,e){return this.invoke("DeleteReportLayout",[t,e],this.DeleteReportLayout.getArguments().slice(2))},DeleteReportPackLayout:function(t){return this.invoke("DeleteReportPackLayout",[t],this.DeleteReportPackLayout.getArguments().slice(1))},DeleteRules:function(t){return this.invoke("DeleteRules",[t],this.DeleteRules.getArguments().slice(1))},DeleteStatementLines:function(t,e){return this.invoke("DeleteStatementLines",[t,e],this.DeleteStatementLines.getArguments().slice(2))},DeleteTemplate:function(t,e){return this.invoke("DeleteTemplate",[t,e],this.DeleteTemplate.getArguments().slice(2))},DeleteTemplatePopup:function(t){return this.invoke("DeleteTemplatePopup",[t],this.DeleteTemplatePopup.getArguments().slice(1))},DisableSalesTaxLookup:function(){return this.invoke("DisableSalesTaxLookup",[],this.DisableSalesTaxLookup.getArguments())},DuplicateTemplate:function(t,e){return this.invoke("DuplicateTemplate",[t,e],this.DuplicateTemplate.getArguments().slice(2))},DuplicateTemplatePopup:function(t){return this.invoke("DuplicateTemplatePopup",[t],this.DuplicateTemplatePopup.getArguments().slice(1))},EditAccount:function(t,e){return this.invoke("EditAccount",[t,e],this.EditAccount.getArguments().slice(2))},EditBankAccount:function(t,e,n){return this.invoke("EditBankAccount",[t,e,n],this.EditBankAccount.getArguments().slice(3))},EditCategory:function(t,e,n){return this.invoke("EditCategory",[t,e,n],this.EditCategory.getArguments().slice(3))},EditReportField:function(t){return this.invoke("EditReportField",[t],this.EditReportField.getArguments().slice(1))},EmailCountInInvoiceMessageSettings:function(t){return this.invoke("EmailCountInInvoiceMessageSettings",[t],this.EmailCountInInvoiceMessageSettings.getArguments().slice(1))},FindContactsHtml:function(t,e){return this.invoke("FindContactsHtml",[t,e],this.FindContactsHtml.getArguments().slice(2))},ForceSyncNow:function(){return this.invoke("ForceSyncNow",[],this.ForceSyncNow.getArguments())},GetAccountDescriptions:function(t){return this.invoke("GetAccountDescriptions",[t],this.GetAccountDescriptions.getArguments().slice(1))},GetAccountDisplayHtml:function(t,e,n){return this.invoke("GetAccountDisplayHtml",[t,e,n],this.GetAccountDisplayHtml.getArguments().slice(3))},GetAccountLineItemsHtml:function(t,e){return this.invoke("GetAccountLineItemsHtml",[t,e],this.GetAccountLineItemsHtml.getArguments().slice(2))},GetActivateStripeBankFeedHtml:function(t,e){return this.invoke("GetActivateStripeBankFeedHtml",[t,e],this.GetActivateStripeBankFeedHtml.getArguments().slice(2))},GetAddAccountHtml:function(t){return this.invoke("GetAddAccountHtml",[t],this.GetAddAccountHtml.getArguments().slice(1))},GetAddAccountHtml:function(t,e){return this.invoke("GetAddAccountHtml",[t,e],this.GetAddAccountHtml.getArguments().slice(2))},GetAddAddressHtml:function(t){return this.invoke("GetAddAddressHtml",[t],this.GetAddAddressHtml.getArguments().slice(1))},GetAddAllAccountsHtml:function(t,e){return this.invoke("GetAddAllAccountsHtml",[t,e],this.GetAddAllAccountsHtml.getArguments().slice(2))},GetAddBankAccountHtml_1:function(t){return this.invoke("GetAddBankAccountHtml_1",[t],this.GetAddBankAccountHtml_1.getArguments().slice(1))},GetAddChequeAddressForNewContactHtml:function(){return this.invoke("GetAddChequeAddressForNewContactHtml",[],this.GetAddChequeAddressForNewContactHtml.getArguments())},GetAddChequeAddressHtml:function(t){return this.invoke("GetAddChequeAddressHtml",[t],this.GetAddChequeAddressHtml.getArguments().slice(1))},GetAddContactHtml:function(){return this.invoke("GetAddContactHtml",[],this.GetAddContactHtml.getArguments())},GetAddCreditCardBankAccountHtml:function(t){return this.invoke("GetAddCreditCardBankAccountHtml",[t],this.GetAddCreditCardBankAccountHtml.getArguments().slice(1))},GetAddEmployeeHtml:function(){return this.invoke("GetAddEmployeeHtml",[],this.GetAddEmployeeHtml.getArguments())},GetAddPayPalBankAccountHtml:function(t){return this.invoke("GetAddPayPalBankAccountHtml",[t],this.GetAddPayPalBankAccountHtml.getArguments().slice(1))},GetAddPriceListItemPopUpHtml:function(t,e){return this.invoke("GetAddPriceListItemPopUpHtml",[t,e],this.GetAddPriceListItemPopUpHtml.getArguments().slice(2))},GetAddTrackingItemHtml:function(t,e,n){return this.invoke("GetAddTrackingItemHtml",[t,e,n],this.GetAddTrackingItemHtml.getArguments().slice(3))},GetApplyLayoutOptionsHtml:function(t,e){return this.invoke("GetApplyLayoutOptionsHtml",[t,e],this.GetApplyLayoutOptionsHtml.getArguments().slice(2))},GetApprovedPOsBySupplierId:function(t){return this.invoke("GetApprovedPOsBySupplierId",[t],this.GetApprovedPOsBySupplierId.getArguments().slice(1))},GetArchivedTrackingTab:function(){return this.invoke("GetArchivedTrackingTab",[],this.GetArchivedTrackingTab.getArguments())},GetAskMyAccountantHtml:function(){return this.invoke("GetAskMyAccountantHtml",[],this.GetAskMyAccountantHtml.getArguments())},GetBankFeedErrorHtml:function(t,e){return this.invoke("GetBankFeedErrorHtml",[t,e],this.GetBankFeedErrorHtml.getArguments().slice(2))},GetBankFeedNames:function(t){return this.invoke("GetBankFeedNames",[t],this.GetBankFeedNames.getArguments().slice(1))},GetBankFeesHtml:function(t,e){return this.invoke("GetBankFeesHtml",[t,e],this.GetBankFeesHtml.getArguments().slice(2))},GetBankNotRecognizedHtml_1:function(t){return this.invoke("GetBankNotRecognizedHtml_1",[t],this.GetBankNotRecognizedHtml_1.getArguments().slice(1))},GetBaseCurrencyBankAccounts:function(){return this.invoke("GetBaseCurrencyBankAccounts",[],this.GetBaseCurrencyBankAccounts.getArguments())},GetBudgetJSON:function(t,e){return this.invoke("GetBudgetJSON",[t,e],this.GetBudgetJSON.getArguments().slice(2))},GetCanNotAddCategoryPopup:function(){return this.invoke("GetCanNotAddCategoryPopup",[],this.GetCanNotAddCategoryPopup.getArguments())},GetCategoryWarningPopup:function(t,e){return this.invoke("GetCategoryWarningPopup",[t,e],this.GetCategoryWarningPopup.getArguments().slice(2))},GetChequePaymentJSON:function(t){return this.invoke("GetChequePaymentJSON",[t],this.GetChequePaymentJSON.getArguments().slice(1))},GetChequeTemplatesJSON:function(){return this.invoke("GetChequeTemplatesJSON",[],this.GetChequeTemplatesJSON.getArguments())},GetChooseReportHtml:function(t){return this.invoke("GetChooseReportHtml",[t],this.GetChooseReportHtml.getArguments().slice(1))},GetConfirmRestoreItemPopup:function(t){return this.invoke("GetConfirmRestoreItemPopup",[t],this.GetConfirmRestoreItemPopup.getArguments().slice(1))},GetConfirmSaveReportPackLayoutHtml:function(t,e){return this.invoke("GetConfirmSaveReportPackLayoutHtml",[t,e],this.GetConfirmSaveReportPackLayoutHtml.getArguments().slice(2))},GetConfirmYourPreviousReturnHtml:function(t,e,n){return this.invoke("GetConfirmYourPreviousReturnHtml",[t,e,n],this.GetConfirmYourPreviousReturnHtml.getArguments().slice(3))},GetContactAddress:function(t){return this.invoke("GetContactAddress",[t],this.GetContactAddress.getArguments().slice(1))},GetContactDetailsHtml:function(t){return this.invoke("GetContactDetailsHtml",[t],this.GetContactDetailsHtml.getArguments().slice(1))},GetContacts:function(t){return this.invoke("GetContacts",[t],this.GetContacts.getArguments().slice(1))},GetContactSupportHtml:function(t){return this.invoke("GetContactSupportHtml",[t],this.GetContactSupportHtml.getArguments().slice(1))},GetCopyExistingReportPackHtml:function(){return this.invoke("GetCopyExistingReportPackHtml",[],this.GetCopyExistingReportPackHtml.getArguments())},GetCreditCardFeedNames:function(t){return this.invoke("GetCreditCardFeedNames",[t],this.GetCreditCardFeedNames.getArguments().slice(1))},GetCurrencyAccountHtml:function(t){return this.invoke("GetCurrencyAccountHtml",[t],this.GetCurrencyAccountHtml.getArguments().slice(1))},GetCurrencyAutocompleter:function(t,e,n){return this.invoke("GetCurrencyAutocompleter",[t,e,n],this.GetCurrencyAutocompleter.getArguments().slice(3))},GetCurrencyData:function(t){return this.invoke("GetCurrencyData",[t],this.GetCurrencyData.getArguments().slice(1))},GetCurrencyHtml:function(t,e){return this.invoke("GetCurrencyHtml",[t,e],this.GetCurrencyHtml.getArguments().slice(2))},GetCurrencyProviderRates:function(t){return this.invoke("GetCurrencyProviderRates",[t],this.GetCurrencyProviderRates.getArguments().slice(1))},GetCurrencyRateData:function(t,e){return this.invoke("GetCurrencyRateData",[t,e],this.GetCurrencyRateData.getArguments().slice(2))},GetCurrencyRateSummary:function(t,e,n){return this.invoke("GetCurrencyRateSummary",[t,e,n],this.GetCurrencyRateSummary.getArguments().slice(3))},GetDADMappingHtml:function(t){return this.invoke("GetDADMappingHtml",[t],this.GetDADMappingHtml.getArguments().slice(1))},GetDeactivateBankFeedHtml_1:function(t,e,n){return this.invoke("GetDeactivateBankFeedHtml_1",[t,e,n],this.GetDeactivateBankFeedHtml_1.getArguments().slice(3))},GetDeleteAndMoveContactHtml:function(t){return this.invoke("GetDeleteAndMoveContactHtml",[t],this.GetDeleteAndMoveContactHtml.getArguments().slice(1))},GetDeleteArchivedItemPopup:function(t,e){return this.invoke("GetDeleteArchivedItemPopup",[t,e],this.GetDeleteArchivedItemPopup.getArguments().slice(2))},GetDeleteChequePaymentWarningHtml:function(){return this.invoke("GetDeleteChequePaymentWarningHtml",[],this.GetDeleteChequePaymentWarningHtml.getArguments())},GetDeleteChequeWarningHtml:function(){return this.invoke("GetDeleteChequeWarningHtml",[],this.GetDeleteChequeWarningHtml.getArguments())},GetDeleteReportPackLayoutHtml:function(t,e,n,i){return this.invoke("GetDeleteReportPackLayoutHtml",[t,e,n,i],this.GetDeleteReportPackLayoutHtml.getArguments().slice(4))},GetDeleteTemplateWarningHtml:function(t){return this.invoke("GetDeleteTemplateWarningHtml",[t],this.GetDeleteTemplateWarningHtml.getArguments().slice(1))},GetDeleteUserWarningHtml:function(){return this.invoke("GetDeleteUserWarningHtml",[],this.GetDeleteUserWarningHtml.getArguments())},GetDeleteUserWithBankFeedsWarningHtml:function(t,e,n,i){return this.invoke("GetDeleteUserWithBankFeedsWarningHtml",[t,e,n,i],this.GetDeleteUserWithBankFeedsWarningHtml.getArguments().slice(4))},GetDeleteWarningHtml:function(t){return this.invoke("GetDeleteWarningHtml",[t],this.GetDeleteWarningHtml.getArguments().slice(1))},GetDocxUploaderPopup:function(t){return this.invoke("GetDocxUploaderPopup",[t],this.GetDocxUploaderPopup.getArguments().slice(1))},GetEditAccountBalanceDetailHtml:function(t,e,n,i,a){return this.invoke("GetEditAccountBalanceDetailHtml",[t,e,n,i,a],this.GetEditAccountBalanceDetailHtml.getArguments().slice(5))},GetEditAccountHtml:function(t){return this.invoke("GetEditAccountHtml",[t],this.GetEditAccountHtml.getArguments().slice(1))},GetEditBankAccountHtml:function(t,e){return this.invoke("GetEditBankAccountHtml",[t,e],this.GetEditBankAccountHtml.getArguments().slice(2))},GetEditBudgetHtml:function(t){return this.invoke("GetEditBudgetHtml",[t],this.GetEditBudgetHtml.getArguments().slice(1))},GetEditCategoryPopup:function(t){return this.invoke("GetEditCategoryPopup",[t],this.GetEditCategoryPopup.getArguments().slice(1))},GetEditChequeHtml:function(t){return this.invoke("GetEditChequeHtml",[t],this.GetEditChequeHtml.getArguments().slice(1))},GetEditChequeHtml:function(t,e){return this.invoke("GetEditChequeHtml",[t,e],this.GetEditChequeHtml.getArguments().slice(2))},GetEditEmployeeHtml:function(t){return this.invoke("GetEditEmployeeHtml",[t],this.GetEditEmployeeHtml.getArguments().slice(1))},GetEditExchangeRateHtml:function(t,e,n,i){return this.invoke("GetEditExchangeRateHtml",[t,e,n,i],this.GetEditExchangeRateHtml.getArguments().slice(4))},GetEditItemPopup:function(t){return this.invoke("GetEditItemPopup",[t],this.GetEditItemPopup.getArguments().slice(1))},GetEditPriceListItemPopUpHtml:function(t){return this.invoke("GetEditPriceListItemPopUpHtml",[t],this.GetEditPriceListItemPopUpHtml.getArguments().slice(1))},GetExchangeRatesForDate:function(t){return this.invoke("GetExchangeRatesForDate",[t],this.GetExchangeRatesForDate.getArguments().slice(1))},GetExportToGoogleDocsUrl:function(t){return this.invoke("GetExportToGoogleDocsUrl",[t],this.GetExportToGoogleDocsUrl.getArguments().slice(1))},GetFeedNames:function(t){return this.invoke("GetFeedNames",[t],this.GetFeedNames.getArguments().slice(1))},GetFollowUpPanel:function(t){return this.invoke("GetFollowUpPanel",[t],this.GetFollowUpPanel.getArguments().slice(1))},GetFreetext:function(t,e){return this.invoke("GetFreetext",[t,e],this.GetFreetext.getArguments().slice(2))},GetFreshBooksSynchronisationStatus:function(t){return this.invoke("GetFreshBooksSynchronisationStatus",[t],this.GetFreshBooksSynchronisationStatus.getArguments().slice(1))},GetFXSummary:function(t,e,n,i){return this.invoke("GetFXSummary",[t,e,n,i],this.GetFXSummary.getArguments().slice(4))},GetGroupAccountsHtml:function(t,e){return this.invoke("GetGroupAccountsHtml",[t,e],this.GetGroupAccountsHtml.getArguments().slice(2))},GetGroupContactHtml:function(){return this.invoke("GetGroupContactHtml",[],this.GetGroupContactHtml.getArguments())},GetGroupReportCodesHtml:function(t,e,n,i){return this.invoke("GetGroupReportCodesHtml",[t,e,n,i],this.GetGroupReportCodesHtml.getArguments().slice(4))},GetHelpTip:function(t){return this.invoke("GetHelpTip",[t],this.GetHelpTip.getArguments().slice(1))},GetHighriseWidgetStatus:function(t){return this.invoke("GetHighriseWidgetStatus",[t],this.GetHighriseWidgetStatus.getArguments().slice(1))},GetHistoryHtml:function(t){return this.invoke("GetHistoryHtml",[t],this.GetHistoryHtml.getArguments().slice(1))},GetInvoices:function(t,e,n,i){return this.invoke("GetInvoices",[t,e,n,i],this.GetInvoices.getArguments().slice(4))},GetItemWarningPopup:function(t,e,n){return this.invoke("GetItemWarningPopup",[t,e,n],this.GetItemWarningPopup.getArguments().slice(3))},GetLineItemsForPreviousInvoice:function(t,e,n){return this.invoke("GetLineItemsForPreviousInvoice",[t,e,n],this.GetLineItemsForPreviousInvoice.getArguments().slice(3))},GetLineItemsHtml:function(t,e){return this.invoke("GetLineItemsHtml",[t,e],this.GetLineItemsHtml.getArguments().slice(2))},GetMakePaymentHtml:function(){return this.invoke("GetMakePaymentHtml",[],this.GetMakePaymentHtml.getArguments())},GetMarkReconciledWarningHtml:function(t,e,n,i){return this.invoke("GetMarkReconciledWarningHtml",[t,e,n,i],this.GetMarkReconciledWarningHtml.getArguments().slice(4))},GetMergeContactsHtml:function(t){return this.invoke("GetMergeContactsHtml",[t],this.GetMergeContactsHtml.getArguments().slice(1))},GetMFAChallenge:function(t,e,n,i){return this.invoke("GetMFAChallenge",[t,e,n,i],this.GetMFAChallenge.getArguments().slice(4))},GetMoveAccountsHtml:function(t){return this.invoke("GetMoveAccountsHtml",[t],this.GetMoveAccountsHtml.getArguments().slice(1))},GetMoveContactHtml:function(){return this.invoke("GetMoveContactHtml",[],this.GetMoveContactHtml.getArguments())},GetMoveReportCodesHtml:function(t){return this.invoke("GetMoveReportCodesHtml",[t],this.GetMoveReportCodesHtml.getArguments().slice(1))},GetNewPaymentFromBankRuleHtml:function(t,e,n,i,a,o,r){return this.invoke("GetNewPaymentFromBankRuleHtml",[t,e,n,i,a,o,r],this.GetNewPaymentFromBankRuleHtml.getArguments().slice(7))},GetNewPaymentFromSquareHtml:function(t,e,n){return this.invoke("GetNewPaymentFromSquareHtml",[t,e,n],this.GetNewPaymentFromSquareHtml.getArguments().slice(3))},GetNewPaymentHtml:function(t,e,n,i,a,o,r,s,l,u,c,d,h,f){return this.invoke("GetNewPaymentHtml",[t,e,n,i,a,o,r,s,l,u,c,d,h,f],this.GetNewPaymentHtml.getArguments().slice(14))},GetNewPayrunHtml:function(){return this.invoke("GetNewPayrunHtml",[],this.GetNewPayrunHtml.getArguments())},GetNewQuickBankTransactionHtml:function(t,e){return this.invoke("GetNewQuickBankTransactionHtml",[t,e],this.GetNewQuickBankTransactionHtml.getArguments().slice(2))},GetNewTransferFromBankRuleHtml:function(t,e,n,i,a,o){return this.invoke("GetNewTransferFromBankRuleHtml",[t,e,n,i,a,o],this.GetNewTransferFromBankRuleHtml.getArguments().slice(6))},GetNextStatementLine:function(t,e,n,i){return this.invoke("GetNextStatementLine",[t,e,n,i],this.GetNextStatementLine.getArguments().slice(4))},GetNonEmployeeContacts:function(t){return this.invoke("GetNonEmployeeContacts",[t],this.GetNonEmployeeContacts.getArguments().slice(1))},GetNote:function(t,e){return this.invoke("GetNote",[t,e],this.GetNote.getArguments().slice(2))},GetOrganisationLimitsHtml:function(t,e){return this.invoke("GetOrganisationLimitsHtml",[t,e],this.GetOrganisationLimitsHtml.getArguments().slice(2))},GetOverpaymentHtml:function(t,e,n,i,a){return this.invoke("GetOverpaymentHtml",[t,e,n,i,a],this.GetOverpaymentHtml.getArguments().slice(5))},GetPayByChequeHtml:function(t,e){return this.invoke("GetPayByChequeHtml",[t,e],this.GetPayByChequeHtml.getArguments().slice(2))},GetPayItemHtml:function(t,e){return this.invoke("GetPayItemHtml",[t,e],this.GetPayItemHtml.getArguments().slice(2))},GetPaymentCancelledWarning:function(){return this.invoke("GetPaymentCancelledWarning",[],this.GetPaymentCancelledWarning.getArguments())},GetPossibleMatchForStatementLine:function(t,e,n){return this.invoke("GetPossibleMatchForStatementLine",[t,e,n],this.GetPossibleMatchForStatementLine.getArguments().slice(3))},GetPreviousLoginPopup:function(){return this.invoke("GetPreviousLoginPopup",[],this.GetPreviousLoginPopup.getArguments())},GetPrintJobStatus:function(t){return this.invoke("GetPrintJobStatus",[t],this.GetPrintJobStatus.getArguments().slice(1))},GetProvisionTaxRatesHtml:function(t){return this.invoke("GetProvisionTaxRatesHtml",[t],this.GetProvisionTaxRatesHtml.getArguments().slice(1))},GetProvisionDrcTaxRatesHtml:function(t){return this.invoke("GetProvisionDrcTaxRatesHtml",[t],this.GetProvisionDrcTaxRatesHtml.getArguments().slice(1))},GetReconcileTransactionFormHtml:function(t,e,n,i){return this.invoke("GetReconcileTransactionFormHtml",[t,e,n,i],this.GetReconcileTransactionFormHtml.getArguments().slice(4))},GetReimbursementsHtml:function(t){return this.invoke("GetReimbursementsHtml",[t],this.GetReimbursementsHtml.getArguments().slice(1))},GetRemovePayrollRoleWarningHtml:function(t){return this.invoke("GetRemovePayrollRoleWarningHtml",[t],this.GetRemovePayrollRoleWarningHtml.getArguments().slice(1))},GetReportLayoutJSON:function(t,e,n,i){return this.invoke("GetReportLayoutJSON",[t,e,n,i],this.GetReportLayoutJSON.getArguments().slice(4))},GetReportPackJson:function(t){return this.invoke("GetReportPackJson",[t],this.GetReportPackJson.getArguments().slice(1))},GetRequestReviewHtml:function(t,e){return this.invoke("GetRequestReviewHtml",[t,e],this.GetRequestReviewHtml.getArguments().slice(2))},GetSalesTaxLookupAboutHtml:function(){return this.invoke("GetSalesTaxLookupAboutHtml",[],this.GetSalesTaxLookupAboutHtml.getArguments())},GetSalesTaxLookupChangedTaxRateHtml:function(){return this.invoke("GetSalesTaxLookupChangedTaxRateHtml",[],this.GetSalesTaxLookupChangedTaxRateHtml.getArguments())},GetSalesTaxLookupCheckingRatesHaveChangedHtml:function(){return this.invoke("GetSalesTaxLookupCheckingRatesHaveChangedHtml",[],this.GetSalesTaxLookupCheckingRatesHaveChangedHtml.getArguments())},GetSalesTaxLookupInvoicesToBulkApprove:function(t){return this.invoke("GetSalesTaxLookupInvoicesToBulkApprove",[t],this.GetSalesTaxLookupInvoicesToBulkApprove.getArguments().slice(1))},GetSalesTaxLookupRateCustomerAddressHtml:function(){return this.invoke("GetSalesTaxLookupRateCustomerAddressHtml",[],this.GetSalesTaxLookupRateCustomerAddressHtml.getArguments())},GetSalesTaxLookupSettingsHtml:function(){return this.invoke("GetSalesTaxLookupSettingsHtml",[],this.GetSalesTaxLookupSettingsHtml.getArguments())},GetSaveLayoutAsFavouriteHtml:function(t){return this.invoke("GetSaveLayoutAsFavouriteHtml",[t],this.GetSaveLayoutAsFavouriteHtml.getArguments().slice(1))},GetSecondaryContactHtml:function(){return this.invoke("GetSecondaryContactHtml",[],this.GetSecondaryContactHtml.getArguments())},GetSequentialChequeNumbers:function(t,e,n){return this.invoke("GetSequentialChequeNumbers",[t,e,n],this.GetSequentialChequeNumbers.getArguments().slice(3))},GetSplitPaymentHtml:function(t,e,n,i,a){return this.invoke("GetSplitPaymentHtml",[t,e,n,i,a],this.GetSplitPaymentHtml.getArguments().slice(5))},GetStatementLines:function(t,e,n,i,a,o,r,s){return this.invoke("GetStatementLines",[t,e,n,i,a,o,r,s],this.GetStatementLines.getArguments().slice(8))},GetStatementLinesJSON:function(){return this.invoke("GetStatementLinesJSON",[],this.GetStatementLinesJSON.getArguments())},GetStatements:function(t,e,n,i,a){return this.invoke("GetStatements",[t,e,n,i,a],this.GetStatements.getArguments().slice(5))},GetSwitchTaxRateHtml:function(t,e,n){return this.invoke("GetSwitchTaxRateHtml",[t,e,n],this.GetSwitchTaxRateHtml.getArguments().slice(3))},GetSyncHistoryData:function(t,e,n){return this.invoke("GetSyncHistoryData",[t,e,n],this.GetSyncHistoryData.getArguments().slice(3))},GetSyncStatus:function(t){return this.invoke("GetSyncStatus",[t],this.GetSyncStatus.getArguments().slice(1))},GetSyncStatus2:function(t){return this.invoke("GetSyncStatus2",[t],this.GetSyncStatus2.getArguments().slice(1))},GetTaxComponentHtml:function(t){return this.invoke("GetTaxComponentHtml",[t],this.GetTaxComponentHtml.getArguments().slice(1))},GetTaxRateHtml:function(t,e){return this.invoke("GetTaxRateHtml",[t,e],this.GetTaxRateHtml.getArguments().slice(2))},GetTransferHtml:function(t,e,n,i,a){return this.invoke("GetTransferHtml",[t,e,n,i,a],this.GetTransferHtml.getArguments().slice(5))},GetUnreconciledTransactionRowHtml:function(t,e,n,i){return this.invoke("GetUnreconciledTransactionRowHtml",[t,e,n,i],this.GetUnreconciledTransactionRowHtml.getArguments().slice(4))},GetUnreconciledTransactionsHtml:function(t,e,n,i,a,o,r,s,l,u,c,d,h){return this.invoke("GetUnreconciledTransactionsHtml",[t,e,n,i,a,o,r,s,l,u,c,d,h],this.GetUnreconciledTransactionsHtml.getArguments().slice(13))},GetUnreconcileWarningHtml:function(t,e,n,i,a){return this.invoke("GetUnreconcileWarningHtml",[t,e,n,i,a],this.GetUnreconcileWarningHtml.getArguments().slice(5))},GetUpdateTaxRateHtml:function(){return this.invoke("GetUpdateTaxRateHtml",[],this.GetUpdateTaxRateHtml.getArguments())},GetUnreconciledTransactionsRowsHtml:function(t,e,n){return this.invoke("GetUnreconciledTransactionsRowsHtml",[t,e,n],this.GetUnreconciledTransactionsRowsHtml.getArguments().slice(3))},GetUpdateUserRoleWithBankFeedsWarningHtml:function(t,e){return this.invoke("GetUpdateUserRoleWithBankFeedsWarningHtml",[t,e],this.GetUpdateUserRoleWithBankFeedsWarningHtml.getArguments().slice(2))},GetViewChequeHtml:function(t,e){return this.invoke("GetViewChequeHtml",[t,e],this.GetViewChequeHtml.getArguments().slice(2))},GetVoidChequesWarningHtml:function(t){return this.invoke("GetVoidChequesWarningHtml",[t],this.GetVoidChequesWarningHtml.getArguments().slice(1))},GetWarningPopup_3:function(t,e,n){return this.invoke("GetWarningPopup_3",[t,e,n],this.GetWarningPopup_3.getArguments().slice(3))},GetWarningPopup_5:function(t,e,n,i,a){return this.invoke("GetWarningPopup_5",[t,e,n,i,a],this.GetWarningPopup_5.getArguments().slice(5))},GetWidgetHtml:function(t,e,n){return this.invoke("GetWidgetHtml",[t,e,n],this.GetWidgetHtml.getArguments().slice(3))},GetXero2XeroOrganisationOfflineStatus:function(t){return this.invoke("GetXero2XeroOrganisationOfflineStatus",[t],this.GetXero2XeroOrganisationOfflineStatus.getArguments().slice(1))},GroupAccounts:function(t,e,n,i,a,o){return this.invoke("GroupAccounts",[t,e,n,i,a,o],this.GroupAccounts.getArguments().slice(6))},GroupContacts:function(t,e){return this.invoke("GroupContacts",[t,e],this.GroupContacts.getArguments().slice(2))},HasProvider:function(t){return this.invoke("HasProvider",[t],this.HasProvider.getArguments().slice(1))},HasRepeatTransactions:function(t){return this.invoke("HasRepeatTransactions",[t],this.HasRepeatTransactions.getArguments().slice(1))},HideARDefaultsRecommendation:function(){return this.invoke("HideARDefaultsRecommendation",[],this.HideARDefaultsRecommendation.getArguments())},HideBillDotComBanner:function(t){return this.invoke("HideBillDotComBanner",[t],this.HideBillDotComBanner.getArguments().slice(1))},HideGettingStarted:function(t){return this.invoke("HideGettingStarted",[t],this.HideGettingStarted.getArguments().slice(1))},HideInvoiceReminderTout:function(t){return this.invoke("HideInvoiceReminderTout",[t],this.HideInvoiceReminderTout.getArguments().slice(1))},HideUnreconcileWarning:function(){return this.invoke("HideUnreconcileWarning",[],this.HideUnreconcileWarning.getArguments())},ImportFile:function(t,e,n,i){return this.invoke("ImportFile",[t,e,n,i],this.ImportFile.getArguments().slice(4))},InvoiceSequencingPopup:function(){return this.invoke("InvoiceSequencingPopup",[],this.InvoiceSequencingPopup.getArguments())},IsChequeNumberInUse:function(t,e,n){return this.invoke("IsChequeNumberInUse",[t,e,n],this.IsChequeNumberInUse.getArguments().slice(3))},IsContactMergedHtml:function(t){return this.invoke("IsContactMergedHtml",[t],this.IsContactMergedHtml.getArguments().slice(1))},IsEligibleForAddLastItems:function(t,e){return this.invoke("IsEligibleForAddLastItems",[t,e],this.IsEligibleForAddLastItems.getArguments().slice(2))},IsOrgLimitReached:function(t,e){return this.invoke("IsOrgLimitReached",[t,e],this.IsOrgLimitReached.getArguments().slice(2))},LoadOrganisationSalesTaxSettings:function(){return this.invoke("LoadOrganisationSalesTaxSettings",[],this.LoadOrganisationSalesTaxSettings.getArguments())},Login:function(t,e){return this.invoke("Login",[t,e],this.Login.getArguments().slice(2))},LogIssue:function(t,e,n){return this.invoke("LogIssue",[t,e,n],this.LogIssue.getArguments().slice(3))},LogIssueWithFeeling:function(t,e){return this.invoke("LogIssueWithFeeling",[t,e],this.LogIssueWithFeeling.getArguments().slice(2))},MarkStatementLineAsDuplicate:function(t,e,n){return this.invoke("MarkStatementLineAsDuplicate",[t,e,n],this.MarkStatementLineAsDuplicate.getArguments().slice(3))},MergeContacts:function(t,e){return this.invoke("MergeContacts",[t,e],this.MergeContacts.getArguments().slice(2))},MoveAccounts:function(t,e,n,i,a){return this.invoke("MoveAccounts",[t,e,n,i,a],this.MoveAccounts.getArguments().slice(5))},MoveContacts:function(t,e){return this.invoke("MoveContacts",[t,e],this.MoveContacts.getArguments().slice(2))},OpenEmailWindow_5:function(t,e,n,i,a){return this.invoke("OpenEmailWindow_5",[t,e,n,i,a],this.OpenEmailWindow_5.getArguments().slice(5))},OpenRepeatingInvoiceEmailWindow:function(t,e,n,i,a){return this.invoke("OpenRepeatingInvoiceEmailWindow",[t,e,n,i,a],this.OpenRepeatingInvoiceEmailWindow.getArguments().slice(5))},OpenStatementEmailWindow:function(t,e,n,i,a,o){return this.invoke("OpenStatementEmailWindow",[t,e,n,i,a,o],this.OpenStatementEmailWindow.getArguments().slice(6))},Ping:function(){return this.invoke("Ping",[],this.Ping.getArguments())},PlaceholderPreview:function(t){return this.invoke("PlaceholderPreview",[t],this.PlaceholderPreview.getArguments().slice(1))},PrintCheque:function(t){return this.invoke("PrintCheque",[t],this.PrintCheque.getArguments().slice(1))},PrintCheques:function(t){return this.invoke("PrintCheques",[t],this.PrintCheques.getArguments().slice(1))},PrintDocumentPopupHtml:function(t,e,n){return this.invoke("PrintDocumentPopupHtml",[t,e,n],this.PrintDocumentPopupHtml.getArguments().slice(3))},PrintInvoice:function(t,e){return this.invoke("PrintInvoice",[t,e],this.PrintInvoice.getArguments().slice(2))},PrintInvoices:function(t,e){return this.invoke("PrintInvoices",[t,e],this.PrintInvoices.getArguments().slice(2))},PrintPayslip:function(t,e,n){return this.invoke("PrintPayslip",[t,e,n],this.PrintPayslip.getArguments().slice(3))},PrintPayslips:function(t,e,n){return this.invoke("PrintPayslips",[t,e,n],this.PrintPayslips.getArguments().slice(3))},ReconcileToBatchedTransactions:function(t,e,n){return this.invoke("ReconcileToBatchedTransactions",[t,e,n],this.ReconcileToBatchedTransactions.getArguments().slice(3))},ReconcileToTransaction:function(t,e,n,i,a,o){return this.invoke("ReconcileToTransaction",[t,e,n,i,a,o],this.ReconcileToTransaction.getArguments().slice(6))},ReconcileToTransactions:function(t,e,n,i,a,o,r,s,l){return this.invoke("ReconcileToTransactions",[t,e,n,i,a,o,r,s,l],this.ReconcileToTransactions.getArguments().slice(9))},RefreshMfaFeed:function(t,e){return this.invoke("RefreshMfaFeed",[t,e],this.RefreshMfaFeed.getArguments().slice(2))},RegisterCheque:function(t,e,n){return this.invoke("RegisterCheque",[t,e,n],this.RegisterCheque.getArguments().slice(3))},RegisterCheques:function(t,e){return this.invoke("RegisterCheques",[t,e],this.RegisterCheques.getArguments().slice(2))},RemoveAttachment:function(t){return this.invoke("RemoveAttachment",[t],this.RemoveAttachment.getArguments().slice(1))},RemoveContacts:function(t,e){return this.invoke("RemoveContacts",[t,e],this.RemoveContacts.getArguments().slice(2))},RemoveStatement:function(t,e){return this.invoke("RemoveStatement",[t,e],this.RemoveStatement.getArguments().slice(2))},RenameCategory:function(t,e){return this.invoke("RenameCategory",[t,e],this.RenameCategory.getArguments().slice(2))},RenameItem:function(t,e){return this.invoke("RenameItem",[t,e],this.RenameItem.getArguments().slice(2))},RequestGraceToken:function(t){return this.invoke("RequestGraceToken",[t],this.RequestGraceToken.getArguments().slice(1))},ResendVerificationEmail:function(){return this.invoke("ResendVerificationEmail",[],this.ResendVerificationEmail.getArguments())},ResetOrganisationCurrencyRates:function(t,e,n,i,a){return this.invoke("ResetOrganisationCurrencyRates",[t,e,n,i,a],this.ResetOrganisationCurrencyRates.getArguments().slice(5))},RestoreContacts:function(t){return this.invoke("RestoreContacts",[t],this.RestoreContacts.getArguments().slice(1))},RestoreStatementLines:function(t,e){return this.invoke("RestoreStatementLines",[t,e],this.RestoreStatementLines.getArguments().slice(2))},RestoreTracking:function(t,e,n,i,a){return this.invoke("RestoreTracking",[t,e,n,i,a],this.RestoreTracking.getArguments().slice(5))},SaveAccount:function(t,e){return this.invoke("SaveAccount",[t,e],this.SaveAccount.getArguments().slice(2))},SaveAccount:function(t,e,n){return this.invoke("SaveAccount",[t,e,n],this.SaveAccount.getArguments().slice(3))},SaveAddress:function(t,e,n,i,a,o,r,s){return this.invoke("SaveAddress",[t,e,n,i,a,o,r,s],this.SaveAddress.getArguments().slice(8))},SaveAddress:function(t,e,n,i,a,o,r,s,l,u,c){return this.invoke("SaveAddress",[t,e,n,i,a,o,r,s,l,u,c],this.SaveAddress.getArguments().slice(11))},SaveAndActivateBankFeed:function(t,e){return this.invoke("SaveAndActivateBankFeed",[t,e],this.SaveAndActivateBankFeed.getArguments().slice(2))},SaveBankAccount:function(t,e,n){return this.invoke("SaveBankAccount",[t,e,n],this.SaveBankAccount.getArguments().slice(3))},SaveBankAccountsOrder:function(t){return this.invoke("SaveBankAccountsOrder",[t],this.SaveBankAccountsOrder.getArguments().slice(1))},SaveBankRulePayment:function(t,e,n,i,a,o,r){return this.invoke("SaveBankRulePayment",[t,e,n,i,a,o,r],this.SaveBankRulePayment.getArguments().slice(7))},SaveBankRuleTransfer:function(t,e,n,i,a,o,r){return this.invoke("SaveBankRuleTransfer",[t,e,n,i,a,o,r],this.SaveBankRuleTransfer.getArguments().slice(7))},SaveBudget:function(t,e,n){return this.invoke("SaveBudget",[t,e,n],this.SaveBudget.getArguments().slice(3))},SaveBudgetTracking:function(t,e){return this.invoke("SaveBudgetTracking",[t,e],this.SaveBudgetTracking.getArguments().slice(2))},SaveBulkExchangeRates:function(t,e){return this.invoke("SaveBulkExchangeRates",[t,e],this.SaveBulkExchangeRates.getArguments().slice(2))},SaveCheque:function(t,e,n){return this.invoke("SaveCheque",[t,e,n],this.SaveCheque.getArguments().slice(3))},SaveChequeAddress:function(t,e,n,i,a,o,r,s,l,u,c){return this.invoke("SaveChequeAddress",[t,e,n,i,a,o,r,s,l,u,c],this.SaveChequeAddress.getArguments().slice(11))},SaveChequeTemplate:function(t,e){return this.invoke("SaveChequeTemplate",[t,e],this.SaveChequeTemplate.getArguments().slice(2))},SaveContactGroup:function(t){return this.invoke("SaveContactGroup",[t],this.SaveContactGroup.getArguments().slice(1))},SaveContacts:function(t,e,n,i,a,o){return this.invoke("SaveContacts",[t,e,n,i,a,o],this.SaveContacts.getArguments().slice(6))},SaveCurrencySubscription_2:function(t,e){return this.invoke("SaveCurrencySubscription_2",[t,e],this.SaveCurrencySubscription_2.getArguments().slice(2))},SaveCurrencySubscription_3:function(t,e,n){return this.invoke("SaveCurrencySubscription_3",[t,e,n],this.SaveCurrencySubscription_3.getArguments().slice(3))},SaveDefaultToTodaySetting:function(t){return this.invoke("SaveDefaultToTodaySetting",[t],this.SaveDefaultToTodaySetting.getArguments().slice(1))},SaveDraftPayRun:function(t,e){return this.invoke("SaveDraftPayRun",[t,e],this.SaveDraftPayRun.getArguments().slice(2))},SaveDraftPayslip:function(t,e){return this.invoke("SaveDraftPayslip",[t,e],this.SaveDraftPayslip.getArguments().slice(2))},SaveEmployee:function(t,e){return this.invoke("SaveEmployee",[t,e],this.SaveEmployee.getArguments().slice(2))},SaveEmployeeStatuses:function(t){return this.invoke("SaveEmployeeStatuses",[t],this.SaveEmployeeStatuses.getArguments().slice(1))},SaveExchangeRate:function(t,e,n,i,a,o,r,s,l){return this.invoke("SaveExchangeRate",[t,e,n,i,a,o,r,s,l],this.SaveExchangeRate.getArguments().slice(9))},SaveFastPayment:function(t,e,n,i,a,o,r,s,l,u,c,d,h,f){return this.invoke("SaveFastPayment",[t,e,n,i,a,o,r,s,l,u,c,d,h,f],this.SaveFastPayment.getArguments().slice(14))},SaveFastTransfer:function(t,e,n,i,a,o,r,s,l){return this.invoke("SaveFastTransfer",[t,e,n,i,a,o,r,s,l],this.SaveFastTransfer.getArguments().slice(9))},SaveFollowUpPanel:function(t,e,n){return this.invoke("SaveFollowUpPanel",[t,e,n],this.SaveFollowUpPanel.getArguments().slice(3))},SaveGettingStarted:function(t){return this.invoke("SaveGettingStarted",[t],this.SaveGettingStarted.getArguments().slice(1))},SaveLayoutAsFavourite:function(t,e){return this.invoke("SaveLayoutAsFavourite",[t,e],this.SaveLayoutAsFavourite.getArguments().slice(2))},SaveManyFollowUpPanel:function(t,e,n){return this.invoke("SaveManyFollowUpPanel",[t,e,n],this.SaveManyFollowUpPanel.getArguments().slice(3))},SaveNewCategory:function(t,e){return this.invoke("SaveNewCategory",[t,e],this.SaveNewCategory.getArguments().slice(2))},SaveNewRuleOrder:function(t){return this.invoke("SaveNewRuleOrder",[t],this.SaveNewRuleOrder.getArguments().slice(1))},SaveNote:function(t,e){return this.invoke("SaveNote",[t,e],this.SaveNote.getArguments().slice(2))},SaveNoteWithType:function(t,e,n){return this.invoke("SaveNoteWithType",[t,e,n],this.SaveNoteWithType.getArguments().slice(3))},SavePayItem:function(t,e,n){return this.invoke("SavePayItem",[t,e,n],this.SavePayItem.getArguments().slice(3))},SavePayment:function(t,e,n,i){return this.invoke("SavePayment",[t,e,n,i],this.SavePayment.getArguments().slice(4))},SavePaymentServicePayment:function(t,e,n,i){return this.invoke("SavePaymentServicePayment",[t,e,n,i],this.SavePaymentServicePayment.getArguments().slice(4))},SavePriceListItem:function(t,e,n,i){return this.invoke("SavePriceListItem",[t,e,n,i],this.SavePriceListItem.getArguments().slice(4))},SaveQuickBankTransaction:function(t,e,n){return this.invoke("SaveQuickBankTransaction",[t,e,n],this.SaveQuickBankTransaction.getArguments().slice(3))},SaveReportField:function(t){return this.invoke("SaveReportField",[t],this.SaveReportField.getArguments().slice(1))},SaveReportLayout:function(t,e){return this.invoke("SaveReportLayout",[t,e],this.SaveReportLayout.getArguments().slice(2))},SaveSalesTaxLookupContactAddress:function(t){return this.invoke("SaveSalesTaxLookupContactAddress",[t],this.SaveSalesTaxLookupContactAddress.getArguments().slice(1))},SaveSalesTaxLookupSettings:function(t){return this.invoke("SaveSalesTaxLookupSettings",[t],this.SaveSalesTaxLookupSettings.getArguments().slice(1))},SaveTaxRate:function(t,e){return this.invoke("SaveTaxRate",[t,e],this.SaveTaxRate.getArguments().slice(2))},SaveTrackingItem:function(t,e,n,i,a){return this.invoke("SaveTrackingItem",[t,e,n,i,a],this.SaveTrackingItem.getArguments().slice(5))},SendEmails_7:function(t,e,n,i,a,o,r){return this.invoke("SendEmails_7",[t,e,n,i,a,o,r],this.SendEmails_7.getArguments().slice(7))},SendEmails_8:function(t,e,n,i,a,o,r,s){return this.invoke("SendEmails_8",[t,e,n,i,a,o,r,s],this.SendEmails_8.getArguments().slice(8))},SendReviewRequest:function(t,e){return this.invoke("SendReviewRequest",[t,e],this.SendReviewRequest.getArguments().slice(2))},SetAccountMemorisationVisibility:function(t,e,n){return this.invoke("SetAccountMemorisationVisibility",[t,e,n],this.SetAccountMemorisationVisibility.getArguments().slice(3))},SetApprovedPOsToBilled:function(t){return this.invoke("SetApprovedPOsToBilled",[t],this.SetApprovedPOsToBilled.getArguments().slice(1))},SetExchangeRateToCurrencyProvider:function(t,e,n){return this.invoke("SetExchangeRateToCurrencyProvider",[t,e,n],this.SetExchangeRateToCurrencyProvider.getArguments().slice(3))},SetShowGstAdjustments:function(t){return this.invoke("SetShowGstAdjustments",[t],this.SetShowGstAdjustments.getArguments().slice(1))},SetShowTaxNumberOnPayslips:function(t){return this.invoke("SetShowTaxNumberOnPayslips",[t],this.SetShowTaxNumberOnPayslips.getArguments().slice(1))},SetUserFeeling:function(t){return this.invoke("SetUserFeeling",[t],this.SetUserFeeling.getArguments().slice(1))},ShowBulkEmailDialog:function(t){return this.invoke("ShowBulkEmailDialog",[t],this.ShowBulkEmailDialog.getArguments().slice(1))},ShowChooseLayoutPopup:function(t,e,n,i){return this.invoke("ShowChooseLayoutPopup",[t,e,n,i],this.ShowChooseLayoutPopup.getArguments().slice(4))},ShowOnDashboard:function(t){return this.invoke("ShowOnDashboard",[t],this.ShowOnDashboard.getArguments().slice(1))},ShowSingleEmailDialog:function(t){return this.invoke("ShowSingleEmailDialog",[t],this.ShowSingleEmailDialog.getArguments().slice(1))},ShowSingleEmailDialog:function(t,e){return this.invoke("ShowSingleEmailDialog",[t,e],this.ShowSingleEmailDialog.getArguments().slice(2))},StartPaymentAdviceBatchPrintJob:function(t,e,n,i){return this.invoke("StartPaymentAdviceBatchPrintJob",[t,e,n,i],this.StartPaymentAdviceBatchPrintJob.getArguments().slice(4))},StartPaymentAdvicePrintJob:function(t,e,n){return this.invoke("StartPaymentAdvicePrintJob",[t,e,n],this.StartPaymentAdvicePrintJob.getArguments().slice(3))},StartRemittancePrintJob:function(t,e,n,i){return this.invoke("StartRemittancePrintJob",[t,e,n,i],this.StartRemittancePrintJob.getArguments().slice(4))},StartStatementPrintJob:function(t,e,n,i,a){return this.invoke("StartStatementPrintJob",[t,e,n,i,a],this.StartStatementPrintJob.getArguments().slice(5))},StatementLineDetails:function(t){return this.invoke("StatementLineDetails",[t],this.StatementLineDetails.getArguments().slice(1))},SubmitBulkEmailDialog:function(t){return this.invoke("SubmitBulkEmailDialog",[t],this.SubmitBulkEmailDialog.getArguments().slice(1))},SubmitSingleEmailDialog:function(t){return this.invoke("SubmitSingleEmailDialog",[t],this.SubmitSingleEmailDialog.getArguments().slice(1))},SubmitSingleEmailPaymentAdviceDialog:function(t,e){return this.invoke("SubmitSingleEmailPaymentAdviceDialog",[t,e],this.SubmitSingleEmailPaymentAdviceDialog.getArguments().slice(2))},SwitchMultiCurrencyOn:function(){return this.invoke("SwitchMultiCurrencyOn",[],this.SwitchMultiCurrencyOn.getArguments())},SwitchOrganisation:function(t){return this.invoke("SwitchOrganisation",[t],this.SwitchOrganisation.getArguments().slice(1))},SynchronizeWithFreshBooks:function(){return this.invoke("SynchronizeWithFreshBooks",[],this.SynchronizeWithFreshBooks.getArguments())},TemplateChoicePopUp:function(t,e,n,i,a){return this.invoke("TemplateChoicePopUp",[t,e,n,i,a],this.TemplateChoicePopUp.getArguments().slice(5))},TemplateChoicePopUpForEmail:function(t,e,n,i,a){return this.invoke("TemplateChoicePopUpForEmail",[t,e,n,i,a],this.TemplateChoicePopUpForEmail.getArguments().slice(5))},TemplateDocxPropertiesPopup:function(t){return this.invoke("TemplateDocxPropertiesPopup",[t],this.TemplateDocxPropertiesPopup.getArguments().slice(1))},TemplatePropertiesPopup:function(t,e){return this.invoke("TemplatePropertiesPopup",[t,e],this.TemplatePropertiesPopup.getArguments().slice(2))},ToggleShowMarkAsReconciledButton:function(t){return this.invoke("ToggleShowMarkAsReconciledButton",[t],this.ToggleShowMarkAsReconciledButton.getArguments().slice(1))},TrackLoginError:function(t){return this.invoke("TrackLoginError",[t],this.TrackLoginError.getArguments().slice(1))},Transfer:function(t,e,n,i){return this.invoke("Transfer",[t,e,n,i],this.Transfer.getArguments().slice(4))},UnMarkAsSent:function(t){return this.invoke("UnMarkAsSent",[t],this.UnMarkAsSent.getArguments().slice(1))},UnreconcileTransaction:function(t,e){return this.invoke("UnreconcileTransaction",[t,e],this.UnreconcileTransaction.getArguments().slice(2))},UpdateEmailInInvoiceMessageSettings:function(t,e){return this.invoke("UpdateEmailInInvoiceMessageSettings",[t,e],this.UpdateEmailInInvoiceMessageSettings.getArguments().slice(2))},UpdateFeedLogin:function(t,e){return this.invoke("UpdateFeedLogin",[t,e],this.UpdateFeedLogin.getArguments().slice(2))},UpdateFreetext:function(t,e,n,i){return this.invoke("UpdateFreetext",[t,e,n,i],this.UpdateFreetext.getArguments().slice(4))},FetchInvoiceMessageRecipients:function(t,e){return this.invoke("FetchInvoiceMessageRecipients",[t,e],this.FetchInvoiceMessageRecipients.getArguments().slice(2))},UpdateInvoices:function(t){return this.invoke("UpdateInvoices",[t],this.UpdateInvoices.getArguments().slice(1))},UpdateMapping:function(t,e,n,i){return this.invoke("UpdateMapping",[t,e,n,i],this.UpdateMapping.getArguments().slice(4))},UpdateNote:function(t,e,n){return this.invoke("UpdateNote",[t,e,n],this.UpdateNote.getArguments().slice(3))},UpdatePdfPreferencesForPractice:function(t,e){return this.invoke("UpdatePdfPreferencesForPractice",[t,e],this.UpdatePdfPreferencesForPractice.getArguments().slice(2))},UpdateReportSettings:function(t,e){return this.invoke("UpdateReportSettings",[t,e],this.UpdateReportSettings.getArguments().slice(2))},UpdateSectionsVisibility:function(t,e,n){return this.invoke("UpdateSectionsVisibility",[t,e,n],this.UpdateSectionsVisibility.getArguments().slice(3))},UpdateSectionVisibility:function(t,e,n){return this.invoke("UpdateSectionVisibility",[t,e,n],this.UpdateSectionVisibility.getArguments().slice(3))},UpdateSetupWizard:function(t,e){return this.invoke("UpdateSetupWizard",[t,e],this.UpdateSetupWizard.getArguments().slice(2))},UpdateThemeOrder:function(t){return this.invoke("UpdateThemeOrder",[t],this.UpdateThemeOrder.getArguments().slice(1))},UploadEmailLogoPopup:function(t){return this.invoke("UploadEmailLogoPopup",[t],this.UploadEmailLogoPopup.getArguments().slice(1))},UploadLogoPopup:function(t){return this.invoke("UploadLogoPopup",[t],this.UploadLogoPopup.getArguments().slice(1))},ValidateAccountNumber:function(t,e){return this.invoke("ValidateAccountNumber",[t,e],this.ValidateAccountNumber.getArguments().slice(2))},ValidateDuplicateForm:function(t){return this.invoke("ValidateDuplicateForm",[t],this.ValidateDuplicateForm.getArguments().slice(1))},ValidateInvoice:function(t,e){return this.invoke("ValidateInvoice",[t,e],this.ValidateInvoice.getArguments().slice(2))},ValidateInvoiceNumberForm:function(t){return this.invoke("ValidateInvoiceNumberForm",[t],this.ValidateInvoiceNumberForm.getArguments().slice(1))},ValidatePropertyForm:function(t){return this.invoke("ValidatePropertyForm",[t],this.ValidatePropertyForm.getArguments().slice(1))},ValidateTemplateName:function(t){return this.invoke("ValidateTemplateName",[t],this.ValidateTemplateName.getArguments().slice(1))},url:""})),Ajax=new Ajax_class},function(t,e){window.notifications=null,window.notificationsPlugins=[],Ext.onReady(function(){Ext.ns("Notifications"),Notifications.Core=Ext.extend(Ext.Component,{initComponent:function(){Notifications.Core.superclass.initComponent.apply(this,arguments),this.ajax=new Notifications.Ajax},pollForMessageTask:null,pollForMessage:function(t,e,n,i){this.pollForMessageTask&&Ext.TaskMgr.stop(this.pollForMessageTask),this.pollForMessageTask={run:function(t,e,n){this.ajax.findInboxMessage(t,e,{callback:function(t){t.InboxMessage&&(Ext.TaskMgr.stop(this.pollForMessageTask),n(t))},scope:this})},interval:n,scope:this,args:[t,e,i]},Ext.TaskMgr.start(this.pollForMessageTask)},pollForMessageByTypeTask:[],pollForMessageByType:function(t,e,n,i,a){this.pollForMessageByTypeTask[t]&&Ext.TaskMgr.stop(this.pollForMessageByTypeTask[t]),this.pollForMessageByTypeTask[t]={run:function(e,n,i){this.ajax.findInboxMessageByNotificationType(e,n,{callback:function(e){e.InboxMessage&&(Ext.TaskMgr.stop(this.pollForMessageByTypeTask[t]),i(e))},scope:this})},interval:i,scope:this,args:[e,n,a]},Ext.TaskMgr.start(this.pollForMessageByTypeTask[t])},formatDate:function(t){return t.format("d M Y")},formatDateTime:function(t){return t.format("d M Y \\a\\t g:i A")},formatFriendlyDate:function(t){var e=new Date-t,n=Math.floor(e/864e5);if(n<5){if(n>=1)return n+" day"+(n>1?"s":"")+" ago";var i=Math.floor(e%864e5/36e5);if(i>=1)return i+" hour"+(i>1?"s":"")+" ago";var a=Math.floor(e%864e5%36e5/6e4);return a>=1?a+" minute"+(a>1?"s":"")+" ago":"Just now"}return this.formatDate(t)}}),Notifications.Ajax=Ext.extend(Ext.Component,{request:function(t){var e=t.callback.createDelegate(t.scope),n=t.params?{data:Ext.util.JSON.encode(t.params)}:null;t.scope.close&&t.scope.close(),Ext.Ajax.request({url:t.url,params:n,method:t.method,success:function(t){var n=Ext.util.JSON.decode(t.responseText);!n||n.Failed||e(n)},scope:t.scope,timeout:t.timeout})},applyCfg:function(t,e){return Ext.applyIf(t||{},Ext.applyIf(e||{},{callback:Ext.emptyFn,method:"POST",timeout:65e3,scope:this}))},getInboxMessage:function(t,e){this.request(this.applyCfg({url:"/notifications/getinboxmessage",params:{notificationId:t}},e))},findInboxMessage:function(t,e,n){this.request(this.applyCfg({url:"/notifications/findinboxmessage",params:{name:t,value:e}},n))},findInboxMessageByNotificationType:function(t,e,n){this.request(this.applyCfg({url:"/notifications/findinboxmessagebynotificationtype",params:{name:t,value:e}},n))},markInboxMessageAsRead:function(t,e){this.request(this.applyCfg({url:"/notifications/markinboxmessageasread",params:{notificationId:t}},e))}}),Notifications.UI=Ext.extend(Ext.Component,{currentUnreadCount:0,constructor:function(t){var e={ajax:null,interval:3e4};Ext.apply(e,t),Notifications.UI.superclass.constructor.call(this,e),notifications.addEvents("bannersloaded")},initComponent:function(){Notifications.UI.superclass.initComponent.apply(this,arguments),this.host={isXeroV1:Ext.getBody().hasClass("xeroV1"),isXeroV2:Ext.getBody().hasClass("xeroV2")},this.initPlugins(),this.initBanner()},initPlugins:function(){for(var t=0;t<notificationsPlugins.length;t++)new notificationsPlugins[t].plugin(notificationsPlugins[t].cfg)},initBanner:function(){if(this.host.isXeroV1){var t=Ext.select("div.AllPagePadding").first();if(!t)return;Ext.DomHelper.insertHtml("afterBegin",t.dom,'<div id="xn_banner"></div>')}else{if(!this.host.isXeroV2)return;var t=Ext.get("dashboardPrompts")||Ext.select("div.document h1").first();if(!t)return;Ext.DomHelper.insertHtml("afterEnd",t.dom,'<div id="xn_banner"></div>')}this.bannerEl=Ext.get("xn_banner"),this.uiBanner=new Notifications.UI.PageBanner({applyTo:this.bannerEl})}}),Notifications.UI.Banner=Ext.extend(Ext.BoxComponent,{initComponent:function(){Notifications.UI.Banner.superclass.initComponent.apply(this,arguments),notifications.on("bannersloaded",this.bannersLoadedHandler,this)},initEvents:function(t){this.el.select("a").each(function(t){"#inbox"==t.dom.hash&&t.on("click",function(t,e){notifications.ui.uiPopup.show(e,"inbox")},this,{preventDefault:!0}),"#message"==t.dom.hash&&t.on("click",function(t,e){for(var n=e.parentNode,i=null;null==i||"xn_banner"!=n.id;)n.id.indexOf("_banner_")>-1&&(i=n.id.slice(-36)),n=n.parentNode;notifications.ui.uiPopup.show(e,"message",{id:i})},this,{preventDefault:!0})})},bannersLoadedHandler:function(t,e){this.ajax=t.ajax,this.data=e,this.render()},render:function(t,e){this.data&&Notifications.UI.Banner.superclass.render.call(this,t,e)},afterRender:function(t){"3.0.3"==Ext.version&&this.tpl&&(this.tpl.compile||(this.tpl=new Ext.XTemplate(this.tpl)),this.data&&(this.el.update(this.tpl.apply(this.data)),delete this.data)),Notifications.UI.Banner.superclass.afterRender.call(this),this.initEvents(t)}}),Notifications.UI.PageBanner=Ext.extend(Notifications.UI.Banner,{tplText:'<div class="xn_placeHolder">&nbsp;</div><div id="xn_bannerInner"><tpl for="Banners"><tpl if="NotificationLevel &lt; 10"><div id="xn_banner_{NotificationId}" class="xn_bannerContent"><tpl if="Host.isXeroV1"><tpl exec="values.BannerType = values.IsUrgent ? \'errors\' : values.IsWarning ? \'tips\' : values.IsConfirmation ? \'confirmations\' : \'informations\'"></tpl><div class="message widest {BannerType}"><div class="image-icon">&nbsp;</div><tpl if="IsClosableByUser"><div class="close">&nbsp;</div></tpl><tpl if="!IsClosableByUser"><div class="xn_xv1pad">&nbsp;</div></tpl><div class="xn_xv1container">{Message}</div><div class="smallspace">&nbsp;</div></div><div class="shade widest" id="wholemsgshadow">&nbsp;</div></tpl><tpl if="Host.isXeroV2"><tpl exec="values.BannerType = values.IsUrgent ? \'bg-red\' : values.IsWarning ? \'bg-orange\' : values.IsConfirmation ? \'bg-green\' : \'bg-blue\'"></tpl><div class="notify {BannerType} bigger"><em></em><tpl if="IsClosableByUser"><a href="#" class="icons msg-close"></a></tpl><div class="message">{Message}</div></div><div class="shadow"></div></tpl></div></tpl></tpl></div>',constructor:function(t){var e={tpl:new Ext.XTemplate(this.tplText).compile()};Ext.apply(e,t),Notifications.UI.PageBanner.superclass.constructor.call(this,e)},initComponent:function(){Notifications.UI.PageBanner.superclass.initComponent.apply(this,arguments),this.isIE7XeroV1=Ext.isIE7&&Ext.getBody().hasClass("xeroV1")},initEvents:function(t){Notifications.UI.PageBanner.superclass.initEvents.apply(this,arguments),this.el.on("click",this.closeBannerHandler,this,{delegate:"a.msg-close",preventDefault:!0}),this.el.on("click",this.closeBannerHandler,this,{delegate:"div.close",preventDefault:!0})},afterRender:function(t){Notifications.UI.PageBanner.superclass.afterRender.call(this);var e=Ext.fly("xn_bannerInner").getHeight();this.isIE7XeroV1&&12==e&&(e=0),Ext.fly("xn_banner").setHeight(e,{easing:"easeOutStrong",duration:.35,callback:function(){var t=Ext.fly("xn_bannerInner");this.isIE7XeroV1||t.setStyle("position","static"),t.show({easing:"easeOutStrong",duration:.35,callback:function(){this.isIE7XeroV1?Ext.fly("xn_banner").setHeight(e):Ext.fly("xn_banner").setHeight("auto")},scope:this})},scope:this})},closeBannerHandler:function(t,e){var n=Ext.fly(e).parent().parent();this.ajax.markBannerAsRead(n.id.replace("xn_banner_",""));var i=Ext.fly("xn_banner").getHeight()-n.getHeight();n.hide({easing:"easeOutStrong",duration:.35,callback:function(){n.setHeight(0,{duration:.35,callback:function(){n.remove()}}),this.isIE7XeroV1&&Ext.fly("xn_banner").setHeight(i,{duration:.35})},scope:this})}}),notifications=new Notifications.Core,notifications.ui=new Notifications.UI})},function(t,e){XERO.Contacts={clicked:null,cache:new Ext.util.MixedCollection,toggle:function(){switch(this.clicked){case"person":elm=this.cache.get("person"),elm.opened?(this.cache.get("finances").hide(),this.cache.containsKey("employee")&&this.cache.get("employee").hide()):2==XERO.Contacts.cache.items.length&&this.cache.get("finances").show();break;case"finances":elm=this.cache.get("finances"),elm.opened?(this.cache.get("person").hide(),this.cache.containsKey("employee")&&this.cache.get("employee").hide()):2==XERO.Contacts.cache.items.length&&this.cache.get("person").show();break;case"employee":elm=this.cache.get("employee"),elm.opened&&(this.cache.get("person").hide(),this.cache.get("finances").hide())}},remove:function(t){this.window=XERO.MsgBox.createAjax("__delete",{title:"Merge Contact",html:null,modal:!0,width:385}),res=Ajax.GetDeleteAndMoveContactHtml(t),res.value&&(this.window.setHtml(res.value),this.window.center())},merge:function(t,e,n){msg=Ext.fly("error"),e&&n&&""!=e&&""!=n?e==t?(msg.child("p").update("That's the same contact, please choose another"),msg.show()):SubmitAction("DeleteAndMergeContact",t+"|"+e):(msg.child("p").update("Please choose a contact"),msg.show())},updateMerge:function(t,e,n){Ext.fly("MergeToContactID").dom.value=n.key},CheckRepeatingInvoicesEmails:function(t){if(this.EmailAddressUpdated()&&Ext.get("OldContactID")&&Ext.get("Name")){var e=this.GetNewChangedEmails(),n=Ext.get("OldContactID").dom.value,i=Ext.get("Name").dom.value,a=Ajax.EmailCountInInvoiceMessageSettings(n).value;if(a&&a.IsValid&&a.Result>0){var o=e.every(function(t){return""===t}),r=Ext.String.format("<p><strong>Would you like to apply these changes to the {0} repeating invoice{1} for {2}?</strong></p>",a.Result,1==a.Result?"":"s",i),s=Ext.String.format("<ul style='list-style:disc;margin-left: 15px;margin-top: 10px;word-wrap: break-word;'><li>Update recipients to: {0}</li>",e.join(",")),l=r+(o?"<ul style='list-style:disc;margin-left: 15px;margin-top: 10px;'><li>Remove recipients from all repeating invoices</li><li>Repeating invoices will be saved as draft and not sent</li></ul></p>":s);return XERO.MsgBox.confirm(l,"Update repeating invoices",null,"Yes, update all",function(i,a){Ajax.UpdateEmailInInvoiceMessageSettings(n,e),SubmitAction(t)},"No, leave as is",function(e,n){SubmitAction(t)},null,null,{close:function(){XERO.widget.Buttons.enable(),XERO.widget.Menus.enable()}},600),!1}}SubmitAction(t)},isEmailChanged:function(t){return t.value!==t.getAttribute("value")},hasNotBeenDeleted:function(t){return"DELETED"!==Ext.get("Status_"+t.id.substring("SecondaryEmailAddress_".length)).dom.value},hasIncludeInEmailsChecked:function(t){return!0===Ext.query("input[id ^= "+t.id.replace("SecondaryEmailAddress_","SecondaryInclude_")+"]")[0].checked},EmailAddressUpdated:function(){return Ext.select("input[id^=SecondaryEmailAddress_]").elements.filter(this.hasIncludeInEmailsChecked).some(this.isEmailChanged)||Ext.select("#EmailAddress").elements.some(this.isEmailChanged)||Ext.select("[id^=Status_]").elements.some(function(t){return"DELETED"===t.value})||Ext.select("[id^=SecondaryInclude_]").elements.some(function(t){return t.hasAttribute("checked")!==t.checked})},GetValue:function(t){return t.value},GetNewChangedEmails:function(){return Ext.query("#EmailAddress").map(this.GetValue).concat(Ext.query("input[id ^= SecondaryEmailAddress_]").filter(this.hasNotBeenDeleted).filter(this.hasIncludeInEmailsChecked).map(this.GetValue))},validateAccountNumberAction:function(t,e){var n,i;n=t.el.getValue(),i=Ext.fly("OldContactID").getValue(),(n||""===n)&&Ajax.ValidateAccountNumber(i,n,function(n){var i;n.value.IsValid?(i=n.value.Data.getValue("isUnique"),e(null,i,t)):e("result not valid")})}},XERO.Contacts.Record=function(t,e){this.title=Ext.get(t),this.type=e,this.view=this.title.next("div.view"),this.edit=this.title.next("div.edit"),this.edit&&!this.edit.hasClass("hide")?this.editing=!0:this.editing=!1,this.title.hasClass("hide")?this.opened=!1:this.opened=!0,this.title.on("click",this.click,this)},XERO.Contacts.Record.prototype={click:function(t,e){"A"!=e.tagName&&"STRONG"!=e.tagName&&(XERO.Contacts.clicked=this.type,this.opened?this.hide():this.show(),XERO.Contacts.toggle())},show:function(){this.edit?this.edit.removeClass("hide"):this.view.removeClass("hide"),this.title.removeClass("hide"),this.opened=!0},hide:function(){this.edit?this.edit.addClass("hide"):this.view.addClass("hide"),this.title.addClass("hide"),this.opened=!1},toggle:function(){0==this.editing?(this.edit.addClass("hide"),this.view.removeClass("hide"),this.title.addClass("view")):(this.view.addClass("hide"),this.edit.removeClass("hide"),this.title.removeClass("view"),this.editing=!0),this.opened=!0},save:function(){task=new Ext.util.DelayedTask(function(){this.opened=!0,this.editing=!1,XERO.widget.Buttons.enable(),this.toggle()},this),task.delay(1e3)},modify:function(){this.opened=!0,this.editing=!0,this.toggle()}},XERO.Contacts.Address=function(t,e){this.el=Ext.get(t),this.ae=Ext.get(t+"_Address"),this.eme=Ext.get(t+"_EmailAddress"),this.link=this.el.next("a.editAddress"),this.title=e||"Customer's Address",Ext.fly("ContactID")?this.id=Ext.fly("ContactID").dom.value:this.id=this.el.dom.id},XERO.Contacts.Address.prototype={click:function(){XERO.Contacts.clicked=this,XERO.MsgBox.createAjax("__address",{title:this.title,html:null,modal:!0,width:385}),Ajax.GetAddAddressHtml(this.id,this.getAddressCallback)},getAddressCallback:function(t){t.value&&(this.window=Ext.WindowMgr.getActive(),this.window.setHtml(t.value),this.window.center())},save:function(){task=new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()},this),task.delay(200),this.getData(),res=Ajax.SaveAddress(this.id,this.EmailAddress,this.AttentionTo,this.address,this.city,this.region,this.postcode,this.country,this.latitude,this.longitude,this.plusfour),result=res.value,result&&(result.IsValid?(Windows.closeAll(),this.setData(result)):Ext.WindowMgr.getActive().setHtml(result.Result))},getData:function(){this.id=Ext.fly("contactID").getValue(),this.EmailAddress=Ext.fly("POEmailAddress").getValue(),this.AttentionTo=Ext.fly("POAttentionTo").getValue(),this.address=Ext.fly("POAddress").getValue(),this.city=Ext.fly("POCity").getValue(),this.region=Ext.fly("PORegion").getValue(),this.postcode=Ext.fly("POPostalCode").getValue(),this.country=Ext.fly("POCountry").getValue(),this.latitude=this.getIfExists(Ext.fly("POLatitude")),this.longitude=this.getIfExists(Ext.fly("POLongitude")),this.plusfour=this.getIfExists(Ext.fly("POPlusFour"))},getIfExists:function(t){return t?t.getValue():null},setData:function(t){if(this.link)if(null==t.Result||""==t.Result)this.el.update("No address"),this.link.update("Add address");else{this.el.update(t.Result),this.link.update("Edit address");try{this.eme.update(t.Data.getValue("EmailAddress"))}catch(t){}}else{this.eme.update(t.Data.getValue("EmailAddress"));var e=t.Data.getValue("StatementsAddress");this.ae.update(e||"Add address"),e?$(this.ae.id).setAttribute("style","color:black;text-decoration:none;"):$(this.ae.id).removeAttribute("style")}}}},function(t,e){!function(){function t(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function e(t){return null!=t&&!isNaN(t)}function n(t){return{left:function(e,n,i,a){for(arguments.length<3&&(i=0),arguments.length<4&&(a=e.length);i<a;){var o=i+a>>>1;t(e[o],n)<0?i=o+1:a=o}return i},right:function(e,n,i,a){for(arguments.length<3&&(i=0),arguments.length<4&&(a=e.length);i<a;){var o=i+a>>>1;t(e[o],n)>0?a=o:i=o+1}return i}}}function i(t){return t.length}function a(t){for(var e=1;t*e%1;)e*=10;return e}function o(t,e){try{for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}catch(n){t.prototype=e}}function r(){}function s(t){return lr+t in this}function l(t){return(t=lr+t)in this&&delete this[t]}function u(){var t=[];return this.forEach(function(e){t.push(e)}),t}function c(){var t=0;for(var e in this)e.charCodeAt(0)===ur&&++t;return t}function d(){for(var t in this)if(t.charCodeAt(0)===ur)return!1;return!0}function h(){}function f(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function p(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.substring(1);for(var n=0,i=cr.length;n<i;++n){var a=cr[n]+e;if(a in t)return a}}function m(){}function g(){}function v(t){function e(){for(var e,i=n,a=-1,o=i.length;++a<o;)(e=i[a].on)&&e.apply(this,arguments);return t}var n=[],i=new r;return e.on=function(e,a){var o,r=i.get(e);return arguments.length<2?r&&r.on:(r&&(r.on=null,n=n.slice(0,o=n.indexOf(r)).concat(n.slice(o+1)),i.remove(e)),a&&n.push(i.set(e,{on:a})),t)},e}function y(){Yo.event.preventDefault()}function E(){for(var t,e=Yo.event;t=e.sourceEvent;)e=t;return e}function x(t){for(var e=new g,n=0,i=arguments.length;++n<i;)e[arguments[n]]=v(e);return e.of=function(n,i){return function(a){try{var o=a.sourceEvent=Yo.event;a.target=t,Yo.event=a,e[a.type].apply(n,i)}finally{Yo.event=o}}},e}function w(t){return hr(t,vr),t}function b(t){return"function"==typeof t?t:function(){return fr(t,this)}}function C(t){return"function"==typeof t?t:function(){return pr(t,this)}}function A(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function a(){this.setAttribute(t,e)}function o(){this.setAttributeNS(t.space,t.local,e)}function r(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=Yo.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?s:r:t.local?o:a}function k(t){return t.trim().replace(/\s+/g," ")}function T(t){return new RegExp("(?:^|\\s+)"+Yo.requote(t)+"(?:\\s+|$)","g")}function R(t){return t.trim().split(/^|\s+/)}function S(t,e){function n(){for(var n=-1;++n<a;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<a;)t[n](this,i)}t=R(t).map(D);var a=t.length;return"function"==typeof e?i:n}function D(t){var e=T(t);return function(n,i){if(a=n.classList)return i?a.add(t):a.remove(t);var a=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(a)||n.setAttribute("class",k(a+" "+t))):n.setAttribute("class",k(a.replace(e," ")))}}function O(t,e,n){function i(){this.style.removeProperty(t)}function a(){this.style.setProperty(t,e,n)}function o(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?o:a}function M(t,e){function n(){delete this[t]}function i(){this[t]=e}function a(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?a:i}function I(t){return"function"==typeof t?t:(t=Yo.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function _(t){return{__data__:t}}function P(t){return function(){return gr(this,t)}}function F(e){return arguments.length||(e=t),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function N(t,e){for(var n=0,i=t.length;n<i;n++)for(var a,o=t[n],r=0,s=o.length;r<s;r++)(a=o[r])&&e(a,r,n);return t}function L(t){return hr(t,Er),t}function B(t){var e,n;return function(i,a,o){var r,s=t[o].update,l=s.length;for(o!=n&&(n=o,e=0),a>=e&&(e=a+1);!(r=s[e])&&++e<l;);return r}}function H(){var t=this.__transition__;t&&++t.active}function X(t,e,n){function i(){var e=this[r];e&&(this.removeEventListener(t,e,e.$),delete this[r])}function a(){var a=l(e,Jo(arguments));i.call(this),this.addEventListener(t,this[r]=a,a.$=n),a._=e}function o(){var e,n=new RegExp("^__on([^.]+)"+Yo.requote(t)+"$");for(var i in this)if(e=i.match(n)){var a=this[i];this.removeEventListener(e[1],a,a.$),delete this[i]}}var r="__on"+t,s=t.indexOf("."),l=G;s>0&&(t=t.substring(0,s));var u=wr.get(t);return u&&(t=u,l=V),s?e?a:i:e?m:o}function G(t,e){return function(n){var i=Yo.event;Yo.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{Yo.event=i}}}function V(t,e){var n=G(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function U(){var t=".dragsuppress-"+ ++Cr,e="click"+t,n=Yo.select(tr).on("touchmove"+t,y).on("dragstart"+t,y).on("selectstart"+t,y);if(br){var i=Zo.style,a=i[br];i[br]="none"}return function(o){function r(){n.on(e,null)}n.on(t,null),br&&(i[br]=a),o&&(n.on(e,function(){y(),r()},!0),setTimeout(r,0))}}function W(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}function j(){return Yo.event.changedTouches[0].identifier}function z(){return Yo.event.target}function q(){return tr}function $(t){return t>0?1:t<0?-1:0}function Y(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function K(t){return t>1?0:t<-1?Ar:Math.acos(t)}function J(t){return t>1?Tr:t<-1?-Tr:Math.asin(t)}function Q(t){return((t=Math.exp(t))-1/t)/2}function Z(t){return((t=Math.exp(t))+1/t)/2}function tt(t){return((t=Math.exp(2*t))-1)/(t+1)}function et(t){return(t=Math.sin(t/2))*t}function nt(){}function it(t,e,n){return new at(t,e,n)}function at(t,e,n){this.h=t,this.s=e,this.l=n}function ot(t,e,n){function i(t){return t>360?t-=360:t<0&&(t+=360),t<60?o+(r-o)*t/60:t<180?r:t<240?o+(r-o)*(240-t)/60:o}function a(t){return Math.round(255*i(t))}var o,r;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,n=n<0?0:n>1?1:n,r=n<=.5?n*(1+e):n+e-n*e,o=2*n-r,yt(a(t+120),a(t),a(t-120))}function rt(t,e,n){return new st(t,e,n)}function st(t,e,n){this.h=t,this.c=e,this.l=n}function lt(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),ut(n,Math.cos(t*=Dr)*e,Math.sin(t)*e)}function ut(t,e,n){return new ct(t,e,n)}function ct(t,e,n){this.l=t,this.a=e,this.b=n}function dt(t,e,n){var i=(t+16)/116,a=i+e/500,o=i-n/200;return a=ft(a)*Hr,i=ft(i)*Xr,o=ft(o)*Gr,yt(mt(3.2404542*a-1.5371385*i-.4985314*o),mt(-.969266*a+1.8760108*i+.041556*o),mt(.0556434*a-.2040259*i+1.0572252*o))}function ht(t,e,n){return t>0?rt(Math.atan2(n,e)*Or,Math.sqrt(e*e+n*n),t):rt(NaN,NaN,t)}function ft(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function pt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function mt(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function gt(t){return yt(t>>16,t>>8&255,255&t)}function vt(t){return gt(t)+""}function yt(t,e,n){return new Et(t,e,n)}function Et(t,e,n){this.r=t,this.g=e,this.b=n}function xt(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function wt(t,e,n){var i,a,o,r=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(t))switch(a=i[2].split(","),i[1]){case"hsl":return n(parseFloat(a[0]),parseFloat(a[1])/100,parseFloat(a[2])/100);case"rgb":return e(kt(a[0]),kt(a[1]),kt(a[2]))}return(o=Wr.get(t))?e(o.r,o.g,o.b):(null==t||"#"!==t.charAt(0)||isNaN(o=parseInt(t.substring(1),16))||(4===t.length?(r=(3840&o)>>4,r|=r>>4,s=240&o,s|=s>>4,l=15&o,l|=l<<4):7===t.length&&(r=(16711680&o)>>16,s=(65280&o)>>8,l=255&o)),e(r,s,l))}function bt(t,e,n){var i,a,o=Math.min(t/=255,e/=255,n/=255),r=Math.max(t,e,n),s=r-o,l=(r+o)/2;return s?(a=l<.5?s/(r+o):s/(2-r-o),i=t==r?(e-n)/s+(e<n?6:0):e==r?(n-t)/s+2:(t-e)/s+4,i*=60):(i=NaN,a=l>0&&l<1?0:i),it(i,a,l)}function Ct(t,e,n){t=At(t),e=At(e),n=At(n);var i=pt((.4124564*t+.3575761*e+.1804375*n)/Hr),a=pt((.2126729*t+.7151522*e+.072175*n)/Xr);return ut(116*a-16,500*(i-a),200*(a-pt((.0193339*t+.119192*e+.9503041*n)/Gr)))}function At(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function kt(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Tt(t){return"function"==typeof t?t:function(){return t}}function Rt(t){return t}function St(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Dt(e,n,t,i)}}function Dt(t,e,n,i){function a(){var t,e=l.status;if(!e&&l.responseText||e>=200&&e<300||304===e){try{t=n.call(o,l)}catch(t){return void r.error.call(o,t)}r.load.call(o,t)}else r.error.call(o,l)}var o={},r=Yo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,u=null;return!tr.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=a:l.onreadystatechange=function(){l.readyState>3&&a()},l.onprogress=function(t){var e=Yo.event;Yo.event=t;try{r.progress.call(o,l)}finally{Yo.event=e}},o.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",o)},o.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",o):e},o.responseType=function(t){return arguments.length?(u=t,o):u},o.response=function(t){return n=t,o},["get","post"].forEach(function(t){o[t]=function(){return o.send.apply(o,[t].concat(Jo(arguments)))}}),o.send=function(n,i,a){if(2===arguments.length&&"function"==typeof i&&(a=i,i=null),l.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),l.setRequestHeader)for(var c in s)l.setRequestHeader(c,s[c]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=u&&(l.responseType=u),null!=a&&o.on("error",a).on("load",function(t){a(null,t)}),r.beforesend.call(o,l),l.send(null==i?null:i),o},o.abort=function(){return l.abort(),o},Yo.rebind(o,r,"on"),null==i?o:o.get(Ot(i))}function Ot(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Mt(){var t=It(),e=_t()-t;e>24?(isFinite(e)&&(clearTimeout($r),$r=setTimeout(Mt,e)),qr=0):(qr=1,Kr(Mt))}function It(){var t=Date.now();for(Yr=jr;Yr;)t>=Yr.t&&(Yr.f=Yr.c(t-Yr.t)),Yr=Yr.n;return t}function _t(){for(var t,e=jr,n=1/0;e;)e.f?e=t?t.n=e.n:jr=e.n:(e.t<n&&(n=e.t),e=(t=e).n);return zr=t,n}function Pt(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Ft(t,e){var n=Math.pow(10,3*sr(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Nt(t){var e=t.decimal,n=t.thousands,i=t.grouping,a=t.currency,o=i?function(t){for(var e=t.length,a=[],o=0,r=i[0];e>0&&r>0;)a.push(t.substring(e-=r,e+r)),r=i[o=(o+1)%i.length];return a.reverse().join(n)}:Rt;return function(t){var n=Qr.exec(t),i=n[1]||" ",r=n[2]||">",s=n[3]||"",l=n[4]||"",u=n[5],c=+n[6],d=n[7],h=n[8],f=n[9],p=1,m="",g="",v=!1;switch(h&&(h=+h.substring(1)),(u||"0"===i&&"="===r)&&(u=i="0",r="=",d&&(c-=Math.floor((c-1)/4))),f){case"n":d=!0,f="g";break;case"%":p=100,g="%",f="f";break;case"p":p=100,g="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(m="0"+f.toLowerCase());case"c":case"d":v=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(m=a[0],g=a[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=Zr.get(f)||Lt;var y=u&&d;return function(t){var n=g;if(v&&t%1)return"";var a=t<0||0===t&&1/t<0?(t=-t,"-"):s;if(p<0){var l=Yo.formatPrefix(t,h);t=l.scale(t),n=l.symbol+g}else t*=p;t=f(t,h);var E=t.lastIndexOf("."),x=E<0?t:t.substring(0,E),w=E<0?"":e+t.substring(E+1);!u&&d&&(x=o(x));var b=m.length+x.length+w.length+(y?0:a.length),C=b<c?new Array(b=c-b+1).join(i):"";return y&&(x=o(C+x)),a+=m,t=x+w,("<"===r?a+t+C:">"===r?C+a+t:"^"===r?C.substring(0,b>>=1)+a+t+C.substring(b):a+(y?t:C+t))+n}}}function Lt(t){return t+""}function Bt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ht(t,e,n){function i(e){var n=t(e),i=o(n,1);return e-n<i-e?n:i}function a(n){return e(n=t(new es(n-1)),1),n}function o(t,n){return e(t=new es(+t),n),t}function r(t,i,o){var r=a(t),s=[];if(o>1)for(;r<i;)n(r)%o||s.push(new Date(+r)),e(r,1);else for(;r<i;)s.push(new Date(+r)),e(r,1);return s}function s(t,e,n){try{es=Bt;var i=new Bt;return i._=t,r(i,e,n)}finally{es=Date}}t.floor=t,t.round=i,t.ceil=a,t.offset=o,t.range=r;var l=t.utc=Xt(t);return l.floor=l,l.round=Xt(i),l.ceil=Xt(a),l.offset=Xt(o),l.range=s,t}function Xt(t){return function(e,n){try{es=Bt;var i=new Bt;return i._=e,t(i,n)._}finally{es=Date}}}function Gt(t){function e(t){function e(e){for(var n,a,o,r=[],s=-1,l=0;++s<i;)37===t.charCodeAt(s)&&(r.push(t.substring(l,s)),null!=(a=is[n=t.charAt(++s)])&&(n=t.charAt(++s)),(o=S[n])&&(n=o(e,null==a?"e"===n?" ":"0":a)),r.push(n),l=s+1);return r.push(t.substring(l,s)),r.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var a=null!=i.Z&&es!==Bt,o=new(a?Bt:es);return"j"in i?o.setFullYear(i.y,0,i.j):"w"in i&&("W"in i||"U"in i)?(o.setFullYear(i.y,0,1),o.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(o.getDay()+5)%7:i.w+7*i.U-(o.getDay()+6)%7)):o.setFullYear(i.y,i.m,i.d),o.setHours(i.H+Math.floor(i.Z/100),i.M+i.Z%100,i.S,i.L),a?o._:o},e.toString=function(){return t},e}function n(t,e,n,i){for(var a,o,r,s=0,l=e.length,u=n.length;s<l;){if(i>=u)return-1;if(37===(a=e.charCodeAt(s++))){if(r=e.charAt(s++),!(o=D[r in is?e.charAt(s++):r])||(i=o(t,n,i))<0)return-1}else if(a!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){b.lastIndex=0;var i=b.exec(e.substring(n));return i?(t.w=C.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){x.lastIndex=0;var i=x.exec(e.substring(n));return i?(t.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){T.lastIndex=0;var i=T.exec(e.substring(n));return i?(t.m=R.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,n){A.lastIndex=0;var i=A.exec(e.substring(n));return i?(t.m=k.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,i){return n(t,S.c.toString(),e,i)}function l(t,e,i){return n(t,S.x.toString(),e,i)}function u(t,e,i){return n(t,S.X.toString(),e,i)}function c(t,e,n){var i=E.get(e.substring(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var d=t.dateTime,h=t.date,f=t.time,p=t.periods,m=t.days,g=t.shortDays,v=t.months,y=t.shortMonths;e.utc=function(t){function n(t){try{es=Bt;var e=new es;return e._=t,i(e)}finally{es=Date}}var i=e(t);return n.parse=function(t){try{es=Bt;var e=i.parse(t);return e&&e._}finally{es=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=se;var E=Yo.map(),x=Ut(m),w=Wt(m),b=Ut(g),C=Wt(g),A=Ut(v),k=Wt(v),T=Ut(y),R=Wt(y);p.forEach(function(t,e){E.set(t.toLowerCase(),e)});var S={a:function(t){return g[t.getDay()]},A:function(t){return m[t.getDay()]},b:function(t){return y[t.getMonth()]},B:function(t){return v[t.getMonth()]},c:e(d),d:function(t,e){return Vt(t.getDate(),e,2)},e:function(t,e){return Vt(t.getDate(),e,2)},H:function(t,e){return Vt(t.getHours(),e,2)},I:function(t,e){return Vt(t.getHours()%12||12,e,2)},j:function(t,e){return Vt(1+ts.dayOfYear(t),e,3)},L:function(t,e){return Vt(t.getMilliseconds(),e,3)},m:function(t,e){return Vt(t.getMonth()+1,e,2)},M:function(t,e){return Vt(t.getMinutes(),e,2)},p:function(t){return p[+(t.getHours()>=12)]},S:function(t,e){return Vt(t.getSeconds(),e,2)},U:function(t,e){return Vt(ts.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Vt(ts.mondayOfYear(t),e,2)},x:e(h),X:e(f),y:function(t,e){return Vt(t.getFullYear()%100,e,2)},Y:function(t,e){return Vt(t.getFullYear()%1e4,e,4)},Z:oe,"%":function(){return"%"}},D={a:i,A:a,b:o,B:r,c:s,d:Zt,e:Zt,H:ee,I:ee,j:te,L:ae,m:Qt,M:ne,p:c,S:ie,U:zt,w:jt,W:qt,x:l,X:u,y:Yt,Y:$t,Z:Kt,"%":re};return e}function Vt(t,e,n){var i=t<0?"-":"",a=(i?-t:t)+"",o=a.length;return i+(o<n?new Array(n-o+1).join(e)+a:a)}function Ut(t){return new RegExp("^(?:"+t.map(Yo.requote).join("|")+")","i")}function Wt(t){for(var e=new r,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function jt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function zt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n));return i?(t.U=+i[0],n+i[0].length):-1}function qt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n));return i?(t.W=+i[0],n+i[0].length):-1}function $t(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function Yt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.y=Jt(+i[0]),n+i[0].length):-1}function Kt(t,e,n){return/^[+-]\d{4}$/.test(e=e.substring(n,n+5))?(t.Z=-e,n+5):-1}function Jt(t){return t+(t>68?1900:2e3)}function Qt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Zt(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function te(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function ee(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function ne(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ie(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function ae(t,e,n){as.lastIndex=0;var i=as.exec(e.substring(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function oe(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=~~(sr(e)/60),a=sr(e)%60;return n+Vt(i,"0",2)+Vt(a,"0",2)}function re(t,e,n){os.lastIndex=0;var i=os.exec(e.substring(n,n+1));return i?n+i[0].length:-1}function se(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function le(){}function ue(t,e,n){var i=n.s=t+e,a=i-t,o=i-a;n.t=t-o+(e-a)}function ce(t,e){t&&us.hasOwnProperty(t.type)&&us[t.type](t,e)}function de(t,e,n){var i,a=-1,o=t.length-n;for(e.lineStart();++a<o;)i=t[a],e.point(i[0],i[1],i[2]);e.lineEnd()}function he(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)de(t[n],e,1);e.polygonEnd()}function fe(){function t(t,e){t*=Dr,e=e*Dr/2+Ar/4;var n=t-i,r=n>=0?1:-1,s=r*n,l=Math.cos(e),u=Math.sin(e),c=o*u,d=a*l+c*Math.cos(s),h=c*r*Math.sin(s);ds.add(Math.atan2(h,d)),i=t,a=l,o=u}var e,n,i,a,o;hs.point=function(r,s){hs.point=t,i=(e=r)*Dr,a=Math.cos(s=(n=s)*Dr/2+Ar/4),o=Math.sin(s)},hs.lineEnd=function(){t(e,n)}}function pe(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ge(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ve(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function ye(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Ee(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function xe(t){return[Math.atan2(t[1],t[0]),J(t[2])]}function we(t,e){return sr(t[0]-e[0])<Rr&&sr(t[1]-e[1])<Rr}function be(t,e){t*=Dr;var n=Math.cos(e*=Dr);Ce(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function Ce(t,e,n){++fs,ms+=(t-ms)/fs,gs+=(e-gs)/fs,vs+=(n-vs)/fs}function Ae(){function t(t,a){t*=Dr;var o=Math.cos(a*=Dr),r=o*Math.cos(t),s=o*Math.sin(t),l=Math.sin(a),u=Math.atan2(Math.sqrt((u=n*l-i*s)*u+(u=i*r-e*l)*u+(u=e*s-n*r)*u),e*r+n*s+i*l);ps+=u,ys+=u*(e+(e=r)),Es+=u*(n+(n=s)),xs+=u*(i+(i=l)),Ce(e,n,i)}var e,n,i;As.point=function(a,o){a*=Dr;var r=Math.cos(o*=Dr);e=r*Math.cos(a),n=r*Math.sin(a),i=Math.sin(o),As.point=t,Ce(e,n,i)}}function ke(){As.point=be}function Te(){function t(t,e){t*=Dr;var n=Math.cos(e*=Dr),r=n*Math.cos(t),s=n*Math.sin(t),l=Math.sin(e),u=a*l-o*s,c=o*r-i*l,d=i*s-a*r,h=Math.sqrt(u*u+c*c+d*d),f=i*r+a*s+o*l,p=h&&-K(f)/h,m=Math.atan2(h,f);ws+=p*u,bs+=p*c,Cs+=p*d,ps+=m,ys+=m*(i+(i=r)),Es+=m*(a+(a=s)),xs+=m*(o+(o=l)),Ce(i,a,o)}var e,n,i,a,o;As.point=function(r,s){e=r,n=s,As.point=t,r*=Dr;var l=Math.cos(s*=Dr);i=l*Math.cos(r),a=l*Math.sin(r),o=Math.sin(s),Ce(i,a,o)},As.lineEnd=function(){t(e,n),As.lineEnd=ke,As.point=be}}function Re(){return!0}function Se(t,e,n,i,a){var o=[],r=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(we(n,i)){a.lineStart();for(var s=0;s<e;++s)a.point((n=t[s])[0],n[1]);return void a.lineEnd()}var l=new Oe(n,t,null,!0),u=new Oe(n,null,l,!1);l.o=u,o.push(l),r.push(u),l=new Oe(i,t,null,!1),u=new Oe(i,null,l,!0),l.o=u,o.push(l),r.push(u)}}),r.sort(e),De(o),De(r),o.length){for(var s=0,l=n,u=r.length;s<u;++s)r[s].e=l=!l;for(var c,d,h=o[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;c=f.z,a.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,u=c.length;s<u;++s)a.point((d=c[s])[0],d[1]);else i(f.x,f.n.x,1,a);f=f.n}else{if(p){c=f.p.z;for(var s=c.length-1;s>=0;--s)a.point((d=c[s])[0],d[1])}else i(f.x,f.p.x,-1,a);f=f.p}f=f.o,c=f.z,p=!p}while(!f.v);a.lineEnd()}}}function De(t){if(e=t.length){for(var e,n,i=0,a=t[0];++i<e;)a.n=n=t[i],n.p=a,a=n;a.n=n=t[0],n.p=a}}function Oe(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Me(t,e,n,i){return function(a,o){function r(e,n){var i=a(e,n);t(e=i[0],n=i[1])&&o.point(e,n)}function s(t,e){var n=a(t,e);g.point(n[0],n[1])}function l(){y.point=s,g.lineStart()}function u(){y.point=r,g.lineEnd()}function c(t,e){m.push([t,e]);var n=a(t,e);x.point(n[0],n[1])}function d(){x.lineStart(),m=[]}function h(){c(m[0][0],m[0][1]),x.lineEnd();var t,e=x.clean(),n=E.buffer(),i=n.length;if(m.pop(),p.push(m),m=null,i)if(1&e){t=n[0];var a,i=t.length-1,r=-1;if(i>0){for(w||(o.polygonStart(),w=!0),o.lineStart();++r<i;)o.point((a=t[r])[0],a[1]);o.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),f.push(n.filter(Ie))}var f,p,m,g=e(o),v=a.invert(i[0],i[1]),y={point:r,lineStart:l,lineEnd:u,polygonStart:function(){y.point=c,y.lineStart=d,y.lineEnd=h,f=[],p=[]},polygonEnd:function(){y.point=r,y.lineStart=l,y.lineEnd=u,f=Yo.merge(f);var t=Fe(v,p);f.length?(w||(o.polygonStart(),w=!0),Se(f,Pe,t,n,o)):t&&(w||(o.polygonStart(),w=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),w&&(o.polygonEnd(),w=!1),f=p=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}},E=_e(),x=e(E),w=!1;return y}}function Ie(t){return t.length>1}function _e(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:m,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Pe(t,e){return((t=t.x)[0]<0?t[1]-Tr-Rr:Tr-t[1])-((e=e.x)[0]<0?e[1]-Tr-Rr:Tr-e[1])}function Fe(t,e){var n=t[0],i=t[1],a=[Math.sin(n),-Math.cos(n),0],o=0,r=0;ds.reset();for(var s=0,l=e.length;s<l;++s){var u=e[s],c=u.length;if(c)for(var d=u[0],h=d[0],f=d[1]/2+Ar/4,p=Math.sin(f),m=Math.cos(f),g=1;;){g===c&&(g=0),t=u[g];var v=t[0],y=t[1]/2+Ar/4,E=Math.sin(y),x=Math.cos(y),w=v-h,b=w>=0?1:-1,C=b*w,A=C>Ar,k=p*E;if(ds.add(Math.atan2(k*b*Math.sin(C),m*x+k*Math.cos(C))),o+=A?w+b*kr:w,A^h>=n^v>=n){var T=ge(pe(d),pe(t));Ee(T);var R=ge(a,T);Ee(R);var S=(A^w>=0?-1:1)*J(R[2]);(i>S||i===S&&(T[0]||T[1]))&&(r+=A^w>=0?1:-1)}if(!g++)break;h=v,p=E,m=x,d=t}}return(o<-Rr||o<Rr&&ds<0)^1&r}function Ne(t){var e,n=NaN,i=NaN,a=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,r){var s=o>0?Ar:-Ar,l=sr(o-n);sr(l-Ar)<Rr?(t.point(n,i=(i+r)/2>0?Tr:-Tr),t.point(a,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(o,i),e=0):a!==s&&l>=Ar&&(sr(n-a)<Rr&&(n-=a*Rr),sr(o-s)<Rr&&(o-=s*Rr),i=Le(n,i,o,r),t.point(a,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=o,i=r),a=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function Le(t,e,n,i){var a,o,r=Math.sin(t-n);return sr(r)>Rr?Math.atan((Math.sin(e)*(o=Math.cos(i))*Math.sin(n)-Math.sin(i)*(a=Math.cos(e))*Math.sin(t))/(a*o*r)):(e+i)/2}function Be(t,e,n,i){var a;if(null==t)a=n*Tr,i.point(-Ar,a),i.point(0,a),i.point(Ar,a),i.point(Ar,0),i.point(Ar,-a),i.point(0,-a),i.point(-Ar,-a),i.point(-Ar,0),i.point(-Ar,a);else if(sr(t[0]-e[0])>Rr){var o=t[0]<e[0]?Ar:-Ar;a=n*o/2,i.point(-o,a),i.point(0,a),i.point(o,a)}else i.point(e[0],e[1])}function He(t){function e(t,e){return Math.cos(t)*Math.cos(e)>o}function n(t){var n,o,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(d,h){var f,p=[d,h],m=e(d,h),g=r?m?0:a(d,h):m?a(d+(d<0?Ar:-Ar),h):0;if(!n&&(u=l=m)&&t.lineStart(),m!==l&&(f=i(n,p),(we(n,f)||we(p,f))&&(p[0]+=Rr,p[1]+=Rr,m=e(p[0],p[1]))),m!==l)c=0,m?(t.lineStart(),f=i(p,n),t.point(f[0],f[1])):(f=i(n,p),t.point(f[0],f[1]),t.lineEnd()),n=f;else if(s&&n&&r^m){var v;g&o||!(v=i(p,n,!0))||(c=0,r?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!m||n&&we(n,p)||t.point(p[0],p[1]),n=p,l=m,o=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}}function i(t,e,n){var i=pe(t),a=pe(e),r=[1,0,0],s=ge(i,a),l=me(s,s),u=s[0],c=l-u*u;if(!c)return!n&&t;var d=o*l/c,h=-o*u/c,f=ge(r,s),p=ye(r,d);ve(p,ye(s,h));var m=f,g=me(p,m),v=me(m,m),y=g*g-v*(me(p,p)-1);if(!(y<0)){var E=Math.sqrt(y),x=ye(m,(-g-E)/v);if(ve(x,p),x=xe(x),!n)return x;var w,b=t[0],C=e[0],A=t[1],k=e[1];C<b&&(w=b,b=C,C=w);var T=C-b,R=sr(T-Ar)<Rr,S=R||T<Rr;if(!R&&k<A&&(w=A,A=k,k=w),S?R?A+k>0^x[1]<(sr(x[0]-b)<Rr?A:k):A<=x[1]&&x[1]<=k:T>Ar^(b<=x[0]&&x[0]<=C)){var D=ye(m,(-g+E)/v);return ve(D,p),[x,xe(D)]}}}function a(e,n){var i=r?t:Ar-t,a=0;return e<-i?a|=1:e>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}var o=Math.cos(t),r=o>0,s=sr(o)>Rr;return Me(e,n,pn(t,6*Dr),r?[0,-t]:[-Ar,t-Ar])}function Xe(t,e,n,i){return function(a){var o,r=a.a,s=a.b,l=r.x,u=r.y,c=s.x,d=s.y,h=0,f=1,p=c-l,m=d-u;if(o=t-l,p||!(o>0)){if(o/=p,p<0){if(o<h)return;o<f&&(f=o)}else if(p>0){if(o>f)return;o>h&&(h=o)}if(o=n-l,p||!(o<0)){if(o/=p,p<0){if(o>f)return;o>h&&(h=o)}else if(p>0){if(o<h)return;o<f&&(f=o)}if(o=e-u,m||!(o>0)){if(o/=m,m<0){if(o<h)return;o<f&&(f=o)}else if(m>0){if(o>f)return;o>h&&(h=o)}if(o=i-u,m||!(o<0)){if(o/=m,m<0){if(o>f)return;o>h&&(h=o)}else if(m>0){if(o<h)return;o<f&&(f=o)}return h>0&&(a.a={x:l+h*p,y:u+h*m}),f<1&&(a.b={x:l+f*p,y:u+f*m}),a}}}}}}function Ge(t,e,n,i){function a(i,a){return sr(i[0]-t)<Rr?a>0?0:3:sr(i[0]-n)<Rr?a>0?2:1:sr(i[1]-e)<Rr?a>0?1:0:a>0?3:2}function o(t,e){return r(t.x,e.x)}function r(t,e){var n=a(t,1),i=a(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function l(t){for(var e=0,n=g.length,i=t[1],a=0;a<n;++a)for(var o,r=1,s=g[a],l=s.length,u=s[0];r<l;++r)o=s[r],u[1]<=i?o[1]>i&&Y(u,o,t)>0&&++e:o[1]<=i&&Y(u,o,t)<0&&--e,u=o;return 0!==e}function u(o,s,l,u){var c=0,d=0;if(null==o||(c=a(o,l))!==(d=a(s,l))||r(o,s)<0^l>0)do{u.point(0===c||3===c?t:n,c>1?i:e)}while((c=(c+l+4)%4)!==d);else u.point(s[0],s[1])}function c(a,o){return t<=a&&a<=n&&e<=o&&o<=i}function d(t,e){c(t,e)&&s.point(t,e)}function h(){D.point=p,g&&g.push(v=[]),A=!0,C=!1,w=b=NaN}function f(){m&&(p(y,E),x&&C&&R.rejoin(),m.push(R.buffer())),D.point=d,C&&s.lineEnd()}function p(t,e){t=Math.max(-Ts,Math.min(Ts,t)),e=Math.max(-Ts,Math.min(Ts,e));var n=c(t,e);if(g&&v.push([t,e]),A)y=t,E=e,x=n,A=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&C)s.point(t,e);else{var i={a:{x:w,y:b},b:{x:t,y:e}};S(i)?(C||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),k=!1):n&&(s.lineStart(),s.point(t,e),k=!1)}w=t,b=e,C=n}var m,g,v,y,E,x,w,b,C,A,k,T=s,R=_e(),S=Xe(t,e,n,i),D={point:d,lineStart:h,lineEnd:f,polygonStart:function(){s=R,m=[],g=[],k=!0},polygonEnd:function(){s=T,m=Yo.merge(m);var e=l([t,i]),n=k&&e,a=m.length;(n||a)&&(s.polygonStart(),n&&(s.lineStart(),u(null,null,1,s),s.lineEnd()),a&&Se(m,o,e,u,s),s.polygonEnd()),m=g=v=null}};return D}}function Ve(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function Ue(t){var e=0,n=Ar/3,i=rn(t),a=i(e,n);return a.parallels=function(t){return arguments.length?i(e=t[0]*Ar/180,n=t[1]*Ar/180):[e/Ar*180,n/Ar*180]},a}function We(t,e){function n(t,e){var n=Math.sqrt(o-2*a*Math.sin(e))/a;return[n*Math.sin(t*=a),r-n*Math.cos(t)]}var i=Math.sin(t),a=(i+Math.sin(e))/2,o=1+i*(2*a-i),r=Math.sqrt(o)/a;return n.invert=function(t,e){var n=r-e;return[Math.atan2(t,n)/a,J((o-(t*t+n*n)*a*a)/(2*a))]},n}function je(){function t(t,e){Ss+=a*t-i*e,i=t,a=e}var e,n,i,a;_s.point=function(o,r){_s.point=t,e=i=o,n=a=r},_s.lineEnd=function(){t(e,n)}}function ze(t,e){t<Ds&&(Ds=t),t>Ms&&(Ms=t),e<Os&&(Os=e),e>Is&&(Is=e)}function qe(){function t(t,e){r.push("M",t,",",e,o)}function e(t,e){r.push("M",t,",",e),s.point=n}function n(t,e){r.push("L",t,",",e)}function i(){s.point=t}function a(){r.push("Z")}var o=$e(4.5),r=[],s={point:t,lineStart:function(){s.point=e},lineEnd:i,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=i,s.point=t},pointRadius:function(t){return o=$e(t),s},result:function(){if(r.length){var t=r.join("");return r=[],t}}};return s}function $e(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Ye(t,e){ms+=t,gs+=e,++vs}function Ke(){function t(t,i){var a=t-e,o=i-n,r=Math.sqrt(a*a+o*o);ys+=r*(e+t)/2,Es+=r*(n+i)/2,xs+=r,Ye(e=t,n=i)}var e,n;Fs.point=function(i,a){Fs.point=t,Ye(e=i,n=a)}}function Je(){Fs.point=Ye}function Qe(){function t(t,e){var n=t-i,o=e-a,r=Math.sqrt(n*n+o*o);ys+=r*(i+t)/2,Es+=r*(a+e)/2,xs+=r,r=a*t-i*e,ws+=r*(i+t),bs+=r*(a+e),Cs+=3*r,Ye(i=t,a=e)}var e,n,i,a;Fs.point=function(o,r){Fs.point=t,Ye(e=i=o,n=a=r)},Fs.lineEnd=function(){t(e,n)}}function Ze(t){function e(e,n){t.moveTo(e,n),t.arc(e,n,r,0,kr)}function n(e,n){t.moveTo(e,n),s.point=i}function i(e,n){t.lineTo(e,n)}function a(){s.point=e}function o(){t.closePath()}var r=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:a,polygonStart:function(){s.lineEnd=o},polygonEnd:function(){s.lineEnd=a,s.point=e},pointRadius:function(t){return r=t,s},result:m};return s}function tn(t){function e(t){return(s?i:n)(t)}function n(e){return an(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){E=NaN,A.point=o,e.lineStart()}function o(n,i){var o=pe([n,i]),r=t(n,i);a(E,x,y,w,b,C,E=r[0],x=r[1],y=n,w=o[0],b=o[1],C=o[2],s,e),e.point(E,x)}function r(){A.point=n,e.lineEnd()}function l(){i(),A.point=u,A.lineEnd=c}function u(t,e){o(d=t,h=e),f=E,p=x,m=w,g=b,v=C,A.point=o}function c(){a(E,x,y,w,b,C,f,p,d,m,g,v,s,e),A.lineEnd=r,r()}var d,h,f,p,m,g,v,y,E,x,w,b,C,A={point:n,lineStart:i,lineEnd:r,polygonStart:function(){e.polygonStart(),A.lineStart=l},polygonEnd:function(){e.polygonEnd(),A.lineStart=i}};return A}function a(e,n,i,s,l,u,c,d,h,f,p,m,g,v){var y=c-e,E=d-n,x=y*y+E*E;if(x>4*o&&g--){var w=s+f,b=l+p,C=u+m,A=Math.sqrt(w*w+b*b+C*C),k=Math.asin(C/=A),T=sr(sr(C)-1)<Rr||sr(i-h)<Rr?(i+h)/2:Math.atan2(b,w),R=t(T,k),S=R[0],D=R[1],O=S-e,M=D-n,I=E*O-y*M;(I*I/x>o||sr((y*O+E*M)/x-.5)>.3||s*f+l*p+u*m<r)&&(a(e,n,i,s,l,u,S,D,T,w/=A,b/=A,C,g,v),v.point(S,D),a(S,D,T,w,b,C,c,d,h,f,p,m,g,v))}}var o=.5,r=Math.cos(30*Dr),s=16;return e.precision=function(t){return arguments.length?(s=(o=t*t)>0&&16,e):Math.sqrt(o)},e}function en(t){var e=tn(function(e,n){return t([e*Or,n*Or])});return function(t){return sn(e(t))}}function nn(t){this.stream=t}function an(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function on(t){return rn(function(){return t})()}function rn(t){function e(t){return t=s(t[0]*Dr,t[1]*Dr),[t[0]*h+l,u-t[1]*h]}function n(t){return(t=s.invert((t[0]-l)/h,(u-t[1])/h))&&[t[0]*Or,t[1]*Or]}function i(){s=Ve(r=cn(v,y,E),o);var t=o(m,g);return l=f-t[0]*h,u=p+t[1]*h,a()}function a(){return c&&(c.valid=!1,c=null),e}var o,r,s,l,u,c,d=tn(function(t,e){return t=o(t,e),[t[0]*h+l,u-t[1]*h]}),h=150,f=480,p=250,m=0,g=0,v=0,y=0,E=0,x=ks,w=Rt,b=null,C=null;return e.stream=function(t){return c&&(c.valid=!1),c=sn(x(r,d(w(t)))),c.valid=!0,c},e.clipAngle=function(t){return arguments.length?(x=null==t?(b=t,ks):He((b=+t)*Dr),a()):b},e.clipExtent=function(t){return arguments.length?(C=t,w=t?Ge(t[0][0],t[0][1],t[1][0],t[1][1]):Rt,a()):C},e.scale=function(t){return arguments.length?(h=+t,i()):h},e.translate=function(t){return arguments.length?(f=+t[0],p=+t[1],i()):[f,p]},e.center=function(t){return arguments.length?(m=t[0]%360*Dr,g=t[1]%360*Dr,i()):[m*Or,g*Or]},e.rotate=function(t){return arguments.length?(v=t[0]%360*Dr,y=t[1]%360*Dr,E=t.length>2?t[2]%360*Dr:0,i()):[v*Or,y*Or,E*Or]},Yo.rebind(e,d,"precision"),function(){return o=t.apply(this,arguments),e.invert=o.invert&&n,i()}}function sn(t){return an(t,function(e,n){t.point(e*Dr,n*Dr)})}function ln(t,e){return[t,e]}function un(t,e){return[t>Ar?t-kr:t<-Ar?t+kr:t,e]}function cn(t,e,n){return t?e||n?Ve(hn(t),fn(e,n)):hn(t):e||n?fn(e,n):un}function dn(t){return function(e,n){return e+=t,[e>Ar?e-kr:e<-Ar?e+kr:e,n]}}function hn(t){var e=dn(t);return e.invert=dn(-t),e}function fn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*i+s*a;return[Math.atan2(l*o-c*r,s*i-u*a),J(c*o+l*r)]}var i=Math.cos(t),a=Math.sin(t),o=Math.cos(e),r=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*o-l*r;return[Math.atan2(l*o+u*r,s*i+c*a),J(c*i-s*a)]},n}function pn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(a,o,r,s){var l=r*e;null!=a?(a=mn(n,a),o=mn(n,o),(r>0?a<o:a>o)&&(a+=r*kr)):(a=t+r*kr,o=t-.5*l);for(var u,c=a;r>0?c>o:c<o;c-=l)s.point((u=xe([n,-i*Math.cos(c),-i*Math.sin(c)]))[0],u[1])}}function mn(t,e){var n=pe(e);n[0]-=t,Ee(n);var i=K(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Rr)%(2*Math.PI)}function gn(t,e,n){var i=Yo.range(t,e-Rr,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function vn(t,e,n){var i=Yo.range(t,e-Rr,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function yn(t){return t.source}function En(t){return t.target}function xn(t,e,n,i){var a=Math.cos(e),o=Math.sin(e),r=Math.cos(i),s=Math.sin(i),l=a*Math.cos(t),u=a*Math.sin(t),c=r*Math.cos(n),d=r*Math.sin(n),h=2*Math.asin(Math.sqrt(et(i-e)+a*r*et(n-t))),f=1/Math.sin(h),p=h?function(t){var e=Math.sin(t*=h)*f,n=Math.sin(h-t)*f,i=n*l+e*c,a=n*u+e*d,r=n*o+e*s;return[Math.atan2(a,i)*Or,Math.atan2(r,Math.sqrt(i*i+a*a))*Or]}:function(){return[t*Or,e*Or]};return p.distance=h,p}function wn(){function t(t,a){var o=Math.sin(a*=Dr),r=Math.cos(a),s=sr((t*=Dr)-e),l=Math.cos(s);Ns+=Math.atan2(Math.sqrt((s=r*Math.sin(s))*s+(s=i*o-n*r*l)*s),n*o+i*r*l),e=t,n=o,i=r}var e,n,i;Ls.point=function(a,o){e=a*Dr,n=Math.sin(o*=Dr),i=Math.cos(o),Ls.point=t},Ls.lineEnd=function(){Ls.point=Ls.lineEnd=m}}function bn(t,e){function n(e,n){var i=Math.cos(e),a=Math.cos(n),o=t(i*a);return[o*a*Math.sin(e),o*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),a=e(i),o=Math.sin(a),r=Math.cos(a);return[Math.atan2(t*o,i*r),Math.asin(i&&n*o/i)]},n}function Cn(t,e){function n(t,e){r>0?e<-Tr+Rr&&(e=-Tr+Rr):e>Tr-Rr&&(e=Tr-Rr);var n=r/Math.pow(a(e),o);return[n*Math.sin(o*t),r-n*Math.cos(o*t)]}var i=Math.cos(t),a=function(t){return Math.tan(Ar/4+t/2)},o=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(a(e)/a(t)),r=i*Math.pow(a(t),o)/o;return o?(n.invert=function(t,e){var n=r-e,i=$(o)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/o,2*Math.atan(Math.pow(r/i,1/o))-Tr]},n):kn}function An(t,e){function n(t,e){var n=o-e;return[n*Math.sin(a*t),o-n*Math.cos(a*t)]}var i=Math.cos(t),a=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),o=i/a+t;return sr(a)<Rr?ln:(n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/a,o-$(a)*Math.sqrt(t*t+n*n)]},n)}function kn(t,e){return[t,Math.log(Math.tan(Ar/4+e/2))]}function Tn(t){var e,n=on(t),i=n.scale,a=n.translate,o=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=a.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var r=o.apply(n,arguments);if(r===n){if(e=null==t){var s=Ar*i(),l=a();o([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else e&&(r=null);return r},n.clipExtent(null)}function Rn(t,e){return[Math.log(Math.tan(Ar/4+e/2)),-t]}function Sn(t){return t[0]}function Dn(t){return t[1]}function On(t){for(var e=t.length,n=[0,1],i=2,a=2;a<e;a++){for(;i>1&&Y(t[n[i-2]],t[n[i-1]],t[a])<=0;)--i;n[i++]=a}return n.slice(0,i)}function Mn(t,e){return t[0]-e[0]||t[1]-e[1]}function In(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function _n(t,e,n,i){var a=t[0],o=n[0],r=e[0]-a,s=i[0]-o,l=t[1],u=n[1],c=e[1]-l,d=i[1]-u,h=(s*(l-u)-d*(a-o))/(d*r-s*c);return[a+h*r,l+h*c]}function Pn(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Fn(){ni(this),this.edge=this.site=this.circle=null}function Nn(t){var e=Ys.pop()||new Fn;return e.site=t,e}function Ln(t){qn(t),zs.remove(t),Ys.push(t),ni(t)}function Bn(t){var e=t.circle,n=e.x,i=e.cy,a={x:n,y:i},o=t.P,r=t.N,s=[t];Ln(t);for(var l=o;l.circle&&sr(n-l.circle.x)<Rr&&sr(i-l.circle.cy)<Rr;)o=l.P,s.unshift(l),Ln(l),l=o;s.unshift(l),qn(l);for(var u=r;u.circle&&sr(n-u.circle.x)<Rr&&sr(i-u.circle.cy)<Rr;)r=u.N,s.push(u),Ln(u),u=r;s.push(u),qn(u);var c,d=s.length;for(c=1;c<d;++c)u=s[c],l=s[c-1],Zn(u.edge,l.site,u.site,a);l=s[0],u=s[d-1],u.edge=Jn(l.site,u.site,null,a),zn(l),zn(u)}function Hn(t){for(var e,n,i,a,o=t.x,r=t.y,s=zs._;s;)if((i=Xn(s,r)-o)>Rr)s=s.L;else{if(!((a=o-Gn(s,r))>Rr)){i>-Rr?(e=s.P,n=s):a>-Rr?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var l=Nn(t);if(zs.insert(e,l),e||n){if(e===n)return qn(e),n=Nn(e.site),zs.insert(l,n),l.edge=n.edge=Jn(e.site,l.site),zn(e),void zn(n);if(!n)return void(l.edge=Jn(e.site,l.site));qn(e),qn(n);var u=e.site,c=u.x,d=u.y,h=t.x-c,f=t.y-d,p=n.site,m=p.x-c,g=p.y-d,v=2*(h*g-f*m),y=h*h+f*f,E=m*m+g*g,x={x:(g*y-f*E)/v+c,y:(h*E-m*y)/v+d};Zn(n.edge,u,p,x),l.edge=Jn(u,t,null,x),n.edge=Jn(t,p,null,x),zn(e),zn(n)}}function Xn(t,e){var n=t.site,i=n.x,a=n.y,o=a-e;if(!o)return i;var r=t.P;if(!r)return-1/0;n=r.site;var s=n.x,l=n.y,u=l-e;if(!u)return s;var c=s-i,d=1/o-1/u,h=c/u;return d?(-h+Math.sqrt(h*h-2*d*(c*c/(-2*u)-l+u/2+a-o/2)))/d+i:(i+s)/2}function Gn(t,e){var n=t.N;if(n)return Xn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Vn(t){this.site=t,this.edges=[]}function Un(t){for(var e,n,i,a,o,r,s,l,u,c,d=t[0][0],h=t[1][0],f=t[0][1],p=t[1][1],m=js,g=m.length;g--;)if((o=m[g])&&o.prepare())for(s=o.edges,l=s.length,r=0;r<l;)c=s[r].end(),i=c.x,a=c.y,u=s[++r%l].start(),e=u.x,n=u.y,(sr(i-e)>Rr||sr(a-n)>Rr)&&(s.splice(r,0,new ti(Qn(o.site,c,sr(i-d)<Rr&&p-a>Rr?{x:d,y:sr(e-d)<Rr?n:p}:sr(a-p)<Rr&&h-i>Rr?{x:sr(n-p)<Rr?e:h,y:p}:sr(i-h)<Rr&&a-f>Rr?{x:h,y:sr(e-h)<Rr?n:f}:sr(a-f)<Rr&&i-d>Rr?{x:sr(n-f)<Rr?e:d,y:f}:null),o.site,null)),++l)}function Wn(t,e){return e.angle-t.angle}function jn(){ni(this),this.x=this.y=this.arc=this.site=this.cy=null}function zn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,a=t.site,o=n.site;if(i!==o){var r=a.x,s=a.y,l=i.x-r,u=i.y-s,c=o.x-r,d=o.y-s,h=2*(l*d-u*c);if(!(h>=-Sr)){var f=l*l+u*u,p=c*c+d*d,m=(d*f-u*p)/h,g=(l*p-c*f)/h,d=g+s,v=Ks.pop()||new jn;v.arc=t,v.site=a,v.x=m+r,v.y=d+Math.sqrt(m*m+g*g),v.cy=d,t.circle=v;for(var y=null,E=$s._;E;)if(v.y<E.y||v.y===E.y&&v.x<=E.x){if(!E.L){y=E.P;break}E=E.L}else{if(!E.R){y=E;break}E=E.R}$s.insert(y,v),y||(qs=v)}}}}function qn(t){var e=t.circle;e&&(e.P||(qs=e.N),$s.remove(e),Ks.push(e),ni(e),t.circle=null)}function $n(t){for(var e,n=Ws,i=Xe(t[0][0],t[0][1],t[1][0],t[1][1]),a=n.length;a--;)e=n[a],(!Yn(e,t)||!i(e)||sr(e.a.x-e.b.x)<Rr&&sr(e.a.y-e.b.y)<Rr)&&(e.a=e.b=null,n.splice(a,1))}function Yn(t,e){var n=t.b;if(n)return!0;var i,a,o=t.a,r=e[0][0],s=e[1][0],l=e[0][1],u=e[1][1],c=t.l,d=t.r,h=c.x,f=c.y,p=d.x,m=d.y,g=(h+p)/2,v=(f+m)/2;if(m===f){if(g<r||g>=s)return;if(h>p){if(o){if(o.y>=u)return}else o={x:g,y:l};n={x:g,y:u}}else{if(o){if(o.y<l)return}else o={x:g,y:u};n={x:g,y:l}}}else if(i=(h-p)/(m-f),a=v-i*g,i<-1||i>1)if(h>p){if(o){if(o.y>=u)return}else o={x:(l-a)/i,y:l};n={x:(u-a)/i,y:u}}else{if(o){if(o.y<l)return}else o={x:(u-a)/i,y:u};n={x:(l-a)/i,y:l}}else if(f<m){if(o){if(o.x>=s)return}else o={x:r,y:i*r+a};n={x:s,y:i*s+a}}else{if(o){if(o.x<r)return}else o={x:s,y:i*s+a};n={x:r,y:i*r+a}}return t.a=o,t.b=n,!0}function Kn(t,e){this.l=t,this.r=e,this.a=this.b=null}function Jn(t,e,n,i){var a=new Kn(t,e);return Ws.push(a),n&&Zn(a,t,e,n),i&&Zn(a,e,t,i),js[t.i].edges.push(new ti(a,t,e)),js[e.i].edges.push(new ti(a,e,t)),a}function Qn(t,e,n){var i=new Kn(t,null);return i.a=e,i.b=n,Ws.push(i),i}function Zn(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function ti(t,e,n){var i=t.a,a=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(a.x-i.x,i.y-a.y):Math.atan2(i.x-a.x,a.y-i.y)}function ei(){this._=null}function ni(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ii(t,e){var n=e,i=e.R,a=n.U;a?a.L===n?a.L=i:a.R=i:t._=i,i.U=a,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function ai(t,e){var n=e,i=e.L,a=n.U;a?a.L===n?a.L=i:a.R=i:t._=i,i.U=a,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function oi(t){for(;t.L;)t=t.L;return t}function ri(t,e){var n,i,a,o=t.sort(si).pop();for(Ws=[],js=new Array(t.length),zs=new ei,$s=new ei;;)if(a=qs,o&&(!a||o.y<a.y||o.y===a.y&&o.x<a.x))o.x===n&&o.y===i||(js[o.i]=new Vn(o),Hn(o),n=o.x,i=o.y),o=t.pop();else{if(!a)break;Bn(a.arc)}e&&($n(e),Un(e));var r={cells:js,edges:Ws};return zs=$s=Ws=js=null,r}function si(t,e){return e.y-t.y||e.x-t.x}function li(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function ui(t){return t.x}function ci(t){return t.y}function di(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function hi(t,e,n,i,a,o){if(!t(e,n,i,a,o)){var r=.5*(n+a),s=.5*(i+o),l=e.nodes;l[0]&&hi(t,l[0],n,i,r,s),l[1]&&hi(t,l[1],r,i,a,s),l[2]&&hi(t,l[2],n,s,r,o),l[3]&&hi(t,l[3],r,s,a,o)}}function fi(t,e){t=Yo.rgb(t),e=Yo.rgb(e);var n=t.r,i=t.g,a=t.b,o=e.r-n,r=e.g-i,s=e.b-a;return function(t){return"#"+xt(Math.round(n+o*t))+xt(Math.round(i+r*t))+xt(Math.round(a+s*t))}}function pi(t,e){var n,i={},a={};for(n in t)n in e?i[n]=vi(t[n],e[n]):a[n]=t[n];for(n in e)n in t||(a[n]=e[n]);return function(t){for(n in i)a[n]=i[n](t);return a}}function mi(t,e){return e-=t=+t,function(n){return t+e*n}}function gi(t,e){var n,i,a,o=Qs.lastIndex=Zs.lastIndex=0,r=-1,s=[],l=[];for(t+="",e+="";(n=Qs.exec(t))&&(i=Zs.exec(e));)(a=i.index)>o&&(a=e.substring(o,a),s[r]?s[r]+=a:s[++r]=a),(n=n[0])===(i=i[0])?s[r]?s[r]+=i:s[++r]=i:(s[++r]=null,l.push({i:r,x:mi(n,i)})),o=Zs.lastIndex;return o<e.length&&(a=e.substring(o),s[r]?s[r]+=a:s[++r]=a),s.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function vi(t,e){for(var n,i=Yo.interpolators.length;--i>=0&&!(n=Yo.interpolators[i](t,e)););return n}function yi(t,e){var n,i=[],a=[],o=t.length,r=e.length,s=Math.min(t.length,e.length);for(n=0;n<s;++n)i.push(vi(t[n],e[n]));for(;n<o;++n)a[n]=t[n];for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<s;++n)a[n]=i[n](t);return a}}function Ei(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function xi(t){return function(e){return 1-t(1-e)}}function wi(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function bi(t){return t*t}function Ci(t){return t*t*t}function Ai(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ki(t){return function(e){return Math.pow(e,t)}}function Ti(t){return 1-Math.cos(t*Tr)}function Ri(t){return Math.pow(2,10*(t-1))}function Si(t){return 1-Math.sqrt(1-t*t)}function Di(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/kr*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*kr/e)}}function Oi(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function Mi(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Ii(t,e){t=Yo.hcl(t),e=Yo.hcl(e);var n=t.h,i=t.c,a=t.l,o=e.h-n,r=e.c-i,s=e.l-a;return isNaN(r)&&(r=0,i=isNaN(i)?e.c:i),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:o<-180&&(o+=360),function(t){return lt(n+o*t,i+r*t,a+s*t)+""}}function _i(t,e){t=Yo.hsl(t),e=Yo.hsl(e);var n=t.h,i=t.s,a=t.l,o=e.h-n,r=e.s-i,s=e.l-a;return isNaN(r)&&(r=0,i=isNaN(i)?e.s:i),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:o<-180&&(o+=360),function(t){return ot(n+o*t,i+r*t,a+s*t)+""}}function Pi(t,e){t=Yo.lab(t),e=Yo.lab(e);var n=t.l,i=t.a,a=t.b,o=e.l-n,r=e.a-i,s=e.b-a;return function(t){return dt(n+o*t,i+r*t,a+s*t)+""}}function Fi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Ni(t){var e=[t.a,t.b],n=[t.c,t.d],i=Bi(e),a=Li(e,n),o=Bi(Hi(n,e,-a))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,a*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Or,this.translate=[t.e,t.f],this.scale=[i,o],this.skew=o?Math.atan2(a,o)*Or:0}function Li(t,e){return t[0]*e[0]+t[1]*e[1]}function Bi(t){var e=Math.sqrt(Li(t,t));return e&&(t[0]/=e,t[1]/=e),e}function Hi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Xi(t,e){var n,i=[],a=[],o=Yo.transform(t),r=Yo.transform(e),s=o.translate,l=r.translate,u=o.rotate,c=r.rotate,d=o.skew,h=r.skew,f=o.scale,p=r.scale;return s[0]!=l[0]||s[1]!=l[1]?(i.push("translate(",null,",",null,")"),a.push({i:1,x:mi(s[0],l[0])},{i:3,x:mi(s[1],l[1])})):l[0]||l[1]?i.push("translate("+l+")"):i.push(""),u!=c?(u-c>180?c+=360:c-u>180&&(u+=360),a.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:mi(u,c)})):c&&i.push(i.pop()+"rotate("+c+")"),d!=h?a.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:mi(d,h)}):h&&i.push(i.pop()+"skewX("+h+")"),f[0]!=p[0]||f[1]!=p[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),a.push({i:n-4,x:mi(f[0],p[0])},{i:n-2,x:mi(f[1],p[1])})):1==p[0]&&1==p[1]||i.push(i.pop()+"scale("+p+")"),n=a.length,function(t){for(var e,o=-1;++o<n;)i[(e=a[o]).i]=e.x(t);return i.join("")}}function Gi(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return(n-t)*e}}function Vi(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return Math.max(0,Math.min(1,(n-t)*e))}}function Ui(t){for(var e=t.source,n=t.target,i=ji(e,n),a=[e];e!==i;)e=e.parent,a.push(e);for(var o=a.length;n!==i;)a.splice(o,0,n),n=n.parent;return a}function Wi(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function ji(t,e){if(t===e)return t;for(var n=Wi(t),i=Wi(e),a=n.pop(),o=i.pop(),r=null;a===o;)r=a,a=n.pop(),o=i.pop();return r}function zi(t){t.fixed|=2}function qi(t){t.fixed&=-7}function $i(t){t.fixed|=4,t.px=t.x,t.py=t.y}function Yi(t){t.fixed&=-5}function Ki(t,e,n){var i=0,a=0;if(t.charge=0,!t.leaf)for(var o,r=t.nodes,s=r.length,l=-1;++l<s;)null!=(o=r[l])&&(Ki(o,e,n),t.charge+=o.charge,i+=o.charge*o.cx,a+=o.charge*o.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=e*n[t.point.index];t.charge+=t.pointCharge=u,i+=u*t.point.x,a+=u*t.point.y}t.cx=i/t.charge,t.cy=a/t.charge}function Ji(t,e){return Yo.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=ia,t}function Qi(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(a=t.children)&&(i=a.length))for(var i,a;--i>=0;)n.push(a[i])}function Zi(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(o=t.children)&&(a=o.length))for(var a,o,r=-1;++r<a;)n.push(o[r]);for(;null!=(t=i.pop());)e(t)}function ta(t){return t.children}function ea(t){return t.value}function na(t,e){return e.value-t.value}function ia(t){return Yo.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function aa(t){return t.x}function oa(t){return t.y}function ra(t,e,n){t.y0=e,t.y=n}function sa(t){return Yo.range(t.length)}function la(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function ua(t){for(var e,n=1,i=0,a=t[0][1],o=t.length;n<o;++n)(e=t[n][1])>a&&(i=n,a=e);return i}function ca(t){return t.reduce(da,0)}function da(t,e){return t+e[1]}function ha(t,e){return fa(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function fa(t,e){for(var n=-1,i=+t[0],a=(t[1]-i)/e,o=[];++n<=e;)o[n]=a*n+i;return o}function pa(t){return[Yo.min(t),Yo.max(t)]}function ma(t,e){return t.value-e.value}function ga(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function va(t,e){t._pack_next=e,e._pack_prev=t}function ya(t,e){var n=e.x-t.x,i=e.y-t.y,a=t.r+e.r;return.999*a*a>n*n+i*i}function Ea(t){function e(t){c=Math.min(t.x-t.r,c),d=Math.max(t.x+t.r,d),h=Math.min(t.y-t.r,h),f=Math.max(t.y+t.r,f)}if((n=t.children)&&(u=n.length)){var n,i,a,o,r,s,l,u,c=1/0,d=-1/0,h=1/0,f=-1/0;if(n.forEach(xa),i=n[0],i.x=-i.r,i.y=0,e(i),u>1&&(a=n[1],a.x=a.r,a.y=0,e(a),u>2))for(o=n[2],Ca(i,a,o),e(o),ga(i,o),i._pack_prev=o,ga(o,a),a=i._pack_next,r=3;r<u;r++){Ca(i,a,o=n[r]);var p=0,m=1,g=1;for(s=a._pack_next;s!==a;s=s._pack_next,m++)if(ya(s,o)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!ya(l,o);l=l._pack_prev,g++);p?(m<g||m==g&&a.r<i.r?va(i,a=s):va(i=l,a),r--):(ga(i,o),a=o,e(o))}var v=(c+d)/2,y=(h+f)/2,E=0;for(r=0;r<u;r++)o=n[r],o.x-=v,o.y-=y,E=Math.max(E,o.r+Math.sqrt(o.x*o.x+o.y*o.y));t.r=E,n.forEach(wa)}}function xa(t){t._pack_next=t._pack_prev=t}function wa(t){delete t._pack_next,delete t._pack_prev}function ba(t,e,n,i){var a=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,a)for(var o=-1,r=a.length;++o<r;)ba(a[o],e,n,i)}function Ca(t,e,n){var i=t.r+n.r,a=e.x-t.x,o=e.y-t.y;if(i&&(a||o)){var r=e.r+n.r,s=a*a+o*o;r*=r,i*=i;var l=.5+(i-r)/(2*s),u=Math.sqrt(Math.max(0,2*r*(i+s)-(i-=s)*i-r*r))/(2*s);n.x=t.x+l*a+u*o,n.y=t.y+l*o-u*a}else n.x=t.x+i,n.y=t.y}function Aa(t,e){return t.parent==e.parent?1:2}function ka(t){var e=t.children;return e.length?e[0]:t.t}function Ta(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function Ra(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Sa(t){for(var e,n=0,i=0,a=t.children,o=a.length;--o>=0;)e=a[o],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Da(t,e,n){return t.a.parent===e.parent?t.a:n}function Oa(t){return 1+Yo.max(t,function(t){return t.y})}function Ma(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Ia(t){var e=t.children;return e&&e.length?Ia(e[0]):t}function _a(t){var e,n=t.children;return n&&(e=n.length)?_a(n[e-1]):t}function Pa(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Fa(t,e){var n=t.x+e[3],i=t.y+e[0],a=t.dx-e[1]-e[3],o=t.dy-e[0]-e[2];return a<0&&(n+=a/2,a=0),o<0&&(i+=o/2,o=0),{x:n,y:i,dx:a,dy:o}}function Na(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function La(t){return t.rangeExtent?t.rangeExtent():Na(t.range())}function Ba(t,e,n,i){var a=n(t[0],t[1]),o=i(e[0],e[1]);return function(t){return o(a(t))}}function Ha(t,e){var n,i=0,a=t.length-1,o=t[i],r=t[a];return r<o&&(n=i,i=a,a=n,n=o,o=r,r=n),t[i]=e.floor(o),t[a]=e.ceil(r),t}function Xa(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:cl}function Ga(t,e,n,i){var a=[],o=[],r=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++r<=s;)a.push(n(t[r-1],t[r])),o.push(i(e[r-1],e[r]));return function(e){var n=Yo.bisect(t,e,1,s)-1;return o[n](a[n](e))}}function Va(t,e,n,i){function a(){var a=Math.min(t.length,e.length)>2?Ga:Ba,l=i?Vi:Gi;return r=a(t,e,l,n),s=a(e,t,l,vi),o}function o(t){return r(t)}var r,s;return o.invert=function(t){return s(t)},o.domain=function(e){return arguments.length?(t=e.map(Number),a()):t},o.range=function(t){return arguments.length?(e=t,a()):e},o.rangeRound=function(t){return o.range(t).interpolate(Fi)},o.clamp=function(t){return arguments.length?(i=t,a()):i},o.interpolate=function(t){return arguments.length?(n=t,a()):n},o.ticks=function(e){return za(t,e)},o.tickFormat=function(e,n){return qa(t,e,n)},o.nice=function(e){return Wa(t,e),a()},o.copy=function(){return Va(t,e,n,i)},a()}function Ua(t,e){return Yo.rebind(t,e,"range","rangeRound","interpolate","clamp")}function Wa(t,e){return Ha(t,Xa(ja(t,e)[2]))}function ja(t,e){null==e&&(e=10);var n=Na(t),i=n[1]-n[0],a=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),o=e/i*a;return o<=.15?a*=10:o<=.35?a*=5:o<=.75&&(a*=2),n[0]=Math.ceil(n[0]/a)*a,n[1]=Math.floor(n[1]/a)*a+.5*a,n[2]=a,n}function za(t,e){return Yo.range.apply(Yo,ja(t,e))}function qa(t,e,n){var i=ja(t,e);if(n){var a=Qr.exec(n);if(a.shift(),"s"===a[8]){var o=Yo.formatPrefix(Math.max(sr(i[0]),sr(i[1])));return a[7]||(a[7]="."+$a(o.scale(i[2]))),a[8]="f",n=Yo.format(a.join("")),function(t){return n(o.scale(t))+o.symbol}}a[7]||(a[7]="."+Ya(a[8],i)),n=a.join("")}else n=",."+$a(i[2])+"f";return Yo.format(n)}function $a(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function Ya(t,e){var n=$a(e[2]);return t in dl?Math.abs(n-$a(Math.max(sr(e[0]),sr(e[1]))))+ +("e"!==t):n-2*("%"===t)}function Ka(t,e,n,i){function a(t){return(n?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function o(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function r(e){return t(a(e))}return r.invert=function(e){return o(t.invert(e))},r.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(a)),r):i},r.base=function(n){return arguments.length?(e=+n,t.domain(i.map(a)),r):e},r.nice=function(){var e=Ha(i.map(a),n?Math:fl);return t.domain(e),i=e.map(o),r},r.ticks=function(){var t=Na(i),r=[],s=t[0],l=t[1],u=Math.floor(a(s)),c=Math.ceil(a(l)),d=e%1?2:e;if(isFinite(c-u)){if(n){for(;u<c;u++)for(var h=1;h<d;h++)r.push(o(u)*h);r.push(o(u))}else for(r.push(o(u));u++<c;)for(var h=d-1;h>0;h--)r.push(o(u)*h);for(u=0;r[u]<s;u++);for(c=r.length;r[c-1]>l;c--);r=r.slice(u,c)}return r},r.tickFormat=function(t,e){if(!arguments.length)return hl;arguments.length<2?e=hl:"function"!=typeof e&&(e=Yo.format(e));var i,s=Math.max(.1,t/r.ticks().length),l=n?(i=1e-12,Math.ceil):(i=-1e-12,Math.floor);return function(t){return t/o(l(a(t)+i))<=s?e(t):""}},r.copy=function(){return Ka(t.copy(),e,n,i)},Ua(r,t)}function Ja(t,e,n){function i(e){return t(a(e))}var a=Qa(e),o=Qa(1/e);return i.invert=function(e){return o(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(a)),i):n},i.ticks=function(t){return za(n,t)},i.tickFormat=function(t,e){return qa(n,t,e)},i.nice=function(t){return i.domain(Wa(n,t))},i.exponent=function(r){return arguments.length?(a=Qa(e=r),o=Qa(1/e),t.domain(n.map(a)),i):e},i.copy=function(){return Ja(t.copy(),e,n)},Ua(i,t)}function Qa(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Za(t,e){function n(n){return o[((a.get(n)||("range"===e.t?a.set(n,t.push(n)):NaN))-1)%o.length]}function i(e,n){return Yo.range(t.length).map(function(t){return e+n*t})}var a,o,s;return n.domain=function(i){if(!arguments.length)return t;t=[],a=new r;for(var o,s=-1,l=i.length;++s<l;)a.has(o=i[s])||a.set(o,t.push(o));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(o=t,s=0,e={t:"range",a:arguments},n):o},n.rangePoints=function(a,r){arguments.length<2&&(r=0);var l=a[0],u=a[1],c=(u-l)/(Math.max(1,t.length-1)+r);return o=i(t.length<2?(l+u)/2:l+c*r/2,c),s=0,e={t:"rangePoints",a:arguments},n},n.rangeBands=function(a,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var u=a[1]<a[0],c=a[u-0],d=a[1-u],h=(d-c)/(t.length-r+2*l);return o=i(c+h*l,h),u&&o.reverse(),s=h*(1-r),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(a,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var u=a[1]<a[0],c=a[u-0],d=a[1-u],h=Math.floor((d-c)/(t.length-r+2*l)),f=d-c-(t.length-r)*h;return o=i(c+Math.round(f/2),h),u&&o.reverse(),s=Math.round(h*(1-r)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return s},n.rangeExtent=function(){return Na(e.a[0])},n.copy=function(){return Za(t,e)},n.domain(t)}function to(n,i){function a(){var t=0,e=i.length;for(r=[];++t<e;)r[t-1]=Yo.quantile(n,t/e);return o}function o(t){if(!isNaN(t=+t))return i[Yo.bisect(r,t)]}var r;return o.domain=function(i){return arguments.length?(n=i.filter(e).sort(t),a()):n},o.range=function(t){return arguments.length?(i=t,a()):i},o.quantiles=function(){return r},o.invertExtent=function(t){return t=i.indexOf(t),t<0?[NaN,NaN]:[t>0?r[t-1]:n[0],t<r.length?r[t]:n[n.length-1]]},o.copy=function(){return to(n,i)},a()}function eo(t,e,n){function i(e){return n[Math.max(0,Math.min(r,Math.floor(o*(e-t))))]}function a(){return o=n.length/(e-t),r=n.length-1,i}var o,r;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],a()):[t,e]},i.range=function(t){return arguments.length?(n=t,a()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=e<0?NaN:e/o+t,[e,e+1/o]},i.copy=function(){return eo(t,e,n)},a()}function no(t,e){function n(n){if(n<=n)return e[Yo.bisect(t,n)]}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return no(t,e)},n}function io(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return za(t,e)},e.tickFormat=function(e,n){return qa(t,e,n)},e.copy=function(){return io(t)},e}function ao(t){return t.innerRadius}function oo(t){return t.outerRadius}function ro(t){return t.startAngle}function so(t){return t.endAngle}function lo(t){function e(e){function r(){u.push("M",o(t(c),s))}for(var l,u=[],c=[],d=-1,h=e.length,f=Tt(n),p=Tt(i);++d<h;)a.call(this,l=e[d],d)?c.push([+f.call(this,l,d),+p.call(this,l,d)]):c.length&&(r(),c=[]);return c.length&&r(),u.length?u.join(""):null}var n=Sn,i=Dn,a=Re,o=uo,r=o.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(a=t,e):a},e.interpolate=function(t){return arguments.length?(r="function"==typeof t?o=t:(o=xl.get(t)||uo).key,e):r},e.tension=function(t){return arguments.length?(s=t,e):s},e}function uo(t){return t.join("L")}function co(t){return uo(t)+"Z"}function ho(t){for(var e=0,n=t.length,i=t[0],a=[i[0],",",i[1]];++e<n;)a.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&a.push("H",i[0]),a.join("")}function fo(t){for(var e=0,n=t.length,i=t[0],a=[i[0],",",i[1]];++e<n;)a.push("V",(i=t[e])[1],"H",i[0]);return a.join("")}function po(t){for(var e=0,n=t.length,i=t[0],a=[i[0],",",i[1]];++e<n;)a.push("H",(i=t[e])[0],"V",i[1]);return a.join("")}function mo(t,e){return t.length<4?uo(t):t[1]+yo(t.slice(1,t.length-1),Eo(t,e))}function go(t,e){return t.length<3?uo(t):t[0]+yo((t.push(t[0]),t),Eo([t[t.length-2]].concat(t,[t[1]]),e))}function vo(t,e){return t.length<3?uo(t):t[0]+yo(t,Eo(t,e))}function yo(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return uo(t);var n=t.length!=e.length,i="",a=t[0],o=t[1],r=e[0],s=r,l=1;if(n&&(i+="Q"+(o[0]-2*r[0]/3)+","+(o[1]-2*r[1]/3)+","+o[0]+","+o[1],a=t[1],l=2),e.length>1){s=e[1],o=t[l],l++,i+="C"+(a[0]+r[0])+","+(a[1]+r[1])+","+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1];for(var u=2;u<e.length;u++,l++)o=t[l],s=e[u],i+="S"+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1]}if(n){var c=t[l];i+="Q"+(o[0]+2*s[0]/3)+","+(o[1]+2*s[1]/3)+","+c[0]+","+c[1]}return i}function Eo(t,e){for(var n,i=[],a=(1-e)/2,o=t[0],r=t[1],s=1,l=t.length;++s<l;)n=o,o=r,r=t[s],i.push([a*(r[0]-n[0]),a*(r[1]-n[1])]);return i}function xo(t){if(t.length<3)return uo(t);var e=1,n=t.length,i=t[0],a=i[0],o=i[1],r=[a,a,a,(i=t[1])[0]],s=[o,o,o,i[1]],l=[a,",",o,"L",Ao(Cl,r),",",Ao(Cl,s)];for(t.push(t[n-1]);++e<=n;)i=t[e],r.shift(),r.push(i[0]),s.shift(),s.push(i[1]),ko(l,r,s);return t.pop(),l.push("L",i),l.join("")}function wo(t){if(t.length<4)return uo(t);for(var e,n=[],i=-1,a=t.length,o=[0],r=[0];++i<3;)e=t[i],o.push(e[0]),r.push(e[1]);for(n.push(Ao(Cl,o)+","+Ao(Cl,r)),--i;++i<a;)e=t[i],o.shift(),o.push(e[0]),r.shift(),r.push(e[1]),ko(n,o,r);return n.join("")}function bo(t){for(var e,n,i=-1,a=t.length,o=a+4,r=[],s=[];++i<4;)n=t[i%a],r.push(n[0]),s.push(n[1]);for(e=[Ao(Cl,r),",",Ao(Cl,s)],--i;++i<o;)n=t[i%a],r.shift(),r.push(n[0]),s.shift(),s.push(n[1]),ko(e,r,s);return e.join("")}function Co(t,e){var n=t.length-1;if(n)for(var i,a,o=t[0][0],r=t[0][1],s=t[n][0]-o,l=t[n][1]-r,u=-1;++u<=n;)i=t[u],a=u/n,i[0]=e*i[0]+(1-e)*(o+a*s),i[1]=e*i[1]+(1-e)*(r+a*l);return xo(t)}function Ao(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ko(t,e,n){t.push("C",Ao(wl,e),",",Ao(wl,n),",",Ao(bl,e),",",Ao(bl,n),",",Ao(Cl,e),",",Ao(Cl,n))}function To(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Ro(t){for(var e=0,n=t.length-1,i=[],a=t[0],o=t[1],r=i[0]=To(a,o);++e<n;)i[e]=(r+(r=To(a=o,o=t[e+1])))/2;return i[e]=r,i}function So(t){for(var e,n,i,a,o=[],r=Ro(t),s=-1,l=t.length-1;++s<l;)e=To(t[s],t[s+1]),sr(e)<Rr?r[s]=r[s+1]=0:(n=r[s]/e,i=r[s+1]/e,(a=n*n+i*i)>9&&(a=3*e/Math.sqrt(a),r[s]=a*n,r[s+1]=a*i));for(s=-1;++s<=l;)a=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+r[s]*r[s])),o.push([a||0,r[s]*a||0]);return o}function Do(t){return t.length<3?uo(t):t[0]+yo(t,So(t))}function Oo(t){for(var e,n,i,a=-1,o=t.length;++a<o;)e=t[a],n=e[0],i=e[1]+yl,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function Mo(t){function e(e){function l(){m.push("M",s(t(v),d),c,u(t(g.reverse()),d),"Z")}for(var h,f,p,m=[],g=[],v=[],y=-1,E=e.length,x=Tt(n),w=Tt(a),b=n===i?function(){return f}:Tt(i),C=a===o?function(){return p}:Tt(o);++y<E;)r.call(this,h=e[y],y)?(g.push([f=+x.call(this,h,y),p=+w.call(this,h,y)]),v.push([+b.call(this,h,y),+C.call(this,h,y)])):g.length&&(l(),g=[],v=[]);return g.length&&l(),m.length?m.join(""):null}var n=Sn,i=Sn,a=0,o=Dn,r=Re,s=uo,l=s.key,u=s,c="L",d=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(a=o=t,e):o},e.y0=function(t){return arguments.length?(a=t,e):a},e.y1=function(t){return arguments.length?(o=t,e):o},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?s=t:(s=xl.get(t)||uo).key,u=s.reverse||s,c=s.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(d=t,e):d},e}function Io(t){return t.radius}function _o(t){return[t.x,t.y]}function Po(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]+yl;return[n*Math.cos(i),n*Math.sin(i)]}}function Fo(){return 64}function No(){return"circle"}function Lo(t){var e=Math.sqrt(t/Ar);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Bo(t,e){return hr(t,Dl),t.id=e,t}function Ho(t,e,n,i){var a=t.id;return N(t,"function"==typeof n?function(t,o,r){t.__transition__[a].tween.set(e,i(n.call(t,t.__data__,o,r)))}:(n=i(n),function(t){t.__transition__[a].tween.set(e,n)}))}function Xo(t){return null==t&&(t=""),function(){this.textContent=t}}function Go(t,e,n,i){var a=t.__transition__||(t.__transition__={active:0,count:0}),o=a[n];if(!o){var s=i.time;o=a[n]={tween:new r,time:s,ease:i.ease,delay:i.delay,duration:i.duration},++a.count,Yo.timer(function(i){function r(i){if(a.active>n)return u();a.active=n,o.event&&o.event.start.call(t,c,e),o.tween.forEach(function(n,i){(i=i.call(t,c,e))&&m.push(i)}),Yo.timer(function(){return p.c=l(i||1)?Re:l,1},0,s)}function l(i){if(a.active!==n)return u();for(var r=i/f,s=d(r),l=m.length;l>0;)m[--l].call(t,s);return r>=1?(o.event&&o.event.end.call(t,c,e),u()):void 0}function u(){return--a.count?delete a[n]:delete t.__transition__,1}var c=t.__data__,d=o.ease,h=o.delay,f=o.duration,p=Yr,m=[];if(p.t=h+s,h<=i)return r(i-h);p.c=r},0,s)}}function Vo(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})}function Uo(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})}function Wo(t){return t.toISOString()}function jo(t,e,n){function i(e){return t(e)}function a(t,n){var i=t[1]-t[0],a=i/n,o=Yo.bisect(Bl,a);return o==Bl.length?[e.year,ja(t.map(function(t){return t/31536e6}),n)[2]]:o?e[a/Bl[o-1]<Bl[o]/a?o-1:o]:[Gl,ja(t,n)[2]]}return i.invert=function(e){return zo(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(zo)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,zo(+n+1),e).length}var o=i.domain(),r=Na(o),s=null==t?a(r,10):"number"==typeof t&&a(r,t);return s&&(t=s[0],e=s[1]),i.domain(Ha(o,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=zo(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=zo(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Na(i.domain()),o=null==t?a(n,10):"number"==typeof t?a(n,t):!t.range&&[{range:t},e];return o&&(t=o[0],e=o[1]),t.range(n[0],zo(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return n},i.copy=function(){return jo(t.copy(),e,n)},Ua(i,t)}function zo(t){return new Date(t)}function qo(t){return JSON.parse(t.responseText)}function $o(t){var e=Qo.createRange();return e.selectNode(Qo.body),e.createContextualFragment(t.responseText)}var Yo={version:"3.4.8"};Date.now||(Date.now=function(){return+new Date});var Ko=[].slice,Jo=function(t){return Ko.call(t)},Qo=document,Zo=Qo.documentElement,tr=window;try{Jo(Zo.childNodes)[0].nodeType}catch(t){Jo=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}try{Qo.createElement("div").style.setProperty("opacity",0,"")}catch(t){var er=tr.Element.prototype,nr=er.setAttribute,ir=er.setAttributeNS,ar=tr.CSSStyleDeclaration.prototype,or=ar.setProperty;er.setAttribute=function(t,e){nr.call(this,t,e+"")},er.setAttributeNS=function(t,e,n){ir.call(this,t,e,n+"")},ar.setProperty=function(t,e,n){or.call(this,t,e+"",n)}}Yo.ascending=t,Yo.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},Yo.min=function(t,e){var n,i,a=-1,o=t.length;if(1===arguments.length){for(;++a<o&&!(null!=(n=t[a])&&n<=n);)n=void 0;for(;++a<o;)null!=(i=t[a])&&n>i&&(n=i)}else{for(;++a<o&&!(null!=(n=e.call(t,t[a],a))&&n<=n);)n=void 0;for(;++a<o;)null!=(i=e.call(t,t[a],a))&&n>i&&(n=i)}return n},Yo.max=function(t,e){var n,i,a=-1,o=t.length;if(1===arguments.length){for(;++a<o&&!(null!=(n=t[a])&&n<=n);)n=void 0;for(;++a<o;)null!=(i=t[a])&&i>n&&(n=i)}else{for(;++a<o&&!(null!=(n=e.call(t,t[a],a))&&n<=n);)n=void 0;for(;++a<o;)null!=(i=e.call(t,t[a],a))&&i>n&&(n=i)}return n},Yo.extent=function(t,e){var n,i,a,o=-1,r=t.length;if(1===arguments.length){for(;++o<r&&!(null!=(n=a=t[o])&&n<=n);)n=a=void 0;for(;++o<r;)null!=(i=t[o])&&(n>i&&(n=i),a<i&&(a=i))}else{for(;++o<r&&!(null!=(n=a=e.call(t,t[o],o))&&n<=n);)n=void 0;for(;++o<r;)null!=(i=e.call(t,t[o],o))&&(n>i&&(n=i),a<i&&(a=i))}return[n,a]},Yo.sum=function(t,e){var n,i=0,a=t.length,o=-1;if(1===arguments.length)for(;++o<a;)isNaN(n=+t[o])||(i+=n);else for(;++o<a;)isNaN(n=+e.call(t,t[o],o))||(i+=n);return i},Yo.mean=function(t,n){var i,a=0,o=t.length,r=-1,s=o;if(1===arguments.length)for(;++r<o;)e(i=t[r])?a+=i:--s;else for(;++r<o;)e(i=n.call(t,t[r],r))?a+=i:--s;return s?a/s:void 0},Yo.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),a=+t[i-1],o=n-i;return o?a+o*(t[i]-a):a},Yo.median=function(n,i){return arguments.length>1&&(n=n.map(i)),n=n.filter(e),n.length?Yo.quantile(n.sort(t),.5):void 0};var rr=n(t);Yo.bisectLeft=rr.left,Yo.bisect=Yo.bisectRight=rr.right,Yo.bisector=function(e){return n(1===e.length?function(n,i){return t(e(n),i)}:e)},Yo.shuffle=function(t){for(var e,n,i=t.length;i;)n=Math.random()*i--|0,e=t[i],t[i]=t[n],t[n]=e;return t},Yo.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},Yo.pairs=function(t){for(var e=0,n=t.length-1,i=t[0],a=new Array(n<0?0:n);e<n;)a[e]=[i,i=t[++e]];return a},Yo.zip=function(){if(!(a=arguments.length))return[];for(var t=-1,e=Yo.min(arguments,i),n=new Array(e);++t<e;)for(var a,o=-1,r=n[t]=new Array(a);++o<a;)r[o]=arguments[o][t];return n},Yo.transpose=function(t){return Yo.zip.apply(Yo,t)},Yo.keys=function(t){var e=[];for(var n in t)e.push(n);return e},Yo.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},Yo.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},Yo.merge=function(t){for(var e,n,i,a=t.length,o=-1,r=0;++o<a;)r+=t[o].length;for(n=new Array(r);--a>=0;)for(i=t[a],e=i.length;--e>=0;)n[--r]=i[e];return n};var sr=Math.abs;Yo.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var i,o=[],r=a(sr(n)),s=-1;if(t*=r,e*=r,n*=r,n<0)for(;(i=t+n*++s)>e;)o.push(i/r);else for(;(i=t+n*++s)<e;)o.push(i/r);return o},Yo.map=function(t){var e=new r;if(t instanceof r)t.forEach(function(t,n){e.set(t,n)});else for(var n in t)e.set(n,t[n]);return e},o(r,{has:s,get:function(t){return this[lr+t]},set:function(t,e){return this[lr+t]=e},remove:l,keys:u,values:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},entries:function(){var t=[];return this.forEach(function(e,n){t.push({key:e,value:n})}),t},size:c,empty:d,forEach:function(t){for(var e in this)e.charCodeAt(0)===ur&&t.call(this,e.substring(1),this[e])}});var lr="\0",ur=lr.charCodeAt(0);Yo.nest=function(){function t(e,s,l){if(l>=o.length)return i?i.call(a,s):n?s.sort(n):s;for(var u,c,d,h,f=-1,p=s.length,m=o[l++],g=new r;++f<p;)(h=g.get(u=m(c=s[f])))?h.push(c):g.set(u,[c]);return e?(c=e(),d=function(n,i){c.set(n,t(e,i,l))}):(c={},d=function(n,i){c[n]=t(e,i,l)}),g.forEach(d),c}function e(t,n){if(n>=o.length)return t;var i=[],a=s[n++];return t.forEach(function(t,a){i.push({key:t,values:e(a,n)})}),a?i.sort(function(t,e){return a(t.key,e.key)}):i}var n,i,a={},o=[],s=[];return a.map=function(e,n){return t(n,e,0)},a.entries=function(n){return e(t(Yo.map,n,0),0)},a.key=function(t){return o.push(t),a},a.sortKeys=function(t){return s[o.length-1]=t,a},a.sortValues=function(t){return n=t,a},a.rollup=function(t){return i=t,a},a},Yo.set=function(t){var e=new h;if(t)for(var n=0,i=t.length;n<i;++n)e.add(t[n]);return e},o(h,{has:s,add:function(t){return this[lr+t]=!0,t},remove:function(t){return(t=lr+t)in this&&delete this[t]},values:u,size:c,empty:d,forEach:function(t){for(var e in this)e.charCodeAt(0)===ur&&t.call(this,e.substring(1))}}),Yo.behavior={},Yo.rebind=function(t,e){for(var n,i=1,a=arguments.length;++i<a;)t[n=arguments[i]]=f(t,e,e[n]);return t};var cr=["webkit","ms","moz","Moz","o","O"];Yo.dispatch=function(){for(var t=new g,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=v(t);return t},g.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.substring(n+1),t=t.substring(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},Yo.event=null,Yo.requote=function(t){return t.replace(dr,"\\$&")};var dr=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,hr={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},fr=function(t,e){return e.querySelector(t)},pr=function(t,e){return e.querySelectorAll(t)},mr=Zo[p(Zo,"matchesSelector")],gr=function(t,e){return mr.call(t,e)};"function"==typeof Sizzle&&(fr=function(t,e){return Sizzle(t,e)[0]||null},pr=Sizzle,gr=Sizzle.matchesSelector),Yo.selection=function(){return xr};var vr=Yo.selection.prototype=[];vr.select=function(t){var e,n,i,a,o=[];t=b(t);for(var r=-1,s=this.length;++r<s;){o.push(e=[]),e.parentNode=(i=this[r]).parentNode;for(var l=-1,u=i.length;++l<u;)(a=i[l])?(e.push(n=t.call(a,a.__data__,l,r)),n&&"__data__"in a&&(n.__data__=a.__data__)):e.push(null)}return w(o)},vr.selectAll=function(t){var e,n,i=[];t=C(t);for(var a=-1,o=this.length;++a<o;)for(var r=this[a],s=-1,l=r.length;++s<l;)(n=r[s])&&(i.push(e=Jo(t.call(n,n.__data__,s,a))),e.parentNode=n);return w(i)};var yr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Yo.ns={prefix:yr,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.substring(0,e),t=t.substring(e+1)),yr.hasOwnProperty(n)?{space:yr[n],local:t}:t}},vr.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=Yo.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(A(e,t[e]));return this}return this.each(A(t,e))},vr.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=R(t)).length,a=-1;if(e=n.classList){for(;++a<i;)if(!e.contains(t[a]))return!1}else for(e=n.getAttribute("class");++a<i;)if(!T(t[a]).test(e))return!1;return!0}for(e in t)this.each(S(e,t[e]));return this}return this.each(S(t,e))},vr.style=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e="");for(n in t)this.each(O(n,t[n],e));return this}if(i<2)return tr.getComputedStyle(this.node(),null).getPropertyValue(t);n=""}return this.each(O(t,e,n))},vr.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(M(e,t[e]));return this}return this.each(M(t,e))},vr.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},vr.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},vr.append=function(t){return t=I(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},vr.insert=function(t,e){return t=I(t),e=b(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},vr.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},vr.data=function(t,e){function n(t,n){var i,a,o,s=t.length,d=n.length,h=Math.min(s,d),f=new Array(d),p=new Array(d),m=new Array(s);if(e){var g,v=new r,y=new r,E=[];for(i=-1;++i<s;)g=e.call(a=t[i],a.__data__,i),v.has(g)?m[i]=a:v.set(g,a),E.push(g);for(i=-1;++i<d;)g=e.call(n,o=n[i],i),(a=v.get(g))?(f[i]=a,a.__data__=o):y.has(g)||(p[i]=_(o)),y.set(g,o),v.remove(g);for(i=-1;++i<s;)v.has(E[i])&&(m[i]=t[i])}else{for(i=-1;++i<h;)a=t[i],o=n[i],a?(a.__data__=o,f[i]=a):p[i]=_(o);for(;i<d;++i)p[i]=_(n[i]);for(;i<s;++i)m[i]=t[i]}p.update=f,p.parentNode=f.parentNode=m.parentNode=t.parentNode,l.push(p),u.push(f),c.push(m)}var i,a,o=-1,s=this.length;if(!arguments.length){for(t=new Array(s=(i=this[0]).length);++o<s;)(a=i[o])&&(t[o]=a.__data__);return t}var l=L([]),u=w([]),c=w([]);if("function"==typeof t)for(;++o<s;)n(i=this[o],t.call(i,i.parentNode.__data__,o));else for(;++o<s;)n(i=this[o],t);return u.enter=function(){return l},u.exit=function(){return c},u},vr.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},vr.filter=function(t){var e,n,i,a=[];"function"!=typeof t&&(t=P(t));for(var o=0,r=this.length;o<r;o++){a.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,o)&&e.push(i)}return w(a)},vr.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],a=i.length-1,o=i[a];--a>=0;)(n=i[a])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},vr.sort=function(t){t=F.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},vr.each=function(t){return N(this,function(e,n,i){t.call(e,e.__data__,n,i)})},vr.call=function(t){var e=Jo(arguments);return t.apply(e[0]=this,e),this},vr.empty=function(){return!this.node()},vr.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],i=0,a=n.length;i<a;i++){var o=n[i];if(o)return o}return null},vr.size=function(){var t=0;return this.each(function(){++t}),t};var Er=[];Yo.selection.enter=L,Yo.selection.enter.prototype=Er,Er.append=vr.append,Er.empty=vr.empty,Er.node=vr.node,Er.call=vr.call,Er.size=vr.size,Er.select=function(t){for(var e,n,i,a,o,r=[],s=-1,l=this.length;++s<l;){i=(a=this[s]).update,r.push(e=[]),e.parentNode=a.parentNode;for(var u=-1,c=a.length;++u<c;)(o=a[u])?(e.push(i[u]=n=t.call(a.parentNode,o.__data__,u,s)),n.__data__=o.__data__):e.push(null)}return w(r)},Er.insert=function(t,e){return arguments.length<2&&(e=B(this)),vr.insert.call(this,t,e)},vr.transition=function(){for(var t,e,n=kl||++Ol,i=[],a=Tl||{time:Date.now(),ease:Ai,delay:0,duration:250},o=-1,r=this.length;++o<r;){i.push(t=[]);for(var s=this[o],l=-1,u=s.length;++l<u;)(e=s[l])&&Go(e,l,n,a),t.push(e)}return Bo(i,n)},vr.interrupt=function(){return this.each(H)},Yo.select=function(t){var e=["string"==typeof t?fr(t,Qo):t];return e.parentNode=Zo,w([e])},Yo.selectAll=function(t){var e=Jo("string"==typeof t?pr(t,Qo):t);return e.parentNode=Zo,w([e])};var xr=Yo.select(Zo);vr.on=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e=!1);for(n in t)this.each(X(n,t[n],e));return this}if(i<2)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(X(t,e,n))};var wr=Yo.map({mouseenter:"mouseover",mouseleave:"mouseout"});wr.forEach(function(t){"on"+t in Qo&&wr.remove(t)});var br="onselectstart"in Qo?null:p(Zo.style,"userSelect"),Cr=0;Yo.mouse=function(t){return W(t,E())},Yo.touches=function(t,e){return arguments.length<2&&(e=E().touches),e?Jo(e).map(function(e){var n=W(t,e);return n.identifier=e.identifier,n}):[]},Yo.behavior.drag=function(){function t(){this.on("mousedown.drag",a).on("touchstart.drag",o)}function e(t,e,a,o,r){return function(){function s(){var t,n,i=e(h,m);i&&(t=i[0]-E[0],n=i[1]-E[1],p|=t|n,E=i,f({type:"drag",x:i[0]+u[0],y:i[1]+u[1],dx:t,dy:n}))}function l(){e(h,m)&&(v.on(o+g,null).on(r+g,null),y(p&&Yo.event.target===d),f({type:"dragend"}))}var u,c=this,d=Yo.event.target,h=c.parentNode,f=n.of(c,arguments),p=0,m=t(),g=".drag"+(null==m?"":"-"+m),v=Yo.select(a()).on(o+g,s).on(r+g,l),y=U(),E=e(h,m);i?(u=i.apply(c,arguments),u=[u.x-E[0],u.y-E[1]]):u=[0,0],f({type:"dragstart"})}}var n=x(t,"drag","dragstart","dragend"),i=null,a=e(m,Yo.mouse,q,"mousemove","mouseup"),o=e(j,Yo.touch,z,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},Yo.rebind(t,n,"on")};var Ar=Math.PI,kr=2*Ar,Tr=Ar/2,Rr=1e-6,Sr=Rr*Rr,Dr=Ar/180,Or=180/Ar,Mr=Math.SQRT2,Ir=2;Yo.interpolateZoom=function(t,e){function n(t){var e=t*y;if(v){var n=Z(m),r=o/(Ir*h)*(n*tt(Mr*e+m)-Q(m));return[i+r*u,a+r*c,o*n/Z(Mr*e+m)]}return[i+t*u,a+t*c,o*Math.exp(Mr*e)]}var i=t[0],a=t[1],o=t[2],r=e[0],s=e[1],l=e[2],u=r-i,c=s-a,d=u*u+c*c,h=Math.sqrt(d),f=(l*l-o*o+4*d)/(2*o*Ir*h),p=(l*l-o*o-4*d)/(2*l*Ir*h),m=Math.log(Math.sqrt(f*f+1)-f),g=Math.log(Math.sqrt(p*p+1)-p),v=g-m,y=(v||Math.log(l/o))/Mr;return n.duration=1e3*y,n},Yo.behavior.zoom=function(){function t(t){t.on(R,u).on(Fr+".zoom",d).on(S,h).on("dblclick.zoom",f).on(O,c)}function e(t){return[(t[0]-A.x)/A.k,(t[1]-A.y)/A.k]}function n(t){return[t[0]*A.k+A.x,t[1]*A.k+A.y]}function i(t){A.k=Math.max(T[0],Math.min(T[1],t))}function a(t,e){e=n(e),A.x+=t[0]-e[0],A.y+=t[1]-e[1]}function o(){w&&w.domain(E.range().map(function(t){return(t-A.x)/A.k}).map(E.invert)),C&&C.domain(b.range().map(function(t){return(t-A.y)/A.k}).map(b.invert))}function r(t){t({type:"zoomstart"})}function s(t){o(),t({type:"zoom",scale:A.k,translate:[A.x,A.y]})}function l(t){t({type:"zoomend"})}function u(){function t(){c=1,a(Yo.mouse(i),f),s(u)}function n(){d.on(S,tr===i?h:null).on(D,null),p(c&&Yo.event.target===o),l(u)}var i=this,o=Yo.event.target,u=M.of(i,arguments),c=0,d=Yo.select(tr).on(S,t).on(D,n),f=e(Yo.mouse(i)),p=U();H.call(i),r(u)}function c(){function t(){var t=Yo.touches(f);return h=A.k,t.forEach(function(t){t.identifier in m&&(m[t.identifier]=e(t))}),t}function n(){var e=Yo.event.target;Yo.select(e).on(x,o).on(w,d),b.push(e);for(var n=Yo.event.changedTouches,r=0,l=n.length;r<l;++r)m[n[r].identifier]=null;var u=t(),c=Date.now();if(1===u.length){if(c-v<500){var h=u[0],f=m[h.identifier];i(2*A.k),a(h,f),y(),s(p)}v=c}else if(u.length>1){var h=u[0],E=u[1],C=h[0]-E[0],k=h[1]-E[1];g=C*C+k*k}}function o(){for(var t,e,n,o,r=Yo.touches(f),l=0,u=r.length;l<u;++l,o=null)if(n=r[l],o=m[n.identifier]){if(e)break;t=n,e=o}if(o){var c=(c=n[0]-t[0])*c+(c=n[1]-t[1])*c,d=g&&Math.sqrt(c/g);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+o[0])/2,(e[1]+o[1])/2],i(d*h)}v=null,a(t,e),s(p)}function d(){if(Yo.event.touches.length){for(var e=Yo.event.changedTouches,n=0,i=e.length;n<i;++n)delete m[e[n].identifier];for(var a in m)return void t()}Yo.selectAll(b).on(E,null),C.on(R,u).on(O,c),k(),l(p)}var h,f=this,p=M.of(f,arguments),m={},g=0,E=".zoom-"+Yo.event.changedTouches[0].identifier,x="touchmove"+E,w="touchend"+E,b=[],C=Yo.select(f).on(R,null).on(O,n),k=U();H.call(f),n(),r(p)}function d(){var t=M.of(this,arguments);g?clearTimeout(g):(H.call(this),r(t)),g=setTimeout(function(){g=null,l(t)},50),y();var n=m||Yo.mouse(this);p||(p=e(n)),i(Math.pow(2,.002*_r())*A.k),a(n,p),s(t)}function h(){p=null}function f(){var t=M.of(this,arguments),n=Yo.mouse(this),o=e(n),u=Math.log(A.k)/Math.LN2;r(t),i(Math.pow(2,Yo.event.shiftKey?Math.ceil(u)-1:Math.floor(u)+1)),a(n,o),s(t),l(t)}var p,m,g,v,E,w,b,C,A={x:0,y:0,k:1},k=[960,500],T=Pr,R="mousedown.zoom",S="mousemove.zoom",D="mouseup.zoom",O="touchstart.zoom",M=x(t,"zoomstart","zoom","zoomend");return t.event=function(t){t.each(function(){var t=M.of(this,arguments),e=A;kl?Yo.select(this).transition().each("start.zoom",function(){A=this.__chart__||{x:0,y:0,k:1},r(t)}).tween("zoom:zoom",function(){var n=k[0],i=k[1],a=n/2,o=i/2,r=Yo.interpolateZoom([(a-A.x)/A.k,(o-A.y)/A.k,n/A.k],[(a-e.x)/e.k,(o-e.y)/e.k,n/e.k]);return function(e){var i=r(e),l=n/i[2];this.__chart__=A={x:a-i[0]*l,y:o-i[1]*l,k:l},s(t)}}).each("end.zoom",function(){l(t)}):(this.__chart__=A,r(t),s(t),l(t))})},t.translate=function(e){return arguments.length?(A={x:+e[0],y:+e[1],k:A.k},o(),t):[A.x,A.y]},t.scale=function(e){return arguments.length?(A={x:A.x,y:A.y,k:+e},o(),t):A.k},t.scaleExtent=function(e){return arguments.length?(T=null==e?Pr:[+e[0],+e[1]],t):T},t.center=function(e){return arguments.length?(m=e&&[+e[0],+e[1]],t):m},t.size=function(e){return arguments.length?(k=e&&[+e[0],+e[1]],t):k},t.x=function(e){return arguments.length?(w=e,E=e.copy(),A={x:0,y:0,k:1},t):w},t.y=function(e){return arguments.length?(C=e,b=e.copy(),A={x:0,y:0,k:1},t):C},Yo.rebind(t,M,"on")};var _r,Pr=[0,1/0],Fr="onwheel"in Qo?(_r=function(){return-Yo.event.deltaY*(Yo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Qo?(_r=function(){return Yo.event.wheelDelta},"mousewheel"):(_r=function(){return-Yo.event.detail},"MozMousePixelScroll");nt.prototype.toString=function(){return this.rgb()+""},Yo.hsl=function(t,e,n){return 1===arguments.length?t instanceof at?it(t.h,t.s,t.l):wt(""+t,bt,it):it(+t,+e,+n)};var Nr=at.prototype=new nt;Nr.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),it(this.h,this.s,this.l/t)},Nr.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),it(this.h,this.s,t*this.l)},Nr.rgb=function(){return ot(this.h,this.s,this.l)},Yo.hcl=function(t,e,n){return 1===arguments.length?t instanceof st?rt(t.h,t.c,t.l):t instanceof ct?ht(t.l,t.a,t.b):ht((t=Ct((t=Yo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):rt(+t,+e,+n)};var Lr=st.prototype=new nt;Lr.brighter=function(t){return rt(this.h,this.c,Math.min(100,this.l+Br*(arguments.length?t:1)))},Lr.darker=function(t){return rt(this.h,this.c,Math.max(0,this.l-Br*(arguments.length?t:1)))},Lr.rgb=function(){return lt(this.h,this.c,this.l).rgb()},Yo.lab=function(t,e,n){return 1===arguments.length?t instanceof ct?ut(t.l,t.a,t.b):t instanceof st?lt(t.l,t.c,t.h):Ct((t=Yo.rgb(t)).r,t.g,t.b):ut(+t,+e,+n)};var Br=18,Hr=.95047,Xr=1,Gr=1.08883,Vr=ct.prototype=new nt;Vr.brighter=function(t){return ut(Math.min(100,this.l+Br*(arguments.length?t:1)),this.a,this.b)},Vr.darker=function(t){return ut(Math.max(0,this.l-Br*(arguments.length?t:1)),this.a,this.b)},Vr.rgb=function(){return dt(this.l,this.a,this.b)},Yo.rgb=function(t,e,n){return 1===arguments.length?t instanceof Et?yt(t.r,t.g,t.b):wt(""+t,yt,ot):yt(~~t,~~e,~~n)};var Ur=Et.prototype=new nt;Ur.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,a=30;return e||n||i?(e&&e<a&&(e=a),n&&n<a&&(n=a),i&&i<a&&(i=a),yt(Math.min(255,~~(e/t)),Math.min(255,~~(n/t)),Math.min(255,~~(i/t)))):yt(a,a,a)},Ur.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),yt(~~(t*this.r),~~(t*this.g),~~(t*this.b))},Ur.hsl=function(){return bt(this.r,this.g,this.b)},Ur.toString=function(){return"#"+xt(this.r)+xt(this.g)+xt(this.b)};var Wr=Yo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Wr.forEach(function(t,e){Wr.set(t,gt(e))}),Yo.functor=Tt,Yo.xhr=St(Rt),Yo.dsv=function(t,e){function n(t,n,o){arguments.length<3&&(o=n,n=null);var r=Dt(t,e,null==n?i:a(n),o);return r.row=function(t){return arguments.length?r.response(null==(n=t)?i:a(t)):n},r}function i(t){return n.parse(t.responseText)}function a(t){return function(e){return n.parse(e.responseText,t)}}function o(e){return e.map(r).join(t)}function r(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var a=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(a(t),n)}:a})},n.parseRows=function(t,e){function n(){if(c>=u)return r;if(a)return a=!1,o;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}c=n+2;var i=t.charCodeAt(n+1);return 13===i?(a=!0,10===t.charCodeAt(n+2)&&++c):10===i&&(a=!0),t.substring(e+1,n).replace(/""/g,'"')}for(;c<u;){var i=t.charCodeAt(c++),s=1;if(10===i)a=!0;else if(13===i)a=!0,10===t.charCodeAt(c)&&(++c,++s);else if(i!==l)continue;return t.substring(e,c-s)}return t.substring(e)}for(var i,a,o={},r={},s=[],u=t.length,c=0,d=0;(i=n())!==r;){for(var h=[];i!==o&&i!==r;)h.push(i),i=n();e&&!(h=e(h,d++))||s.push(h)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new h,a=[];return e.forEach(function(t){for(var e in t)i.has(e)||a.push(i.add(e))}),[a.map(r).join(t)].concat(e.map(function(e){return a.map(function(t){return r(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(o).join("\n")},n},Yo.csv=Yo.dsv(",","text/csv"),Yo.tsv=Yo.dsv("\t","text/tab-separated-values"),Yo.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=E().changedTouches),e)for(var i,a=0,o=e.length;a<o;++a)if((i=e[a]).identifier===n)return W(t,i)};var jr,zr,qr,$r,Yr,Kr=tr[p(tr,"requestAnimationFrame")]||function(t){setTimeout(t,17)};Yo.timer=function(t,e,n){var i=arguments.length;i<2&&(e=0),i<3&&(n=Date.now());var a=n+e,o={c:t,t:a,f:!1,n:null};zr?zr.n=o:jr=o,zr=o,qr||($r=clearTimeout($r),qr=1,Kr(Mt))},Yo.timer.flush=function(){It(),_t()},Yo.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Jr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Ft);Yo.formatPrefix=function(t,e){var n=0;return t&&(t<0&&(t*=-1),e&&(t=Yo.round(t,Pt(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Jr[8+n/3]};var Qr=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Zr=Yo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=Yo.round(t,Pt(t,e))).toFixed(Math.max(0,Math.min(20,Pt(t*(1+1e-15),e))))}}),ts=Yo.time={},es=Date;Bt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ns.setUTCDate.apply(this._,arguments)},setDay:function(){ns.setUTCDay.apply(this._,arguments)},setFullYear:function(){ns.setUTCFullYear.apply(this._,arguments)},setHours:function(){ns.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ns.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ns.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ns.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ns.setUTCSeconds.apply(this._,arguments)},setTime:function(){ns.setTime.apply(this._,arguments)}};var ns=Date.prototype;ts.year=Ht(function(t){return t=ts.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),ts.years=ts.year.range,ts.years.utc=ts.year.utc.range,ts.day=Ht(function(t){var e=new es(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),ts.days=ts.day.range,ts.days.utc=ts.day.utc.range,ts.dayOfYear=function(t){var e=ts.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=ts[t]=Ht(function(t){return(t=ts.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=ts.year(t).getDay();return Math.floor((ts.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});ts[t+"s"]=n.range,ts[t+"s"].utc=n.utc.range,ts[t+"OfYear"]=function(t){var n=ts.year(t).getDay();return Math.floor((ts.dayOfYear(t)+(n+e)%7)/7)}}),ts.week=ts.sunday,ts.weeks=ts.sunday.range,ts.weeks.utc=ts.sunday.utc.range,ts.weekOfYear=ts.sundayOfYear;var is={"-":"",_:" ",0:"0"},as=/^\s*\d+/,os=/^%/;Yo.locale=function(t){return{numberFormat:Nt(t),timeFormat:Gt(t)}};var rs=Yo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Yo.format=rs.numberFormat,Yo.geo={},le.prototype={s:0,t:0,add:function(t){ue(t,this.t,ss),ue(ss.s,this.s,this),this.s?this.t+=ss.t:this.s=ss.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ss=new le;Yo.geo.stream=function(t,e){t&&ls.hasOwnProperty(t.type)?ls[t.type](t,e):ce(t,e)};var ls={Feature:function(t,e){ce(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,a=n.length;++i<a;)ce(n[i].geometry,e)}},us={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,a=n.length;++i<a;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){de(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,a=n.length;++i<a;)de(n[i],e,0)},Polygon:function(t,e){he(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,a=n.length;++i<a;)he(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,a=n.length;++i<a;)ce(n[i],e)}};Yo.geo.area=function(t){return cs=0,Yo.geo.stream(t,hs),cs};var cs,ds=new le,hs={sphere:function(){cs+=4*Ar},point:m,lineStart:m,lineEnd:m,polygonStart:function(){ds.reset(),hs.lineStart=fe},polygonEnd:function(){var t=2*ds;cs+=t<0?4*Ar+t:t,hs.lineStart=hs.lineEnd=hs.point=m}};Yo.geo.bounds=function(){function t(t,e){E.push(x=[c=t,h=t]),e<d&&(d=e),e>f&&(f=e)}function e(e,n){var i=pe([e*Dr,n*Dr]);if(v){var a=ge(v,i),o=[a[1],-a[0],0],r=ge(o,a);Ee(r),r=xe(r);var l=e-p,u=l>0?1:-1,m=r[0]*Or*u,g=sr(l)>180;if(g^(u*p<m&&m<u*e)){var y=r[1]*Or;y>f&&(f=y)}else if(m=(m+360)%360-180,g^(u*p<m&&m<u*e)){var y=-r[1]*Or;y<d&&(d=y)}else n<d&&(d=n),n>f&&(f=n);g?e<p?s(c,e)>s(c,h)&&(h=e):s(e,h)>s(c,h)&&(c=e):h>=c?(e<c&&(c=e),e>h&&(h=e)):e>p?s(c,e)>s(c,h)&&(h=e):s(e,h)>s(c,h)&&(c=e)}else t(e,n);v=i,p=e}function n(){w.point=e}function i(){x[0]=c,x[1]=h,w.point=t,v=null}function a(t,n){if(v){var i=t-p;y+=sr(i)>180?i+(i>0?360:-360):i}else m=t,g=n;hs.point(t,n),e(t,n)}function o(){hs.lineStart()}function r(){a(m,g),hs.lineEnd(),sr(y)>Rr&&(c=-(h=180)),x[0]=c,x[1]=h,v=null}function s(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function u(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var c,d,h,f,p,m,g,v,y,E,x,w={point:t,lineStart:n,lineEnd:i,polygonStart:function(){w.point=a,w.lineStart=o,w.lineEnd=r,y=0,hs.polygonStart()},polygonEnd:function(){hs.polygonEnd(),w.point=t,w.lineStart=n,w.lineEnd=i,ds<0?(c=-(h=180),d=-(f=90)):y>Rr?f=90:y<-Rr&&(d=-90),x[0]=c,x[1]=h}};return function(t){f=h=-(c=d=1/0),E=[],Yo.geo.stream(t,w);var e=E.length;if(e){E.sort(l);for(var n,i=1,a=E[0],o=[a];i<e;++i)n=E[i],u(n[0],a)||u(n[1],a)?(s(a[0],n[1])>s(a[0],a[1])&&(a[1]=n[1]),s(n[0],a[1])>s(a[0],a[1])&&(a[0]=n[0])):o.push(a=n);for(var r,n,p=-1/0,e=o.length-1,i=0,a=o[e];i<=e;a=n,++i)n=o[i],(r=s(a[1],n[0]))>p&&(p=r,c=n[0],h=a[1])}return E=x=null,c===1/0||d===1/0?[[NaN,NaN],[NaN,NaN]]:[[c,d],[h,f]]}}(),Yo.geo.centroid=function(t){fs=ps=ms=gs=vs=ys=Es=xs=ws=bs=Cs=0,Yo.geo.stream(t,As);var e=ws,n=bs,i=Cs,a=e*e+n*n+i*i;return a<Sr&&(e=ys,n=Es,i=xs,ps<Rr&&(e=ms,n=gs,i=vs),(a=e*e+n*n+i*i)<Sr)?[NaN,NaN]:[Math.atan2(n,e)*Or,J(i/Math.sqrt(a))*Or]};var fs,ps,ms,gs,vs,ys,Es,xs,ws,bs,Cs,As={sphere:m,point:be,lineStart:Ae,lineEnd:ke,polygonStart:function(){As.lineStart=Te},polygonEnd:function(){As.lineStart=Ae}},ks=Me(Re,Ne,Be,[-Ar,-Ar/2]),Ts=1e9;Yo.geo.clipExtent=function(){var t,e,n,i,a,o,r={stream:function(t){return a&&(a.valid=!1),a=o(t),a.valid=!0,a},extent:function(s){return arguments.length?(o=Ge(t=+s[0][0],e=+s[0][1],n=+s[1][0],i=+s[1][1]),a&&(a.valid=!1,a=null),r):[[t,e],[n,i]]}};return r.extent([[0,0],[960,500]])},(Yo.geo.conicEqualArea=function(){return Ue(We)}).raw=We,Yo.geo.albers=function(){return Yo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},Yo.geo.albersUsa=function(){function t(t){var o=t[0],r=t[1];return e=null,n(o,r),e||(i(o,r),e)||a(o,r),e}var e,n,i,a,o=Yo.geo.albers(),r=Yo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=Yo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=o.scale(),n=o.translate(),i=(t[0]-n[0])/e,a=(t[1]-n[1])/e;return(a>=.12&&a<.234&&i>=-.425&&i<-.214?r:a>=.166&&a<.234&&i>=-.214&&i<-.115?s:o).invert(t)},t.stream=function(t){var e=o.stream(t),n=r.stream(t),i=s.stream(t);return{point:function(t,a){e.point(t,a),n.point(t,a),i.point(t,a)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(o.precision(e),r.precision(e),s.precision(e),t):o.precision()},t.scale=function(e){return arguments.length?(o.scale(e),r.scale(.35*e),s.scale(e),t.translate(o.translate())):o.scale()},t.translate=function(e){if(!arguments.length)return o.translate();var u=o.scale(),c=+e[0],d=+e[1];return n=o.translate(e).clipExtent([[c-.455*u,d-.238*u],[c+.455*u,d+.238*u]]).stream(l).point,i=r.translate([c-.307*u,d+.201*u]).clipExtent([[c-.425*u+Rr,d+.12*u+Rr],[c-.214*u-Rr,d+.234*u-Rr]]).stream(l).point,a=s.translate([c-.205*u,d+.212*u]).clipExtent([[c-.214*u+Rr,d+.166*u+Rr],[c-.115*u-Rr,d+.234*u-Rr]]).stream(l).point,t},t.scale(1070)};var Rs,Ss,Ds,Os,Ms,Is,_s={point:m,lineStart:m,lineEnd:m,polygonStart:function(){Ss=0,_s.lineStart=je},polygonEnd:function(){_s.lineStart=_s.lineEnd=_s.point=m,Rs+=sr(Ss/2)}},Ps={point:ze,lineStart:m,lineEnd:m,polygonStart:m,polygonEnd:m},Fs={point:Ye,lineStart:Ke,lineEnd:Je,polygonStart:function(){Fs.lineStart=Qe},polygonEnd:function(){Fs.point=Ye,Fs.lineStart=Ke,Fs.lineEnd=Je}};Yo.geo.path=function(){function t(t){return t&&("function"==typeof s&&o.pointRadius(+s.apply(this,arguments)),r&&r.valid||(r=a(o)),Yo.geo.stream(t,r)),o.result()}function e(){return r=null,t}var n,i,a,o,r,s=4.5;return t.area=function(t){return Rs=0,Yo.geo.stream(t,a(_s)),Rs},t.centroid=function(t){return ms=gs=vs=ys=Es=xs=ws=bs=Cs=0,Yo.geo.stream(t,a(Fs)),Cs?[ws/Cs,bs/Cs]:xs?[ys/xs,Es/xs]:vs?[ms/vs,gs/vs]:[NaN,NaN]},t.bounds=function(t){return Ms=Is=-(Ds=Os=1/0),Yo.geo.stream(t,a(Ps)),[[Ds,Os],[Ms,Is]]},t.projection=function(t){return arguments.length?(a=(n=t)?t.stream||en(t):Rt,e()):n},t.context=function(t){return arguments.length?(o=null==(i=t)?new qe:new Ze(t),"function"!=typeof s&&o.pointRadius(s),e()):i},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(o.pointRadius(+e),+e),t):s},t.projection(Yo.geo.albersUsa()).context(null)},Yo.geo.transform=function(t){return{stream:function(e){var n=new nn(e);for(var i in t)n[i]=t[i];return n}}},nn.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Yo.geo.projection=on,Yo.geo.projectionMutator=rn,(Yo.geo.equirectangular=function(){return on(ln)}).raw=ln.invert=ln,Yo.geo.rotation=function(t){function e(e){return e=t(e[0]*Dr,e[1]*Dr),e[0]*=Or,e[1]*=Or,e}return t=cn(t[0]%360*Dr,t[1]*Dr,t.length>2?t[2]*Dr:0),e.invert=function(e){return e=t.invert(e[0]*Dr,e[1]*Dr),e[0]*=Or,e[1]*=Or,e},e},un.invert=ln,Yo.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=cn(-t[0]*Dr,-t[1]*Dr,0).invert,a=[];return n(null,null,1,{point:function(t,n){a.push(t=e(t,n)),t[0]*=Or,t[1]*=Or}}),{type:"Polygon",coordinates:[a]}}var e,n,i=[0,0],a=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=pn((e=+i)*Dr,a*Dr),t):e},t.precision=function(i){return arguments.length?(n=pn(e*Dr,(a=+i)*Dr),t):a},t.angle(90)},Yo.geo.distance=function(t,e){var n,i=(e[0]-t[0])*Dr,a=t[1]*Dr,o=e[1]*Dr,r=Math.sin(i),s=Math.cos(i),l=Math.sin(a),u=Math.cos(a),c=Math.sin(o),d=Math.cos(o);return Math.atan2(Math.sqrt((n=d*r)*n+(n=u*c-l*d*s)*n),l*c+u*d*s)},Yo.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return Yo.range(Math.ceil(o/g)*g,a,g).map(h).concat(Yo.range(Math.ceil(u/v)*v,l,v).map(f)).concat(Yo.range(Math.ceil(i/p)*p,n,p).filter(function(t){return sr(t%g)>Rr}).map(c)).concat(Yo.range(Math.ceil(s/m)*m,r,m).filter(function(t){return sr(t%v)>Rr}).map(d))}var n,i,a,o,r,s,l,u,c,d,h,f,p=10,m=p,g=90,v=360,y=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[h(o).concat(f(l).slice(1),h(a).reverse().slice(1),f(u).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(o=+e[0][0],a=+e[1][0],u=+e[0][1],l=+e[1][1],o>a&&(e=o,o=a,a=e),u>l&&(e=u,u=l,l=e),t.precision(y)):[[o,u],[a,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],s=+e[0][1],r=+e[1][1],i>n&&(e=i,i=n,n=e),s>r&&(e=s,s=r,r=e),t.precision(y)):[[i,s],[n,r]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(g=+e[0],v=+e[1],t):[g,v]},t.minorStep=function(e){return arguments.length?(p=+e[0],m=+e[1],t):[p,m]},t.precision=function(e){return arguments.length?(y=+e,c=gn(s,r,90),d=vn(i,n,y),h=gn(u,l,90),f=vn(o,a,y),t):y},t.majorExtent([[-180,-90+Rr],[180,90-Rr]]).minorExtent([[-180,-80-Rr],[180,80+Rr]])},Yo.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||a.apply(this,arguments)]}}var e,n,i=yn,a=En;return t.distance=function(){return Yo.geo.distance(e||i.apply(this,arguments),n||a.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(a=e,n="function"==typeof e?null:e,t):a},t.precision=function(){return arguments.length?t:0},t},Yo.geo.interpolate=function(t,e){return xn(t[0]*Dr,t[1]*Dr,e[0]*Dr,e[1]*Dr)},Yo.geo.length=function(t){return Ns=0,Yo.geo.stream(t,Ls),Ns};var Ns,Ls={sphere:m,point:m,lineStart:wn,lineEnd:m,polygonStart:m,polygonEnd:m},Bs=bn(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(Yo.geo.azimuthalEqualArea=function(){return on(Bs)}).raw=Bs;var Hs=bn(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},Rt);(Yo.geo.azimuthalEquidistant=function(){return on(Hs)}).raw=Hs,(Yo.geo.conicConformal=function(){return Ue(Cn)}).raw=Cn,(Yo.geo.conicEquidistant=function(){return Ue(An)}).raw=An;var Xs=bn(function(t){return 1/t},Math.atan);(Yo.geo.gnomonic=function(){return on(Xs)}).raw=Xs,kn.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Tr]},(Yo.geo.mercator=function(){return Tn(kn)}).raw=kn;var Gs=bn(function(){return 1},Math.asin);(Yo.geo.orthographic=function(){return on(Gs)}).raw=Gs;var Vs=bn(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(Yo.geo.stereographic=function(){return on(Vs)}).raw=Vs,Rn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Tr]},(Yo.geo.transverseMercator=function(){var t=Tn(Rn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[-t[1],t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},t.rotate([0,0])}).raw=Rn,Yo.geom={},Yo.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,a=Tt(n),o=Tt(i),r=t.length,s=[],l=[];for(e=0;e<r;e++)s.push([+a.call(this,t[e],e),+o.call(this,t[e],e),e]);for(s.sort(Mn),e=0;e<r;e++)l.push([s[e][0],-s[e][1]]);var u=On(s),c=On(l),d=c[0]===u[0],h=c[c.length-1]===u[u.length-1],f=[];for(e=u.length-1;e>=0;--e)f.push(t[s[u[e]][2]]);for(e=+d;e<c.length-h;++e)f.push(t[s[c[e]][2]]);return f}var n=Sn,i=Dn;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},Yo.geom.polygon=function(t){return hr(t,Us),t};var Us=Yo.geom.polygon.prototype=[];Us.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],a=0;++e<n;)t=i,i=this[e],a+=t[1]*i[0]-t[0]*i[1];return.5*a},Us.centroid=function(t){var e,n,i=-1,a=this.length,o=0,r=0,s=this[a-1];for(arguments.length||(t=-1/(6*this.area()));++i<a;)e=s,s=this[i],n=e[0]*s[1]-s[0]*e[1],o+=(e[0]+s[0])*n,r+=(e[1]+s[1])*n;return[o*t,r*t]},Us.clip=function(t){for(var e,n,i,a,o,r,s=Pn(t),l=-1,u=this.length-Pn(this),c=this[u-1];++l<u;){for(e=t.slice(),t.length=0,a=this[l],o=e[(i=e.length-s)-1],n=-1;++n<i;)r=e[n],In(r,c,a)?(In(o,c,a)||t.push(_n(o,r,c,a)),t.push(r)):In(o,c,a)&&t.push(_n(o,r,c,a)),o=r;s&&t.push(t[0]),c=a}return t};var Ws,js,zs,qs,$s,Ys=[],Ks=[];Vn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Wn),e.length},ti.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},ei.prototype={insert:function(t,e){var n,i,a;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=oi(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(a=i.R,a&&a.C?(n.C=a.C=!1,i.C=!0,t=i):(t===n.R&&(ii(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ai(this,i))):(a=i.L,a&&a.C?(n.C=a.C=!1,i.C=!0,t=i):(t===n.L&&(ai(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ii(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,a=t.U,o=t.L,r=t.R;if(n=o?r?oi(r):o:r,a?a.L===t?a.L=n:a.R=n:this._=n,o&&r?(i=n.C,n.C=t.C,n.L=o,o.U=n,n!==r?(a=n.U,n.U=t.U,t=n.R,a.L=t,n.R=r,r.U=n):(n.U=a,a=n,t=n.R)):(i=t.C,t=n),t&&(t.U=a),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===a.L){if(e=a.R,e.C&&(e.C=!1,a.C=!0,ii(this,a),e=a.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ai(this,e),e=a.R),e.C=a.C,a.C=e.R.C=!1,ii(this,a),t=this._;break}}else if(e=a.L,e.C&&(e.C=!1,a.C=!0,ai(this,a),e=a.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ii(this,e),e=a.L),e.C=a.C,a.C=e.L.C=!1,ai(this,a),t=this._;break}e.C=!0,t=a,a=a.U}while(!t.C);t&&(t.C=!1)}}},Yo.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=s[0][0],a=s[0][1],o=s[1][0],r=s[1][1];return ri(n(t),s).cells.forEach(function(n,s){var l=n.edges,u=n.site;(e[s]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):u.x>=i&&u.x<=o&&u.y>=a&&u.y<=r?[[i,r],[o,r],[o,a],[i,a]]:[]).point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(o(t,e)/Rr)*Rr,y:Math.round(r(t,e)/Rr)*Rr,i:e}})}var i=Sn,a=Dn,o=i,r=a,s=Js;return t?e(t):(e.links=function(t){return ri(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return ri(n(t)).cells.forEach(function(n,i){for(var a,o=n.site,r=n.edges.sort(Wn),s=-1,l=r.length,u=r[l-1].edge,c=u.l===o?u.r:u.l;++s<l;)u,a=c,u=r[s].edge,c=u.l===o?u.r:u.l,i<a.i&&i<c.i&&li(o,a,c)<0&&e.push([t[i],t[a.i],t[c.i]])}),e},e.x=function(t){return arguments.length?(o=Tt(i=t),e):i},e.y=function(t){return arguments.length?(r=Tt(a=t),e):a},e.clipExtent=function(t){return arguments.length?(s=null==t?Js:t,e):s===Js?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===Js?null:s&&s[1]},e)};var Js=[[-1e6,-1e6],[1e6,1e6]];Yo.geom.delaunay=function(t){return Yo.geom.voronoi().triangles(t)},Yo.geom.quadtree=function(t,e,n,i,a){function o(t){function o(t,e,n,i,a,o,r,s){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,c=t.y;if(null!=l)if(sr(l-n)+sr(c-i)<.01)u(t,e,n,i,a,o,r,s);else{var d=t.point;t.x=t.y=t.point=null,u(t,d,l,c,a,o,r,s),u(t,e,n,i,a,o,r,s)}else t.x=n,t.y=i,t.point=e}else u(t,e,n,i,a,o,r,s)}function u(t,e,n,i,a,r,s,l){var u=.5*(a+s),c=.5*(r+l),d=n>=u,h=i>=c,f=(h<<1)+d;t.leaf=!1,t=t.nodes[f]||(t.nodes[f]=di()),d?a=u:s=u,h?r=c:l=c,o(t,e,n,i,a,r,s,l)}var c,d,h,f,p,m,g,v,y,E=Tt(s),x=Tt(l);if(null!=e)m=e,g=n,v=i,y=a;else if(v=y=-(m=g=1/0),d=[],h=[],p=t.length,r)for(f=0;f<p;++f)c=t[f],c.x<m&&(m=c.x),c.y<g&&(g=c.y),c.x>v&&(v=c.x),c.y>y&&(y=c.y),d.push(c.x),h.push(c.y);else for(f=0;f<p;++f){var w=+E(c=t[f],f),b=+x(c,f);w<m&&(m=w),b<g&&(g=b),w>v&&(v=w),b>y&&(y=b),d.push(w),h.push(b)}var C=v-m,A=y-g;C>A?y=g+C:v=m+A;var k=di();if(k.add=function(t){o(k,t,+E(t,++f),+x(t,f),m,g,v,y)},k.visit=function(t){hi(t,k,m,g,v,y)},f=-1,null==e){for(;++f<p;)o(k,t[f],d[f],h[f],m,g,v,y);--f}else t.forEach(k.add);return d=h=t=c=null,k}var r,s=Sn,l=Dn;return(r=arguments.length)?(s=ui,l=ci,3===r&&(a=n,i=e,n=e=0),o(t)):(o.x=function(t){return arguments.length?(s=t,o):s},o.y=function(t){return arguments.length?(l=t,o):l},o.extent=function(t){return arguments.length?(null==t?e=n=i=a=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],a=+t[1][1]),o):null==e?null:[[e,n],[i,a]]},o.size=function(t){return arguments.length?(null==t?e=n=i=a=null:(e=n=0,i=+t[0],a=+t[1]),o):null==e?null:[i-e,a-n]},o)},Yo.interpolateRgb=fi,Yo.interpolateObject=pi,Yo.interpolateNumber=mi,Yo.interpolateString=gi;var Qs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Zs=new RegExp(Qs.source,"g");Yo.interpolate=vi,Yo.interpolators=[function(t,e){var n=typeof e;return("string"===n?Wr.has(e)||/^(#|rgb\(|hsl\()/.test(e)?fi:gi:e instanceof nt?fi:Array.isArray(e)?yi:"object"===n&&isNaN(e)?pi:mi)(t,e)}],Yo.interpolateArray=yi;var tl=function(){return Rt},el=Yo.map({linear:tl,poly:ki,quad:function(){return bi},cubic:function(){return Ci},sin:function(){return Ti},exp:function(){return Ri},circle:function(){return Si},elastic:Di,back:Oi,bounce:function(){return Mi}}),nl=Yo.map({in:Rt,out:xi,"in-out":wi,"out-in":function(t){return wi(xi(t))}});Yo.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.substring(0,e):t,i=e>=0?t.substring(e+1):"in";return n=el.get(n)||tl,i=nl.get(i)||Rt,Ei(i(n.apply(null,Ko.call(arguments,1))))},Yo.interpolateHcl=Ii,Yo.interpolateHsl=_i,Yo.interpolateLab=Pi,Yo.interpolateRound=Fi,Yo.transform=function(t){var e=Qo.createElementNS(Yo.ns.prefix.svg,"g");return(Yo.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Ni(n?n.matrix:il)})(t)},Ni.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var il={a:1,b:0,c:0,d:1,e:0,f:0};Yo.interpolateTransform=Xi,Yo.layout={},Yo.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(Ui(t[n]));return e}},Yo.layout.chord=function(){function t(){var t,u,d,h,f,p={},m=[],g=Yo.range(o),v=[];for(n=[],i=[],t=0,h=-1;++h<o;){for(u=0,f=-1;++f<o;)u+=a[h][f];m.push(u),v.push(Yo.range(o)),t+=u}for(r&&g.sort(function(t,e){return r(m[t],m[e])}),s&&v.forEach(function(t,e){t.sort(function(t,n){return s(a[e][t],a[e][n])})}),t=(kr-c*o)/t,u=0,h=-1;++h<o;){for(d=u,f=-1;++f<o;){var y=g[h],E=v[y][f],x=a[y][E],w=u,b=u+=x*t;p[y+"-"+E]={index:y,subindex:E,startAngle:w,endAngle:b,value:x}}i[y]={index:y,startAngle:d,endAngle:u,value:(u-d)/t},u+=c}for(h=-1;++h<o;)for(f=h-1;++f<o;){var C=p[h+"-"+f],A=p[f+"-"+h];(C.value||A.value)&&n.push(C.value<A.value?{source:A,target:C}:{source:C,target:A})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,a,o,r,s,l,u={},c=0;return u.matrix=function(t){return arguments.length?(o=(a=t)&&a.length,n=i=null,u):a},u.padding=function(t){return arguments.length?(c=t,n=i=null,u):c},u.sortGroups=function(t){return arguments.length?(r=t,n=i=null,u):r},u.sortSubgroups=function(t){return arguments.length?(s=t,n=null,u):s},u.sortChords=function(t){return arguments.length?(l=t,n&&e(),u):l},u.chords=function(){return n||t(),n},u.groups=function(){return i||t(),i},u},Yo.layout.force=function(){function t(t){return function(e,n,i,a){if(e.point!==t){var o=e.cx-t.x,r=e.cy-t.y,s=a-n,l=o*o+r*r;if(s*s/g<l){if(l<p){var u=e.charge/l;t.px-=o*u,t.py-=r*u}return!0}if(e.point&&l&&l<p){var u=e.pointCharge/l;t.px-=o*u,t.py-=r*u}}return!e.charge}}function e(t){t.px=Yo.event.x,t.py=Yo.event.y,s.resume()}var n,i,a,o,r,s={},l=Yo.dispatch("start","tick","end"),u=[1,1],c=.9,d=al,h=ol,f=-30,p=rl,m=.1,g=.64,v=[],y=[];return s.tick=function(){if((i*=.99)<.005)return l.end({type:"end",alpha:i=0}),!0;var e,n,s,d,h,p,g,E,x,w=v.length,b=y.length;for(n=0;n<b;++n)s=y[n],d=s.source,h=s.target,E=h.x-d.x,x=h.y-d.y,(p=E*E+x*x)&&(p=i*o[n]*((p=Math.sqrt(p))-a[n])/p,E*=p,x*=p,h.x-=E*(g=d.weight/(h.weight+d.weight)),h.y-=x*g,d.x+=E*(g=1-g),d.y+=x*g);if((g=i*m)&&(E=u[0]/2,x=u[1]/2,n=-1,g))for(;++n<w;)s=v[n],s.x+=(E-s.x)*g,s.y+=(x-s.y)*g;if(f)for(Ki(e=Yo.geom.quadtree(v),i,r),n=-1;++n<w;)(s=v[n]).fixed||e.visit(t(s));for(n=-1;++n<w;)s=v[n],s.fixed?(s.x=s.px,s.y=s.py):(s.x-=(s.px-(s.px=s.x))*c,s.y-=(s.py-(s.py=s.y))*c);l.tick({type:"tick",alpha:i})},s.nodes=function(t){return arguments.length?(v=t,s):v},s.links=function(t){return arguments.length?(y=t,s):y},s.size=function(t){return arguments.length?(u=t,s):u},s.linkDistance=function(t){return arguments.length?(d="function"==typeof t?t:+t,s):d},s.distance=s.linkDistance,s.linkStrength=function(t){return arguments.length?(h="function"==typeof t?t:+t,s):h},s.friction=function(t){return arguments.length?(c=+t,s):c},s.charge=function(t){return arguments.length?(f="function"==typeof t?t:+t,s):f},s.chargeDistance=function(t){return arguments.length?(p=t*t,s):Math.sqrt(p)},s.gravity=function(t){return arguments.length?(m=+t,s):m},s.theta=function(t){return arguments.length?(g=t*t,s):Math.sqrt(g)},s.alpha=function(t){return arguments.length?(t=+t,i?i=t>0?t:0:t>0&&(l.start({type:"start",alpha:i=t}),Yo.timer(s.tick)),s):i},s.start=function(){function t(t,i){if(!n){for(n=new Array(l),s=0;s<l;++s)n[s]=[];for(s=0;s<u;++s){var a=y[s];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,r=n[e],s=-1,u=r.length;++s<u;)if(!isNaN(o=r[s][t]))return o;return Math.random()*i}var e,n,i,l=v.length,c=y.length,p=u[0],m=u[1];for(e=0;e<l;++e)(i=v[e]).index=e,i.weight=0;for(e=0;e<c;++e)i=y[e],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(e=0;e<l;++e)i=v[e],isNaN(i.x)&&(i.x=t("x",p)),isNaN(i.y)&&(i.y=t("y",m)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof d)for(e=0;e<c;++e)a[e]=+d.call(this,y[e],e);else for(e=0;e<c;++e)a[e]=d;if(o=[],"function"==typeof h)for(e=0;e<c;++e)o[e]=+h.call(this,y[e],e);else for(e=0;e<c;++e)o[e]=h;if(r=[],"function"==typeof f)for(e=0;e<l;++e)r[e]=+f.call(this,v[e],e);else for(e=0;e<l;++e)r[e]=f;return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){if(n||(n=Yo.behavior.drag().origin(Rt).on("dragstart.force",zi).on("drag.force",e).on("dragend.force",qi)),!arguments.length)return n;this.on("mouseover.force",$i).on("mouseout.force",Yi).call(n)},Yo.rebind(s,l,"on")};var al=20,ol=1,rl=1/0;Yo.layout.hierarchy=function(){function t(a){var o,r=[a],s=[];for(a.depth=0;null!=(o=r.pop());)if(s.push(o),(u=n.call(t,o,o.depth))&&(l=u.length)){for(var l,u,c;--l>=0;)r.push(c=u[l]),c.parent=o,c.depth=o.depth+1;i&&(o.value=0),o.children=u}else i&&(o.value=+i.call(t,o,o.depth)||0),delete o.children;return Zi(a,function(t){var n,a;e&&(n=t.children)&&n.sort(e),i&&(a=t.parent)&&(a.value+=t.value)}),s}var e=na,n=ta,i=ea;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(Qi(e,function(t){t.children&&(t.value=0)}),Zi(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},Yo.layout.partition=function(){function t(e,n,i,a){var o=e.children;if(e.x=n,e.y=e.depth*a,e.dx=i,e.dy=a,o&&(r=o.length)){var r,s,l,u=-1;for(i=e.value?i/e.value:0;++u<r;)t(s=o[u],n,l=s.value*i,a),n+=l}}function e(t){var n=t.children,i=0;if(n&&(a=n.length))for(var a,o=-1;++o<a;)i=Math.max(i,e(n[o]));return 1+i}function n(n,o){var r=i.call(this,n,o);return t(r[0],0,a[0],a[1]/e(r[0])),r}var i=Yo.layout.hierarchy(),a=[1,1];return n.size=function(t){return arguments.length?(a=t,n):a},Ji(n,i)},Yo.layout.pie=function(){function t(o){var r=o.map(function(n,i){return+e.call(t,n,i)}),s=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof a?a.apply(this,arguments):a)-s)/Yo.sum(r),u=Yo.range(o.length);null!=n&&u.sort(n===sl?function(t,e){return r[e]-r[t]}:function(t,e){return n(o[t],o[e])});var c=[];return u.forEach(function(t){var e;c[t]={data:o[t],value:e=r[t],startAngle:s,endAngle:s+=e*l}}),c}var e=Number,n=sl,i=0,a=kr;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(a=e,t):a},t};var sl={};Yo.layout.stack=function(){function t(s,l){var u=s.map(function(n,i){return e.call(t,n,i)}),c=u.map(function(e){return e.map(function(e,n){return[o.call(t,e,n),r.call(t,e,n)]})}),d=n.call(t,c,l);u=Yo.permute(u,d),c=Yo.permute(c,d);var h,f,p,m=i.call(t,c,l),g=u.length,v=u[0].length;for(f=0;f<v;++f)for(a.call(t,u[0][f],p=m[f],c[0][f][1]),h=1;h<g;++h)a.call(t,u[h][f],p+=c[h-1][f][1],c[h][f][1]);return s}var e=Rt,n=sa,i=la,a=ra,o=aa,r=oa;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:ll.get(e)||sa,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:ul.get(e)||la,t):i},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(r=e,t):r},t.out=function(e){return arguments.length?(a=e,t):a},t};var ll=Yo.map({"inside-out":function(t){var e,n,i=t.length,a=t.map(ua),o=t.map(ca),r=Yo.range(i).sort(function(t,e){return a[t]-a[e]}),s=0,l=0,u=[],c=[];for(e=0;e<i;++e)n=r[e],s<l?(s+=o[n],u.push(n)):(l+=o[n],c.push(n));return c.reverse().concat(u)},reverse:function(t){return Yo.range(t.length).reverse()},default:sa}),ul=Yo.map({silhouette:function(t){var e,n,i,a=t.length,o=t[0].length,r=[],s=0,l=[];for(n=0;n<o;++n){for(e=0,i=0;e<a;e++)i+=t[e][n][1];i>s&&(s=i),r.push(i)}for(n=0;n<o;++n)l[n]=(s-r[n])/2;return l},wiggle:function(t){var e,n,i,a,o,r,s,l,u,c=t.length,d=t[0],h=d.length,f=[];for(f[0]=l=u=0,n=1;n<h;++n){for(e=0,a=0;e<c;++e)a+=t[e][n][1];for(e=0,o=0,s=d[n][0]-d[n-1][0];e<c;++e){for(i=0,r=(t[e][n][1]-t[e][n-1][1])/(2*s);i<e;++i)r+=(t[i][n][1]-t[i][n-1][1])/s;o+=r*t[e][n][1]}f[n]=l-=a?o/a*s:0,l<u&&(u=l)}for(n=0;n<h;++n)f[n]-=u;return f},expand:function(t){var e,n,i,a=t.length,o=t[0].length,r=1/a,s=[];for(n=0;n<o;++n){for(e=0,i=0;e<a;e++)i+=t[e][n][1];if(i)for(e=0;e<a;e++)t[e][n][1]/=i;else for(e=0;e<a;e++)t[e][n][1]=r}for(n=0;n<o;++n)s[n]=0;return s},zero:la});Yo.layout.histogram=function(){function t(t,o){for(var r,s,l=[],u=t.map(n,this),c=i.call(this,u,o),d=a.call(this,c,u,o),o=-1,h=u.length,f=d.length-1,p=e?1:1/h;++o<f;)r=l[o]=[],r.dx=d[o+1]-(r.x=d[o]),r.y=0;if(f>0)for(o=-1;++o<h;)(s=u[o])>=c[0]&&s<=c[1]&&(r=l[Yo.bisect(d,s,1,f)-1],r.y+=p,r.push(t[o]));return l}var e=!0,n=Number,i=pa,a=ha;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Tt(e),t):i},t.bins=function(e){return arguments.length?(a="number"==typeof e?function(t){return fa(t,e)}:Tt(e),t):a},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},Yo.layout.pack=function(){function t(t,o){var r=n.call(this,t,o),s=r[0],l=a[0],u=a[1],c=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,Zi(s,function(t){t.r=+c(t.value)}),Zi(s,Ea),i){var d=i*(e?1:Math.max(2*s.r/l,2*s.r/u))/2;Zi(s,function(t){t.r+=d}),Zi(s,Ea),Zi(s,function(t){t.r-=d})}return ba(s,l/2,u/2,e?1:1/Math.max(2*s.r/l,2*s.r/u)),r}var e,n=Yo.layout.hierarchy().sort(ma),i=0,a=[1,1];return t.size=function(e){return arguments.length?(a=e,t):a},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},Ji(t,n)},Yo.layout.tree=function(){function t(t,a){var c=r.call(this,t,a),d=c[0],h=e(d);if(Zi(h,n),h.parent.m=-h.z,Qi(h,i),u)Qi(d,o);else{var f=d,p=d,m=d;Qi(d,function(t){t.x<f.x&&(f=t),t.x>p.x&&(p=t),t.depth>m.depth&&(m=t)});var g=s(f,p)/2-f.x,v=l[0]/(p.x+s(p,f)/2+g),y=l[1]/(m.depth||1);Qi(d,function(t){t.x=(t.x+g)*v,t.y=t.depth*y})}return c}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var a,o=e.children,r=0,s=o.length;r<s;++r)i.push((o[r]=a={_:o[r],parent:e,children:(a=o[r].children)&&a.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:r}).a=a);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Sa(t);var o=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+s(t._,i._),t.m=t.z-o):t.z=o}else i&&(t.z=i.z+s(t._,i._));t.parent.A=a(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function a(t,e,n){if(e){for(var i,a=t,o=t,r=e,l=a.parent.children[0],u=a.m,c=o.m,d=r.m,h=l.m;r=Ta(r),a=ka(a),r&&a;)l=ka(l),o=Ta(o),o.a=t,i=r.z+d-a.z-u+s(r._,a._),i>0&&(Ra(Da(r,t,n),t,i),u+=i,c+=i),d+=r.m,u+=a.m,h+=l.m,c+=o.m;r&&!Ta(o)&&(o.t=r,o.m+=d-c),a&&!ka(l)&&(l.t=a,l.m+=u-h,n=t)}return n}function o(t){t.x*=l[0],t.y=t.depth*l[1]}var r=Yo.layout.hierarchy().sort(null).value(null),s=Aa,l=[1,1],u=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(u=null==(l=e)?o:null,t):u?null:l},t.nodeSize=function(e){return arguments.length?(u=null==(l=e)?null:o,t):u?l:null},Ji(t,r)},Yo.layout.cluster=function(){function t(t,o){var r,s=e.call(this,t,o),l=s[0],u=0;Zi(l,function(t){var e=t.children;e&&e.length?(t.x=Ma(e),t.y=Oa(e)):(t.x=r?u+=n(t,r):0,t.y=0,r=t)});var c=Ia(l),d=_a(l),h=c.x-n(c,d)/2,f=d.x+n(d,c)/2;return Zi(l,a?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-h)/(f-h)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),s}var e=Yo.layout.hierarchy().sort(null).value(null),n=Aa,i=[1,1],a=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(a=null==(i=e),t):a?null:i},t.nodeSize=function(e){return arguments.length?(a=null!=(i=e),t):a?i:null},Ji(t,e)},Yo.layout.treemap=function(){function t(t,e){for(var n,i,a=-1,o=t.length;++a<o;)i=(n=t[a]).value*(e<0?0:e),n.area=isNaN(i)||i<=0?0:i}function e(n){var o=n.children;if(o&&o.length){var r,s,l,u=d(n),c=[],h=o.slice(),p=1/0,m="slice"===f?u.dx:"dice"===f?u.dy:"slice-dice"===f?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(t(h,u.dx*u.dy/n.value),c.area=0;(l=h.length)>0;)c.push(r=h[l-1]),c.area+=r.area,"squarify"!==f||(s=i(c,m))<=p?(h.pop(),p=s):(c.area-=c.pop().area,a(c,m,u,!1),m=Math.min(u.dx,u.dy),c.length=c.area=0,p=1/0);c.length&&(a(c,m,u,!0),c.length=c.area=0),o.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var o,r=d(e),s=i.slice(),l=[];for(t(s,r.dx*r.dy/e.value),l.area=0;o=s.pop();)l.push(o),l.area+=o.area,null!=o.z&&(a(l,o.z?r.dx:r.dy,r,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,a=0,o=1/0,r=-1,s=t.length;++r<s;)(n=t[r].area)&&(n<o&&(o=n),n>a&&(a=n));return i*=i,e*=e,i?Math.max(e*a*p/i,i/(e*o*p)):1/0}function a(t,e,n,i){var a,o=-1,r=t.length,s=n.x,u=n.y,c=e?l(t.area/e):0;if(e==n.dx){for((i||c>n.dy)&&(c=n.dy);++o<r;)a=t[o],a.x=s,a.y=u,a.dy=c,s+=a.dx=Math.min(n.x+n.dx-s,c?l(a.area/c):0);a.z=!0,a.dx+=n.x+n.dx-s,n.y+=c,n.dy-=c}else{for((i||c>n.dx)&&(c=n.dx);++o<r;)a=t[o],a.x=s,a.y=u,a.dx=c,u+=a.dy=Math.min(n.y+n.dy-u,c?l(a.area/c):0);a.z=!1,a.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function o(i){var a=r||s(i),o=a[0];return o.x=0,o.y=0,o.dx=u[0],o.dy=u[1],r&&s.revalue(o),t([o],o.dx*o.dy/o.value),(r?n:e)(o),h&&(r=a),a}var r,s=Yo.layout.hierarchy(),l=Math.round,u=[1,1],c=null,d=Pa,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return o.size=function(t){return arguments.length?(u=t,o):u},o.padding=function(t){function e(e){var n=t.call(o,e,e.depth);return null==n?Pa(e):Fa(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Fa(e,t)}if(!arguments.length)return c;var i;return d=null==(c=t)?Pa:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,o},o.round=function(t){return arguments.length?(l=t?Math.round:Number,o):l!=Number},o.sticky=function(t){return arguments.length?(h=t,r=null,o):h},o.ratio=function(t){return arguments.length?(p=t,o):p},o.mode=function(t){return arguments.length?(f=t+"",o):f},Ji(o,s)},Yo.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,i,a;do{n=2*Math.random()-1,i=2*Math.random()-1,a=n*n+i*i}while(!a||a>1);return t+e*n*Math.sqrt(-2*Math.log(a)/a)}},logNormal:function(){var t=Yo.random.normal.apply(Yo,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=Yo.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},Yo.scale={};var cl={floor:Rt,ceil:Rt};Yo.scale.linear=function(){return Va([0,1],[0,1],vi,!1)};var dl={s:1,g:1,p:1,r:1,e:1};Yo.scale.log=function(){return Ka(Yo.scale.linear().domain([0,1]),10,!0,[1,10])};var hl=Yo.format(".0e"),fl={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};Yo.scale.pow=function(){return Ja(Yo.scale.linear(),1,[0,1])},Yo.scale.sqrt=function(){return Yo.scale.pow().exponent(.5)},Yo.scale.ordinal=function(){return Za([],{t:"range",a:[[]]})},Yo.scale.category10=function(){return Yo.scale.ordinal().range(pl)},Yo.scale.category20=function(){return Yo.scale.ordinal().range(ml)},Yo.scale.category20b=function(){return Yo.scale.ordinal().range(gl)},Yo.scale.category20c=function(){return Yo.scale.ordinal().range(vl)};var pl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(vt),ml=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(vt),gl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(vt),vl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(vt);Yo.scale.quantile=function(){return to([],[])},Yo.scale.quantize=function(){return eo(0,1,[0,1])},Yo.scale.threshold=function(){return no([.5],[0,1])},Yo.scale.identity=function(){return io([0,1])},Yo.svg={},Yo.svg.arc=function(){function t(){var t=e.apply(this,arguments),o=n.apply(this,arguments),r=i.apply(this,arguments)+yl,s=a.apply(this,arguments)+yl,l=(s<r&&(l=r,r=s,s=l),s-r),u=l<Ar?"0":"1",c=Math.cos(r),d=Math.sin(r),h=Math.cos(s),f=Math.sin(s);return l>=El?t?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+t+"A"+t+","+t+" 0 1,0 0,"+-t+"A"+t+","+t+" 0 1,0 0,"+t+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":t?"M"+o*c+","+o*d+"A"+o+","+o+" 0 "+u+",1 "+o*h+","+o*f+"L"+t*h+","+t*f+"A"+t+","+t+" 0 "+u+",0 "+t*c+","+t*d+"Z":"M"+o*c+","+o*d+"A"+o+","+o+" 0 "+u+",1 "+o*h+","+o*f+"L0,0Z"}var e=ao,n=oo,i=ro,a=so;return t.innerRadius=function(n){return arguments.length?(e=Tt(n),t):e},t.outerRadius=function(e){return arguments.length?(n=Tt(e),t):n},t.startAngle=function(e){return arguments.length?(i=Tt(e),t):i},t.endAngle=function(e){return arguments.length?(a=Tt(e),t):a},t.centroid=function(){var t=(e.apply(this,arguments)+n.apply(this,arguments))/2,o=(i.apply(this,arguments)+a.apply(this,arguments))/2+yl;return[Math.cos(o)*t,Math.sin(o)*t]},t};var yl=-Tr,El=kr-Rr;Yo.svg.line=function(){return lo(Rt)};var xl=Yo.map({linear:uo,"linear-closed":co,step:ho,"step-before":fo,"step-after":po,basis:xo,"basis-open":wo,"basis-closed":bo,bundle:Co,cardinal:vo,"cardinal-open":mo,"cardinal-closed":go,monotone:Do});xl.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var wl=[0,2/3,1/3,0],bl=[0,1/3,2/3,0],Cl=[0,1/6,2/3,1/6];Yo.svg.line.radial=function(){var t=lo(Oo);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},fo.reverse=po,po.reverse=fo,Yo.svg.area=function(){return Mo(Rt)},Yo.svg.area.radial=function(){var t=Mo(Oo);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},Yo.svg.chord=function(){function t(t,s){var l=e(this,o,t,s),u=e(this,r,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,u)?a(l.r,l.p1,l.r,l.p0):a(l.r,l.p1,u.r,u.p0)+i(u.r,u.p1,u.a1-u.a0)+a(u.r,u.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var a=e.call(t,n,i),o=s.call(t,a,i),r=l.call(t,a,i)+yl,c=u.call(t,a,i)+yl;return{r:o,a0:r,a1:c,p0:[o*Math.cos(r),o*Math.sin(r)],p1:[o*Math.cos(c),o*Math.sin(c)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Ar)+",1 "+e}function a(t,e,n,i){return"Q 0,0 "+i}var o=yn,r=En,s=Io,l=ro,u=so;return t.radius=function(e){return arguments.length?(s=Tt(e),t):s},t.source=function(e){return arguments.length?(o=Tt(e),t):o},t.target=function(e){return arguments.length?(r=Tt(e),t):r},t.startAngle=function(e){return arguments.length?(l=Tt(e),t):l},t.endAngle=function(e){return arguments.length?(u=Tt(e),t):u},t},Yo.svg.diagonal=function(){function t(t,a){var o=e.call(this,t,a),r=n.call(this,t,a),s=(o.y+r.y)/2,l=[o,{x:o.x,y:s},{x:r.x,y:s},r];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=yn,n=En,i=_o;return t.source=function(n){return arguments.length?(e=Tt(n),t):e},t.target=function(e){return arguments.length?(n=Tt(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},Yo.svg.diagonal.radial=function(){var t=Yo.svg.diagonal(),e=_o,n=t.projection;return t.projection=function(t){return arguments.length?n(Po(e=t)):e},t},Yo.svg.symbol=function(){function t(t,i){return(Al.get(e.call(this,t,i))||Lo)(n.call(this,t,i))}var e=No,n=Fo;return t.type=function(n){return arguments.length?(e=Tt(n),t):e},t.size=function(e){return arguments.length?(n=Tt(e),t):n},t};var Al=Yo.map({circle:Lo,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Sl)),n=e*Sl;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Rl),n=e*Rl/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Rl),n=e*Rl/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});Yo.svg.symbolTypes=Al.keys();var kl,Tl,Rl=Math.sqrt(3),Sl=Math.tan(30*Dr),Dl=[],Ol=0;Dl.call=vr.call,Dl.empty=vr.empty,Dl.node=vr.node,Dl.size=vr.size,Yo.transition=function(t){return arguments.length?kl?t.transition():t:xr.transition()},Yo.transition.prototype=Dl,Dl.select=function(t){var e,n,i,a=this.id,o=[];t=b(t);for(var r=-1,s=this.length;++r<s;){o.push(e=[]);for(var l=this[r],u=-1,c=l.length;++u<c;)(i=l[u])&&(n=t.call(i,i.__data__,u,r))?("__data__"in i&&(n.__data__=i.__data__),Go(n,u,a,i.__transition__[a]),e.push(n)):e.push(null)}return Bo(o,a)},Dl.selectAll=function(t){var e,n,i,a,o,r=this.id,s=[];t=C(t);for(var l=-1,u=this.length;++l<u;)for(var c=this[l],d=-1,h=c.length;++d<h;)if(i=c[d]){o=i.__transition__[r],n=t.call(i,i.__data__,d,l),s.push(e=[]);for(var f=-1,p=n.length;++f<p;)(a=n[f])&&Go(a,f,r,o),e.push(a)}return Bo(s,r)},Dl.filter=function(t){var e,n,i,a=[];"function"!=typeof t&&(t=P(t));for(var o=0,r=this.length;o<r;o++){a.push(e=[]);for(var n=this[o],s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,o)&&e.push(i)}return Bo(a,this.id)},Dl.tween=function(t,e){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(t):N(this,null==e?function(e){e.__transition__[n].tween.remove(t)}:function(i){i.__transition__[n].tween.set(t,e)})},Dl.attr=function(t,e){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function a(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=r(n,t),function(t){this.setAttribute(s,e(t))})})}function o(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=r(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var r="transform"==t?Xi:vi,s=Yo.ns.qualify(t);return Ho(this,"attr."+t,e,s.local?o:a)},Dl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(a));return i&&function(t){this.setAttribute(a,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(a.space,a.local));return i&&function(t){this.setAttributeNS(a.space,a.local,i(t))}}var a=Yo.ns.qualify(t);return this.tween("attr."+t,a.local?i:n)},Dl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function a(e){return null==e?i:(e+="",function(){var i,a=tr.getComputedStyle(this,null).getPropertyValue(t);return a!==e&&(i=vi(a,e),function(e){this.style.setProperty(t,i(e),n)})})}var o=arguments.length;if(o<3){if("string"!=typeof t){o<2&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return Ho(this,"style."+t,e,a)},Dl.styleTween=function(t,e,n){function i(i,a){var o=e.call(this,i,a,tr.getComputedStyle(this,null).getPropertyValue(t));return o&&function(e){this.style.setProperty(t,o(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},Dl.text=function(t){return Ho(this,"text",t,Xo)},Dl.remove=function(){return this.each("end.transition",function(){var t;this.__transition__.count<2&&(t=this.parentNode)&&t.removeChild(this)})},Dl.ease=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].ease:("function"!=typeof t&&(t=Yo.ease.apply(Yo,arguments)),N(this,function(n){n.__transition__[e].ease=t}))},Dl.delay=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].delay:N(this,"function"==typeof t?function(n,i,a){n.__transition__[e].delay=+t.call(n,n.__data__,i,a)}:(t=+t,function(n){n.__transition__[e].delay=t}))},Dl.duration=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].duration:N(this,"function"==typeof t?function(n,i,a){n.__transition__[e].duration=Math.max(1,t.call(n,n.__data__,i,a))}:(t=Math.max(1,t),function(n){n.__transition__[e].duration=t}))},Dl.each=function(t,e){var n=this.id;if(arguments.length<2){var i=Tl,a=kl;kl=n,N(this,function(e,i,a){Tl=e.__transition__[n],t.call(e,e.__data__,i,a)}),Tl=i,kl=a}else N(this,function(i){var a=i.__transition__[n];(a.event||(a.event=Yo.dispatch("start","end"))).on(t,e)});return this},Dl.transition=function(){for(var t,e,n,i,a=this.id,o=++Ol,r=[],s=0,l=this.length;s<l;s++){r.push(t=[]);for(var e=this[s],u=0,c=e.length;u<c;u++)(n=e[u])&&(i=Object.create(n.__transition__[a]),i.delay+=i.duration,Go(n,u,o,i)),t.push(n)}return Bo(r,o)},Yo.svg.axis=function(){function t(t){t.each(function(){var t,u=Yo.select(this),c=this.__chart__||n,d=this.__chart__=n.copy(),h=null==l?d.ticks?d.ticks.apply(d,s):d.domain():l,f=null==e?d.tickFormat?d.tickFormat.apply(d,s):Rt:e,p=u.selectAll(".tick").data(h,d),m=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Rr),g=Yo.transition(p.exit()).style("opacity",Rr).remove(),v=Yo.transition(p.order()).style("opacity",1),y=La(d),E=u.selectAll(".domain").data([0]),x=(E.enter().append("path").attr("class","domain"),Yo.transition(E));m.append("line"),m.append("text");var w=m.select("line"),b=v.select("line"),C=p.select("text").text(f),A=m.select("text"),k=v.select("text");switch(i){case"bottom":t=Vo,w.attr("y2",a),A.attr("y",Math.max(a,0)+r),b.attr("x2",0).attr("y2",a),k.attr("x",0).attr("y",Math.max(a,0)+r),C.attr("dy",".71em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+o+"V0H"+y[1]+"V"+o);break;case"top":t=Vo,w.attr("y2",-a),A.attr("y",-(Math.max(a,0)+r)),b.attr("x2",0).attr("y2",-a),k.attr("x",0).attr("y",-(Math.max(a,0)+r)),C.attr("dy","0em").style("text-anchor","middle"),x.attr("d","M"+y[0]+","+-o+"V0H"+y[1]+"V"+-o);break;case"left":t=Uo,w.attr("x2",-a),A.attr("x",-(Math.max(a,0)+r)),b.attr("x2",-a).attr("y2",0),k.attr("x",-(Math.max(a,0)+r)).attr("y",0),C.attr("dy",".32em").style("text-anchor","end"),x.attr("d","M"+-o+","+y[0]+"H0V"+y[1]+"H"+-o);break;case"right":t=Uo,w.attr("x2",a),A.attr("x",Math.max(a,0)+r),b.attr("x2",a).attr("y2",0),k.attr("x",Math.max(a,0)+r).attr("y",0),C.attr("dy",".32em").style("text-anchor","start"),x.attr("d","M"+o+","+y[0]+"H0V"+y[1]+"H"+o)}if(d.rangeBand){var T=d,R=T.rangeBand()/2;c=d=function(t){return T(t)+R}}else c.rangeBand?c=d:g.call(t,d);m.call(t,c),v.call(t,d)})}var e,n=Yo.scale.linear(),i=Ml,a=6,o=6,r=3,s=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Il?e+"":Ml,t):i},t.ticks=function(){return arguments.length?(s=arguments,t):s},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(a=+e,o=+arguments[n-1],t):a},t.innerTickSize=function(e){return arguments.length?(a=+e,t):a},t.outerTickSize=function(e){return arguments.length?(o=+e,t):o},t.tickPadding=function(e){return arguments.length?(r=+e,t):r},t.tickSubdivide=function(){return arguments.length&&t},t};var Ml="bottom",Il={top:1,right:1,bottom:1,left:1};Yo.svg.brush=function(){function t(o){o.each(function(){var o=Yo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",a).on("touchstart.brush",a),r=o.selectAll(".background").data([0]);r.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),o.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=o.selectAll(".resize").data(p,Rt);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return _l[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var c,d=Yo.transition(o),h=Yo.transition(r);l&&(c=La(l),h.attr("x",c[0]).attr("width",c[1]-c[0]),n(d)),u&&(c=La(u),h.attr("y",c[0]).attr("height",c[1]-c[0]),i(d)),e(d)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+c[+/e$/.test(t)]+","+d[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",c[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",c[1]-c[0])}function i(t){t.select(".extent").attr("y",d[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",d[1]-d[0])}function a(){function a(){32==Yo.event.keyCode&&(S||(E=null,O[0]-=c[1],O[1]-=d[1],S=2),y())}function p(){32==Yo.event.keyCode&&2==S&&(O[0]+=c[1],O[1]+=d[1],S=0,y())}function m(){var t=Yo.mouse(w),a=!1;x&&(t[0]+=x[0],t[1]+=x[1]),S||(Yo.event.altKey?(E||(E=[(c[0]+c[1])/2,(d[0]+d[1])/2]),O[0]=c[+(t[0]<E[0])],O[1]=d[+(t[1]<E[1])]):E=null),T&&g(t,l,0)&&(n(A),a=!0),R&&g(t,u,1)&&(i(A),a=!0),a&&(e(A),C({type:"brush",mode:S?"move":"resize"}))}function g(t,e,n){var i,a,s=La(e),l=s[0],u=s[1],p=O[n],m=n?d:c,g=m[1]-m[0];if(S&&(l-=p,u-=g+p),i=(n?f:h)?Math.max(l,Math.min(u,t[n])):t[n],S?a=(i+=p)+g:(E&&(p=Math.max(l,Math.min(u,2*E[n]-i))),p<i?(a=i,i=p):a=p),m[0]!=i||m[1]!=a)return n?r=null:o=null,m[0]=i,m[1]=a,!0}function v(){m(),A.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),Yo.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),D(),C({type:"brushend"})}var E,x,w=this,b=Yo.select(Yo.event.target),C=s.of(w,arguments),A=Yo.select(w),k=b.datum(),T=!/^(n|s)$/.test(k)&&l,R=!/^(e|w)$/.test(k)&&u,S=b.classed("extent"),D=U(),O=Yo.mouse(w),M=Yo.select(tr).on("keydown.brush",a).on("keyup.brush",p);if(Yo.event.changedTouches?M.on("touchmove.brush",m).on("touchend.brush",v):M.on("mousemove.brush",m).on("mouseup.brush",v),A.interrupt().selectAll("*").interrupt(),S)O[0]=c[0]-O[0],O[1]=d[0]-O[1];else if(k){var I=+/w$/.test(k),_=+/^n/.test(k);x=[c[1-I]-O[0],d[1-_]-O[1]],O[0]=c[I],O[1]=d[_]}else Yo.event.altKey&&(E=O.slice());A.style("pointer-events","none").selectAll(".resize").style("display",null),Yo.select("body").style("cursor",b.style("cursor")),C({type:"brushstart"}),m()}var o,r,s=x(t,"brushstart","brush","brushend"),l=null,u=null,c=[0,0],d=[0,0],h=!0,f=!0,p=Pl[0];return t.event=function(t){t.each(function(){var t=s.of(this,arguments),e={x:c,y:d,i:o,j:r},n=this.__chart__||e;this.__chart__=e,kl?Yo.select(this).transition().each("start.brush",function(){o=n.i,r=n.j,c=n.x,d=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=yi(c,e.x),i=yi(d,e.y);return o=r=null,function(a){c=e.x=n(a),d=e.y=i(a),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=e.i,r=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(l=e,p=Pl[!l<<1|!u],t):l},t.y=function(e){return arguments.length?(u=e,p=Pl[!l<<1|!u],t):u},t.clamp=function(e){return arguments.length?(l&&u?(h=!!e[0],f=!!e[1]):l?h=!!e:u&&(f=!!e),t):l&&u?[h,f]:l?h:u?f:null},t.extent=function(e){var n,i,a,s,h;return arguments.length?(l&&(n=e[0],i=e[1],u&&(n=n[0],i=i[0]),o=[n,i],l.invert&&(n=l(n),i=l(i)),i<n&&(h=n,n=i,i=h),n==c[0]&&i==c[1]||(c=[n,i])),u&&(a=e[0],s=e[1],l&&(a=a[1],s=s[1]),r=[a,s],u.invert&&(a=u(a),s=u(s)),s<a&&(h=a,a=s,s=h),a==d[0]&&s==d[1]||(d=[a,s])),t):(l&&(o?(n=o[0],i=o[1]):(n=c[0],i=c[1],l.invert&&(n=l.invert(n),i=l.invert(i)),i<n&&(h=n,n=i,i=h))),u&&(r?(a=r[0],s=r[1]):(a=d[0],s=d[1],u.invert&&(a=u.invert(a),s=u.invert(s)),s<a&&(h=a,a=s,s=h))),l&&u?[[n,a],[i,s]]:l?[n,i]:u&&[a,s])},t.clear=function(){return t.empty()||(c=[0,0],d=[0,0],o=r=null),t},t.empty=function(){return!!l&&c[0]==c[1]||!!u&&d[0]==d[1]},Yo.rebind(t,s,"on")};var _l={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Pl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Fl=ts.format=rs.timeFormat,Nl=Fl.utc,Ll=Nl("%Y-%m-%dT%H:%M:%S.%LZ");Fl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Wo:Ll,Wo.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},Wo.toString=Ll.toString,ts.second=Ht(function(t){return new es(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),ts.seconds=ts.second.range,ts.seconds.utc=ts.second.utc.range,ts.minute=Ht(function(t){return new es(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),ts.minutes=ts.minute.range,ts.minutes.utc=ts.minute.utc.range,ts.hour=Ht(function(t){var e=t.getTimezoneOffset()/60;return new es(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),ts.hours=ts.hour.range,ts.hours.utc=ts.hour.utc.range,ts.month=Ht(function(t){return t=ts.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),ts.months=ts.month.range,ts.months.utc=ts.month.utc.range;var Bl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Hl=[[ts.second,1],[ts.second,5],[ts.second,15],[ts.second,30],[ts.minute,1],[ts.minute,5],[ts.minute,15],[ts.minute,30],[ts.hour,1],[ts.hour,3],[ts.hour,6],[ts.hour,12],[ts.day,1],[ts.day,2],[ts.week,1],[ts.month,1],[ts.month,3],[ts.year,1]],Xl=Fl.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Re]]),Gl={range:function(t,e,n){return Yo.range(Math.ceil(t/n)*n,+e,n).map(zo)},floor:Rt,ceil:Rt};Hl.year=ts.year,ts.scale=function(){return jo(Yo.scale.linear(),Hl,Xl)};var Vl=Hl.map(function(t){return[t[0].utc,t[1]]}),Ul=Nl.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Re]]);Vl.year=ts.year.utc,ts.scale.utc=function(){return jo(Yo.scale.linear(),Vl,Ul)},Yo.text=St(function(t){return t.responseText}),Yo.json=function(t,e){return Dt(t,"application/json",qo,e)},Yo.html=function(t,e){return Dt(t,"text/html",$o,e)},Yo.xml=St(function(t){return t.responseXML}),window.d3=Yo}()},function(t,e){XERO.ns("XERO.widget","XERO.widget.d3charts"),XERO.widget.d3charts.BaseClass=Ext.extend(Ext.Component,{extend:"Ext.Component",baseCls:"x-d3-chart",autoEl:{tag:"div",children:[{tag:"svg"}]},width:660,height:250,innerMargin:{top:20,right:20,bottom:20,left:20},colors:{negative:"rgb(255, 0, 0)",positive:"rgb(0, 98, 224)",areaOpacity:.2},tickCount:{y:4,x:4},tooltipOffset:{top:0,left:0},formatDate:function(t){return t=new Date(t),d3.time.format("%b %y")(t)},innerWidth:function(){return this.width-this.innerMargin.left-this.innerMargin.right},innerHeight:function(){return this.height-this.innerMargin.top-this.innerMargin.bottom},data:function(t){return t},tooltip:function(){var t=document.createElement("div");t.className="x-d3-tooltip",t.style.display="none";var e=document.createDocumentFragment();return e.appendChild(t),document.body.appendChild(e),d3.select(t)},tooltipHeaderHtml:function(t){return t[this.dataLabels.x1]},tooltipBodyHtml:function(t){var e=this,n=t[e.dataLabels.y1]>0?"positive":"negative";return"<p>"+e.include.tooltip.valueLabel+"<span class='"+n+"'>"+Ext.util.Format.number(t[e.dataLabels.y1],"0,000")+"</p>"},tooltipPosition:function(t,e,n,i){var a=this,o=a.tooltipOffset,r={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};return{top:e-o.top-n.height+i.top+r.top,left:t-o.left-n.width/2+i.left+r.left}},svg:function(){return d3.select(this.getEl().down("svg").dom).attr("width",this.width).attr("height",this.height).append("g").attr("transform","translate("+this.innerMargin.left+","+this.innerMargin.top+")")},valueFormatY:function(t,e,n){return n[1]>999?t/1e3+"k":t},valueFormatX:function(t,e,n){return t},roundedRect:function(t,e,n,i,a,o){var r="M"+(t+a)+","+e+"h"+(n-2*a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(i-a-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+(2*o-n)+"a"+o+","+o+" 0 0 1 "+-o+","+-o+"v"+(a+o-i)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z";return i?r:null},clipPath:function(t,e,n,i,a,o){return e=e||"clip",n=n||0,i=i||-5,a=a||this.width,o=o||this.height+4,t.append("clipPath").attr("id",e).append("rect").attr("x",n).attr("y",i).attr("width",a).attr("height",o)},gradients:function(t,e,n,i){e.append("linearGradient").attr("id",t).attr("gradientUnits","userSpaceOnUse").selectAll("stop").data([{offset:"0%",color:n||this.colors.positive},{offset:"50%",color:"#EEE"},{offset:"100%",color:i||this.colors.negative}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color})},createScale:function(t){switch(t){case"time":return d3.time.scale().range([0,this.innerWidth()]);case"ordinal":return d3.scale.ordinal().rangeRoundBands([0,this.innerWidth()]);case"linear":return d3.scale.linear().range([this.innerHeight(),0])}},axes:function(t,e,n){var i=d3.svg.axis().scale(t).orient(n);return"bottom"===n?e.append("g").attr("class","x axis").attr("transform","translate(0,"+this.innerHeight()+")"):"left"===n&&e.append("g").attr("class","y axis"),i},zeroLine:function(t,e){return t.append("line").attr({class:"zero",x1:0,x2:e,opacity:0})},grid:function(t,e,n){if("vertical"===n){var i=d3.svg.axis().scale(t).orient("bottom").tickSize(-this.innerHeight(),0,0).tickFormat("");return e.append("g").attr("class"," x grid").attr("transform","translate(0,"+this.innerHeight()+")"),i}if("horizontal"===n){var a=d3.svg.axis().scale(t).orient("left").tickSize(-this.width,0,0).tickFormat("");return e.append("g").attr("class","y grid"),a}},line:function(t,e,n,i,a){var o=this,r=d3.svg.line().x(function(e){return t(e.data[o.dataLabels.x1])}).y(function(t){return e(t.data[o.dataLabels.y1])}),s=n.append("path").attr("class","line");return a&&s.attr("id",a),i&&s.attr("clip-path","url(#"+i+")"),r},area:function(t,e,n,i){var a=this;i=i||"clip";var o=d3.svg.area().x(function(e){return t(e.data[a.dataLabels.x1])}).y1(function(t){return e(t.data[a.dataLabels.y1])});return n.append("path").attr("class","area").attr("clip-path","url(#"+i+")").attr("opacity",this.colors.areaOpacity),o},pane:function(t){return t.append("rect").attr("class","pane").attr("width",this.innerWidth()).attr("height",this.height)}})},function(t,e){XERO.widget.d3charts.Area=Ext.extend(XERO.widget.d3charts.BaseClass,{store:null,innerMargin:{top:20,right:10,bottom:30,left:10},dataLabels:{x1:"Date",y1:"Value"},colors:{negative:"#ED4747",positive:"#00ACF0",fillPositive:"#CBEFFC",fillNegative:"#FBDADA",areaOpacity:.9},pointSize:3,tickOffset:5,axisTypeX:"day",data:function(t){var e=this;return t.forEach(function(t){var n=t.data[e.dataLabels.x1];"z"===n.slice(-1).toLowerCase()||(n+="Z");var i=new Date(n);i.setHours(i.getHours()+i.getTimezoneOffset()/60),t.data[e.dataLabels.x1]=i}),t},getHighLowX:function(t){var e=this;return d3.extent(t,function(t){return t.data[e.dataLabels.x1]})},getHighLowY:function(t){var e=this,n=d3.extent(t,function(t){return t.data[e.dataLabels.y1]});return n[0]>0?n[0]=0:n[1]<0&&(n[1]=0),n},tooltipBodyHtml:function(t){var e=this,n=t[e.dataLabels.y1]>0?"positive":"negative";return"<div><span class='label "+n+"'>"+e.include.tooltip.valueLabel+"</span><span class='"+n+"'>"+Ext.util.Format.number(t[e.dataLabels.y1],"0,000")+"</div>"},guideline:function(t){return t.append("rect").attr({class:"guideline",opacity:0,width:1,height:this.innerHeight()})},guideCircle:function(t){var e=this;return t.append("circle").attr("r",e.pointSize+1).attr("opacity",0).style("stroke","none")},format:d3.time.format("%e %b %Y"),axisFormatX:d3.time.format("%e %b"),lineGradientId:"line-gradient",areaGradientId:"area-gradient",clipId:"clip",drawChart:function(){function t(t){t=e.data(t);var d=e.getHighLowX(t),h=e.getHighLowY(t);i.domain(d),a.domain(h),"month"===e.axisTypeX?o.ticks(d3.time.day,e.tickOffset):"day"===e.axisTypeX&&o.ticks(e.tickOffset),o.tickFormat(function(t){return e.axisFormatX(t)});var f=a(0),p=t[0].data[e.dataLabels.x1],m=t[t.length-1].data[e.dataLabels.x1],g=d3.scale.ordinal().domain(t.map(function(t){return t.data[e.dataLabels.x1]})).range(t.map(function(t){return t.data[e.dataLabels.y1]}));l.y0(f),n.select("#"+e.areaGradientId).attr("x1",0).attr("y1",f-1).attr("x2",0).attr("y2",f+1),n.select("#"+e.lineGradientId).attr("x1",0).attr("y1",f-1).attr("x2",0).attr("y2",f+1),n.select("path.line").datum(t).style("stroke","url(#"+e.lineGradientId+")"),n.select("path.area").datum(t).style("fill","url(#"+e.areaGradientId+")"),n.select("line.zero").attr("x1",0).attr("y1",f).attr("y2",f).attr("opacity",1);var v;e.include.points&&(r=n.selectAll("circle").data(t).enter().append("circle").attr("r",e.pointSize).style("fill",function(t){return a(t.data[e.dataLabels.y1])>f?e.colors.negative:e.colors.positive}).style("stroke","#FFF").style("stroke-width","2px").style("pointer-events","none").style("opacity",0));var y=e.guideCircle(n);if(c.on("mousemove",function(){v=n[0][0].parentNode.getBoundingClientRect();var t,o=d3.event.target,r=o.getBoundingClientRect(),s=d3.event.clientX-r.left,l=i.invert(s);l.getHours()>12?l.setHours(24):l.setHours(0),l.setMinutes(-(new Date).getTimezoneOffset()%60),l.setSeconds(0),l.setMilliseconds(0);var c=g(l);s=i(l),t=a(c);var d={};d[e.dataLabels.x1]=e.format(l),d[e.dataLabels.y1]=c;var h="<div class='tooltip-header'>"+e.tooltipHeaderHtml(d)+"</div><div class='tooltip-body'>"+e.tooltipBodyHtml(d)+"</div>";u.html(h).style("opacity",0).style("display","block");var E={height:u.node().offsetHeight,width:u.node().offsetWidth},x=e.tooltipPosition(s+e.innerMargin.left,t+e.innerMargin.top,E,v);u.style("top",x.top+"px").style("left",x.left+"px").style("opacity",1),l.getTime()<=m.getTime()&&l.getTime()>=p.getTime()?y.attr("opacity",1).style("fill",function(){return t>f?e.colors.negative:e.colors.positive}).attr("cx",s).attr("cy",t):(u.style("display","none"),y.attr("opacity",0))}),c.on("mouseleave",function(){u.style("display","none"),y.attr("opacity",0)}),n.select("g.x.axis").call(o).selectAll("text").style("text-anchor",function(t,e){return t.getTime()===p.getTime()?"start":t.getTime()===m.getTime()?"end":"middle"}),n.select("path.line").attr("d",s),n.select("path.area").attr("d",l),e.include.points){r.attr("transform",function(t){return"translate("+i(t.data[e.dataLabels.x1])+","+a(t.data[e.dataLabels.y1])+")"}).attr("myX",function(t){return i(t.data[e.dataLabels.x1])});d3.select(r[0][2]).attr("myX"),d3.select(r[0][1]).attr("myX");r.style("opacity",function(t){return 1})}}var e=this;e.lineGradientId="line-gradient-"+Ext.id(),e.areaGradientId="area-gradient-"+Ext.id(),e.clipId="clip-"+Ext.id();var n=e.svg();e.clipPath(n,e.clipId),e.gradients(e.lineGradientId,n),e.gradients(e.areaGradientId,n,e.colors.fillPositive,e.colors.fillNegative);var i=e.createScale("time"),a=e.createScale("linear");if(e.include.grid.x){e.grid(i,n,"vertical").ticks(e.tickCount.x)}if(e.include.grid.y){e.grid(a,n,"horizontal").ticks(e.tickCount.y)}var o=e.axes(i,n,"bottom");e.zeroLine(n,e.innerWidth());var r,s=e.line(i,a,n,e.clipId),l=e.area(i,a,n,e.clipId),u=e.tooltip(),c=e.pane(n);e.store.getRange().length>0?t(e.store.getRange()):e.store.on("load",function(){t(e.store.getRange())})},initComponent:function(){var t=this;Ext.apply(t,{cls:"x-d3-chart x-d3-chart-area"}),XERO.widget.d3charts.Area.superclass.initComponent.apply(t,arguments),t.on("render",function(){t.drawChart()})}})},function(t,e){XERO.widget.d3charts.Bar=Ext.extend(XERO.widget.d3charts.BaseClass,{store:null,innerMargin:{top:20,right:10,bottom:30,left:10},colors:{negative:"#F5534F",positive:"#44C4F4",neutral:"#B4B7B9",areaOpacity:.2},barChartType:"regular",barSpacing:.8,bkgdColor:"#FFF",roundedBarRadius:0,defaultBarCount:6,data:function(t){var e=this;if("regular"!=e.barChartType){var n=[];if(t.forEach(function(t){var i=0,a=0;t.data[e.dataLabels.x2].forEach(function(t){t.prev=i,a+=t[e.dataLabels.y1],i+=t[e.dataLabels.y1]}),t.data.sum=a,t.data.Series.length&&n.push(t)}),e.removeEmptySeries)return n}return t},fillFunction:function(t,e){return e%2?me.colors.positive:me.colors.negative},getHighLowX:function(t){var e=this;return t.map(function(t){return t.data[e.dataLabels.x1]})},getHighLowY:function(t){var e,n=this;return e="regular"!=n.barChartType?d3.max(t,function(t){return"stacked"===n.barChartType?d3.sum(t.data[n.dataLabels.x2],function(t){return t[n.dataLabels.y1]}):d3.max(t.data[n.dataLabels.x2],function(t){return t[n.dataLabels.y1]})}):d3.max(t,function(t){return t.data[n.dataLabels.y1]}),[0,e]},tooltipHeaderHtml:function(t){return t},tooltipBodyHtml:function(t){var e=this,n="Overdue"===t.Type||"Expenses"===t.Type?"negative":"positive";return"<div><span class='label "+n+"'>"+t.Type+"</span><span class='"+n+"'>"+Ext.util.Format.number(t[e.dataLabels.y1],"0,000.00")+"</div>"},gradients:function(t,e){e.append("linearGradient").attr("id",t+"-gradient").attr("gradientUnits","userSpaceOnUse").selectAll("stop").data([{offset:"0%",color:this.gradientColors[t].high},{offset:"100%",color:this.gradientColors[t].low}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color})},drawChart:function(){function t(t){t=n.data(t);var e=n.getHighLowX(t),m=n.getHighLowY(t);a.domain(e),o.domain(m),r.ticks(n.tickCount.x).tickFormat(function(t,i){return n.valueFormatX(t,i,e)}),n.include.draggable?(f=g/v,g=t.length*f,a.rangeRoundBands([0,g])):f=g/t.length,i.select("g.x.axis").call(r),l&&i.select("g.y.grid").call(l),s&&i.select("g.x.grid").call(s);var y=n.barSpacing,E=(1-y)/2;if(d=i.selectAll(".series").data(t).enter().append("g").attr("class","series").attr("xPos",function(t){return a(t.data[n.dataLabels.x1])+E*f}).attr("transform",function(t){return"translate("+(a(t.data[n.dataLabels.x1])+E*f)+",0)"}),"stacked"===n.barChartType?h=d.selectAll("path").data(function(t){return t.data[n.dataLabels.x2]}).enter().append("path").attr("d",function(t,e){var i=d3.select(this.parentNode),a=i.data()[0].data[n.dataLabels.x2].length,r=e===a-1,s=o(t[n.dataLabels.y1])+o(t.prev)-o(0),l=y*f,u=o(0)-o(t[n.dataLabels.y1]),c=r?n.roundedBarRadius:0;return r||i.append("rect").attr({x:0,y:s,width:l,height:1,fill:"#FFF"}),n.roundedRect(0,s,l,u,c,0)}).attr("fill",function(t,e){return n.fillFunction(t,e)}):"multi"===n.barChartType?h=d.selectAll("path").data(function(t){return t.data[n.dataLabels.x2]}).enter().append("path").attr("myX",function(t,e){var i=d3.select(this.parentNode),a=i.data()[0].data[n.dataLabels.x2].length;return e*(y*f/a+2)}).attr("d",function(t,e){var i=d3.select(this.parentNode),a=i.data()[0].data[n.dataLabels.x2].length,r=y*f/a,s=e*(r+2),l=o(t[n.dataLabels.y1]),u=r,c=o(0)-o(t[n.dataLabels.y1]),d=n.roundedBarRadius;return n.roundedRect(s,l,u,c,d,0)}).attr("fill",function(t,e){return n.fillFunction(t,e)}):"regular"===n.barChartType&&(h=d.append("rect").attr("class","positive-blocks").attr("rx",n.roundedBarRadius).attr("ry",n.roundedBarRadius).attr("width",y*f).attr("height",function(t){return o(0)-o(t.data[n.dataLabels.y1])}).attr("y",function(t){return o(t.data[n.dataLabels.y1])})),i.select("line.zero").attr("y1",n.innerHeight()).attr("y2",n.innerHeight()).attr("opacity",1),n.include.draggable){i.append("linearGradient").attr("x1",n.innerWidth()).attr("y1",0).attr("x2",n.innerWidth()-f).attr("y2",0).attr("id","fade-gradient").attr("gradientUnits","userSpaceOnUse").selectAll("stop").data([{offset:"0%",color:n.bkgdColor,stopOpacity:1},{offset:"100%",color:n.bkgdColor,stopOpacity:0}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}).attr("stop-opacity",function(t){return t.stopOpacity});var x=container.append("rect").attr("class","fade-me").attr({x:n.innerWidth()-f,y:0,width:f,height:n.innerHeight()});d.call(u),x.call(u)}h.on("mouseover",function(t){var e,r,s=d3.select(this.parentNode),l=s.data()[0].data[n.dataLabels.x2],u=a(s.data()[0].data[n.dataLabels.x1]),c=i[0][0].getBoundingClientRect(),d=o(t[n.dataLabels.y1]),h=d3.select(this).attr("myX");if("stacked"===n.barChartType)d+=o(t.prev)-o(0);else if("multi"===n.barChartType){var m=0,g=d3.max(l,function(t){return t[n.dataLabels.y1]&&m++,t[n.dataLabels.y1]});d=o(g),e=1===m}r=e?l.length:1,u=u+E*f+y*f/r/2,h&&e&&(u+=parseInt(h,10));var v="<div class='tooltip-header'>"+n.tooltipHeaderHtml(s.data()[0].data.Label,s.data())+"</div><div class='tooltip-body'>"+n.tooltipBodyHtml(t,s.data())+"</div>";p.html(v).style("opacity",0).style("display","block");var x={height:p.node().offsetHeight,width:p.node().offsetWidth},w=n.tooltipPosition(u,d,x,c);p.style("top",w.top+"px").style("left",w.left+"px").style("opacity",1)}),h.on("mouseleave",function(t){p.style("display","none")}),h.on("mousedown",function(t){c=1}),h.on("mouseup",function(t){c&&t[n.dataLabels.click]&&(window.location.href=t[n.dataLabels.click])})}function e(){var t=d3.event.dx;c=0,p.style("display","none"),a.rangeRoundBands([m+t,m+g+t]),d.attr("transform",function(e){var n=d3.select(this),i=n.attr("xPos");return i=parseInt(i,10),i+=t,n.attr("xPos",i),"translate("+i+",0)"}),m+=t,i.select("g.x.axis").call(r),s&&i.select("g.x.grid").call(s)}var n=this,i=n.svg(),a=n.createScale("ordinal"),o=n.createScale("linear"),r=n.axes(a,i,"bottom");if(n.zeroLine(i,n.innerWidth()),n.include.grid.x){var s=n.grid(a,i,"vertical");s.ticks(n.tickCount.x)}if(n.include.grid.y){var l=n.grid(o,i,"horizontal");l.ticks(n.tickCount.y)}if(n.include.draggable){var u=d3.behavior.drag().on("drag",e);n.pane(container).call(u)}var c,d,h,f,p=n.tooltip(i),m=0,g=n.innerWidth(),v=n.defaultBarCount;n.store.getRange().length>0?t(n.store.getRange()):n.store.on("load",function(){t(n.store.getRange())})},initComponent:function(){var t=this;Ext.apply(t,{cls:"x-d3-chart x-d3-chart-bar"}),XERO.widget.d3charts.Bar.superclass.initComponent.apply(t,arguments),t.on("render",function(){t.drawChart()})}})},function(t,e){XERO.widget.d3charts.Sparkline=Ext.extend(XERO.widget.d3charts.BaseClass,{store:null,width:260,height:90,innerMargin:{top:10,right:10,bottom:10,left:10},interpolate:"linear",colors:{negative:"rgb(216, 44, 61)",positive:"rgb(94, 191, 0)",neutral:"rgb(102, 183, 214)"},dataLabels:{x1:"Date",y1:"Value",y2:"Direction"},getHighLowX:function(t){var e=this;return t.map(function(t){return t.data[e.dataLabels.x1]})},getHighLowY:function(t){var e=this;return d3.extent(t,function(t){return t.data[e.dataLabels.y1]})},pointStrokeFunction:function(t){var e=this;return"up"===t[e.dataLabels.y2]||"down"===t[e.dataLabels.y2]?"#FFF":"none"},pointFillFunction:function(t){var e=this;return"up"===t[e.dataLabels.y2]?e.colors.positive:"down"===t[e.dataLabels.y2]?e.colors.negative:"none"},pointSizeFunction:function(t){return 4},drawChart:function(){function t(t){t=e.data(t);var d=e.getHighLowX(t),h=e.getHighLowY(t);i.domain(d),a.domain(h),o.ticks(e.tickCount.x).tickFormat(function(t,n){return e.valueFormatX(t,n,d)}),r.ticks(e.tickCount.y).tickFormat(function(t,n){return e.valueFormatY(t,n,h)}),n.select("g.y.axis").call(r),n.select("g.x.axis").call(o),l&&n.select("g.y.grid").call(l),s&&n.select("g.x.grid").call(s),u.interpolate(e.interpolate),n.select("path.line").datum(t).attr("d",u).style("stroke","#44C4F4");var f=-e.innerWidth()/t.length/2;n.select("g.x.axis").attr("transform","translate("+f+","+e.innerHeight()+")"),n.select("g.x.grid").attr("transform","translate("+f+","+e.innerHeight()+")");var p=n.selectAll("circle").data(t).enter().append("circle").attr("r",function(t){return e.pointSizeFunction(t.data)}).attr("transform",function(t){return"translate("+i(t.data[e.dataLabels.x1])+","+a(t.data[e.dataLabels.y1])+")"}).style("stroke",function(t){return e.pointStrokeFunction(t.data)}).style("fill",function(t){return e.pointFillFunction(t.data)});p.on("mouseover",function(t){var o=i(t.data[e.dataLabels.x1]),r=a(t.data[e.dataLabels.y1]),s=n[0][0].parentNode.getBoundingClientRect(),l=d3.select(this),u="<div class='tooltip-header'>"+e.tooltipHeaderHtml(t.data)+"</div><div class='tooltip-body'>"+e.tooltipBodyHtml(t.data)+"</div>";c.html(u).style("opacity",0).style("display","block");var d={height:c.node().offsetHeight,width:c.node().offsetWidth},h=e.tooltipPosition(o,r,d,s);c.style("top",h.top+"px").style("left",h.left+"px").style("opacity",1),l.style("stroke",l.style("fill"))}),p.on("mouseleave",function(t){var e=d3.select(this);c.style("display","none"),e.style("stroke","#FFF")})}var e=this,n=e.svg(),i=e.createScale("ordinal"),a=e.createScale("linear"),o=e.axes(i,n,"bottom"),r=e.axes(a,n,"left");if(e.include.grid.x)var s=e.grid(i,n,"vertical");if(e.include.grid.y){var l=e.grid(a,n,"horizontal");l.ticks(e.tickCount.y)}var u=e.line(i,a,n,!1),c=e.tooltip(n);e.include.axes&&n[0][0].parentNode.classList.add("sparkline-axes"),e.store.getRange().length>0?t(e.store.getRange()):e.store.on("load",function(){t(e.store.getRange())})},initComponent:function(){var t=this;Ext.apply(t,{cls:"x-d3-chart x-d3-chart-sparkline"}),XERO.widget.d3charts.Sparkline.superclass.initComponent.apply(t,arguments),t.on("render",function(){t.drawChart()})}})},function(t,e){XERO.widget.d3charts.SmoothArea=Ext.extend(XERO.widget.d3charts.BaseClass,{store:null,innerMargin:{top:20,right:10,bottom:30,left:10},dataLabels:{x1:"Date",y1:"Value"},colors:{negative:"#ED4747",positive:"#00ACF0",fillPositive:"#CBEFFC",fillNegative:"#FBDADA",areaOpacity:.9},interpolate:"linear",pointSize:3,tickOffset:5,axisTypeX:"day",data:function(t){var e=this;return t.forEach(function(t){t.data[e.dataLabels.x1]=t.data[e.dataLabels.x1].split("T")[0],t.data[e.dataLabels.x1]=new Date(t.data[e.dataLabels.x1]);var n=t.data.Date.getTimezoneOffset()/60;t.data[e.dataLabels.x1].setHours(t.data[e.dataLabels.x1].getHours()+n)}),t},getHighLowX:function(t){var e=this;return d3.extent(t,function(t){return t.data[e.dataLabels.x1]})},getHighLowY:function(t){var e=this,n=d3.extent(t,function(t){return t.data[e.dataLabels.y1]});return n[0]>0?n[0]=0:n[1]<0&&(n[1]=0),n},tooltipBodyHtml:function(t){var e=this,n=t[e.dataLabels.y1]>0?"positive":"negative";return"<div><span class='label "+n+"'>"+e.include.tooltip.valueLabel+"</span><span class='"+n+"'>"+Ext.util.Format.number(t[e.dataLabels.y1],"0,000")+"</div>"},placeXLabels:function(t,e,n,i){return t.getTime()===n.getTime()?"start":t.getTime()===i.getTime()?"end":"middle"},showXLabels:function(t,e,n){return 1},tooltipSnapFunctions:{month:function(t){var e=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,1),i=n.getTime()-e.getTime();return t=t.getTime()>e.getTime()+i/2?n:e,this.tooltipSnapFunctions.clearTime(t)},day:function(t){return t.getHours()>12?t.setHours(24):t.setHours(0),this.tooltipSnapFunctions.clearTime(t)},clearTime:function(t){return t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}},findInflextionPoint:function(t){return t[t.length-2].data},guideline:function(t){return t.append("rect").attr({class:"guideline",opacity:0,width:1,height:this.innerHeight()})},guideCircle:function(t){var e=this;return t.append("circle").attr("r",e.pointSize+1).attr("opacity",0).style("stroke","none")},format:d3.time.format("%e %b %Y"),axisFormatX:d3.time.format("%e %b"),lineGradientId:"line-gradient",areaGradientId:"area-gradient",clipId:"clip",drawChart:function(){function t(t){t=e.data(t);var d=e.getHighLowX(t),h=e.getHighLowY(t);i.domain(d),a.domain(h),"month"===e.axisTypeX?o.ticks(d3.time.day,e.tickOffset):"day"===e.axisTypeX&&o.ticks(e.tickOffset),o.tickFormat(function(t){return e.axisFormatX(t)});var f=a(0),p=t[0].data[e.dataLabels.x1],m=t[t.length-1].data[e.dataLabels.x1],g=d3.scale.ordinal().domain(t.map(function(t){return t.data[e.dataLabels.x1]})).range(t.map(function(t){return t.data[e.dataLabels.y1]}));if(l.y0(f),n.select("#"+e.areaGradientId).attr("x1",0).attr("y1",f-1).attr("x2",0).attr("y2",f+1),n.select("#"+e.lineGradientId).attr("x1",0).attr("y1",f-1).attr("x2",0).attr("y2",f+1),s.interpolate(e.interpolate),l.interpolate(e.interpolate),n.select("path.line").datum(t).style("stroke",function(){return"url(#"+e.lineGradientId+")"}),n.select("path.area").datum(t).style("fill","url(#"+e.areaGradientId+")"),e.include.zeroLine&&n.select("line.zero").attr("x1",0).attr("y1",f).attr("y2",f).attr("opacity",1),e.inflextionPoint){var v=e.findInflextionPoint(t),y=t[t.length-1].data,E=i(v[e.dataLabels.x1]);e.inflexClipId="inflex-clip-"+Ext.id(),e.clipPath(n,e.inflexClipId,E,0);var x=e.line(i,a,n,e.inflexClipId,"inflex-line");x.interpolate(e.interpolate),n.select("path#inflex-line").datum(t).style("stroke",function(){return"Neutral"===y[e.dataLabels.y2]?e.colors.inflextionNeutral:"Up"===y[e.dataLabels.y2]?e.colors.inflextionPositive:e.colors.inflextionNegative})}var w;e.include.points&&(r=n.selectAll("circle").data(t).enter().append("circle").attr("r",function(t){return e.inflextionPoint&&t.data===y?e.pointSize+1:e.pointSize}).style("fill",function(t){return e.inflextionPoint?t.data===v?"Up"===v[e.dataLabels.y2]?e.colors.positive:e.colors.negative:t.data===y?"Neutral"===y[e.dataLabels.y2]?e.colors.inflextionNeutral:"Up"===y[e.dataLabels.y2]?e.colors.inflextionPositive:e.colors.inflextionNegative:"transparent":a(t.data[e.dataLabels.y1])>f?e.colors.negative:e.colors.positive}).style("stroke",function(t){if(e.inflextionPoint){e.dataLabels.y1;return t.data===v||t.data===y?"#FFF":"none"}return"#FFF"}).style("stroke-width",function(t){return"2px"}).style("pointer-events","none").style("opacity",0));var b=e.guideCircle(n);c.on("mousemove",function(){w=n[0][0].parentNode.getBoundingClientRect();var t,o=d3.event.target,r=o.getBoundingClientRect(),s=d3.event.clientX-r.left,l=i.invert(s),c=e.include.tooltip.snapTo||"day";l=e.tooltipSnapFunctions[c].call(e,l);var d=g(l);s=i(l),t=a(d);var h={};h[e.dataLabels.x1]=e.format(l),h[e.dataLabels.y1]=d;var v="<div class='tooltip-header'>"+e.tooltipHeaderHtml(h)+"</div><div class='tooltip-body'>"+e.tooltipBodyHtml(h)+"</div>";u.html(v).style("opacity",0).style("display","block");var y={height:u.node().offsetHeight,width:u.node().offsetWidth},E=e.tooltipPosition(s+e.innerMargin.left,t+e.innerMargin.top,y,w);u.style("top",E.top+"px").style("left",E.left+"px").style("opacity",1),l.getTime()<=m.getTime()&&l.getTime()>=p.getTime()?b.attr("opacity",1).style("fill",function(){return t>f?e.colors.negative:e.colors.positive}).attr("cx",s).attr("cy",t):(u.style("display","none"),b.attr("opacity",0))}),c.on("mouseleave",function(){u.style("display","none"),b.attr("opacity",0)}),n.select("g.x.axis").call(o).selectAll("text").style("opacity",function(n,i){return e.showXLabels(n,i,t.length-1)}).style("text-anchor",function(t,n){return e.placeXLabels(t,n,p,m)}),n.select("path.line").attr("d",s),n.select("path.area").attr("d",l),n.select("path#inflex-line").attr("d",x),e.include.points&&(r.attr("transform",function(t){return"translate("+i(t.data[e.dataLabels.x1])+","+a(t.data[e.dataLabels.y1])+")"}).attr("myX",function(t){return i(t.data[e.dataLabels.x1])}),r.style("opacity",function(t){return 1}))}var e=this,n=e.svg();e.clipId="clip-"+Ext.id(),e.clipPath(n,e.clipId),e.lineGradientId="line-gradient-"+Ext.id(),e.areaGradientId="area-gradient-"+Ext.id(),e.gradients(e.lineGradientId,n),e.gradients(e.areaGradientId,n,e.colors.fillPositive,e.colors.fillNegative);var i=e.createScale("time"),a=e.createScale("linear");if(e.include.grid.x){e.grid(i,n,"vertical").ticks(e.tickCount.x)}if(e.include.grid.y){e.grid(a,n,"horizontal").ticks(e.tickCount.y)}var o=e.axes(i,n,"bottom");e.zeroLine(n,e.innerWidth());var r,s=e.line(i,a,n,e.clipId),l=e.area(i,a,n,e.clipId),u=e.tooltip(),c=e.pane(n);e.store.getRange().length>0?t(e.store.getRange()):e.store.on("load",function(){t(e.store.getRange())})},initComponent:function(){var t=this;Ext.apply(t,{cls:"x-d3-chart x-d3-chart-area"}),XERO.widget.d3charts.SmoothArea.superclass.initComponent.apply(t,arguments),t.on("render",function(){t.drawChart()})}})},function(t,e){XERO.ns("XERO.widget","XERO.widget.d3charts"),XERO.widget.d3charts.SmallBarChart=Ext.extend(Ext.Component,{extend:"Ext.Component",cls:"kpi-bar-chart",autoEl:{tag:"div",children:[{tag:"svg"}]},width:200,height:40,innerMargin:{top:10,right:10,bottom:10,left:10},series:null,getSeries:function(){return this.series},initComponent:function(){var t=this;XERO.widget.d3charts.SmallBarChart.superclass.initComponent.apply(t,arguments),t.on("render",function(){t.drawChart()},t)},getSvg:function(){var t=this;return t.svg||(t.svg=d3.select(t.getEl().down("svg").dom).attr("width",t.width).attr("height",t.height).append("g").attr("transform","translate("+t.innerMargin.left+","+t.innerMargin.top+")")),t.svg},createRoundedRect:function(t,e,n,i,a,o,r,s,l){var u;return u="M"+(t+a)+","+e,u+="h"+(n-2*a),r?u+="a"+a+","+a+" 0 0 1 "+a+","+a:(u+="h"+a,u+="v"+a),u+="v"+(i-2*a),l?u+="a"+a+","+a+" 0 0 1 "+-a+","+a:(u+="v"+a,u+="h"+-a),u+="h"+(2*a-n),s?u+="a"+a+","+a+" 0 0 1 "+-a+","+-a:(u+="h"+-a,u+="v"+-a),u+="v"+(2*a-i),o?u+="a"+a+","+a+" 0 0 1 "+a+","+-a:(u+="v"+-a,u+="h"+a),u+="z"},roundToNearest:function(t){var e,n=t<0;return 0===(t=Math.abs(t))?0:(e=t<30?1:t<300?10:t<1e3?100:t<1e4?1e3:t<1e5?1e4:1e5,Math.ceil(t/e)*e*(n?-1:1))},parseData:function(t){for(var e=function(t,e){return t&&e?t.getTime()===e.getTime():!(t||e)},n=function(t){return new Date(t.getFullYear(),t.getMonth(),1)}((new Date).clearTime().addMonths(-1)),i=n.clone().addMonths(-11),a=[],o=0;i<=n&&!(++o>12);){var r=function(t,e,n){for(var i=0,a=t.length;i<a;i++)if(e.call(n||t,t[i],i))return t[i];return null}(t,function(t){var n=Date.parse(t.date);return n=new Date(n.getFullYear(),n.getMonth(),1),e(i,n)});a.push({Date:i.clone(),Value:r?r.value:0}),i.addMonths(1)}return a},drawChart:function(t,e){var n=this,t=n.getSeries(),i=n.parseData(t),a=n.innerMargin,o=n.width-a.left-a.right,r=n.height-a.top-a.bottom,s=i.map(function(t){return t.Value}),l=0,u=Math.max(Math.abs(d3.min(s)),Math.abs(d3.max(s)));d3.min(s)<0&&(l=d3.min(s)),d3.max(s)<=0&&(u=0);var c=d3.scale.linear().domain([l,u]).range([r,0]).nice(),d=d3.scale.ordinal().domain(i.map(function(t){return t.Date})).rangeRoundBands([0,o],.1,.1);n.getSvg().selectAll(".bar").data(i).enter().append("path").attr("d",function(t,e){if(0!==t.Value){var i=t.Value<0,a=d(t.Date),o=c(Math.max(0,t.Value));return barWidth=d.rangeBand(),barHeight=Math.abs(c(t.Value)-c(0)),n.createRoundedRect(a,o,barWidth,barHeight,1,!i,!i,i,i)}}).attr("class",function(t){return t.Value<0?"bar negative":"bar positive"})}}),XERO.widget.chart.JsonRenderer=function(){},XERO.widget.chart.JsonRenderer.prototype={render:function(t,e,n,i){var a=Ext.decode(e.responseText);e.argument.scope&&e.argument.scope.onLoad&&e.argument.scope.onLoad.call(e.argument.scope||this,a)}},XERO.widget.chart.Panel=Ext.extend(Ext.Panel,{border:!1,layout:"fit",bodyStyle:"background-color:transparent;",initComponent:function(){var t=this;Ext.apply(t,{width:t.width||600,height:t.height||300,renderer:new XERO.widget.chart.JsonRenderer}),t.addEvents("renderchart"),t.autoLoad?t.autoLoad=t.buildLoader(t.autoLoad):t.on("render",function(){t.update('<div class="loading-indicator">Loading graph</div>')},t,{delay:10}),XERO.widget.chart.Panel.superclass.initComponent.apply(t,arguments)},buildLoader:function(t){return Ext.isObject(t)?Ext.applyIf(t,{method:"GET",nocache:!0,scope:this,scripts:!1,text:"Loading graph..."}):t={url:this.autoLoad,method:"GET",nocache:!0,scope:this,scripts:!1,text:"Loading graph..."},t},onLoad:function(t){this.add({xtype:this.chart,chartData:t})}}),XERO.ns("XERO.widget.dashboard"),XERO.widget.dashboard.KPIList=Ext.extend(Ext.Panel,{border:!1,layout:"fit",bodyStyle:"background-color:transparent;",initComponent:function(){var t=this;Ext.apply(t,{width:t.width||450,height:t.height||75,renderer:new XERO.widget.chart.JsonRenderer}),t.addEvents("renderchart"),t.autoLoad?t.autoLoad=t.buildLoader(t.autoLoad):t.on("render",function(){t.update('<div class="loading-indicator">Loading graph</div>')},t,{delay:10}),XERO.widget.dashboard.KPIList.superclass.initComponent.apply(t,arguments)},buildLoader:function(t){return Ext.isObject(t)?Ext.applyIf(t,{method:"GET",nocache:!0,scope:this,scripts:!1,text:"Loading..."}):t={url:this.autoLoad,method:"GET",nocache:!0,scope:this,scripts:!1,text:"Loading..."},t},onLoad:function(t){if(t.portlets&&0!==t.portlets.length){var e=function(t){var e=0,n=t.length;for(e;e<n;e++){if("Monthly"==t[e].name)return t[e];if("Weekly"==t[e].name)return t[e]}return null},n=Ext.select("div[data-type=kpis]").first();new Ext.XTemplate('<table class="standard kpis">','<tpl for="portlets">',"<tr>",'<td class="kpi-title" style="padding-right: 0;vertical-align: middle;cursor:default;">','<a class="inv-totals-value" href="/BusinessPerformance/#kpi:{[this.getMetricCode(values)]}">{name}</a>',"</td>",'<td class="right" style="cursor:default;">','<div id="chartCanvas_{[this.getMetricCode(values)]}" align="center" class="chart"></div>',"</td>",'<td class="right" style="cursor:default;">',"{[this.formatTotal(values)]}","</td>","</tr>","</tpl>","</table>",{compiled:!0,disableFormats:!0,getMetricCode:function(t){return t.name.replace(/\s/gi,"").replace(/%/,"Percentage")},formatTotal:function(t){var n=e(t.granularities);if(n){var i=n.series,a=i[i.length-1],o=t.format||"0,0.0",r=a.value;switch(o){case"#,#":o="0,0";break;case"#,#.#":case"$0.00":o="0,0.0";break;case"#,#.##":o="0,0.00";break;case"#,#.#%":case"Percentage":case"0.0%":r*=100,o="0,0.0%"}return Ext.String.format("<span>{0}</span>",Ext.util.Format.number(r||0,o))}return""}}).overwrite(this.body,t),this.setHeight("auto"),this.doLayout(),Ext.each(t.portlets,function(t){var n=t.name.replace(/\s/gi,"").replace(/%/,"Percentage"),i=e(t.granularities);new XERO.widget.d3charts.SmallBarChart({renderTo:Ext.String.format("chartCanvas_{0}",n),series:i?i.series:[],width:200,height:40})}),n.show()}}}),XERO.widget.chart.ShortBankChart=Ext.extend(XERO.widget.d3charts.Area,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:Ext.String.format("/Dashboard/Reports/GetShortBankReportData?bankAccountId={0}",t.bankAccountId),method:"GET",root:"data",autoLoad:!0,fields:["Date","Value"]});Ext.apply(t,{include:{tooltip:{valueLabel:"Balance"},zoom:!1,points:!0,grid:{x:!0,y:!1}},store:e,tooltipOffset:{top:5,left:0},axisTypeX:"day",axisFormatX:function(t){return t.format(XERO.globalization.CultureInfo.formatPatterns.Ext.monthDay)},tooltipHeaderHtml:function(t){var e=this;return new Date(t[e.dataLabels.x1]).format(XERO.globalization.CultureInfo.formatPatterns.Ext.longMonthDayYear)}}),XERO.widget.chart.ShortBankChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.LongBankChart=Ext.extend(XERO.widget.d3charts.Area,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:Ext.String.format("/Dashboard/Reports/GetBankReportData?bankAccountId={0}",t.bankAccountId),method:"GET",root:"data",autoLoad:!0,fields:["Date","Value"]});Ext.apply(t,{include:{tooltip:{valueLabel:"Balance"},zoom:!1,points:!1,grid:{x:!0,y:!1}},tickOffset:31,store:e,tooltipOffset:{top:5,left:0},axisFormatX:d3.time.format("%B"),axisTypeX:"month"}),XERO.widget.chart.LongBankChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.SummaryARChart=Ext.extend(XERO.widget.d3charts.Bar,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:"/Dashboard/Reports/GetSummarisedAgedDebtors",method:"GET",root:"data",autoLoad:!0,fields:["Label","Series"]});Ext.apply(t,{include:{tooltip:{valueLabel:"Money"},grid:{x:!1,y:!0}},barChartType:"stacked",dataLabels:{x1:"Label",x2:"Series",y1:"Total",click:"Url"},tooltipOffset:{top:0,left:0},store:e,roundedBarRadius:2,fillFunction:function(t,e){var n=this;return"Outstanding"===t.Type?n.colors.positive:"Overdue"===t.Type?n.colors.negative:void 0}}),XERO.widget.chart.SummaryARChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.ARChart=Ext.extend(XERO.widget.d3charts.Bar,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:"/Dashboard/Reports/GetMoneyComingInReport",method:"GET",root:"data",autoLoad:!0,fields:["Label","Series"]});Ext.apply(t,{include:{draggable:!1,tooltip:{valueLabel:"Money"},grid:{x:!1,y:!0}},barChartType:"stacked",dataLabels:{x1:"Label",x2:"Series",y1:"Value",click:"Url"},tooltipOffset:{top:0,left:-2},removeEmptySeries:!1,store:e,roundedBarRadius:2,fillFunction:function(t,e){var n=this;return"Overdue"==t.Type?n.colors.negative:n.colors.positive},defaultBarCount:13,bkgdColor:"rgb(251, 251, 251)"}),XERO.widget.chart.ARChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.APChart=Ext.extend(XERO.widget.d3charts.Bar,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:"/Dashboard/Reports/GetMoneyGoingOutReport",method:"GET",root:"data",autoLoad:!0,fields:["Label","Series"]});Ext.apply(t,{include:{draggable:!1,tooltip:{valueLabel:"Money"},grid:{x:!1,y:!0}},barChartType:"stacked",dataLabels:{x1:"Label",x2:"Series",y1:"Value",click:"Url"},tooltipOffset:{top:0,left:-2},removeEmptySeries:!1,store:e,roundedBarRadius:2,fillFunction:function(t,e){var n=this;return"Outstanding"===t.Type?n.colors.positive:"Overdue"===t.Type?n.colors.negative:void 0},defaultBarCount:13,bkgdColor:"rgb(251, 251, 251)"}),XERO.widget.chart.APChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.CashflowChart=Ext.extend(XERO.widget.d3charts.Bar,{initComponent:function(){var t=this,e=new Ext.data.JsonStore({url:"/Dashboard/Reports/GetCashflow",method:"GET",root:"data",autoLoad:!0,fields:["Label","Series"]});Ext.apply(t,{include:{tooltip:{valueLabel:"Money"},grid:{x:!1,y:!0}},barChartType:"multi",data:function(t){var e=this,n=[],i=!0;return t.forEach(function(t){var a=0,o=0;t.data[e.dataLabels.x2].forEach(function(t){t.prev=a,o+=t[e.dataLabels.y1],a+=t[e.dataLabels.y1]}),t.data.sum=o,t.data.Series.length&&n.push(t),0!==t.data.sum&&(i=!1)}),1==i&&e.loadEmpty(),e.removeEmptySeries?n:t},dataLabels:{x1:"Label",x2:"Series",y1:"Value",click:"Url"},tooltipOffset:{top:0,left:0},store:e,roundedBarRadius:2,valueFormatY:function(t){return t/1e3+"k"},fillFunction:function(t,e){var n=this;return"Expenses"===t.Type?n.colors.neutral:"Revenue"===t.Type?n.colors.positive:void 0},tooltipHeaderHtml:function(t){return t},tooltipBodyHtml:function(t,e){var n=e[0].data;return["<div>","<span class='label in'>In</span>","<span class='in'>",Ext.util.Format.number(n.Series[0].Value,"0,000"),"</span></div>","<div>","<span class='label out'>Out</span>","<span class='out'>",Ext.util.Format.number(n.Series[1].Value,"0,000"),"</span></div>","<div>","<span class='label difference'>Difference</span>","<span class='difference'>",Ext.util.Format.number(n.Series[0].Value-n.Series[1].Value,"0,000"),"</span>","</div>"].join("")},loadEmpty:function(){0===Ext.select("div[data-type=cashflow] div.dashboard-box-inner").getCount()?Ext.select("div[data-type=cashflow]").addClass("empty"):Ext.select("div[data-type=cashflow] div.dashboard-box-inner").addClass("empty"),Ext.select("div[data-type=cashflow] h2 span").update("Track your cashflow");var t=["<div class='empty-state cash-flow'>","<p>See how much cash your business has and make sure it can cover upcoming bills. </p>","<p>Add an <a href='/AccountsReceivable/Edit.aspx' class='trackItem'>invoice</a> or <a href='/AccountsPayable/Edit.aspx' class='trackItem'>bill</a> to get started.</p>","<div class='empty-image'><img src='/common/images/dashboard/dash-img-cashflow.png' /></div>","</div>"].join(""),e=Ext.get("chartCanvas_CashInOutReport");XERO.analytics.Analytics.isTrial()&&e.on("DOMNodeInserted",function(){XERO.analytics.Analytics.trackLinks("#chartCanvas_CashInOutReport a","Dashboard Box Click",function(t){return{Class:t.className,Label:t.textContent||t.innerText}})},this,{single:!0}),e.insertHtml("afterBegin",t)}}),XERO.widget.chart.CashflowChart.superclass.initComponent.apply(t,arguments)}}),XERO.widget.chart.KPIChart=Ext.extend(XERO.widget.d3charts.SmoothArea,{style:"background: transparent;",initComponent:function(){var t,e=this;t=e.localData?new Ext.data.JsonStore({data:e.localData,fields:[{name:"Date",mapping:"date",type:"date"},{name:"Value",mapping:"value",type:"float"},{name:"PercentageDirection",mapping:"trendIndicator"},{name:"PercentageChange",type:"float"}]}):new Ext.data.JsonStore({url:Ext.String.format("/Dashboard/Reports/GetKPI?metric={0}",e.metric),method:"GET",root:"data",autoLoad:!0,fields:["Date","Value","Direction","PercentageChange"]}),Ext.apply(e,{interpolate:"cardinal",innerMargin:{top:10,right:10,bottom:10,left:10},tickOffset:null,inflextionPoint:!0,colors:{negative:"#00ACF0",positive:"#00ACF0",fillPositive:"#CBEFFC",fillNegative:"#CBEFFC",areaOpacity:.9,inflextionPositive:"rgb(98, 182, 0)",inflextionNeutral:"rgb(0, 172, 240)",inflextionNegative:"rgb(238, 57, 52)"},dataLabels:{x1:"Date",y1:"Value",y2:"PercentageDirection",y3:"PercentageChange"},include:{tooltip:{valueLabel:"Balance",snapTo:"month"},points:!0,zeroLine:!1,grid:{x:!1,y:!1}},axisTypeX:"day",store:t,showXLabels:function(t,e,n){return 0},transformRecord:function(t){return t},data:function(t){return t}}),XERO.widget.chart.KPIChart.superclass.initComponent.apply(e,arguments)}}),XERO.widget.chart.RenderXeroChart=function(t,e,n,i){function a(t,e,n,i){if(deconcept.SWFObjectUtil.getPlayerVersion().major>=8){var a,r=Ext.urlEncode(Ext.apply(i,{_dc:(new Date).getTime()})),s=String.format("/Reports/GenerateChart.aspx?{0}",encodeURIComponent(r));return"Top5DebtorsReport"==t?(a=new FusionCharts("/Common/Charts/Pie2D.swf",t,e,n,!1,!1),a.setDataURL(s),a.render(o)):(a=new SWFObject("/Common/Charts/xoChart.swf",t,e,n,"8"),a.addParam("wmode","opaque"),a.addParam("allowScriptAccess","sameDomain"),a.addParam("movie","/Common/Charts/xoChart.swf"),a.addParam("quality","high"),a.addParam("menu","false"),a.addParam("bgcolor","#ffffff"),a.addVariable("dataURL",s),a.write(o)),a}return Ext.fly(o).update("<div class='no-flash'>You must install Flash version 8 or higher to view these charts. Go <a href='http://www.adobe.com/go/getflashplayer/' target='_blank'>here</a> to do that now.</div>"),null}i?Ext.isString(i)&&(i={reportType:i}):i={reportType:t};var o=String.format("chartCanvas_{0}",t);return function(t,e,n,i){switch(i.reportType){case"MonthlyAgedDebtorsReport":return new XERO.widget.chart.SummaryARChart({renderTo:o,width:e,height:n});case"AgedDebtorsReport":case"SummaryAgedDebtorsReport":return new XERO.widget.chart.ARChart({renderTo:o,width:e,height:n});case"ShortCashFlowReport":return new XERO.widget.chart.ShortBankChart({bankAccountId:i.bankAccountID,renderTo:o,width:e,height:n});case"CashFlowReport":return new XERO.widget.chart.LongBankChart({bankAccountId:i.bankAccountID,renderTo:o,width:e,height:n});case"InvoicesToPayReport":return new XERO.widget.chart.APChart({renderTo:o,width:e,height:n});case"CashInOutReport":return new XERO.widget.chart.CashflowChart({renderTo:o,width:e,height:n});case"KPI":return new XERO.widget.chart.KPIChart({renderTo:o,width:e,height:n,metric:i.metric,title:i.title});default:a(t,e,n,i)}}(t,e,n,i)}},function(t,e){!function(){var t={mimeRegxMap:{"image/png":/^(png)$/i,"image/jpeg":/^(jpe|jpeg|jpg)$/i,"image/gif":/^(gif)$/i,"image/bmp":/^(bmp)$/i,"image/vnd.microsoft.icon":/^(ico)$/i,"image/tiff":/^(tif|tif)$/i,"image/svg+xml":/^(svg|svgz)$/i,"image/x-win-bitmap":/^(cur)$/i,"audio/basic":/^(au)$/i,"audio/mpeg":/^(mp3)$/i,"audio/mp4a-latm":/^(m4p|m4b|m4a)$/i,"audio/x-wav":/^(wav)$/i,"audio/ogg":/^(ogg|oga|spx)$/i,"audio/flac":/^(flac)$/i,"audio/x-ms-wma":/^(wma)$/i,"audio/x-pn-realaudio":/^(ra|ram)$/i,"application/vnd.rn-realmedia":/^(rm)$/i,"video/ogg":/^(ogv)$/i,"video/mp4":/^(mp4)$/i,"video/mpeg":/^(mpe|mpg|mpeg|mpga)$/i,"video/quicktime":/^(qt|mov)$/i,"video/x-msvideo":/^(avi)$/i,"video/x-flv":/^(flv)$/i,"video/x-ms-wmv":/^(wmv)$/i,"text/plain":/^(txt)$/i,"text/html":/^(htm|html|shtml|php|php4)$/i,"text/css":/^(css)$/i,"text/x-actionscript":/^(as)$/i,"application/javascript":/^(js)$/i,"application/json":/^(json)$/i,"application/xml":/^(xml|plist)$/i,"application/x-shockwave-flash":/^(swf)$/i,"application/zip":/^(zip)$/i,"application/gzip":/^(gz)$/i,"application/x-tar":/^(tar)$/i,"application/x-rar-compressed":/^(rar)$/i,"application/x-msdownload":/^(exe|msi)$/i,"application/vnd.ms-cab-compressed":/^(cab)$/i,"application/pdf":/^(pdf)$/i,"image/vnd.adobe.photoshop":/^(psd)$/i,"application/postscript":/^(ai|eps|ps)$/i,"application/msword":/^(doc)$/i,"application/x-dot":/^(dot)$/i,"application/rtf":/^(rtf)$/i,"application/vnd.ms-excel":/^(xls|xla)$/i,"application/vnd.ms-powerpoint":/^(ppt)$/i,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":/^(docx)$/i,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":/^(xlsx)$/i,"application/x-director":/^(cdr)$/i},groups:{"previewable/*":"image/png,image/jpeg,image/jpg,image/gif,image/vnd.microsoft.icon"},unknown:"application/octet-stream",normalized:{"application/x-rar-compressed":"application/rar","application/msword":"application/doc","application/x-dot":"application/doc","application/vnd.ms-excel":"application/xls","application/vnd.ms-powerpoint":"application/ppt","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"application/docx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/xlsx"},categories:{pdfs:"application/pdf,image/vnd.adobe.photoshop",documents:"application/msword,application/x-dot,application/rtf,application/vnd.ms-powerpoint,application/doc,application/ppt,application/docx",spreadsheets:"application/xls,application/vnd.ms-excel,application/xlsx",images:"image/png,image/jpeg,image/jpg,image/gif,image/vnd.microsoft.icon,image/bmp,image/tiff,image/x-win-bitmap",archives:"application/zip,application/gzip,application/x-tar,application/x-rar-compressed,application/x-msdownload,application/vnd.ms-cab-compressed"}},e=function(e){var n=t.unknown;return Ext.iterate(t.mimeRegxMap,function(t,i){if(i.test(e))return n=t,!1}),n};Ext.util.Mime={},Ext.apply(Ext.util.Mime,{getMimeFromExtension:function(t){return e(t)},getMimeTypeFromFileName:function(t){var n=t.split(".").pop();return e(n)},normalized:function(e,n){return(e||t.unknown)==t.unknown?(e=Ext.util.Mime.getMimeTypeFromFileName(n),t.normalized[e]||e):t.normalized[e]||e},getTypeCategory:function(e){var n="unknown";return Ext.iterate(t.categories,function(t,i){-1!==i.indexOf(e)&&(n=t)}),n},isPreviewable:function(t){return-1!=="application/pdf,application/msword,application/rtf,application/vnd.ms-powerpoint,application/doc,application/ppt,application/docx".split(",").indexOf(t)}}),Ext.util.Format.mime=function(e){return t.normalized[e]||e}}()},function(t,e){Ext.ns("XERO","XERO.docs","XERO.docs.upload","XERO.docs.attachments"),XERO.routes={Upload:{UploadFile:"/docs/upload/uploadfile"},Docs:{GetFiles:"/docs/docs/getfiles"}},Ext.util.Format.fileSize=function(t){if(t>1){var e=["Bytes","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(t)/Math.log(1024));return n>0?(t/Math.pow(1024,Math.floor(n))).toFixed(2)+" "+e[n]:t+" "+e[n]}return 1==t?"1 Byte":""},Ext.Ajax.get=function(t,e){return Ext.Ajax.request({url:t,method:"GET",callback:e})},Ext.define("XERO.docs.hubdoc.AdGenerator",{extend:"Ext.util.Observable",tooltip:null,pointerTip:null,window:null,countryCode:null,versionCode:null,showToolTip:!1,isPracticeUser:!1,filesButton:null,documentTypeCode:null,toolTipVersion:null,filesCount:0,toolTipState:"GETTINGSTARTED/HUBDOCTOOLTIP2",constructor:function(t){var e=this;e.filesButton=t.filesButton,e.documentTypeCode=e.filesButton.parentType,e.callParent(arguments),e.initialize()},initialize:function(){var t=this;Ext.Ajax.request({url:"/Settings/ConnectedApps/ShowHubdocTooltip",params:{documentTypeCode:t.documentTypeCode},method:"GET",callback:function(e,n,i){var a=Ext.decode(i.responseText);Ext.apply(t,a),!0===t.showToolTip&&(t.track("Show tooltip","Tooltip",{dimension21:t.toolTipVersion,dimension17:"HUBDOC_TOOLTIP"}),t.renderToolTip())}})},goToLandingPage:function(){var t=this;t.track("Try Hudboc","Tooltip",{dimension21:t.toolTipVersion,dimension17:"HUBDOC_TOOLTIP"}),t.removeToolTip(function(){window.open(Ext.String.format("/app/{0}/connect-hubdoc",t.shortCode))}),t.destroy()},renderToolTip:function(){function t(t){var e=t.getXY();return[e[0]-296,e[1]+40]}function e(){r=t(a.filesButton.container);try{a.pointerTip.getEl().setXY(r)}catch(t){}}var n,i,a=this,o=['<div id="tipContent" class="tip-content" style="padding-right:30px;padding-top:20px;">'];"INVOICETYPE/ACCPAY"==a.documentTypeCode?!0===a.isPracticeUser?(n="Connect to Hubdoc to stop chasing bills",i="With Hubdoc and Xero together, you and your clients can easily get bills into Xero, automate data entry and simplify bank reconciliation."):(n="Connect to Hubdoc and spend less time on data entry",i="With Hubdoc and Xero together, you can easily get your bills into Xero, automate data entry and simplify the process for matching transactions to your bank feed."):!0===a.isPracticeUser?(n="Connect to Hubdoc to spend less time chasing receipts",i="With Hubdoc and Xero together, you and your clients can easily get receipts into Xero, automate data entry and simplify bank reconciliation."):(n="Connect to Hubdoc and spend less time on data entry",i="With Hubdoc and Xero together, you can easily get your receipts into Xero, automate data entry and simplify the process for matching transactions to your bank feed."),o.push(Ext.String.format("<h4>{0}</h4><p>{1}</p>",n,i)),o.push('<div style="display:flex;align-items:center;justify-content:flex-end;margin-top:25px;">'),o.push('<a class="btn-setup" id="hubdocToolTipTryButton" href="#" style="width:100px;padding:7px 20px;border-radius:2px;">Set up Hubdoc</a>'),o.push('<a id="hubdocToolTipNoButton" href="#" style="margin-left:20px;">No thanks</a>'),o.push("</div>"),o.push('<span class="close-tip" id="hubdocToolTipCloseButton"></span>'),o.push("</div>"),a.pointerTip=new XERO.tip.PointerTip({target:a.filesButton.container,title:"",cls:"x-pointer-tip x-paymentservices-tip x-hubdoc-tip",html:o.join(""),closable:!0,width:375,defaultAlign:"bl-tr"}),a.pointerTip.setColor("white"),a.pointerTip.showAt(t(a.filesButton.container)),Ext.fly("hubdocToolTipTryButton").on("click",a.goToLandingPage,a),Ext.fly("hubdocToolTipNoButton").on("click",function(){a.track("No thanks","Tooltip",{dimension21:a.toolTipVersion,dimension17:"HUBDOC_TOOLTIP"}),a.removeToolTip(),a.destroy()},a),Ext.fly("hubdocToolTipCloseButton").on("click",function(){a.track("Close","Tooltip",{dimension21:a.toolTipVersion,dimension17:"HUBDOC_TOOLTIP"}),a.removeToolTip(),a.destroy()},a);var r,s=Date.now(),l=setInterval(function(){e(),Date.now()-s>3e3&&clearInterval(l)},300);XERO.bus.addListener("gettingstarted:hidden",e),XERO.bus.addListener("gettingstarted:show",e),window.addEventListener("resize",e),Ext.getDoc().on("mousedown",function(t){t.getTarget("a.xbtn")&&a.destroy()})},removeToolTip:function(t){var e=this;Ext.Ajax.request({url:Ext.String.format("/Ajax/GettingStarted/SaveState?code={0}&display=false",this.toolTipState),method:"POST",callback:function(){t&&t.apply(e,arguments)}})},track:function(t,e,n){var i=Ext.apply({hitType:"event",eventCategory:"Hubdoc Provisioning",eventAction:t,eventLabel:e},n||{});window.ga&&window.ga("send",i)},destroy:function(){this.pointerTip&&this.pointerTip.destroy()}})},function(t,e){!function(t,e){"use strict";function n(t,e){for(var n,i=[],o=0;o<t.length;++o){if(!(n=r[t[o]]||a(t[o])))throw"module definition dependecy not found: "+t[o];i.push(n)}e.apply(null,i)}function i(t,i,a){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(i===e)throw"invalid module definition, dependencies must be specified";if(a===e)throw"invalid module definition, definition function must be specified";n(i,function(){r[t]=a.apply(null,arguments)})}function a(e){for(var n=t,i=e.split(/[.\/]/),a=0;a<i.length;++a){if(!n[i[a]])return;n=n[i[a]]}return n}function o(n){for(var i=0;i<n.length;i++){for(var a=t,o=n[i],s=o.split(/[.\/]/),l=0;l<s.length-1;++l)a[s[l]]===e&&(a[s[l]]={}),a=a[s[l]];a[s[s.length-1]]=r[o]}}var r={};t.define=i,t.expose=o,t.MXI_DEBUG=!1}(window)},function(t,e){window.define("moxie/core/utils/Basic",[],function(){var t=function(t){return void 0===t?"undefined":null===t?"null":t.nodeType?"node":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},e=function(i){return n(arguments,function(a,o){o>0&&n(a,function(n,a){void 0!==n&&(t(i[a])===t(n)&&~r(t(n),["array","object"])?e(i[a],n):i[a]=n)})}),i},n=function(t,e){var n,i,a;if(t){try{n=t.length}catch(t){n=void 0}if(void 0===n){for(i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))return}else for(a=0;a<n;a++)if(!1===e(t[a],a))return}},i=function(e){var n;if(!e||"object"!==t(e))return!0;for(n in e)return!1;return!0},a=function(e,n){function i(o){"function"===t(e[o])&&e[o](function(t){++o<a&&!t?i(o):n(t)})}var a=e.length;"function"!==t(n)&&(n=function(){}),e&&e.length||n(),i(0)},o=function(t,e){var i=0,a=t.length,o=new Array(a);n(t,function(t,n){t(function(t){if(t)return e(t);var r=[].slice.call(arguments);r.shift(),o[n]=r,++i===a&&(o.unshift(null),e.apply(this,o))})})},r=function(t,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n}return-1},s=function(e,n){var i=[];"array"!==t(e)&&(e=[e]),"array"!==t(n)&&(n=[n]);for(var a in e)-1===r(e[a],n)&&i.push(e[a]);return!!i.length&&i},l=function(t,e){var i=[];return n(t,function(t){-1!==r(t,e)&&i.push(t)}),i.length?i:null},u=function(t){var e,n=[];for(e=0;e<t.length;e++)n[e]=t[e];return n},c=Ext.Guid.newGuid,d=function(t){return t?String.prototype.trim?String.prototype.trim.call(t):t.toString().replace(/^\s*/,"").replace(/\s*$/,""):t},h=function(t){if("string"!=typeof t)return t;var e,n={t:1099511627776,g:1073741824,m:1048576,k:1024};return t=/^([0-9]+)([mgk]?)$/.exec(t.toLowerCase().replace(/[^0-9mkg]/g,"")),e=t[2],t=+t[1],n.hasOwnProperty(e)&&(t*=n[e]),t};return{guid:c,typeOf:t,extend:e,each:n,isEmptyObj:i,inSeries:a,inParallel:o,inArray:r,arrayDiff:s,arrayIntersect:l,toArray:u,trim:d,sprintf:function(e){var n=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=n.shift();return"undefined"!==t(e)?e:""})},parseSizeStr:h}})},function(t,e){window.define("moxie/core/I18n",["moxie/core/utils/Basic"],function(t){var e={};return{addI18n:function(n){return t.extend(e,n)},translate:function(t){return e[t]||t},_:function(t){return this.translate(t)},sprintf:function(e){var n=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=n.shift();return"undefined"!==t.typeOf(e)?e:""})}}})},function(t,e){window.define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(t,e){var n={mimes:{},extensions:{},addMimeType:function(t){var e,n,i,a=t.split(/,/);for(e=0;e<a.length;e+=2){for(i=a[e+1].split(/ /),n=0;n<i.length;n++)this.mimes[i[n]]=a[e];this.extensions[a[e]]=i}},extList2mimes:function(e,n){var i,a,o,r,s=this,l=[],u=[];for(a=0;a<e.length;a++)for(i=e[a].extensions.split(/\s*,\s*/),o=0;o<i.length;o++){if("*"===i[o])return[];if(r=s.mimes[i[o]])-1===t.inArray(r,l)&&(u.push("."+i[o]),l.push(r));else{if(!n||!/^\w+$/.test(i[o]))return[];l.push("."+i[o])}}return u.concat(l)},mimes2exts:function(e){var n=this,i=[];return t.each(e,function(e){if("*"===e)return i=[],!1;var a=e.match(/^(\w+)\/(\*|\w+)$/);a&&("*"===a[2]?t.each(n.extensions,function(t,e){new RegExp("^"+a[1]+"/").test(e)&&[].push.apply(i,n.extensions[e])}):n.extensions[e]&&[].push.apply(i,n.extensions[e]))}),i},mimes2extList:function(n){var i=[],a=[];return"string"===t.typeOf(n)&&(n=t.trim(n).split(/\s*,\s*/)),a=this.mimes2exts(n),i.push({title:e.translate("Files"),extensions:a.length?a.join(","):"*"}),i.mimes=n,i},getFileExtension:function(t){var e=t&&t.match(/\.([^.]+)$/);return e?e[1].toLowerCase():""},getFileMime:function(t){return this.mimes[this.getFileExtension(t)]||""}};return n.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-zip-compressed,zipx,application/x-zip,xzip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe,application/rar,rar,application/vnd.oasis.opendocument.formula,odf,message/rfc822,eml,application/vnd.ms-outlook,msg,application/x-7z-compressed,7z,application/vnd.oasis.opendocument.spreadsheet,ods,application/vnd.oasis.opendocument.text,odt,application/x-iwork-keynote-sffkey,keynote,application/vnd.apple.keynote,key,application/x-iwork-pages-sffpages,pages-tef,application/vnd.apple.pages,pages,application/x-iwork-numbers-sffnumbers,numbers-tef,application/vnd.apple.numbers,numbers"),n})},function(t,e){window.define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(t){function e(t,e,n){var i=0,a=0,o=0,r={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},s=function(t){return t=(""+t).replace(/[_\-+]/g,"."),t=t.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),t.length?t.split("."):[-8]},l=function(t){return t?isNaN(t)?r[t]||-7:parseInt(t,10):0};for(t=s(t),e=s(e),a=Math.max(t.length,e.length),i=0;i<a;i++)if(t[i]!=e[i]){if(t[i]=l(t[i]),e[i]=l(e[i]),t[i]<e[i]){o=-1;break}if(t[i]>e[i]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return o<=0;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return o<0;default:return null}}var n=function(t){var e="major",n="name",i="version",a={has:function(t,e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},o={rgx:function(){for(var t,e,n,i,a,o,r,s=0,l=arguments;s<l.length;s+=2){var u=l[s],c=l[s+1];if(void 0===t){t={};for(i in c)a=c[i],"object"==typeof a?t[a[0]]=void 0:t[a]=void 0}for(e=n=0;e<u.length;e++)if(o=u[e].exec(this.getUA())){for(i=0;i<c.length;i++)r=o[++n],a=c[i],"object"==typeof a&&a.length>0?2==a.length?"function"==typeof a[1]?t[a[0]]=a[1].call(this,r):t[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?t[a[0]]=r?r.replace(a[1],a[2]):void 0:t[a[0]]=r?a[1].call(this,r,a[2]):void 0:4==a.length&&(t[a[0]]=r?a[3].call(this,r.replace(a[1],a[2])):void 0):t[a]=r||void 0;break}if(o)break}return t},str:function(t,e){for(var n in e)if("object"==typeof e[n]&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(a.has(e[n][i],t))return"?"===n?void 0:n}else if(a.has(e[n],t))return"?"===n?void 0:n;return t}},r={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},s={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[n,i,e],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[n,"Opera"],i,e],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[n,i,e],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[n,"IE"],i,e],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[n,"Yandex"],i,e],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[n,/_/g," "],i,e],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[n,i,e],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[n,"Dolphin"],i,e],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[n,"Chrome"],i,e],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[n,"Android Browser"],i,e],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[i,e,[n,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[i,e,n],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[n,[e,o.str,r.browser.oldsafari.major],[i,o.str,r.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[n,i,e],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[n,"Netscape"],i,e],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[n,i,e]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,i],[/rv\:([\w\.]+).*(gecko)/i],[i,n]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[i,o.str,r.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[i,o.str,r.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],i],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[n,i],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[n,"Symbian"],i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],i],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[n,i],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],i],[/(sunos)\s?([\w\.]+\d)*/i],[[n,"Solaris"],i],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[n,i],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[n,"iOS"],[i,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[n,[i,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[n,i]]};return(new function(t){var e=t||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return o.rgx.apply(this,s.browser)},this.getEngine=function(){return o.rgx.apply(this,s.engine)},this.getOS=function(){return o.rgx.apply(this,s.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return e},this.setUA=function(t){return e=t,this},this.setUA(e)}).getResult()}(),i=function(){var e={define_property:!1,create_canvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}(),return_response_type:function(e){try{if(-1!==t.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=e,n.responseType===e}}catch(t){}return!1},use_data_uri:function(){var t=new Image;return t.onload=function(){e.use_data_uri=1===t.width&&1===t.height},setTimeout(function(){t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==a.browser||a.version>=9)},use_data_uri_of:function(t){return e.use_data_uri&&t<33e3||e.use_data_uri_over32kb()},use_fileinput:function(){var t=document.createElement("input");return t.setAttribute("type","file"),!t.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===t.typeOf(e[n])?e[n].apply(this,i):!!e[n]}}(),a={can:i,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:e,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return a.OS=a.os,MXI_DEBUG&&(a.debug={runtime:!0,events:!1},a.log=function(){var e=arguments[0];if("string"===t.typeOf(e)&&(e=t.sprintf.apply(this,arguments)),window&&window.console&&window.console.log)window.console.log(e);else if(document){var n=document.getElementById("moxie-console");n||(n=document.createElement("pre"),n.id="moxie-console",document.body.appendChild(n)),-1!==t.inArray(t.typeOf(e),["object","array"])?function(t){n.appendChild(document.createTextNode(t+"\n"))}(e):n.appendChild(document.createTextNode(e+"\n"))}}),a})},function(t,e){window.define("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(t){var e=function(t){return"string"!=typeof t?t:document.getElementById(t)},n=function(t,e){return!!t.className&&new RegExp("(^|\\s+)"+e+"(\\s+|$)").test(t.className)};return{get:e,hasClass:n,addClass:function(t,e){n(t,e)||(t.className=t.className?t.className.replace(/\s+$/,"")+" "+e:e)},removeClass:function(t,e){if(t.className){var n=new RegExp("(^|\\s+)"+e+"(\\s+|$)");t.className=t.className.replace(n,function(t,e,n){return" "===e&&" "===n?" ":""})}},getStyle:function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null)[e]:void 0},getPos:function(e,n){function i(t){var e,n,i=0,a=0;return t&&(n=t.getBoundingClientRect(),e="CSS1Compat"===u.compatMode?u.documentElement:u.body,i=n.left+e.scrollLeft,a=n.top+e.scrollTop),{x:i,y:a}}var a,o,r,s=0,l=0,u=document;if(e=e,n=n||u.body,e&&e.getBoundingClientRect&&"IE"===t.browser&&(!u.documentMode||u.documentMode<8))return o=i(e),r=i(n),{x:o.x-r.x,y:o.y-r.y};for(a=e;a&&a!=n&&a.nodeType;)s+=a.offsetLeft||0,l+=a.offsetTop||0,a=a.offsetParent;for(a=e.parentNode;a&&a!=n&&a.nodeType;)s-=a.scrollLeft||0,l-=a.scrollTop||0,a=a.parentNode;return{x:s,y:l}},getSize:function(t){return{w:t.offsetWidth||t.clientWidth,h:t.offsetHeight||t.clientHeight}}}})},function(t,e){window.define("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(t){function e(t,e){var n;for(n in t)if(t[n]===e)return n;return null}return{RuntimeError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return t.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function e(t){this.code=t,this.name="OperationNotAllowedException"}return t.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return t.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return t.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(t){this.code=t,this.name=e(i,t),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return t.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function e(t){this.code=t,this.name="EventException"}return t.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}})},function(t,e){window.define("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(t,e,n){function i(){var i={};n.extend(this,{uid:null,init:function(){this.uid||(this.uid=n.guid("uid_"))},addEventListener:function(t,e,a,o){var r,s=this;if(this.hasOwnProperty("uid")||(this.uid=n.guid("uid_")),t=n.trim(t),/\s/.test(t))return void n.each(t.split(/\s+/),function(t){s.addEventListener(t,e,a,o)});t=t.toLowerCase(),a=parseInt(a,10)||0,r=i[this.uid]&&i[this.uid][t]||[],r.push({fn:e,priority:a,scope:o||this}),i[this.uid]||(i[this.uid]={}),i[this.uid][t]=r},hasEventListener:function(t){return t?!(!i[this.uid]||!i[this.uid][t]):!!i[this.uid]},removeEventListener:function(t,e){t=t.toLowerCase();var a,o=i[this.uid]&&i[this.uid][t];if(o){if(e){for(a=o.length-1;a>=0;a--)if(o[a].fn===e){o.splice(a,1);break}}else o=[];o.length||(delete i[this.uid][t],n.isEmptyObj(i[this.uid])&&delete i[this.uid])}},removeAllEventListeners:function(){i[this.uid]&&delete i[this.uid]},dispatchEvent:function(a){var o,r,s,l,u={},c=!0;if("string"!==n.typeOf(a)){if(l=a,"string"!==n.typeOf(l.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);a=l.type,void 0!==l.total&&void 0!==l.loaded&&(u.total=l.total,u.loaded=l.loaded),u.async=l.async||!1}if(-1!==a.indexOf("::")?function(t){o=t[0],a=t[1]}(a.split("::")):o=this.uid,a=a.toLowerCase(),r=i[o]&&i[o][a]){r.sort(function(t,e){return e.priority-t.priority}),s=[].slice.call(arguments),s.shift(),u.type=a,s.unshift(u),MXI_DEBUG&&t.debug.events&&t.log("Event '%s' fired on %u",u.type,o);var d=[];n.each(r,function(t){s[0].target=t.scope,u.async?d.push(function(e){setTimeout(function(){e(!1===t.fn.apply(t.scope,s))},1)}):d.push(function(e){e(!1===t.fn.apply(t.scope,s))})}),d.length&&n.inSeries(d,function(t){c=!t})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(t){var e=this;this.bind(t.join(" "),function(t){var e="on"+t.type.toLowerCase();"function"===n.typeOf(this[e])&&this[e].apply(this,arguments)}),n.each(t,function(t){t="on"+t.toLowerCase(t),"undefined"===n.typeOf(e[t])&&(e[t]=null)})}})}return i.instance=new i,i})},function(t,e){window.define("moxie/core/utils/Encode",[],function(){var t=function(t){return unescape(encodeURIComponent(t))},e=function(t){return decodeURIComponent(escape(t))};return{utf8_encode:t,utf8_decode:e,atob:function(t,n){if("function"==typeof window.atob)return n?e(window.atob(t)):window.atob(t);var i,a,o,r,s,l,u,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,f=0,p="",m=[];if(!t)return t;t+="";do{r=d.indexOf(t.charAt(h++)),s=d.indexOf(t.charAt(h++)),l=d.indexOf(t.charAt(h++)),u=d.indexOf(t.charAt(h++)),c=r<<18|s<<12|l<<6|u,i=c>>16&255,a=c>>8&255,o=255&c,m[f++]=64==l?String.fromCharCode(i):64==u?String.fromCharCode(i,a):String.fromCharCode(i,a,o)}while(h<t.length);return p=m.join(""),n?e(p):p},btoa:function(e,n){if(n&&t(e),"function"==typeof window.btoa)return window.btoa(e);var i,a,o,r,s,l,u,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,f=0,p="",m=[];if(!e)return e;do{i=e.charCodeAt(h++),a=e.charCodeAt(h++),o=e.charCodeAt(h++),c=i<<16|a<<8|o,r=c>>18&63,s=c>>12&63,l=c>>6&63,u=63&c,m[f++]=d.charAt(r)+d.charAt(s)+d.charAt(l)+d.charAt(u)}while(h<e.length);p=m.join("");var g=e.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)}}})},function(t,e){window.define("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(t,e,n,i){function a(i,o,s,l,u){var c,d=this,h=e.guid(o+"_"),f=u||"browser";i=i||{},r[h]=this,s=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},s),i.preferred_caps&&(f=a.getMode(l,i.preferred_caps,f)),MXI_DEBUG&&t.debug.runtime&&t.log("\tdefault mode: %s",f),c=function(){var t={};return{exec:function(e,n,i,a){if(c[n]&&(t[e]||(t[e]={context:this,instance:new c[n]}),t[e].instance[i]))return t[e].instance[i].apply(this,a)},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:h,type:o,mode:a.getMode(l,i.required_caps,f),shimid:h+"_container",clients:0,options:i,can:function(t,n){var i=arguments[2]||s;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=a.parseCaps(t)),"object"===e.typeOf(t)){for(var o in t)if(!this.can(o,t[o],i))return!1;return!0}return"function"===e.typeOf(i[t])?i[t].call(this,n):n===i[t]},getShimContainer:function(){var t,i=n.get(this.shimid);return i||(t=this.options.container?n.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),t.appendChild(i),t=null),i},getShim:function(){return c},shimExec:function(t,e){var n=[].slice.call(arguments,2);return d.getShim().exec.call(this,this.uid,t,e,n)},exec:function(t,e){var n=[].slice.call(arguments,2);return d[t]&&d[t][e]?d[t][e].apply(this,n):d.shimExec.apply(this,arguments)},destroy:function(){if(d){var t=n.get(this.shimid);t&&t.parentNode.removeChild(t),c&&c.removeAllInstances(),this.unbindAll(),delete r[this.uid],this.uid=null,h=d=c=t=null}}}),this.mode&&i.required_caps&&!this.can(i.required_caps)&&(this.mode=!1)}var o={},r={};return a.order="html5,flash,silverlight,html4",a.getRuntime=function(t){return!!r[t]&&r[t]},a.addConstructor=function(t,e){e.prototype=i.instance,o[t]=e},a.getConstructor=function(t){return o[t]||null},a.getInfo=function(t){var e=a.getRuntime(t);return e?{uid:e.uid,type:e.type,mode:e.mode,can:function(){return e.can.apply(e,arguments)}}:null},a.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(t){n[t]=!0}),n)},a.can=function(t,e){var n,i,o=a.getConstructor(t);return!!o&&(n=new o({required_caps:e}),i=n.mode,n.destroy(),!!i)},a.thatCan=function(t,e){var n=(e||a.order).split(/\s*,\s*/);for(var i in n)if(a.can(n[i],t))return n[i];return null},a.getMode=function(n,i,a){var o=null;if("undefined"===e.typeOf(a)&&(a="browser"),i&&!e.isEmptyObj(n)){if(e.each(i,function(i,a){if(n.hasOwnProperty(a)){var r=n[a](i);if("string"==typeof r&&(r=[r]),o){if(!(o=e.arrayIntersect(o,r)))return MXI_DEBUG&&t.debug.runtime&&t.log("\t\t%c: %v (conflicting mode requested: %s)",a,i,r),o=!1}else o=r}MXI_DEBUG&&t.debug.runtime&&t.log("\t\t%c: %v (compatible modes: %s)",a,i,o)}),o)return-1!==e.inArray(a,o)?a:o[0];if(!1===o)return!1}return a},a.capTrue=function(){return!0},a.capFalse=function(){return!1},a.capTest=function(t){return function(){return!!t}},a})},function(t,e){window.define("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(t,e,n,i){return function(){var a;n.extend(this,{connectRuntime:function(o){function r(n){var s,u;return n.length?(s=n.shift().toLowerCase(),(u=i.getConstructor(s))?(MXI_DEBUG&&t.debug.runtime&&(t.log("Trying runtime: %s",s),t.log(o)),a=new u(o),a.bind("Init",function(){a.initialized=!0,MXI_DEBUG&&t.debug.runtime&&t.log("Runtime '%s' initialized",a.type),setTimeout(function(){a.clients++,l.trigger("RuntimeInit",a)},1)}),a.bind("Error",function(){MXI_DEBUG&&t.debug.runtime&&t.log("Runtime '%s' failed to initialize",a.type),a.destroy(),r(n)}),MXI_DEBUG&&t.debug.runtime&&t.log("\tselected mode: %s",a.mode),a.mode?void a.init():void a.trigger("Error")):void r(n)):(l.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),void(a=null))}var s,l=this;if("string"===n.typeOf(o)?s=o:"string"===n.typeOf(o.ruid)&&(s=o.ruid),s){if(a=i.getRuntime(s))return a.clients++,a;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}r((o.runtime_order||i.order).split(/\s*,\s*/))},disconnectRuntime:function(){a&&--a.clients<=0&&a.destroy(),a=null},getRuntime:function(){return a&&a.uid?a:a=null},exec:function(){return a?a.exec.apply(this,arguments):null}})}})},function(t,e){window.define("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(t,e,n){function i(o,r){function s(e,n,o){var r,s=a[this.uid];return"string"===t.typeOf(s)&&s.length?(r=new i(null,{type:o,size:n-e}),r.detach(s.substr(e,r.size)),r):null}n.call(this),o&&this.connectRuntime(o),r?"string"===t.typeOf(r)&&(r={data:r}):r={},t.extend(this,{uid:r.uid||t.guid("uid_"),ruid:o,size:r.size||0,type:r.type||"",slice:function(t,e,n){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),t,e,n)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(t){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),t=t||"","data:"==t.substr(0,5)){var n=t.indexOf(";base64,");this.type=t.substring(5,n),t=e.atob(t.substring(n+8))}this.size=t.length,a[this.uid]=t},isDetached:function(){return!this.ruid&&"string"===t.typeOf(a[this.uid])},destroy:function(){this.detach(),delete a[this.uid]}}),r.data?this.detach(r.data):a[this.uid]=r}var a={};return i})},function(t,e){window.define("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(t,e,n){function i(i,a){a||(a={}),n.apply(this,arguments),this.type||(this.type=e.getFileMime(a.name));var o;if(a.name)o=a.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else if(this.type){var r=this.type.split("/")[0];o=t.guid((""!==r?r:"file")+"_"),e.extensions[this.type]&&(o+="."+e.extensions[this.type][0])}t.extend(this,{name:o||t.guid("file_"),relativePath:"",lastModifiedDate:a.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i})},function(t,e){window.define("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(t,e,n,i,a,o,r,s,l){function u(o){MXI_DEBUG&&e.log("Instantiating FileInput...");var u,d,h,f=this;if(-1!==t.inArray(t.typeOf(o),["string","node"])&&(o={browse_button:o}),!(d=i.get(o.browse_button)))throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);h={accept:[{title:r.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:d.parentNode||document.body},o=t.extend({},h,o),"string"==typeof o.required_caps&&(o.required_caps=s.parseCaps(o.required_caps)),"string"==typeof o.accept&&(o.accept=n.mimes2extList(o.accept)),u=i.get(o.container),u||(u=document.body),"static"===i.getStyle(u,"position")&&(u.style.position="relative"),u=d=null,l.call(f),t.extend(f,{uid:t.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){f.bind("RuntimeInit",function(e,n){f.ruid=n.uid,f.shimid=n.shimid,f.bind("Ready",function(){f.trigger("Refresh")},999),f.bind("Refresh",function(){var e,a,r,s;r=i.get(o.browse_button),s=i.get(n.shimid),r&&(e=i.getPos(r,i.get(o.container)),a=i.getSize(r),s&&t.extend(s.style,{top:e.y+"px",left:e.x+"px",width:a.w+"px",height:a.h+"px"})),s=r=null}),n.exec.call(f,"FileInput","init",o)}),f.connectRuntime(t.extend({},o,{required_caps:{select_file:!0}}))},disable:function(e){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===t.typeOf(e)||e)},refresh:function(){f.trigger("Refresh")},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===t.typeOf(this.files)&&t.each(this.files,function(t){t.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(c)}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return u.prototype=o.instance,u})},function(t,e){window.define("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/core/utils/Env","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(t,e,n,i,a,o,r,s,l){function u(n){MXI_DEBUG&&a.log("Instantiating FileDrop...");var o,s=this;"string"==typeof n&&(n={drop_zone:n}),o={accept:[{title:t.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},o,n):o,n.container=e.get(n.drop_zone)||document.body,"static"===e.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=l.mimes2extList(n.accept)),r.call(s),i.extend(s,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){s.bind("RuntimeInit",function(t,e){s.ruid=e.uid,e.exec.call(s,"FileDrop","init",n),s.dispatchEvent("ready")}),s.connectRuntime(n)},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(c)}var c=["ready","dragenter","dragleave","drop","error"];return u.prototype=s.instance,u})},function(t,e){window.define("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(t,e,n){function i(){this.uid=t.guid("uid_"),e.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i})},function(t,e){window.define("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/runtime/RuntimeClient"],function(t,e,n,i,a,o){function r(){function i(t,i){if(this.trigger("loadstart"),this.readyState===r.LOADING)return this.trigger("error",new n.DOMException(n.DOMException.INVALID_STATE_ERR)),void this.trigger("loadend");if(!(i instanceof a))return this.trigger("error",new n.DOMException(n.DOMException.NOT_FOUND_ERR)),void this.trigger("loadend");if(this.result=null,this.readyState=r.LOADING,i.isDetached()){var o=i.getSource();switch(t){case"readAsText":case"readAsBinaryString":this.result=o;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+e.btoa(o)}this.readyState=r.DONE,this.trigger("load"),this.trigger("loadend")}else this.connectRuntime(i.ruid),this.exec("FileReader","read",t,i)}o.call(this),t.extend(this,{uid:t.guid("uid_"),readyState:r.EMPTY,result:null,error:null,readAsBinaryString:function(t){i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){i.call(this,"readAsDataURL",t)},readAsText:function(t){i.call(this,"readAsText",t)},abort:function(){this.result=null,-1===t.inArray(this.readyState,[r.EMPTY,r.DONE])&&(this.readyState===r.LOADING&&(this.readyState=r.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(s),this.bind("Error",function(t,e){this.readyState=r.DONE,this.error=e},999),this.bind("Load",function(t){this.readyState=r.DONE},999)}var s=["loadstart","progress","load","abort","error","loadend"];return r.EMPTY=0,r.LOADING=1,r.DONE=2,r.prototype=i.instance,r})},function(t,e){window.define("moxie/core/utils/Url",[],function(){var t=function(e,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],a=i.length,o={http:80,https:443},r={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,l=s.exec(e||"");a--;)l[a]&&(r[i[a]]=l[a]);if(!r.scheme){n&&"string"!=typeof n||(n=t(n||document.location.href)),r.scheme=n.scheme,r.host=n.host,r.port=n.port;var u="";/^[^\/]/.test(r.path)&&(u=n.path,/(\/|\/[^\.]+)$/.test(u)?u+="/":u=u.replace(/\/[^\/]+$/,"/")),r.path=u+(r.path||"")}return r.port||(r.port=o[r.scheme]||80),r.port=parseInt(r.port,10),r.path||(r.path="/"),delete r.source,r};return{parseUrl:t,resolveUrl:function(e){var n={http:80,https:443},i=t(e);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},hasSameOrigin:function(e){function n(t){return[t.scheme,t.host,t.port].join("/")}return"string"==typeof e&&(e=t(e)),n(t())===n(e)}}})},function(t,e){window.define("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(t,e,n){return function(){function i(t,e){if(!e.isDetached()){var i=this.connectRuntime(e.ruid).exec.call(this,"FileReaderSync","read",t,e);return this.disconnectRuntime(),i}var a=e.getSource();switch(t){case"readAsBinaryString":return a;case"readAsDataURL":return"data:"+e.type+";base64,"+n.btoa(a);case"readAsText":for(var o="",r=0,s=a.length;r<s;r++)o+=String.fromCharCode(a[r]);return o}}e.call(this),t.extend(this,{uid:t.guid("uid_"),readAsBinaryString:function(t){return i.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){return i.call(this,"readAsDataURL",t)},readAsText:function(t){return i.call(this,"readAsText",t)}})}})},function(t,e){window.define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(t,e,n){function i(){var t,i=[];e.extend(this,{append:function(a,o){var r=this,s=e.typeOf(o);o instanceof n?t={name:a,value:o}:"array"===s?(a+="[]",e.each(o,function(t){r.append(a,t)})):"object"===s?e.each(o,function(t,e){r.append(a+"["+e+"]",t)}):"null"===s||"undefined"===s||"number"===s&&isNaN(o)?r.append(a,"false"):i.push({name:a,value:o.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return t&&t.value||null},getBlobName:function(){return t&&t.name||null},each:function(n){e.each(i,function(t){n(t.value,t.name)}),t&&n(t.value,t.name)},destroy:function(){t=null,i=[]}})}return i})},function(t,e){window.define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(t,e,n,i,a,o,r,s,l,u,c,d){function h(){this.uid=t.guid("uid_")}function f(){function n(t,e){if(T.hasOwnProperty(t))return 1===arguments.length?c.can("define_property")?T[t]:k[t]:void(c.can("define_property")?T[t]=e:k[t]=e)}function l(e){function i(){C&&(C.destroy(),C=null),s.dispatchEvent("loadend"),s=null}function a(a){C.bind("LoadStart",function(t){n("readyState",f.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(t),_&&s.upload.dispatchEvent(t)}),C.bind("Progress",function(t){n("readyState")!==f.LOADING&&(n("readyState",f.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(t)}),C.bind("UploadProgress",function(t){_&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:t.total,loaded:t.loaded})}),C.bind("Load",function(e){n("readyState",f.DONE),n("status",Number(a.exec.call(C,"XMLHttpRequest","getStatus")||0)),n("statusText",p[n("status")]||""),n("response",a.exec.call(C,"XMLHttpRequest","getResponse",n("responseType"))),~t.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),X=a.exec.call(C,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),n("status")>0?(_&&s.upload.dispatchEvent(e),s.dispatchEvent(e)):(F=!0,s.dispatchEvent("error")),i()}),C.bind("Abort",function(t){s.dispatchEvent(t),i()}),C.bind("Error",function(t){F=!0,n("readyState",f.DONE),s.dispatchEvent("readystatechange"),P=!0,s.dispatchEvent(t),i()}),a.exec.call(C,"XMLHttpRequest","send",{url:v,method:y,async:R,user:E,password:x,headers:S,mimeType:O,encoding:D,responseType:s.responseType,withCredentials:s.withCredentials,options:H},e)}var s=this;w=(new Date).getTime(),C=new r,"string"==typeof H.required_caps&&(H.required_caps=o.parseCaps(H.required_caps)),H.required_caps=t.extend({},H.required_caps,{return_response_type:s.responseType}),e instanceof u&&(H.required_caps.send_multipart=!0),t.isEmptyObj(S)||(H.required_caps.send_custom_headers=!0),N||(H.required_caps.do_cors=!0),H.ruid?a(C.connectRuntime(H)):(C.bind("RuntimeInit",function(t,e){a(e)}),C.bind("RuntimeError",function(t,e){s.dispatchEvent("RuntimeError",e)}),C.connectRuntime(H))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),w=b=null}var v,y,E,x,w,b,C,A,k=this,T={timeout:0,readyState:f.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},R=!0,S={},D=null,O=null,M=!1,I=!1,_=!1,P=!1,F=!1,N=!1,L=null,B=null,H={},X="";t.extend(this,T,{uid:t.guid("uid_"),upload:new h,open:function(o,r,s,l,u){var c;if(!o||!r)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(~t.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(y=o.toUpperCase()),~t.inArray(y,["CONNECT","TRACE","TRACK"]))throw new e.DOMException(e.DOMException.SECURITY_ERR);if(r=i.utf8_encode(r),c=a.parseUrl(r),N=a.hasSameOrigin(c),v=a.resolveUrl(r),(l||u)&&!N)throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);if(E=l||c.user,x=u||c.pass,!1===(R=s||!0)&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);M=!R,I=!1,S={},g.call(this),n("readyState",f.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(a,o){var r=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==f.OPENED||I)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(a)||i.utf8_encode(a)!==a)throw new e.DOMException(e.DOMException.SYNTAX_ERR);return a=t.trim(a).toLowerCase(),!~t.inArray(a,r)&&!/^(proxy\-|sec\-)/.test(a)&&(S[a]?S[a]+=", "+o:S[a]=o,!0)},getAllResponseHeaders:function(){return X||""},getResponseHeader:function(e){return e=e.toLowerCase(),F||~t.inArray(e,["set-cookie","set-cookie2"])?null:X&&""!==X&&(A||(A={},t.each(X.split(/\r\n/),function(e){var n=e.split(/:\s+/);2===n.length&&(n[0]=t.trim(n[0]),A[n[0].toLowerCase()]={header:n[0],value:t.trim(n[1])})})),A.hasOwnProperty(e))?A[e].header+": "+A[e].value:null},overrideMimeType:function(i){var a,o;if(~t.inArray(n("readyState"),[f.LOADING,f.DONE]))throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(i=t.trim(i.toLowerCase()),/;/.test(i)&&(a=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=a[1],a[2]&&(o=a[2])),!d.mimes[i])throw new e.DOMException(e.DOMException.SYNTAX_ERR);L=i,B=o},send:function(n,a){if(H="string"===t.typeOf(a)?{ruid:a}:a||{},this.readyState!==f.OPENED||I)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(n instanceof s)H.ruid=n.ruid,O=n.type||"application/octet-stream";else if(n instanceof u){if(n.hasBlob()){var o=n.getBlob();H.ruid=o.ruid,O=o.type||"application/octet-stream"}}else"string"==typeof n&&(D="UTF-8",O="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=H.required_caps&&H.required_caps.send_browser_cookies&&!N),_=!M&&this.upload.hasEventListener(),F=!1,P=!n,M||(I=!0),l.call(this,n)},abort:function(){if(F=!0,M=!1,~t.inArray(n("readyState"),[f.UNSENT,f.OPENED,f.DONE]))n("readyState",f.UNSENT);else{if(n("readyState",f.DONE),I=!1,!C)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);C.getRuntime().exec.call(C,"XMLHttpRequest","abort",P),P=!0}},destroy:function(){C&&("function"===t.typeOf(C.destroy)&&C.destroy(),C=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(m.concat(["readystatechange"])),this.upload.handleEventProps(m)}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};h.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"];return f.UNSENT=0,f.OPENED=1,f.HEADERS_RECEIVED=2,f.LOADING=3,f.DONE=4,f.prototype=n.instance,f})},function(t,e){window.define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(t,e,n,i){function a(){function i(){c=d=0,u=this.result=null}function o(e,n){var i=this;l=n,i.bind("TransportingProgress",function(e){(d=e.loaded)<c&&-1===t.inArray(i.state,[a.IDLE,a.DONE])&&r.call(i)},999),i.bind("TransportingComplete",function(){d=c,i.state=a.DONE,u=null,i.result=l.exec.call(i,"Transporter","getAsBlob",e||"")},999),i.state=a.BUSY,i.trigger("TransportingStarted"),r.call(i)}function r(){var t,n=this,i=c-d;h>i&&(h=i),t=e.btoa(u.substr(d,h)),l.exec.call(n,"Transporter","receive",t,c)}var s,l,u,c,d,h;n.call(this),t.extend(this,{uid:t.guid("uid_"),state:a.IDLE,result:null,transport:function(e,n,a){var r=this;if(a=t.extend({chunk_size:204798},a),(s=a.chunk_size%3)&&(a.chunk_size+=3-s),h=a.chunk_size,i.call(this),u=e,c=e.length,"string"===t.typeOf(a)||a.ruid)o.call(r,n,this.connectRuntime(a));else{var l=function(t,e){r.unbind("RuntimeInit",l),o.call(r,n,e)};this.bind("RuntimeInit",l),this.connectRuntime(a)}},abort:function(){var t=this;t.state=a.IDLE,l&&(l.exec.call(t,"Transporter","clear"),t.trigger("TransportingAborted")),i.call(t)},destroy:function(){this.unbindAll(),l=null,this.disconnectRuntime(),i.call(this)}})}return a.IDLE=0,a.BUSY=1,a.DONE=2,a.prototype=i.instance,a})},function(t,e){window.define("moxie/core/JSON",[],function(){return!!window.JSON&&JSON.parse||function(){"use strict";var t,e,n,i,a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},o=function(e){throw{name:"SyntaxError",message:e,at:t,text:n}},r=function(i){return i&&i!==e&&o("Expected '"+i+"' instead of '"+e+"'"),e=n.charAt(t),t+=1,e},s=function(){var t,n="";for("-"===e&&(n="-",r("-"));e>="0"&&e<="9";)n+=e,r();if("."===e)for(n+=".";r()&&e>="0"&&e<="9";)n+=e;if("e"===e||"E"===e)for(n+=e,r(),"-"!==e&&"+"!==e||(n+=e,r());e>="0"&&e<="9";)n+=e,r();if(t=+n,isFinite(t))return t;o("Bad number")},l=function(){var t,n,i,s="";if('"'===e)for(;r();){if('"'===e)return r(),s;if("\\"===e)if(r(),"u"===e){for(i=0,n=0;n<4&&(t=parseInt(r(),16),isFinite(t));n+=1)i=16*i+t;s+=String.fromCharCode(i)}else{if("string"!=typeof a[e])break;s+=a[e]}else s+=e}o("Bad string")},u=function(){for(;e&&e<=" ";)r()},c=function(){switch(e){case"t":return r("t"),r("r"),r("u"),r("e"),!0;case"f":return r("f"),r("a"),r("l"),r("s"),r("e"),!1;case"n":return r("n"),r("u"),r("l"),r("l"),null}o("Unexpected '"+e+"'")},d=function(){var t=[];if("["===e){if(r("["),u(),"]"===e)return r("]"),t;for(;e;){if(t.push(i()),u(),"]"===e)return r("]"),t;r(","),u()}}o("Bad array")},h=function(){var t,n={};if("{"===e){if(r("{"),u(),"}"===e)return r("}"),n;for(;e;){if(t=l(),u(),r(":"),Object.hasOwnProperty.call(n,t)&&o('Duplicate key "'+t+'"'),n[t]=i(),u(),"}"===e)return r("}"),n;r(","),u()}}o("Bad object")};return i=function(){switch(u(),e){case"{":return h();case"[":return d();case'"':return l();case"-":return s();default:return e>="0"&&e<="9"?s():c()}},function(a,r){var s;return n=a,t=0,e=" ",s=i(),u(),e&&o("Syntax error"),"function"==typeof r?function t(e,n){var i,a,o=e[n];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(a=t(o,i),void 0!==a?o[i]=a:delete o[i]);return r.call(e,n,o)}({"":s},""):s}}()})},function(t,e){window.define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(t,e,n,i){function a(e){var a=this,s=n.capTest,l=n.capTrue,u=t.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return a.can("access_binary")&&!!r.Image},display_media:s(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&("IE"!==i.browser||i.version>9)}()),filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),return_response_headers:l,return_response_type:function(t){return!("json"!==t||!window.JSON)||i.can("return_response_type",t)},return_status_code:l,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return a.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return a.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return a.can("select_file")&&!("Safari"===i.browser&&"Windows"===i.os)&&!("iOS"===i.os&&i.verComp(i.osVersion,"7.0.4","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||a.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return a.can("slice_blob")&&a.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~t.inArray(i.browser,["Chrome","Chromium","Safari"])}()),upload_filesize:l},arguments[2]);n.call(this,e,arguments[1]||o,u),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(a),t=a=null}}(this.destroy)}),t.extend(this.getShim(),r)}var o="html5",r={};return n.addConstructor(o,a),r})},function(t,e){window.define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(t,e){function n(){function t(t,e,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(t,e,n):null;try{return t.slice(),t.slice(e,n)}catch(i){return t.slice(e,n-e)}}this.slice=function(){return new e(this.getRuntime().uid,t.apply(this,arguments))}}return t.Blob=n})},function(t,e){window.define("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(t){function e(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},a="moxie_"+t.guid(),o=function(o,r,s,l){var u,c;r=r.toLowerCase(),o.addEventListener?(u=s,o.addEventListener(r,u,!1)):o.attachEvent&&(u=function(){var t=window.event;t.target||(t.target=t.srcElement),t.preventDefault=e,t.stopPropagation=n,s(t)},o.attachEvent("on"+r,u)),o[a]||(o[a]=t.guid()),i.hasOwnProperty(o[a])||(i[o[a]]={}),c=i[o[a]],c.hasOwnProperty(r)||(c[r]=[]),c[r].push({func:u,orig:s,key:l})},r=function(e,n,o){var r;if(n=n.toLowerCase(),e[a]&&i[e[a]]&&i[e[a]][n]){r=i[e[a]][n];for(var s=r.length-1;s>=0&&(r[s].orig!==o&&r[s].key!==o||(e.removeEventListener?e.removeEventListener(n,r[s].func,!1):e.detachEvent&&e.detachEvent("on"+n,r[s].func),r[s].orig=null,r[s].func=null,r.splice(s,1),void 0===o));s--);if(r.length||delete i[e[a]][n],t.isEmptyObj(i[e[a]])){delete i[e[a]];try{delete e[a]}catch(t){e[a]=void 0}}}};return{addEvent:o,removeEvent:r,removeAllEvents:function(e,n){e&&e[a]&&t.each(i[e[a]],function(t,i){r(e,i,n)})}}})},function(t,e){window.define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(t,e,n,i,a,o,r){function s(){var t;n.extend(this,{init:function(s){var l,u,c,d,h,f,p=this,m=p.getRuntime();t=s,c=t.accept.mimes||o.extList2mimes(t.accept,m.can("filter_by_extension")),u=m.getShimContainer(),u.innerHTML='<input id="'+m.uid+'" type="file" style="font-size:999px;opacity:0;"'+(t.multiple&&m.can("select_multiple")?"multiple":"")+(t.directory&&m.can("select_folder")?"webkitdirectory directory":"")+(c?' accept="'+c.join(",")+'"':"")+" />",l=i.get(m.uid),n.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),d=i.get(t.browse_button),m.can("summon_file_dialog")&&("static"===i.getStyle(d,"position")&&(d.style.position="relative"),h=parseInt(i.getStyle(d,"z-index"),10)||1,d.style.zIndex=h,u.style.zIndex=h-1,a.addEvent(d,"click",function(t){var e=i.get(m.uid);e&&!e.disabled&&e.click(),t.preventDefault()},p.uid)),f=m.can("summon_file_dialog")?d:u,a.addEvent(f,"mouseover",function(){p.trigger("mouseenter")},p.uid),a.addEvent(f,"mouseout",function(){p.trigger("mouseleave")},p.uid),a.addEvent(f,"mousedown",function(){p.trigger("mousedown")},p.uid),a.addEvent(i.get(t.container),"mouseup",function(){p.trigger("mouseup")},p.uid),l.onchange=function i(a){if(p.files=[],n.each(this.files,function(n){var i="";if(t.directory&&"."==n.name)return!0;n.webkitRelativePath&&(i="/"+n.webkitRelativePath.replace(/^\//,"")),n=new e(m.uid,n),n.relativePath=i,p.files.push(n)}),"IE"!==r.browser&&"IEMobile"!==r.browser)this.value="";else{var o=this.cloneNode(!0);this.parentNode.replaceChild(o,this),o.onchange=i}p.files.length&&p.trigger("change")},p.trigger({type:"ready",async:!0}),u=null},disable:function(t){var e,n=this.getRuntime();(e=i.get(n.uid))&&(e.disabled=!!t)},destroy:function(){var e=this.getRuntime(),n=e.getShim(),o=e.getShimContainer();a.removeAllEvents(o,this.uid),a.removeAllEvents(t&&i.get(t.container),this.uid),a.removeAllEvents(t&&i.get(t.browse_button),this.uid),o&&(o.innerHTML=""),n.removeInstance(this.uid),t=o=n=null}})}return t.FileInput=s})},function(t,e){window.define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(t,e,n,i,a,o){function r(){function t(t){if(!t.dataTransfer||!t.dataTransfer.types)return!1;var e=n.toArray(t.dataTransfer.types||[]);return-1!==n.inArray("Files",e)||-1!==n.inArray("public.file-url",e)||-1!==n.inArray("application/x-moz-file",e)}function o(t,n){var i=new e(p.ruid,t);i.relativePath=n||"",m.push(i)}function r(t){for(var e=[],i=0;i<t.length;i++)[].push.apply(e,t[i].extensions.split(/\s*,\s*/));return-1===n.inArray("*",e)?e:[]}function s(t,e){var i=[];n.each(t,function(t){var e=t.webkitGetAsEntry();e&&(e.isFile?o(t.getAsFile(),e.fullPath):i.push(e))}),i.length?l(i,e):e()}function l(t,e){var i=[];n.each(t,function(t){i.push(function(e){u(t,e)})}),n.inSeries(i,function(){e()})}function u(t,e){t.isFile?t.file(function(n){o(n,t.fullPath),e()},function(){e()}):t.isDirectory?c(t,e):e()}function c(t,e){function n(t){a.readEntries(function(e){e.length?([].push.apply(i,e),n(t)):t()},t)}var i=[],a=t.createReader();n(function(){l(i,e)})}function d(t){var e,n=Ext.DomHelper,i=Ext.dom&&Ext.dom.AbstractElement?Ext.dom.AbstractElement:Ext.lib.Dom;0===Ext.query("div.external-drop-indicator").length&&(e=t&&0!==t.length?"+ Upload "+t.length+" file"+(1===t.length?"":"s"):"+ Upload files",n.append(Ext.getBody(),{cls:"external-drop-indicator",children:[{cls:"drop-msg",style:{top:i.getViewportHeight()/2-100+"px",left:i.getViewportWidth()/2-120+"px"},children:[{tag:"h1",html:e}]}]}),v.push(Ext.defer(h,4e3)))}function h(){var t=0;v.length;for(Ext.select("div.external-drop-indicator").remove(),t;t>=0;t--)clearTimeout(v[t]);v=[]}var f,p=this,m=[],g=[],v=[];n.extend(this,{init:function(e){var i,l=this;f=e,g=r(f.accept),i=f.container,a.addEvent(i,"dragover",function(e){t(e)&&(e.preventDefault(),d(e.dataTransfer.files),e.dataTransfer.dropEffect="copy")},l.uid),a.addEvent(i,"drop",function(e){if(t(e)&&(e.preventDefault(),h(),m=[],_firstEntryIsDirectory=!1,e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?(e.dataTransfer.items[0].webkitGetAsEntry().isDirectory&&(_firstEntryIsDirectory=!0),s(e.dataTransfer.items,function(){l.files=m,l.trigger("drop")})):(n.each(e.dataTransfer.files,function(t){o(t)}),l.files=m,l.trigger("drop")),window.ga)){var i=window.Invoice?window.Invoice.InvoiceTypeCode||window.Invoice.invoiceTypeCode:"NONE",a=_firstEntryIsDirectory?"Uploaded folder":"Uploaded "+m.length+" files",r={hitType:"event",eventCategory:"Files",eventAction:"Added by Drag and Drop on type "+i,eventLabel:a};window.ga("send",r)}},l.uid),a.addEvent(i,"dragenter",function(t){l.trigger("dragenter")},l.uid),a.addEvent(i,"dragleave",function(t){var e,n,i,a=Ext.dom&&Ext.dom.AbstractElement?Ext.dom.AbstractElement:Ext.lib.Dom;e=t.x||t.clientX,n=t.y||t.clientY,i={width:a.getViewportWidth(),height:a.getViewportHeight()},0<e&&e<i.width&&0<n&&n<i.height||h(),l.trigger("dragleave")},l.uid)},destroy:function(){a.removeAllEvents(f&&i.get(f.container),this.uid),p=m=g=f=null}})}return t.FileDrop=r})},function(t,e){window.define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(t,e,n){function i(){function t(t){return e.atob(t.substring(t.indexOf("base64,")+7))}var i,a=!1;n.extend(this,{read:function(e,o){var r=this;r.result="",i=new window.FileReader,i.addEventListener("progress",function(t){r.trigger(t)}),i.addEventListener("load",function(e){r.result=a?t(i.result):i.result,r.trigger(e)}),i.addEventListener("error",function(t){r.trigger(t,i.error)}),i.addEventListener("loadend",function(t){i=null,r.trigger(t)}),"function"===n.typeOf(i[e])?(a=!1,i[e](o.getSource())):"readAsBinaryString"===e&&(a=!0,i.readAsDataURL(o.getSource()))},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return t.FileReader=i})},function(t,e){window.define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(t,e,n,i,a,o,r,s,l){function u(){function t(t,e){var n,i,a=this;n=e.getBlob().getSource(),i=new window.FileReader,i.onload=function(){e.append(e.getBlobName(),new o(null,{type:n.type,data:i.result})),p.send.call(a,t,e)},i.readAsBinaryString(n)}function u(){return!window.XMLHttpRequest||"IE"===l.browser&&l.version<8?function(){for(var t=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(t){}}():new window.XMLHttpRequest}function c(t){var e=t.responseXML,n=t.responseText;return"IE"===l.browser&&n&&e&&!e.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type"))&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(n)),e&&("IE"===l.browser&&0!==e.parseError||!e.documentElement||"parsererror"===e.documentElement.tagName)?null:e}function d(t){var e="----moxieboundary"+(new Date).getTime(),n="\r\n",i="";if(!this.getRuntime().can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return h.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),t.each(function(t,a){i+=t instanceof o?"--"+e+n+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(t.name||"blob"))+'"'+n+"Content-Type: "+(t.type||"application/octet-stream")+n+n+t.getSource()+n:"--"+e+n+'Content-Disposition: form-data; name="'+a+'"'+n+n+unescape(encodeURIComponent(t))+n}),i+="--"+e+"--"+n}var h,f,p=this;e.extend(this,{send:function(n,a){var s=this,c="Mozilla"===l.browser&&l.version>=4&&l.version<7,p="Android Browser"===l.browser,m=!1;if(f=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),h=u(),h.open(n.method,n.url,n.async,n.user,n.password),a instanceof o)a.isDetached()&&(m=!0),a=a.getSource();else if(a instanceof r){if(a.hasBlob())if(a.getBlob().isDetached())a=d.call(s,a),m=!0;else if((c||p)&&"blob"===e.typeOf(a.getBlob().getSource())&&window.FileReader)return void t.call(s,n,a);if(a instanceof r){var g=new window.FormData;a.each(function(t,e){t instanceof o?g.append(e,t.getSource()):g.append(e,t)}),a=g}}h.upload?(n.withCredentials&&(h.withCredentials=!0),h.addEventListener("load",function(t){s.trigger(t)}),h.addEventListener("error",function(t){s.trigger(t)}),h.addEventListener("progress",function(t){s.trigger(t)}),h.upload.addEventListener("progress",function(t){s.trigger({type:"UploadProgress",loaded:t.loaded,total:t.total})})):h.onreadystatechange=function(){switch(h.readyState){case 1:case 2:break;case 3:var t,e;try{i.hasSameOrigin(n.url)&&(t=h.getResponseHeader("Content-Length")||0),h.responseText&&(e=h.responseText.length)}catch(n){t=e=0}s.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:e});break;case 4:h.onreadystatechange=function(){},0===h.status?s.trigger("error"):s.trigger("load")}},e.isEmptyObj(n.headers)||e.each(n.headers,function(t,e){h.setRequestHeader(e,t)}),""!==n.responseType&&"responseType"in h&&("json"!==n.responseType||l.can("return_response_type","json")?h.responseType=n.responseType:h.responseType="text"),h.timeout=36e4,m?h.sendAsBinary?h.sendAsBinary(a):function(){for(var t=new Uint8Array(a.length),e=0;e<a.length;e++)t[e]=255&a.charCodeAt(e);h.send(t.buffer)}():h.send(a),s.trigger("loadstart")},getStatus:function(){try{if(h)return h.status}catch(t){}return 0},getResponse:function(t){var e=this.getRuntime();try{switch(t){case"blob":var i=new a(e.uid,h.response),o=h.getResponseHeader("Content-Disposition");if(o){var r=o.match(/filename=([\'\"'])([^\1]+)\1/);r&&(f=r[2])}return i.name=f,i.type||(i.type=n.getFileMime(f)),i;case"json":return l.can("return_response_type","json")?h.response:200===h.status&&window.JSON?JSON.parse(h.responseText):null;case"document":return c(h);default:return""!==h.responseText?h.responseText:null}}catch(t){return null}},getAllResponseHeaders:function(){try{return h.getAllResponseHeaders()}catch(t){}return""},abort:function(){h&&h.abort()},destroy:function(){p=f=null}})}return t.XMLHttpRequest=u})},function(t,e){window.define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(t,e,n,i){function a(e){var a=this,s=n.capTest,l=n.capTrue;n.call(this,e,o,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:s(r.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),resize_image:function(){return r.Image&&a.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||!!~t.inArray(e,["text","document",""])},return_status_code:function(e){return!t.arrayDiff(e,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return a.can("select_file")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||!!~t.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:l,use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}}),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(a),t=a=null}}(this.destroy)}),t.extend(this.getShim(),r)}var o="html4",r={};return n.addConstructor(o,a),r})},function(t,e){window.define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(t,e,n,i,a,o,r){function s(){function t(){var o,c,d,h,f,p,m=this,g=m.getRuntime();p=n.guid("uid_"),o=g.getShimContainer(),s&&(d=i.get(s+"_form"))&&n.extend(d.style,{top:"100%"}),h=document.createElement("form"),h.setAttribute("id",p+"_form"),h.setAttribute("method","post"),h.setAttribute("enctype","multipart/form-data"),h.setAttribute("encoding","multipart/form-data"),n.extend(h.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),f=document.createElement("input"),f.setAttribute("id",p),f.setAttribute("type","file"),f.setAttribute("name",l.name||"Filedata"),f.setAttribute("accept",u.join(",")),n.extend(f.style,{fontSize:"999px",opacity:0}),h.appendChild(f),o.appendChild(h),n.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===r.browser&&r.version<10&&n.extend(f.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),f.onchange=function(){var n;if(this.value){if(this.files){if(n=this.files[0],0===n.size)return void h.parentNode.removeChild(h)}else n={name:this.value};n=new e(g.uid,n),this.onchange=function(){},t.call(m),m.files=[n],f.setAttribute("id",n.uid),h.setAttribute("id",n.uid+"_form"),m.trigger("change"),f=h=null}},g.can("summon_file_dialog")&&(c=i.get(l.browse_button),a.removeEvent(c,"click",m.uid),a.addEvent(c,"click",function(t){f&&!f.disabled&&f.click(),t.preventDefault()},m.uid)),s=p,o=d=c=null}var s,l,u=[];n.extend(this,{init:function(e){var n,r=this,s=r.getRuntime();l=e,u=e.accept.mimes||o.extList2mimes(e.accept,s.can("filter_by_extension")),n=s.getShimContainer(),function(){var t,o,l;t=i.get(e.browse_button),s.can("summon_file_dialog")&&("static"===i.getStyle(t,"position")&&(t.style.position="relative"),o=parseInt(i.getStyle(t,"z-index"),10)||1,t.style.zIndex=o,n.style.zIndex=o-1),l=s.can("summon_file_dialog")?t:n,a.addEvent(l,"mouseover",function(){r.trigger("mouseenter")},r.uid),a.addEvent(l,"mouseout",function(){r.trigger("mouseleave")},r.uid),a.addEvent(l,"mousedown",function(){r.trigger("mousedown")},r.uid),a.addEvent(i.get(e.container),"mouseup",function(){r.trigger("mouseup")},r.uid),t=null}(),t.call(this),n=null,r.trigger({type:"ready",async:!0})},disable:function(t){var e;(e=i.get(s))&&(e.disabled=!!t)},destroy:function(){var t=this.getRuntime(),e=t.getShim(),n=t.getShimContainer();a.removeAllEvents(n,this.uid),a.removeAllEvents(l&&i.get(l.container),this.uid),a.removeAllEvents(l&&i.get(l.browse_button),this.uid),n&&(n.innerHTML=""),e.removeInstance(this.uid),s=u=l=n=e=null}})}return t.FileInput=s})},function(t,e){window.define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(t,e){return t.FileReader=e})},function(t,e){window.define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(t,e,n,i,a,o,r,s){function l(){function t(t){var e,i,a,r,s=this,l=!1;if(c){if(e=c.id.replace(/_iframe$/,""),i=n.get(e+"_form")){for(a=i.getElementsByTagName("input"),r=a.length;r--;)switch(a[r].getAttribute("type")){case"hidden":a[r].parentNode.removeChild(a[r]);break;case"file":l=!0}a=[],l||i.parentNode.removeChild(i),i=null}setTimeout(function(){o.removeEvent(c,"load",s.uid),c.parentNode&&c.parentNode.removeChild(c);var e=s.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=c=null,t()},1)}}var l,u,c;e.extend(this,{send:function(d,h){var f,p,m,g,v=this,y=v.getRuntime();if(l=u=null,h instanceof s&&h.hasBlob()){if(g=h.getBlob(),f=g.uid,m=n.get(f),!(p=n.get(f+"_form")))throw new a.DOMException(a.DOMException.NOT_FOUND_ERR)}else f=e.guid("uid_"),p=document.createElement("form"),p.setAttribute("id",f+"_form"),p.setAttribute("method",d.method),p.setAttribute("enctype","multipart/form-data"),p.setAttribute("encoding","multipart/form-data"),y.getShimContainer().appendChild(p);p.setAttribute("target",f+"_iframe"),h instanceof s&&h.each(function(t,n){if(t instanceof r)m&&m.setAttribute("name",n);else{var i=document.createElement("input");e.extend(i,{type:"hidden",name:n,value:t}),m?p.insertBefore(i,m):p.appendChild(i)}}),p.setAttribute("action",d.url),function(){var n=y.getShimContainer()||document.body,a=document.createElement("div");a.innerHTML='<iframe id="'+f+'_iframe" name="'+f+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',c=a.firstChild,n.appendChild(c),o.addEvent(c,"load",function(){var n;try{n=c.contentWindow.document||c.contentDocument||window.frames[c.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?l=n.title.replace(/^(\d+).*$/,"$1"):(l=200,u=e.trim(n.body.innerHTML),v.trigger({type:"progress",loaded:u.length,total:u.length}),g&&v.trigger({type:"uploadprogress",loaded:g.size||1025,total:g.size||1025}))}catch(e){if(!i.hasSameOrigin(d.url))return void t.call(v,function(){v.trigger("error")});l=404}t.call(v,function(){v.trigger("load")})},v.uid)}(),p.submit(),v.trigger("loadstart")},getStatus:function(){return l},getResponse:function(t){if("json"===t&&"string"===e.typeOf(u)&&window.JSON)try{return JSON.parse(u.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(t){return null}return u},abort:function(){var e=this;c&&c.contentWindow&&(c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand?c.contentWindow.document.execCommand("Stop"):c.src="about:blank"),t.call(this,function(){e.dispatchEvent("abort")})}})}return t.XMLHttpRequest=l})},function(t,e){window.expose(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/core/JSON","moxie/core/utils/Events"])},function(t,e){!function(t){"use strict";var e={},n=t.moxie.core.utils.Basic.inArray;(function t(i){var a,o;for(a in i)o=typeof i[a],"object"!==o||~n(a,["Exceptions","Env","Mime"])?"function"===o&&(e[a]=i[a]):t(i[a])})(t.moxie),e.Env=t.moxie.core.utils.Env,e.Mime=t.moxie.core.utils.Mime,e.Exceptions=t.moxie.core.Exceptions,t.mOxie=e,t.o||(t.o=e)}(window)},function(t,e){!function(t,e,n){function i(t){function e(t,e,n){var a={chunks:"slice_blob",resize:"send_binary_string",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",max_file_size:"access_binary",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};a[t]?i[a[t]]=e:n||(i[t]=e)}var n=t.required_features,i={};return"string"==typeof n?plupload.each(n.split(/\s*,\s*/),function(t){e(t,!0)}):"object"==typeof n?plupload.each(n,function(t,n){e(n,t)}):!0===n&&(t.multipart||(i.send_binary_string=!0),t.chunk_size>0&&(i.slice_blob=!0),plupload.each(t,function(t,n){e(n,!!t,!0)})),i}t.delay=t.setTimeout,fileFilters={},t.plupload={VERSION:"@@version@@",PENDING:"FILE/PENDING",STOPPED:"FILE/STOPPED",STARTED:"FILE/STARTED",QUEUED:"FILE/QUEUED",UPLOADING:"FILE/UPLOADING",FAILED:"FILE/FAILED",DONE:"FILE/DONE",UPLOADED:"FILE/UPLOADED",GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return t?(""+t).replace(n,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(t){var e,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<n.length;e+=2)t=t.replace(n[e],n[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var n="";return plupload.each(e,function(t,e){n+=(n?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n&&(t+=(t.indexOf("?")>0?"&":"?")+n),t},formatSize:function(t){return t===n||/\D/.test(t)?plupload.translate("N/A"):t>1099511627776?Math.round(t/1099511627776,1)+" "+plupload.translate("tb"):t>1073741824?Math.round(t/1073741824,1)+" "+plupload.translate("gb"):t>1048576?Math.round(t/1048576,1)+" "+plupload.translate("mb"):t>1024?Math.round(t/1024,1)+" "+plupload.translate("kb"):t+" "+plupload.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(t,e){var n,i;return e&&(t.runtimes=e),n=new plupload.Uploader(t),i=n.runtime,n.destroy(),i},addFileFilter:function(t,e){fileFilters[t]=e}},plupload.addFileFilter("mime_types",function(){function t(t){var e=[];return plupload.each(t,function(t){plupload.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?e.push("\\.*"):e.push("\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+e.join("|")+")$","i")}var e,n;return function(i,a){return n&&i==e||(n=t(i),e=[].slice.call(i)),!!n.test(a.name)||(this.trigger("Error",{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate("File extension error."),file:a}),!1)}}()),plupload.addFileFilter("max_file_size",function(t,e){return!(void 0!==e.size&&t&&e.size>t)||(this.trigger("Error",{code:plupload.FILE_SIZE_ERROR,message:plupload.translate("File size error."),file:e}),!1)}),plupload.addFileFilter("prevent_duplicates",function(t,e){if(t)for(var n=this.files.length;n--;)if(e.name===this.files[n].name&&e.size===this.files[n].size)return this.trigger("Error",{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate("Duplicate file error."),file:e}),!1;return!0}),plupload.Uploader=function(t){function a(t,n,i,a,o){f=new e.FileInput(plupload.extend({},i,{name:n.file_data_name,multiple:n.multi_selection,container:n.container,browse_button:n.browse_button})),f.onready=function(){var n=e.Runtime.getInfo(this.ruid);e.extend(t.features,{chunks:n.can("slice_blob"),multipart:n.can("send_multipart"),multi_selection:n.can("select_multiple")}),o&&o++,a&&a()},f.onchange=function(){t.addFile(this.files)},f.bind("mouseenter mouseleave mousedown mouseup",function(t){if(!E){var i=e.get(n.browse_button);i&&(n.browse_button_hover&&("mouseenter"===t.type?e.addClass(i,n.browse_button_hover):"mouseleave"===t.type&&e.removeClass(i,n.browse_button_hover)),n.browse_button_active&&("mousedown"===t.type?e.addClass(i,n.browse_button_active):"mouseup"===t.type&&e.removeClass(i,n.browse_button_active)),i=null)}}),f.bind("error runtimeerror",function(){f=null,a&&a()}),f.init()}function o(){var t,e,n=0;if(this.state==plupload.STARTED){for(e=0;e<g.length;e++)t||g[e].status!=plupload.QUEUED?n++:(t=g[e],this.trigger("BeforeUpload",t)&&(t.status=plupload.UPLOADING,this.trigger("UploadFile",t)));n==g.length&&(this.state!==plupload.STOPPED&&(this.state=plupload.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",g))}}function r(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,s()}function s(){var t,e;for(h.reset(),t=0;t<g.length;t++)e=g[t],e.size!==n?(h.size+=e.origSize,h.loaded+=e.loaded*e.origSize/e.size):h.size=n,e.status==plupload.DONE?h.uploaded++:e.status==plupload.FAILED?h.failed++:h.queued++;h.size===n?h.percent=g.length>0?Math.ceil(h.uploaded/g.length*100):0:(h.bytesPerSec=Math.ceil(h.loaded/((+new Date-d||1)/1e3)),h.percent=h.size>0?Math.ceil(h.loaded/h.size*100):0)}function l(){var n=this,i=0,o={accept:t.filters.mime_types,runtime_order:t.runtimes,required_caps:y,swf_url:t.flash_swf_url,xap_url:t.silverlight_xap_url};plupload.each(t.runtimes.split(/\s*,\s*/),function(e){t[e]&&(o[e]=t[e])}),e.inSeries([function(e){t.browse_button?a(n,t,o,e,i):e()},function(a){t.drop_element?(p=new e.FileDrop(plupload.extend({},o,{drop_zone:t.drop_element})),p.onready=function(){var t=e.Runtime.getInfo(this.ruid);n.features.dragdrop=t.can("drag_and_drop"),i++,a()},p.ondrop=function(){n.addFile(this.files)},p.bind("error runtimeerror",function(){p=null,a()}),p.init()):a()}],function(){"function"==typeof t.init?t.init(n):plupload.each(t.init,function(t,e){n.bind(e,t)}),i>=0?n.trigger("PostInit"):n.trigger("Error",{code:plupload.INIT_ERROR,message:plupload.translate("Init error.")})})}function u(t,n){if(t.ruid){var i=e.Runtime.getInfo(t.ruid);if(i)return i.can(n)}return!1}function c(t,n,i){var a=new e.Image;try{a.onload=function(){a.downsize(n.width,n.height,n.crop,n.preserve_headers)},a.onresize=function(){i(this.getAsBlob(t.type,n.quality)),this.destroy()},a.onerror=function(){i(t)},a.load(t)}catch(e){i(t)}}var d,h,f,p,m,g=[],v={},y={},E=!1;h=new plupload.QueueProgress,t=plupload.extend({runtimes:e.Runtime.order,max_retries:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",send_chunk_number:!0},t),t.resize&&(t.resize=plupload.extend({preserve_headers:!0,crop:!1},t.resize)),t.chunk_size=plupload.parseSize(t.chunk_size)||0,"array"===plupload.typeOf(t.filters)&&(t.filters={mime_types:t.filters}),t.filters=plupload.extend({mime_types:[],prevent_duplicates:!!t.prevent_duplicates,max_file_size:plupload.parseSize(t.max_file_size)||0},t.filters),t.required_features=y=i(plupload.extend({},t)),plupload.extend(this,{id:plupload.guid(),state:plupload.STOPPED,features:{},runtime:e.Runtime.thatCan(y,t.runtimes),files:g,settings:t,total:h,init:function(){var n=this;t.browse_button=e.get(t.browse_button),t.drop_element=e.get(t.drop_element),"function"==typeof t.preinit?t.preinit(n):plupload.each(t.preinit,function(t,e){n.bind(e,t)}),n.bind("BeforeAdd",function(t,e){var n,i=t.settings.filters;for(n in i)if(fileFilters[n]&&!fileFilters[n].call(this,i[n],e))return!1}),n.bind("FilesAdded",function(t,e){[].push.apply(g,e),delay(function(){n.trigger("QueueChanged"),n.refresh()},1)}),n.bind("CancelUpload",function(){m&&m.abort()}),t.unique_names&&n.bind("BeforeUpload",function(t,e){var n=e.name.match(/\.([^.]+)$/),i="part";n&&(i=n[1]),e.target_name=e.id+"."+i}),n.bind("UploadFile",function(n,i){function a(){h-- >0?delay(o,1):(i.loaded=f,n.trigger("Error",{code:plupload.HTTP_ERROR,message:plupload.translate("HTTP Error."),file:i,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}))}function o(){var u,c,h,p;i.status!=plupload.DONE&&i.status!=plupload.FAILED&&n.state!=plupload.STOPPED&&(h={name:i.target_name||i.name},d&&l.chunks&&r.size>d?(p=Math.min(d,r.size-f),u=r.slice(f,f+p)):(p=r.size,u=r),d&&l.chunks&&(t.send_chunk_number?(h.chunk=Math.ceil(f/d),h.chunks=Math.ceil(r.size/d)):(h.offset=f,h.total=r.size)),m=new e.XMLHttpRequest,m.upload&&(m.upload.onprogress=function(t){i.loaded=Math.min(i.size,f+t.loaded),n.trigger("UploadProgress",i)}),m.onload=function(){if(m.status>=400)return void a();p<r.size?(u.destroy(),f+=p,i.loaded=Math.min(f,r.size),n.trigger("ChunkUploaded",i,{offset:i.loaded,total:r.size,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&n.trigger("UploadProgress",i)):i.loaded=i.size,u=c=null,!f||f>=r.size?(i.size!=i.origSize&&(r.destroy(),r=null),n.trigger("UploadProgress",i),i.status=plupload.DONE,n.trigger("FileUploaded",i,{response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()})):delay(o,1)},m.onerror=function(){a()},m.onloadend=function(){this.destroy(),m=null},n.settings.multipart&&l.multipart?(h.name=i.target_name||i.name,m.open("post",s,!0),plupload.each(n.settings.headers,function(t,e){m.setRequestHeader(e,t)}),c=new e.FormData,plupload.each(plupload.extend(h,n.settings.multipart_params),function(t,e){c.append(e,t)}),c.append(n.settings.file_data_name,u),m.send(c,{runtime_order:n.settings.runtimes,required_caps:y,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})):(s=plupload.buildUrl(n.settings.url,plupload.extend(h,n.settings.multipart_params)),m.open("post",s,!0),m.setRequestHeader("Content-Type","application/octet-stream"),plupload.each(n.settings.headers,function(t,e){m.setRequestHeader(e,t)}),m.send(u,{runtime_order:n.settings.runtimes,required_caps:y,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})))}var r,s=n.settings.url,l=n.features,d=t.chunk_size,h=t.max_retries,f=0;s=plupload.buildUrl(s,n.settings.params),i.loaded&&(f=i.loaded=d*Math.floor(i.loaded/d)),r=i.getSource(),!e.isEmptyObj(n.settings.resize)&&u(r,"send_binary_string")&&~e.inArray(r.type,["image/jpeg","image/png"])?c.call(this,r,n.settings.resize,function(t){r=t,i.size=t.size,o()}):o()}),n.bind("UploadProgress",function(t,e){r(e),n.trigger("Progress",e)}),n.bind("StateChanged",function(t){if(t.state==plupload.STARTED)d=+new Date;else if(t.state==plupload.STOPPED)for(var e=t.files.length-1;e>=0;e--)t.files[e].status==plupload.UPLOADING&&(t.files[e].status=plupload.QUEUED,s())}),n.bind("QueueChanged",s),n.bind("Error",function(t,e){e.file&&(e.file.status=plupload.FAILED,r(e.file),t.state==plupload.STARTED&&delay(function(){o.call(n)},1))}),n.bind("FileUploaded",function(){s(),delay(function(){o.call(n)},1)}),n.trigger("Init",{runtime:this.runtime}),l.call(this)},refresh:function(){f&&f.trigger("Refresh"),this.trigger("Refresh")},start:function(e){e&&(t.params=e),this.state!=plupload.STARTED&&(this.state=plupload.STARTED,this.trigger("StateChanged"),o.call(this))},stop:function(){this.state!=plupload.STOPPED&&(this.state=plupload.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){E=arguments[0]===n||arguments[0],f&&f.disable(E),this.trigger("DisableBrowse",E)},getFile:function(t){var e;for(e=g.length-1;e>=0;e--)if(g[e].id===t)return g[e]},addFile:function(t,n){function i(t){var s=e.typeOf(t);if(t instanceof e.File){if(!t.ruid){if(!a)return!1;t.ruid=a,t.connectRuntime(a)}i(new plupload.File(t))}else t instanceof e.Blob?(i(t.getSource()),t.destroy()):t instanceof plupload.File?(n&&(t.name=n),o.trigger("BeforeAdd",t)&&r.push(t)):-1!==e.inArray(s,["file","blob"])?i(new e.File(null,t)):"node"===s&&"filelist"===e.typeOf(t.files)?e.each(t.files,i):"array"===s&&(n=null,e.each(t,i))}var a,o=this,r=[];a=function(){var t=p||f;return!!t&&t.getRuntime().uid}(),i(t),r.length&&this.trigger("FilesAdded",r)},removeFile:function(t){for(var e="string"==typeof t?t:t.id,n=g.length-1;n>=0;n--)if(g[n].id===e)return this.splice(n,1)[0]},splice:function(t,e){var i=g.splice(t===n?0:t,e===n?g.length:e);return this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),plupload.each(i,function(t){t.destroy()}),i},trigger:function(t){var e,n,i=v[t.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,e=0;e<i.length;e++)if(!1===i[e].func.apply(i[e].scope,n))return!1;return!0},hasEventListener:function(t){return!!v[t.toLowerCase()]},bind:function(t,e,n){var i;t=t.toLowerCase(),i=v[t]||[],i.push({func:e,scope:n||this}),v[t]=i},unbind:function(t){t=t.toLowerCase();var e,i=v[t],a=arguments[1];if(i){if(a!==n){for(e=i.length-1;e>=0;e--)if(i[e].func===a){i.splice(e,1);break}}else i=[];i.length||delete v[t]}},unbindAll:function(){var t=this;plupload.each(v,function(e,n){t.unbind(n)})},destroy:function(){this.stop(),plupload.each(g,function(t){t.destroy()}),g=[],f&&(f.destroy(),f=null),p&&(p.destroy(),p=null),y={},d=h=E=m=null,this.trigger("Destroy"),this.unbindAll(),v={}},setBrowseButton:function(n){t.browse_button=e.get(n),a(this,t,{accept:t.filters.mime_types,runtime_order:t.runtimes,required_caps:y,swf_url:t.flash_swf_url,xap_url:t.silverlight_xap_url},function(){})}})},plupload.File=function(){function t(t){plupload.extend(this,{id:plupload.guid(),name:t.name||t.fileName,type:t.type||"",mimeType:t.type||"",size:t.size||t.fileSize,origSize:t.size||t.fileSize,loaded:0,percent:0,status:plupload.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var t=this.getSource().getSource();return-1!==e.inArray(e.typeOf(t),["blob","file"])?t:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete n[this.id])}}),n[this.id]=t}var n={};return t}(),plupload.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},t.plupload=plupload}(window,mOxie)},function(t,e){Ext.define("XERO.docs.upload.Manager",{extend:"Ext.util.Observable",maxFileSize:"25mb",uniqueNames:!1,multipart:!0,pluploadPath:"plupload/",pluploadRuntimes:"html5,html4",dropElement:null,browseButton:null,filters:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp,tiff,tif"},{title:"Documents",extensions:"pdf,doc,docx,xls,xlsx,ppt,pptx,odf,csv,txt,rtf,eml,msg,ods,odt,keynote,key,pages-tef,pages,numbers-tef,numbers"},{title:"Zip files",extensions:"zip,rar,zipx,xzip,7z"}],loadedFile:0,success:[],failed:[],constructor:function(t){var e=this;Ext.apply(e,t||{}),e.addEvents("beforeupload","filesadded","progressall","progressfile"),XERO.docs.upload.Manager.superclass.constructor.apply(e,arguments),e.uploader=new plupload.Uploader({url:e.url||"/docs/upload/uploadfile",runtimes:e.pluploadRuntimes,browse_button:e.browseButton,max_file_size:e.maxFileSize||"",resize:e.resize||"",flash_swf_url:e.pluploadPath+"/plupload.flash.swf",filters:e.filters||[],chunk_size:e.chunkSize,unique_names:e.uniqueNames,multipart:e.multipart,multipart_params:e.multipartParams||null,drop_element:e.dropElement||Ext.getBody().dom.id,required_features:e.requiredFeatures||null,params:e.params||null}),Ext.each(["Init","ChunkUploaded","FilesAdded","FilesRemoved","FileUploaded","PostInit","QueueChanged","Refresh","StateChanged","UploadFile","Progress","Error","UploadComplete"],function(t){this.uploader.bind(t,this["Plupload"+t],this)},e),e.uploader.init()},getState:function(){return this.uploader.state||0},updateProgress:function(t){var e=this,n=e.uploader.total,i=n.size,a=n.loaded;e.fireEvent("progressall",e,n),t&&(i=t.size,a=this.loadedFile,e.fireEvent("progressfile",e,t,Ext.util.Format.fileSize(a)+"/"+Ext.util.Format.fileSize(i),t.percent))},startUpload:function(t){var e=this;!1!==e.fireEvent("beforeupload",e,e.uploader)&&Ext.defer(function(){e.uploader.start(t),e.updateProgress()},250)},setBrowseButton:function(t){this.uploader.setBrowseButton(t.dom||t)},PluploadInit:function(t,e){},PluploadChunkUploaded:function(){},PluploadFilesAdded:function(t,e){this.fireEvent("filesadded",this,t,e)},PluploadFilesRemoved:function(t,e){},PluploadFileUploaded:function(t,e,n){try{var i=Ext.decode(n.response);!0===i.success?this.fireEvent("uploadcomplete",this,e,i.file):this.PluploadError(t,{code:"ERROR_SIZE"==i.file.StatusCode?-600:"ERROR_EXTENSION"==i.file.StatusCode?-601:"ERROR_DIRECTORY_404"==i.file.StatusCode?-800:"EMPTY_FILE"==i.file.StatusCode?-900:"ERROR_MIMETYPE"==i.file.StatusCode?-950:"ERROR_FILENAME"==i.file.StatusCode?-999:-1,file:e})}catch(n){this.PluploadError(t,{code:-1e3,file:e})}},PluploadPostInit:function(){},PluploadQueueChanged:function(t){},PluploadRefresh:function(t){},PluploadStateChanged:function(t){},PluploadUploadFile:function(){this.loadedFile=0},PluploadProgress:function(t,e){this.updateProgress(e),this.loadedFile=e.loaded},PluploadUploadComplete:function(t,e){this.fireEvent("queuecomplete",this,e)},PluploadError:function(t,e){var n,i,a='<a href="https://help.xero.com/FilesUpload" target="_blank">Read more</a>';switch(e.code){case-300:case-400:n="FILE_IO",i=Ext.String.format("Sorry, the file you have tried to upload is not supported. {0}",a);break;case-601:n="FILE_EXTENSION",i=Ext.String.format("Sorry, the file you have tried to upload is not supported. {0}",a);break;case-600:n="FILE_SIZE",i=Ext.String.format("Sorry, the file you have tried to upload is too large. {0}",a);break;case-900:n="FILE_EMPTY",i=Ext.String.format("Sorry, the file you have tried to upload is empty. {0}",a);break;case-800:n="ERROR_DIRECTORY_404",i=Ext.String.format("Sorry, you cannot upload files into this directory as it has been deleted. {0}",a);break;case-999:n="FILE_NAME",i=Ext.String.format("Sorry, the file name in invalid. {0}",a);break;case-950:n="FILE_MIMETYPE",i=Ext.String.format("Sorry, the file you have tried to upload is not supported. {0}",a);break;case-1e3:n="FILE_ERROR",i=Ext.String.format("Sorry, there was an error uploading the file. Please try again. {0}",a);break;default:n="FILE_ERROR",i="Sorry, there was an error uploading the file. Please try again."}this.fireEvent("error",this,n,i,e.file)},getRuntime:function(){return this.uploader.runtime||"unknown"},destroy:function(){this.uploader&&this.uploader.destroy()}}),Ext.onReady(function(){Ext.defer(function(){!function(){var t=Ext.query("table.standard td.attachment, table.expenseClaimSummary td.attachment, table#chartOfAccounts td.attachment, table#contactList td.attachment"),e=!1;if(t&&t.length>0){e=!0;var n=Ext.Array.map(t,function(t){return Ext.fly(t).getAttribute("data-id")});Ext.Ajax.request({url:"/docs/docs/getassociationlist",method:"POST",params:{objectIds:n},success:function(t){var e=Ext.decode(t.responseText);e.associations&&e.associations.length>0&&Ext.each(e.associations,function(t){if(t.FileCount&&t.FileCount>0){var e=t.FileCount>9?"9+":t.FileCount;Ext.select(Ext.String.format("td.attachment[data-id={0}], td.attachment[data-id={1}], td.attachment div.inner-attachment[data-id={0}], td.attachment div.inner-attachment[data-id={1}]",t.ObjectId.toLowerCase(),t.ObjectId.toUpperCase())).insertHtml("beforeEnd",Ext.String.format('<a href="javascript:" class="icons attachment" id="{0}"><span>{1}</span></a>',t.ObjectId,e))}})},failure:function(){}})}}()},50),Ext.getDoc().on("click",function(t,e,n){if(t.getTarget("a.view-attachment-list")||t.getTarget("a.x_view-attachment-list")||t.getTarget("a.icons.attachment")){t.stopEvent();var i=Ext.fly(e).getAttribute("id"),a=-1!==Ext.fly(e).getAttribute("class").indexOf("force-fetch");i.startsWith("x_")&&(i=i.replace(/x_/gi,""));var o=Ext.StoreMgr.get("attachedFilesStore"),r=function(t,e){e&&"FILE/UPLOADED"==e.get("status")&&new Ext.ux.FilePreviewer({store:t,initialRecord:e}).show()};if(o&&!a)r(o,o.getById(i));else{var s,l;t.getTarget("a.icons.attachment")?(s=new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/docs/docs/getfiles"}),l={associatedWith:i}):(s=new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/docs/docs/getfiledetails"}),l={fileId:i}),o=new XERO.docs.FilesStore({proxy:s,listeners:{load:function(t,e){r(t,e[0])}}}),o.load({params:l})}}},{delegate:"a"})})},function(t,e){Ext.ns("Ext.ux"),Ext.ux.ComponentDataView=Ext.extend(Ext.DataView,{defaultType:"textfield",initComponent:function(){Ext.ux.ComponentDataView.superclass.initComponent.call(this),this.components=[]},refresh:function(){Ext.destroy(this.components),this.components=[],Ext.ux.ComponentDataView.superclass.refresh.call(this),this.renderItems(0,this.store.getCount()-1)},onUpdate:function(t,e){var n=t.indexOf(e);n>-1&&this.destroyItems(n),Ext.ux.ComponentDataView.superclass.onUpdate.apply(this,arguments),n>-1&&this.renderItems(n,n)},onAdd:function(t,e,n){var i=this.all.getCount();Ext.ux.ComponentDataView.superclass.onAdd.apply(this,arguments),0!==i&&this.renderItems(n,n+e.length-1)},onRemove:function(t,e,n){this.destroyItems(n),Ext.ux.ComponentDataView.superclass.onRemove.apply(this,arguments)},onDestroy:function(){Ext.ux.ComponentDataView.onDestroy.call(this),Ext.destroy(this.components),this.components=[]},renderItems:function(t,e){for(var n=this.all.elements,i=[t,0],a=t;a<=e;a++)for(var o,r=i[i.length]=[],s=this.items,l=0,u=s.length;l<u;l++)o=s[l].render?o=s[l].cloneConfig():Ext.create(s[l],this.defaultType),r[l]=o,o.renderTarget?o.render(Ext.DomQuery.selectNode(o.renderTarget,n[a])):o.applyTarget?o.applyToMarkup(Ext.DomQuery.selectNode(o.applyTarget,n[a])):o.render(n[a]),Ext.isFunction(o.setValue)&&o.applyValue&&(o.setValue(this.store.getAt(a).get(o.applyValue)),o.on("blur",function(t){this.store.getAt(this.index).data[this.dataIndex]=t.getValue()},{store:this.store,index:a,dataIndex:o.applyValue}));this.components.splice.apply(this.components,i)},destroyItems:function(t){Ext.destroy(this.components[t]),this.components.splice(t,1)}}),Ext.reg("compdataview",Ext.ux.ComponentDataView),Ext.ux.ComponentListView=Ext.extend(Ext.ListView,{defaultType:"textfield",initComponent:function(){Ext.ux.ComponentListView.superclass.initComponent.call(this),this.components=[]},refresh:function(){Ext.destroy(this.components),this.components=[],Ext.ux.ComponentListView.superclass.refresh.apply(this,arguments),this.renderItems(0,this.store.getCount()-1)},onUpdate:function(t,e){var n=t.indexOf(e);n>-1&&this.destroyItems(n),Ext.ux.ComponentListView.superclass.onUpdate.apply(this,arguments),n>-1&&this.renderItems(n,n)},onAdd:function(t,e,n){var i=this.all.getCount();Ext.ux.ComponentListView.superclass.onAdd.apply(this,arguments),0!==i&&this.renderItems(n,n+e.length-1)},onRemove:function(t,e,n){this.destroyItems(n),Ext.ux.ComponentListView.superclass.onRemove.apply(this,arguments)},onDestroy:function(){Ext.ux.ComponentDataView.onDestroy.call(this),Ext.destroy(this.components),this.components=[]},renderItems:function(t,e){for(var n=this.all.elements,i=[t,0],a=t;a<=e;a++)for(var o,r=i[i.length]=[],s=this.columns,l=0,u=s.length;l<u;l++){var c=s[l].component;o=c.render?o=c.cloneConfig():Ext.create(c,this.defaultType),r[l]=o;var d=n[a].getElementsByTagName("dt")[l].firstChild;o.renderTarget?o.render(Ext.DomQuery.selectNode(o.renderTarget,d)):o.applyTarget?o.applyToMarkup(Ext.DomQuery.selectNode(o.applyTarget,d)):o.render(d),!0===o.applyValue&&(o.applyValue=s[l].dataIndex),Ext.isFunction(o.setValue)&&o.applyValue&&(o.setValue(this.store.getAt(a).get(o.applyValue)),o.on("blur",function(t){this.store.getAt(this.index).data[this.dataIndex]=t.getValue()},{store:this.store,index:a,dataIndex:o.applyValue}))}this.components.splice.apply(this.components,i)},destroyItems:function(t){Ext.destroy(this.components[t]),this.components.splice(t,1)}}),Ext.reg("complistview",Ext.ux.ComponentListView)},function(t,e){Ext.define("Ext.data.roles.JsonReader",{extend:"Ext.data.JsonReader",readRecords:function(t){this.jsonData=t,t.metaData&&this.onMetaChange(t.metaData);var e,n,i=this.meta,a=this.recordType,o=a.prototype.fields,r=(o.items,o.length,this.getRoot(t)),s=r.length,l=s,u=!0;return i.totalProperty&&(e=parseInt(this.getTotal(t),10),isNaN(e)||(l=e)),i.successProperty&&(!1!==(e=this.getSuccess(t))&&"false"!==e||(u=!1)),i.rolesProperty&&(n=this.getRoles(t)),{roles:n,success:u,records:this.extractData(r,!0),totalRecords:l}},buildExtractors:function(){if(!this.ef){this.callParent(arguments);var t=this.meta;t.rolesProperty&&(this.getRoles=this.createAccessor(t.rolesProperty))}}}),Ext.define("Ext.data.roles.JsonStore",{extend:"Ext.data.GroupingStore",roles:null,constructor:function(t){Ext.data.roles.JsonStore.superclass.constructor.call(this,Ext.apply(t,{reader:new Ext.data.roles.JsonReader(t)}))},loadRecords:function(t,e,n){t.roles&&(roles=t.roles),this.callParent(arguments)},isInRole:function(t){return!roles||-1!==roles.indexOf(t)}}),Ext.define("XERO.docs.FilesStore",{extend:"Ext.data.roles.JsonStore",constructor:function(t){Ext.applyIf(t||{},{root:"files",idProperty:"id",rolesProperty:"roles",groupField:"send",groupDir:"DESC",sortInfo:{field:"updatedOn",direction:"DESC"},fields:["id","name","url","mimeType","uploadedBy","thumbnailUrl","status","msg",{name:"updatedOn",type:"date",dateFormat:"c",sortType:Ext.data.SortTypes.asDate},{name:"size",type:"float"},{name:"percent",type:"float"},{name:"loaded",type:"float"},{name:"send",type:"boolean",sortType:function(t){return!0===t?1:0}},{name:"mediaType",convert:function(t,e){var n=(e.mimeType||"application/x-object").toLowerCase();return n.endsWith("pdf")?"PDF":n.startsWith("image")?n.endsWith("tiff")?"TIFF":"IMAGE":null}},"tags"]}),this.callParent(arguments)}}),Ext.define("XERO.docs.attachments.FileUploadButton",{extend:"Ext.Button",cls:"x-btn-attach",iconCls:"x-btn-attach-fake",textTpl:"<em class='btn-attachment-icon {1}'>&nbsp;</em>{0}",isLoading:!0,canDock:!1,docked:!1,getDockingDimensions:!1,filePreviewer:null,showHudDocAd:!1,hasUploadFiles:!0,initComponent:function(){var t=this;switch(t.canSend=t.canSend||!1,t.fileListAlign||"right"){case"left":t.fileListAlignTo="tl-bl",t.fileListOffset=[-10,10],t.fileListArrow="left";break;case"center":t.fileListAlignTo="t-br",t.fileListOffset=[-31,10],t.fileListArrow="center";break;default:t.fileListAlignTo="tr-br",t.fileListOffset=[10,10],t.fileListArrow="right"}!function(){var t=Ext.urlDecode((location.search||"").right(location.search.length-1));!t.attach||Ext.isEmpty(t.attach)}();t.store=t.initStore(t.isNewParent),t.mon(t.store,"load",t.onLoad,t),t.mon(t.store,"update",t.onStoreUpdate,t),t.callParent(arguments),t.on("click",t.onClick,t),t.on("render",function(){t.getEl()&&(!0===t.isNewParent&&(t.filesPendingField=new Ext.form.Hidden({name:"__FilesPending",renderTo:t.getEl().parent(),value:t.parentId+"|false"})),t.fakeFileStoreId&&(t.fakeFileStoreField=new Ext.form.Hidden({name:"FileStoreID",renderTo:t.getEl().parent(),value:t.fileStoreId||""})))}),Ext.getDoc().on("mousedown",t.handleDocumentMouseDown,t),t.store.load(),function(){XERO.docs.attachments.FileUploadButton.current=function(){return t}}()},handleDocumentMouseDown:function(t){var e=this;t.getTarget(".ext-el-mask")||t.getTarget(".file-library")||t.getTarget(".file-library")||t.getTarget(".file-previewer")||t.getTarget(".x-attachment-container")||t.getTarget(".file-attachments")||t.getTarget(".files-context-menu")||e.fileViewer&&e.fileViewer.isVisible()&&e.fileViewer.hide()},setFilesPending:function(t){var e=this;e.filesPendingField&&e.filesPendingField.setValue(e.parentId+"|"+t)},setFakeFileStoreId:function(t){var e=this;e.fakeFileStoreField&&(e.fakeFileStoreField.setValue(t),Ext.Ajax.request({url:"/docs/docs/updatefilestoreid",method:"POST",params:{invoiceId:e.parentId,fileStoreId:t},success:function(){},failure:function(){}}))},initStore:function(t){var e=this;return new XERO.docs.FilesStore({storeId:"attachedFilesStore",baseParams:{associatedWith:this.parentId},hasUploadFiles:e.hasUploadFiles,proxy:new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:Ext.String.format("{0}{1}",XERO.routes.Docs.GetFiles,!0===t?"?pending=true":"")})})},onLoad:function(t,e){var n=this;n.isLoading=!1,!1===t.isInRole("ROLE/READONLY")&&!0===n.hasUploadFiles&&n.initPlUpload(),n.updateEl(e.length),0!==e.length&!0===n.isNewParent&&n.setFilesPending(!0),!0===n.docked&&0!==e.length?n.showFilePreviewer(e[0],!0):!0===n.showHudDocAd&&(n.hubDocAdGenerator=new XERO.docs.hubdoc.AdGenerator({filesButton:n})),n.fireEvent("load",n,t,e)},setText:function(t,e){var n=this;return n.text=t,n.el&&(n.btnEl.update(Ext.String.format(n.textTpl,t||"&#160;",e)),n.setButtonClass()),n.doAutoWidth(),n},initPlUpload:function(t){var e=this;t&&Ext.get(t);e.uploadManager=new XERO.docs.upload.Manager({url:"/docs/upload/uploadfile",dropElement:Ext.getBody().dom.id,params:{associateWithId:e.parentId,asssociateWithType:e.parentType},listeners:{filesadded:e.onFilesAdded,progressfile:e.updateStoreFile,uploadcomplete:e.onUploadComplete,queuecomplete:e.onQueuecomplete,uploadfailure:e.onUploadFailure,error:e.onUploadError,scope:e}}),e.uploadManager.uploader.settings.headers={"X-CSRFToken":Ext.select("input[name=__RequestVerificationToken]").first().getValue()}},onDestroy:function(){var t=this;t.uploadManager&&t.uploadManager.destroy(),t.fileViewer&&t.fileViewer.destroy(),t.filePreviewer&&t.filePreviewer.destroy(),t.fileLibraryViewer&&t.fileLibraryViewer.destroy(),Ext.getDoc().un("mousedown",this.handleDocumentMouseDown,this),XERO.docs.attachments.FileUploadButton.superclass.onDestroy.call(this)},onFilesAdded:function(t,e,n){var i=this;i.updateStoreFiles(t,n),i.startUpload(t)},onUploadComplete:function(t,e,n){if(e&&n){var i=this,a=i.store.getById(e.id),o=i.store.indexOf(a);Ext.apply(e,n),a&&(i.store.removeAt(o),i.addRecords(o,e),0===o&&i.setFakeFileStoreId(e.id))}},onQueuecomplete:function(){this.filePreviewer&&this.filePreviewer.refresh(),XERO.widget.Histories&&Ext.defer(XERO.widget.Histories.refresh,500,XERO.widget.Histories)},onUploadError:function(t,e,n,i){var a=this,o=a.store.getById(i.id),r=a.store.indexOf(o),s=a.fileViewer;s&&s.showError(n),a.store.removeAt(r)},onUploadFailure:function(t,e,n){var i=this,a=i.store.getById(e.id);i.store.indexOf(a);a&&a.set("status","FILE/FAILED"),i.fileViewer&&i.fileViewer.showError("The file could not be uploaded. Please try again")},addRecords:function(t,e){var n=this;e=[].concat(e);var i=n.store.reader.readRecords({files:e});n.store.insert(t,i.records)},updateStoreFiles:function(t,e){var n=this;Ext.each(e,function(e){n.updateStoreFile(t,e)},n)},updateStoreFile:function(t,e){if(e&&e&&"FILE/DONE"!=e.status){var n=this,i=n.store.getById(e.id);if(i)i.beginEdit(),i.set("percent",e.percent),i.set("status",e.status),i.set("msg",e.msg),i.set("size",e.size),i.set("loaded",e.loaded),i.commit();else{e=Ext.applyIf(e,{uploadedBy:"Craig Walker"});var a=n.store.query("send",!0).getCount();n.addRecords(a,e)}}},startUpload:function(t){var e=this,t=t||e.uploadManager;e.showFileViewer(),t.startUpload()},onStoreUpdate:function(t){this.updateEl(t.getCount())},updateEl:function(t){this.renderTpl(t)},renderTpl:function(t){this.setText(0===t?"":t,t>9?"too-many":"")},onClick:function(t){t.stopEvent();var e=this;if(!0===e.isLoading)return!1;if(e.fileViewer&&e.fileViewer.isVisible())e.fileViewer.hide();else if(e.showFileViewer(),window.Invoice){var n=window.Invoice.InvoiceTypeCode||window.Invoice.invoiceTypeCode;if(""!==n){var i=window.location.pathname;i=i.includes("View.aspx")?"view":i.includes("Edit.aspx")?"edit":"",window.ga&&"function"==typeof window.ga&&window.ga("send",{hitType:"event",eventCategory:"Manage Invoice",eventAction:"Open attach file dialog",eventLabel:"Open file upload dialog from "+i+" "+n})}}},showFileViewer:function(){var t=this;t.fileViewer?t.fileViewer.showBy(t.el):(t.fileViewer=t.createFileViewerWindow(),t.fileViewer.showBy(t.el)),t.hubDocAdGenerator&&t.hubDocAdGenerator.destroy()},updateFileViewerTitle:function(t){this.fileViewer&&this.fileViewer.updateTitle(t)},createFileViewerWindow:function(){var t=this;return new XERO.docs.attachments.FileListWindow({width:400,store:t.store,parentType:t.parentType,uploadManager:t.uploadManager,fileListAlignTo:t.fileListAlignTo,fileListOffset:t.fileListOffset,fileListArrow:t.fileListArrow,canSend:t.canSend,canDock:t.canDock,getDockingDimensions:t.getDockingDimensions,listeners:{addfromlibraryclick:t.handleAddFromLibraryClick,deletefile:t.handleDeleteFile,removefile:t.handleRemoveFile,sendfile:t.handleSendFile,rowclick:t.handleFileListRowClick,scope:t}})},handleFileListRowClick:function(t,e){"FILE/UPLOADED"==e.get("status")&&this.showFilePreviewer(e)},showFilePreviewer:function(t,e,n,i){var a=this;a.filePreviewer?a.filePreviewer.goToRecord(t):(a.filePreviewer=new Ext.ux.FilePreviewer({x:n,y:i,store:a.store,initialRecord:t,canDock:a.canDock||!1,docked:e,getDockingDimensions:a.getDockingDimensions||!1,listeners:{toggledocking:function(t,e){var n=t.activeItemIndex;Invoice.windowWidth=null,Invoice.gridWidth=null,t.close(),a.showFilePreviewer(a.store.getAt(n),!e),a.fileViewer&&a.fileViewer.realign()},refresh:function(t,e){var n=t.activeItemIndex,i=t.getPosition();t.close(),a.showFilePreviewer(a.store.getAt(n),e,i[0],i[1])},scope:a}}),a.filePreviewer.show(),a.filePreviewer.on("destroy",function(){a.filePreviewer=null,a.fileViewer&&a.fileViewer.realign(),a.fireEvent("previewerdestroy",a)})),!0===e&&a.fileViewer&&a.fileViewer.realign()},handleDeleteFile:function(t,e){this.removeFile(e,!0)},handleRemoveFile:function(t,e){this.removeFile(e,!1)},handleSendFile:function(t,e,n){var i=this;e.set("send",!e.get("send")),i.fileViewer&&(i.store.applySort(),i.fileViewer.fileList.refresh()),Ext.Ajax.request({url:"/docs/docs/sendwithinvoice",method:"POST",params:{fileId:e.getId(),objectId:i.parentId,send:e.get("send")},success:function(){},failure:function(){}})},removeFile:function(t,e){var n=this,i=n.store;i.remove(t),n.updateEl(i.getCount()),n.updateFileViewerTitle(i.getCount()),0===i.getCount()?(n.setFilesPending(!1),n.setFakeFileStoreId("")):n.fakeFileStoreField&&n.fakeFileStoreField.getValue().toLowerCase()==t.getId().toLowerCase()&&n.setFakeFileStoreId(i.getAt(0).getId()),Ext.Ajax.request({url:"/docs/docs/deleteassociation",method:"POST",params:{objectId:n.parentId,fileId:t.getId(),deleteFile:e},success:function(){},failure:function(){}}),n.fileViewer&&(n.store.applySort(),n.fileViewer.fileList.refresh())},handleAddFromLibraryClick:function(){var t=this;t.fileLibraryViewer=t.createFileLibraryViewer(),t.fileLibraryViewer.show()},createFileLibraryViewer:function(){var t=this;return new XERO.docs.attachments.FileLibraryWindow({width:900,height:600,parentId:t.parentId,listeners:{addfiles:t.handleAddFilesFromLibraryClick,scope:t}})},handleAddFilesFromLibraryClick:function(t,e,n){var i=this,a=i.store;0===a.getCount()&&i.setFakeFileStoreId(n[0].id),i.addRecords(a.getCount(),n),i.updateEl(a.getCount()),i.updateFileViewerTitle(a.getCount()),i.fileLibraryViewer.close(),i.fileLibraryViewer=null,i.setFilesPending(!0),Ext.Ajax.request({url:"/docs/docs/associatefiles",method:"POST",params:{objectId:i.parentId,objectType:i.parentType,isNew:i.isNewParent||!1,fileIds:Ext.Array.map(n,function(t){return t.id})},success:function(){},failure:function(){}})}}),Ext.define("XERO.docs.attachments.FileLibraryWindow",{extend:"Ext.Window",cls:"x-popup file-library",modal:!0,shadow:!1,resizable:!1,ddGhost:!1,closeAction:"close",shim:!1,animCollapse:!1,constrainHeader:!0,layout:"border",title:"Choose unattached files from your library",initComponent:function(t){var e=this;e.fileStore=e.getFileLibraryStore(),e.grid=new XERO.docs.attachments.FileLibrary({region:"center",store:e.fileStore}),e.addFilesButton=new Ext.Button({text:"Add Files",cls:"green file-library-add-files",width:147,handler:e.handleAddFiles,scope:e}),e.folderStore=new Ext.data.JsonStore({url:"/docs/folders/getfolderswithunassociatedfiles",fields:[{name:"FolderID"},{name:"Name"},{name:"FileCount",type:"int"}]}),e.folderStore.load(),e.folderTree=new Ext.list.ListView({region:"west",cls:"folder-tree",width:160,store:e.folderStore,hideHeaders:!0,singleSelect:!0,columns:[{dataIndex:"Name",tpl:new Ext.XTemplate(" {[this.getFolderName(values)]} <span>({FileCount})</span>",{compiled:!0,getFolderName:function(t){return Ext.util.Format.ellipsis(t.Name,15)}})}]}),Ext.apply(e,{items:[e.folderTree,e.grid],buttons:[e.addFilesButton,{text:"Cancel",cls:"gray file-library-cancel",width:100,handler:function(){e.close()}}]}),e.callParent(arguments),e.grid.getSelectionModel().on("selectionchange",e.handleGridSelection,e),e.folderTree.on("selectionchange",e.handleFolderSelection,e),e.folderStore.on("load",e.handleFolderStoreLoad,e),e.grid.on("rowclick",e.handleItemClick,e)},handleItemClick:function(t,e,n){var i=this,a=this.grid.getStore().getAt(e);n.getTarget("h4")&&"FILE/UPLOADED"==a.get("status")&&new Ext.ux.FilePreviewer({store:i.grid.store,initialRecord:a}).show()},handleFolderStoreLoad:function(t,e,n){this.folderTree.select(0)},handleFolderSelection:function(t,e){this.fileStore.load({params:{folderId:this.folderTree.getRecord(e[0]).get("FolderID"),objectId:this.parentId}})},handleGridSelection:function(){var t,e=this,n=e.grid.getSelectionModel().getCount();t=0===n?"Add files":Ext.String.format("Add {0} file{1}",n,1!==n?"s":""),e.addFilesButton.setText(t)},handleAddFiles:function(){var t,e=this,n=e.grid,i=n.getSelectionModel().getSelections();0!==i.length&&(t=Ext.Array.map(i,function(t){return t.data}),this.fireEvent("addfiles",e,n,t))},getFileLibraryStore:function(){return new Ext.data.JsonStore({proxy:new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/docs/docs/getfilestoassociate"}),idProperty:"id",root:"files",totalProperty:"totalCount",fields:["id",{name:"name",sortType:Ext.data.SortTypes.asUCText},"url","mimeType",{name:"uploadedBy",sortType:Ext.data.SortTypes.asUCText},"thumbnailUrl","status","msg",{name:"updatedOn",type:"date",dateFormat:"c"},{name:"size",type:"float"},{name:"percent",type:"float"},{name:"loaded",type:"float"},{name:"fromSync",type:"boolean"},{name:"isPending",type:"boolean"},{name:"mediaType",convert:function(t,e){var n=(e.mimeType||"application/x-object").toLowerCase();return n.endsWith("pdf")?"PDF":n.startsWith("image")?"IMAGE":null}},"associations","folders","tags"]})}}),Ext.define("XERO.docs.attachments.FileLibrary",{extend:"Ext.grid.GridPanel",cls:"file-list",resizable:!1,enableColumnHide:!1,enableColumnMove:!1,enableColumnResize:!1,enableLocking:!1,border:!1,initComponent:function(){var t=this,e=new Ext.grid.CheckboxSelectionModel({checkOnly:!0,width:30});Ext.apply(t,{selModel:e,colModel:new Ext.grid.ColumnModel({defaults:{draggable:!1,resizable:!1,hideable:!1,menuDisabled:!0},columns:[e,{header:"",xtype:"templatecolumn",sortable:!1,dataIndex:"mimeType",width:30,fixed:!0,tdCls:"mime-type",tpl:new Ext.XTemplate('<div class="mime-type-32x32 {[this.getMimeTypeClass(values)]}">&nbsp;</div>',{compiled:!0,getMimeTypeImage:function(t){return t.previewUrl?t.previewUrl:Ext.String.format("/common/images/docs/types/{0}.gif",Ext.util.Mime.normalized(t.mimeType,t.name))},getMimeTypeClass:function(t){return Ext.util.Mime.getTypeCategory(Ext.util.Mime.normalized(t.mimeType,t.name))}})},{header:'<a href="javascript:">File</a>',xtype:"templatecolumn",dataIndex:"name",sortable:!0,flex:1,tpl:new Ext.XTemplate('<div class="file-list-details" style="display:table-cell;">','<div style="word-wrap:break-word;">',"<h4>","{name:htmlEncode}","</h4>","</div>","</div>",{compiled:!0,getAttached:function(t,e,n){var i,a;switch(t.InvoiceTypeCode){case"INVOICETYPE/ACCREC":default:i=Ext.String.format("/AccountsReceivable/View.aspx?invoiceid={0}",t.InvoiceID),a=t.InvoiceNumber}return Ext.String.format('<li><a href="{0}" target="_blank">{1}</a>{2}</li>',i,a,e===n-1?" &":e!=n?",":"")},getFolder:function(t,e,n){return Ext.String.format('<li><a href="#" data-id="{0}">{1}</a></li>',t.FolderID,t.Name)},getMimeTypeClass:function(t){return Ext.util.Mime.getTypeCategory(Ext.util.Mime.normalized(t.mimeType,t.name))}})},{header:'<a href="javascript:">Size</a>',xtype:"templatecolumn",sortable:!0,dataIndex:"size",tpl:"{size:fileSize}",fixed:!0,width:75},{header:'<a href="javascript:">Uploaded</a>',xtype:"templatecolumn",sortable:!0,width:125,fixed:!0,dataIndex:"updatedOn",tpl:new Ext.XTemplate('<tpl if="this.isUploading(values)">','<div class="x-progress x-progress-striped {[values.percent == 100 ? "x-active" : "x-active"]}">','<div class="x-bar" style="width:{percent}%"></div>',"</div>","</tpl>",'<tpl if="! this.isUploading(values)">',"{[this.uploadedOn(values.updatedOn)]}","</tpl>",{compiled:!0,isUploading:function(t){return"FILE/UPLOADED"!=t.status},uploadedOn:function(t){return Ext.util.Format.friendlyDate(Date.parse(t))}})},{header:'<a href="javascript:">Uploaded by</a>',sortable:!0,width:125,fixed:!0,dataIndex:"uploadedBy"}]}),loadMask:{msg:"",msgCls:"x-mask-loading file-list-grid-loading",maskCls:"x-mask file-list-grid-mask"},viewConfig:{forceFit:!0,emptyText:['<div class="file-list-empty">','<div class="file-list-empty-inner">','<div class="file-list-empty-left">&nbsp;</div>','<div class="file-list-empty-right" style="margin-top:10px">',"<h3>No files</h3>",'<div style="margin-top:10px;">There are no unattached files in this folder.</div>',"</div>","</div>","</div>"].join(""),getRowClass:function(t,e){return!0===t.get("isPending")?"already-attached":""}}}),t.callParent(arguments)},initEvents:function(){this.callParent(arguments),this.loadMask.show()}})},function(t,e){Ext.list.GroupingListView=Ext.extend(Ext.ListView,{initComponent:function(){var t=this;t.canSend=t.canSend||!1;var e="invoice";switch(t.parentType){case"INVOICETYPE/ACCREC":case"INVOICETYPE/ACCPAY":e="invoice";break;case"INVOICETYPE/ACCPAYCREDIT":case"INVOICETYPE/ACCRECCREDIT":e="credit note";break;case"INVOICETYPE/ARPREPAYMENT":case"INVOICETYPE/ACCRECPAYMENT":case"INVOICETYPE/ACCPAYPAYMENT":case"INVOICETYPE/EXPPAYMENT":case"INVOICETYPE/ARCREDITPAYMENT":case"INVOICETYPE/APOVERPAYMENTSOURCEPAYMENT":case"INVOICETYPE/APCREDITPAYMENT":case"INVOICETYPE/PAYBATCH":case"INVOICETYPE/ARPREPAYMENTSOURCEPAYMENT":case"INVOICETYPE/APOVERPAYMENT":e="payment"}if(!0===t.canSend){var n=['<div class="empty-files">','<div class="x-grid-group-hd">','<div class="x-grid-group-title">TO INCLUDE WITH ',e.toUpperCase(),"</div>","</div>",'<div class="file-list-empty send-with-invoice">','<div class="file-list-empty-inner">',"<div>No files attached to ",e,"</div>","</div>","</div>",'<div class="x-grid-group-hd">','<div class="x-grid-group-title">RELATED FILES</div>',"</div>",'<div class="file-list-empty upload-your-files">','<div class="file-list-empty-inner">','<div class="file-list-empty-left">&nbsp;</div>','<div class="file-list-empty-right">',"<div>Upload your files to store them alongside all of your financial documents</div>","<p>Added files will only be visible to users with access to your company</p>","</div>","</div>","</div>","</div>"].join("");Ext.apply(t,{emptyText:n}),t.tpl=new Ext.XTemplate('<div class="x-grid-group">','<div class="x-grid-group-hd">','<div class="x-grid-group-title">TO INCLUDE WITH ',e.toUpperCase(),"</div>","</div>",'<div class="x-grid-group-body sent-with-invoice">','<tpl if="this.isSendEmpty() === true">','<div class="file-list-empty send-with-invoice">','<div class="file-list-empty-inner">',"<div>No files attached to ",e,"</div>","</div>","</div>","</tpl>",'<tpl if="this.isSendEmpty() !== true">','<tpl for="rows">','<tpl if="send === true">','<dl class="x-grid3-row">','<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">',"{[values.tpl.apply(parent)]}","</em>","</dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>","</tpl>","</tpl>","</div>","</div>",'<div class="x-grid-group" >','<div class="x-grid-group-hd">','<div class="x-grid-group-title">RELATED FILES</div>',"</div>",'<div class="x-grid-group-body related-files">','<tpl if="this.isRelatedEmpty() === true">','<div class="file-list-empty upload-your-files">','<div class="file-list-empty-inner">','<div class="file-list-empty-left">&nbsp;</div>','<div class="file-list-empty-right">',"<div>Upload your files to store them alongside all of your financial documents</div>","<p>Added files will only be visible to users with access to your company</p>","</div>","</div>","</div>","</tpl>",'<tpl if="this.isRelatedEmpty() !== true">','<tpl for="rows">','<tpl if="send !== true">','<dl class="x-grid3-row">','<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">',"{[values.tpl.apply(parent)]}","</em>","</dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>","</tpl>","</tpl>","</div>","</div>",'<div class="dataview-border"></div>',{isSendEmpty:function(){if(0===t.store.query("send",!0).getCount())return!0},isRelatedEmpty:function(){if(0===t.store.query("send",!1).getCount())return!0},isBigger:function(t,e){return t>e},getCollapseClass:function(t){return t.group_collapsed?" x-grid-group-collapsed":""}})}Ext.list.GroupingListView.superclass.initComponent.apply(this,arguments)},collectData:function(t,e){var n=Ext.Array.map(t,function(t){return t.data});return{columns:this.columns,rows:n}},onUpdate:function(t,e){this.refresh()},onAdd:function(t,e){this.refresh()}}),XERO.docs.attachments.FileList=Ext.extend(Ext.list.GroupingListView,{multiSelect:!1,singleSelect:!1,deferEmptyText:!1,reserveScrollOffset:!0,cls:"file-attachment-list",hideHeaders:!0,columnResize:!1,columnSort:!1,initComponent:function(){var t=this;if(t.canSend=t.canSend||!1,!1===t.canSend){var e=['<div class="file-list-empty upload-your-files">','<div class="file-list-empty-inner">','<div class="file-list-empty-left">&nbsp;</div>','<div class="file-list-empty-right">',"<div>Upload your files to store them alongside all of your financial documents</div>","<p>Added files will only be visible to users with access to your company</p>","</div>","</div>","</div>","</div>"].join("");Ext.apply(t,{emptyText:e})}Ext.apply(t,{columns:[{cls:"first",dataIndex:"mimeType",width:.09,tpl:new Ext.XTemplate('<div class="mime-type-32x32 {[this.getMimeTypeClass(values)]}">&nbsp;</div>',{compiled:!0,getMimeTypeClass:function(t){return Ext.util.Mime.getTypeCategory(Ext.util.Mime.normalized(t.mimeType,t.name))},getMimeTypeImage:function(t){return t.previewUrl?t.previewUrl:String.format("/common/images/docs/types/{0}.gif",Ext.util.Mime.normalized(t.mimeType,t.name))}})},{dataIndex:"name",tpl:new Ext.XTemplate('<div class="file-list-details">',"<h4>{name:htmlEncode}</h4>",'<tpl if="this.hasErrored(values)">','<div class="x-upload-error">',"Upload failed","</div>","</tpl>",'<tpl if="this.isUploading(values)">','<tpl if="this.getPercentage(values) < 100">','<div class="x-progress">','<div class="x-bar" style="width:{percent}%"></div>',"</div>","</tpl>",'<tpl if="this.getPercentage(values) == 100">','<div class="x-progress-msg">{[this.getUploadingMessage()]}</div>',"</tpl>","</tpl>","<tpl if=\"! this.isUploading(values) && values.status != 'FILE/FAILED'\">",'<div class="uploaded-on">File uploaded {[this.uploadedOn(values.updatedOn)]} by {uploadedBy}</div>',"</tpl>",'<div class="file-delete-buttons" style="display:none;">','<a style="width: 55px;" class="xbtn large red delete-file" href="#">Delete</a>','<a style="padding:6px 13px 5px;" class="xbtn large red-text remove-file" href="#">Remove & Save to File Library</a>',"</div>",'<tpl if="this.showMenu()">','<div class="file-context-menu" style="display:none;position:absolute;z-index:20000;width:170px;">',"<ul>",'<li class="menu-send-item"><a class="file-context-menu-send" href="#">{[this.getSendMessage(values)]} with {[this.attachedToName()]}</a></li>','<li class="menu-delete-item"><a class="file-context-menu-delete" href="#">Delete</a></li>',"</ul>","</div>","</tpl>","</div>",{compiled:!0,hasErrored:function(t){return"FILE/FAILED"==t.status},hasErrored:function(t){return"FILE/FAILED"==t.status},isUploading:function(t){return"FILE/UPLOADED"!=t.status&&"FILE/FAILED"!=t.status},uploadedOn:function(t){return Ext.util.Format.friendlyDate(Date.parse(t))},getPercentage:function(e){return"html4"==t.uploadManager.getRuntime()||Ext.isIE9||Ext.isIE8?100:e.percent},showMenu:function(){return t.canSend},getSendMessage:function(t){return!0===t.send?"Don't include":"Include"},getUploadingMessage:function(){return"html4"==t.uploadManager.getRuntime()||Ext.isIE9||Ext.isIE8?"Uploading...":"Finishing..."},attachedToName:function(){switch(t.parentType){case"OBJECTTYPE/FIXEDASSET":return"asset";case"OBJECTTYPE/CONTACT":return"contact";case"OBJECTTYPE/ACCOUNT":return"account";case"INVOICETYPE/ACCREC":case"INVOICETYPE/ACCPAY":return"invoice";case"INVOICETYPE/PAYSLIP":return"payslip";case"INVOICETYPE/TRANSFER":return"transfer";case"INVOICETYPE/EXPCLAIM":return"account";case"INVOICETYPE/ADJUSTMENT":case"INVOICETYPE/STARTINGBALANCE":case"INVOICETYPE/CASHPAID":case"INVOICETYPE/CASHREC":return"transaction";case"INVOICETYPE/MANJOURNAL":return"journal";case"INVOICETYPE/QUOTE":return"quote";case"INVOICETYPE/WAGEPAYABLE":return"payable";case"INVOICETYPE/ACCPAYCREDIT":case"INVOICETYPE/ACCRECCREDIT":return"credit note";case"INVOICETYPE/RECEIPT":return"receipt";case"INVOICETYPE/ARPREPAYMENT":case"INVOICETYPE/ACCRECPAYMENT":case"INVOICETYPE/ACCPAYPAYMENT":case"INVOICETYPE/EXPPAYMENT":case"INVOICETYPE/ARCREDITPAYMENT":case"INVOICETYPE/APOVERPAYMENTSOURCEPAYMENT":case"INVOICETYPE/APCREDITPAYMENT":case"INVOICETYPE/PAYBATCH":case"INVOICETYPE/ARPREPAYMENTSOURCEPAYMENT":case"INVOICETYPE/APOVERPAYMENT":return"payment";default:return"invoice"}}})}]}),!1===t.store.isInRole("ROLE/READONLY")&&!0===t.store.hasUploadFiles&&t.columns.push({cls:"last",tpl:new Ext.XTemplate('<tpl if="this.showMenu()">','<a href="#" class="x-action-col x-context-menu"></a>',"</tpl>",'<tpl if="!this.showMenu()">','<a href="#" class="file-context-menu-delete x-delete-btn"></a>',"</tpl>",{compiled:!0,showMenu:function(){return t.canSend}}),width:.09}),XERO.docs.attachments.FileList.superclass.initComponent.call(this)},onItemClick:function(t,e,n){var i=this,a=i.store.getAt(e);if(n.stopEvent(),"FILE/UPLOADED"==a.get("status"))if(n.getTarget("a.x-context-menu"))i.showContextMenu(n.getTarget("a.x-context-menu"),t,e,a,n);else if(n.getTarget(".x-row-indeletion"))n.getTarget("a.delete-file")?i.fireEvent("deletefile",i,a):n.getTarget("a.remove-file")?i.fireEvent("removefile",i,a):n.getTarget("a.file-context-menu-delete")&&i.showDeleteButtons(n.getTarget("a.file-context-menu-delete"),t,e,a,n);else if(n.getTarget("a.file-context-menu-send")){if(i.fireEvent("sendfile",i,a),window.Invoice&&window.ga){var o=window.Invoice.InvoiceTypeCode||window.Invoice.invoiceTypeCode;if(""!==o){var r=window.location.pathname;r=r.includes("View.aspx")?"view":r.includes("Edit.aspx")?"edit":"","Include with invoice"===n.target.innerText&&"INVOICETYPE/ACCREC"===o&&"function"==typeof window.ga&&window.ga("send",{hitType:"event",eventCategory:"Manage Invoice",eventAction:"Include file with invoice",eventLabel:"File included from list in "+r+" "+o})}}}else n.getTarget("a.file-context-menu-delete")?i.showDeleteButtons(n.getTarget("a.file-context-menu-delete"),t,e,a,n):n.getTarget("li.add-tags")?i.onAddTagsClick(t,e,a,n.getTarget("li.force")):n.getTarget("a.x-delete")?i.showDeleteButtons(n.getTarget("a.x-delete"),t,e,a):i.fireEvent("rowclick",i,a)},showContextMenu:function(t,e,n,i,a){var o="div.file-context-menu";Ext.select(o).removeClass("current-menu"),Ext.fly(e).child(o).addClass("current-menu"),Ext.select("div.file-context-menu:not(.current-menu)").setVisibilityMode(Ext.Element.DISPLAY).hide(),Ext.fly(e).child(o).setVisibilityMode(Ext.Element.DISPLAY).toggle().setXY([a.xy[0]-100,a.xy[1]+10])},showDeleteButtons:function(t,e,n,i,a){Ext.fly(e).child("div.file-context-menu")&&Ext.fly(e).child("div.file-context-menu").setVisibilityMode(Ext.Element.DISPLAY).hide(),Ext.fly(e).toggleClass("x-row-indeletion"),Ext.fly(e).child("div.file-delete-buttons").setVisibilityMode(Ext.Element.DISPLAY).toggle()},onAddTagsClick:function(t,e,n,i){var a=this;if(i)return void a.showTagsEditor(n);null!=n.get("tags")&&0!=n.get("tags").length?a.toggleTagsView(n):a.showTagsEditor(n)},toggleTagsView:function(t,e){var n=this,i=Ext.fly(n.getNode(t)).select("ul.tag-list").first();e&&i.isVisible()||i.setVisibilityMode(Ext.Element.DISPLAY)[i.isVisible()?"slideOut":"slideIn"]("t",{easing:"easeOut",duration:.3,remove:!1,useDisplay:!0})},showTagsEditor:function(t){var e=this,n=t.get("tags");n||(n=[]),new Ext.ux.TagsEditor({tags:n,listeners:{savetags:function(n,i,a){t.set("tags",i.getRange().map(function(t){return t.data})),Ext.defer(function(){e.toggleTagsView(t)},50)}}}).show()}}),Ext.define("XERO.docs.attachments.DeleteFileToolbar",{extend:"Ext.Tip",width:350,autoHide:!1,closable:!1,border:!1,shadow:!1,floating:{shadow:!1,shim:!0,useDisplay:!0,constrain:!1},cls:"file-attachments delete-files",initComponent:function(){var t=this;Ext.apply(t,{items:[{xtype:"button",text:"Delete",cls:"red delete-file",width:85},{xtype:"button",text:"Remove from invoice",cls:"red-text delete-attachment"}]}),t.callParent(arguments)},showBy:function(t){var e=this;e.showAt([-1e3,-1e3]),e.showAt(e.el.getAlignToXY(t,"r-l?",[-5,0]))}})},function(t,e){Ext.define("XERO.docs.attachments.ErrorMessage",{extend:"Ext.Component",closable:!0,type:"error",initComponent:function(){var t=this;t.data={type:t.type||"message",title:t.title||null,msg:t.msg||"",closable:t.closable},Ext.apply(t,{tpl:new Ext.XTemplate('<div class="x-msg {[this.getMessageCls(values.type)]} x-alert x-alert-{type}">','<tpl if="closable"><a class="x-close" data-dismiss="alert"></a></tpl>','<tpl if="title"><strong>{title}</strong> </tpl>',"<span>{msg}</span>","</div>",{compiled:!0,getMessageCls:function(t){switch(t){case"error":return"red";case"success":return"green";case"message":return"orange";case"info":return"blue"}return""}})}),t.callParent(arguments),t.on("afterrender",function(e){t.getEl().on("click",function(e){e.getTarget("a.x-close")&&(e.stopEvent(),t.hide())})})},show:function(t){var e=this,n=e.getEl(),i=n.child("span");Ext.isEmpty(t)||i.update(t),this.callParent(arguments)}}),Ext.define("XERO.docs.attachments.FileListWindow",{extend:"Ext.Tip",width:500,autoHide:!1,closable:!1,border:!1,shadow:!1,floating:{shadow:!1,shim:!0,useDisplay:!0,constrain:!1},uploadManager:null,fileListAlignTo:"right",fileListOffset:[-31,10],fileListArrow:"center",initComponent:function(t){var e=this;e.canSend=e.canSend||!1,e.fileList=new XERO.docs.attachments.FileList({uploadManager:e.uploadManager,parentType:e.parentType,store:e.store,canSend:e.canSend});var n=["callout","border-callout","file-attachments"];0===e.store.getCount()&&n.push("no-files"),e.cls=n.join(" "),e.errorPanel=new XERO.docs.attachments.ErrorMessage({hidden:!0,closable:!0,msg:'Sorry, the file you have tried to upload is not supported. <br/><a href="http://help.xero.com/" target="_blank">Read more</a>'}),Ext.apply(e,{title:!1===e.canSend?"Related Files ":"",items:[e.errorPanel,e.fileList],listeners:{afterrender:function(t){var n=t.getEl().query(".upload-files");n&&n.length>0&&e.uploadManager.setBrowseButton(n[0])},render:function(t){var n=t.getEl();n.createChild({tag:"b",cls:"border-notch notch "+e.fileListArrow},n.last()),n.createChild({tag:"b",cls:"notch "+e.fileListArrow},n.last())}},buttonAlign:"center",fbar:!0===e.store.isInRole("ROLE/READONLY")||!1===e.store.hasUploadFiles?null:new Ext.Toolbar({buttonAlign:"center",cls:"file-attachments-buttons",items:[{text:"+ Add from file library...",width:"100%",cls:"btn-left",listeners:{click:function(){var t="";if(window.Invoice){var n=window.Invoice.InvoiceTypeCode||window.Invoice.invoiceTypeCode;""!==n&&(t=e.createEventLabel(n))}window.ga&&"function"==typeof window.ga&&window.ga("send",{hitType:"event",eventCategory:"Text Button",eventAction:"Attach",eventLabel:"Attach file "+t}),e.fireEvent("addfromlibraryclick",e)}}},{text:"+ Upload files...",width:"100%",cls:"btn-right upload-files",listeners:{click:function(){var t="";if(window.Invoice){var n=window.Invoice.InvoiceTypeCode||window.Invoice.invoiceTypeCode;""!==n&&(t=e.createEventLabel(n))}window.ga&&"function"==typeof window.ga&&window.ga("send",{hitType:"event",eventCategory:"Text Button",eventAction:"Upload",eventLabel:"Upload file "+t})}}}]})}),e.callParent(arguments),e.store.on("update",function(){e.updateTitle(e.store.getCount())}),Ext.EventManager.on(window,"resize",e.realign,e),e.relayEvents(e.fileList,["deletefile","removefile","sendfile","rowclick"])},realign:function(){var t=this;if(t.rendered&&t.isVisible()&&t.currentAnchorEl){var e=t.el.getAlignToXY(t.currentAnchorEl,t.fileListAlignTo,t.fileListOffset);t.setPagePosition(e[0],e[1])}},updateTitle:function(t){this.setTitle(0===t?"No Related Files":"Related Files")},showError:function(t){this.errorPanel.show(t)},showBy:function(t){var e=this;e.showAt([-1e3,-1e3]),e.showAt(e.el.getAlignToXY(t,e.fileListAlignTo,e.fileListOffset)),e.currentAnchorEl=t},createEventLabel:function(t){var e=window.location.pathname;return"from "+(e=""!==t?e.includes("View.aspx")?"view":e.includes("Edit.aspx")?"edit":"":"")+" "+t}})},function(t,e){Ext.QuickTips.init(),Ext.define("Ext.ux.FilePreviewer",{extend:"XERO.Window",width:750,height:625,layout:"card",activeItem:0,cls:"x-popup file-previewer",ddGhost:!1,canDock:!1,docked:!1,getDockingDimensions:function(){return 250},initComponent:function(){var t=this;if(t.tooltips=t.tooltips||{},t.tooltips=Ext.applyIf(t.tooltips,{stretchHorizontally:{text:"Stretch horizontally",cls:"quick-tip"},stretchVertically:{text:"Stretch vertically",cls:"quick-tip"},stretchOptimally:{text:"Stretch optimally",cls:"quick-tip"},zoomIn:{text:"Zoom in",cls:"quick-tip"},zoomOut:{text:"Zoom out",cls:"quick-tip"},rotateClockwise:{text:"Rotate clockwise",cls:"quick-tip"},rotateAntiClockwise:{text:"Rotate anticlockwise",cls:"quick-tip"},save:{text:"Download file",cls:"quick-tip"}}),t.toolsToolbar=new Ext.Toolbar({width:260,cls:"floating-tools",items:[{itemId:"stretch-h",tooltip:t.tooltips.stretchHorizontally,cls:"x-btn-icon resize-horizontal x-btn-group-start",listeners:{click:t.stretchHorizontally,scope:t}},{itemId:"stretch-v",tooltip:t.tooltips.stretchVertically,cls:"x-btn-icon resize-vertical x-btn-group-middle",listeners:{click:t.stretchVertically,scope:t}},{itemId:"stretch-o",tooltip:t.tooltips.stretchOptimally,cls:"x-btn-icon resize-optimal x-btn-group-middle",listeners:{click:t.stretchOptimally,scope:t}},{itemId:"zoom-in",tooltip:t.tooltips.zoomIn,cls:"x-btn-icon zoom-in x-btn-group-middle",listeners:{click:t.zoomIn,scope:t}},{itemId:"zoom-out",tooltip:t.tooltips.zoomOut,cls:"x-btn-icon zoom-out x-btn-group-middle",listeners:{click:t.zoomOut,scope:t}},{itemId:"rotate-c",tooltip:t.tooltips.rotateClockwise,cls:"x-btn-icon rotate-clockwise x-btn-group-middle",listeners:{click:t.rotateClockwise,scope:t}},{itemId:"rotate-ac",tooltip:t.tooltips.rotateAntiClockwise,cls:"x-btn-icon rotate-anticlockwise x-btn-group-middle",listeners:{click:t.rotateAntiClockwise,scope:t}},{itemId:"save",tooltip:t.tooltips.save,cls:"x-btn-icon download x-btn-group-end",listeners:{click:t.downloadFile,scope:t}}]}),Ext.apply(t,{bbar:{items:[{xtype:"tbtext",itemId:"pager-status",style:{padding:"5px"},text:""},{itemId:"download-pdf",cls:"download-pdf",text:"Download",hidden:!0,handler:t.downloadPdf,scope:t},"->",{itemId:"move-prev",cls:"x-btn-icon chevron-left link",hidden:1===t.store.getCount(),handler:t.navigate.createDelegate(t,[-1]),scope:t},{itemId:"move-next",cls:"x-btn-icon chevron-right link",hidden:1===t.store.getCount(),handler:t.navigate.createDelegate(t,[1]),scope:t}]},items:t.getItemsFromStore()}),!0===t.canDock&&Ext.apply(t,{tools:[{id:"minimize",handler:function(){t.fireEvent("toggledocking",t,t.docked)},scope:t}]}),!0===t.docked){var e=Ext.getBody().getSize(),n=(Ext.getBody().getViewSize(),t.getDockingDimensions(t));Ext.apply(t,{draggable:!1,x:0,y:Ext.get("header").getHeight()+60,height:e.height-140,width:n,resizable:!1,minWidth:200,cls:"x-popup file-previewer docked"})}Ext.ux.FilePreviewer.superclass.initComponent.call(this),!0===t.docked&&(t.on("hide",function(){Invoice.windowWidth=null,Invoice.gridWidth=null,t.getDockingDimensions(t,!0)}),Ext.EventManager.on(window,"resize",t.handleWindowResize,t))},getDockYPos:function(){return Ext.get("header").getHeight()+61},removeFile:function(t){var e=this,n=e.getComponentByRecord(t),i=e.getComponent(n);e.items.indexOf(e.layout.activeItem);i&&(e.remove(i),e.doLayout())},onRender:function(){var t=this;Ext.ux.FilePreviewer.superclass.onRender.apply(t,arguments),t.toolsToolbar.render(t.el)},refresh:function(){this.fireEvent("refresh",this,this.docked)},getItemsFromStore:function(){var t=this,e=t.store,n=[],i=0;return e.each(function(a,o){a==t.initialRecord&&(i=o),n.push(t.createPreviewComponent(e,a,o))},t),t.activeItem=i||0,t.activeItemIndex=i||0,n},createPreviewComponent:function(t,e,n){var i=this;return new Ext.ux.PreviewComponent({record:e,listeners:{activate:function(a){i.setTitle(Ext.util.Format.ellipsis(Ext.util.Format.htmlEncode(e.get("name")),70)),i.bottomToolbar.getComponent("pager-status").setText(String.format("Previewing {0} of {1}",n+1,t.getCount())),i.bottomToolbar.getComponent("download-pdf")["PDF"==e.get("mediaType")?"show":"hide"](),i.toolsToolbar["IMAGE"==a.getType()?"show":"hide"](),i.centerImage()}}})},navigate:function(t){var e=this,n=e.items.indexOf(e.layout.activeItem),i=parseInt(n,10)+t;i<0?i=e.items.length-1:i==e.items.length&&(i=0),e.layout.setActiveItem(i),e.activeItemIndex=i},goToRecord:function(t){var e=this,n=e.getComponentByRecord(t);-1===n&&(n=0),e.layout.setActiveItem(n),e.activeItemIndex=n},getComponentByRecord:function(t){var e=this,n=e.items.getCount(),i=0;for(i;i<n;i++)if(e.getComponent(i).record==t)return i;return-1},downloadPdf:function(t,e){var n=this;if(n.rendered&&n.layout&&n.layout.activeItem&&n.layout.activeItem.rendered&&n.layout.activeItem.record){var i=n.layout.activeItem.record;t.setText("Downloading"),location.href=Ext.String.format("/docs/docs/downloadfile?fileId={0}",i.get("id")),Ext.defer(function(){t.setText("Download")},2500)}},onLayout:function(){var t=this;Ext.ux.FilePreviewer.superclass.onLayout.call(t),t.rendered&&t.layout&&t.layout.activeItem&&t.layout.activeItem.rendered&&"IMAGE"==t.layout.activeItem.getType()&&t.centerImage()},centerImage:function(){this.layout.activeItem.centerImage.apply(this.layout.activeItem,arguments)},stretchHorizontally:function(){this.layout.activeItem.stretchHorizontally.apply(this.layout.activeItem,arguments)},stretchOptimally:function(){this.layout.activeItem.stretchOptimally.apply(this.layout.activeItem,arguments)},stretchVertically:function(){this.layout.activeItem.stretchVertically.apply(this.layout.activeItem,arguments)},zoomOut:function(){this.layout.activeItem.zoomOut.apply(this.layout.activeItem,arguments)},zoomIn:function(){this.layout.activeItem.zoomIn.apply(this.layout.activeItem,arguments)},rotateClockwise:function(){this.layout.activeItem.rotateClockwise.apply(this.layout.activeItem,arguments)},rotateAntiClockwise:function(){this.layout.activeItem.rotateAntiClockwise.apply(this.layout.activeItem,arguments)},downloadFile:function(){this.layout.activeItem.downloadFile.apply(this.layout.activeItem,arguments)},handleWindowResize:function(){var t=this;t.isDestroyed||!0!==t.docked||(width=t.getDockingDimensions(t),width>=200&&t.setWidth(width),t.setHeight(Ext.getBody().getSize().height-140))},onDestroy:function(){Ext.EventManager.removeListener(window,"resize",this.handleWindowResize,this),Ext.ux.FilePreviewer.superclass.onDestroy.call(this)}}),Ext.ux.PreviewComponent=Ext.extend(Ext.Container,{style:{width:"100%",height:"100%",backgroundColor:"#FAFBFB",overflow:"inherit",padding:"10px"},initComponent:function(){var t=this;Ext.apply(t,{items:{xtype:"box",itemId:"preview-splash",data:t.record.data,style:{width:"100%",height:"100%"},tpl:new Ext.XTemplate('<div class="file-list-details" style="height:100%">','<div class="preview-placeholder" style="height:100%">','<div class="mime-type-54x54 {[this.getMimeTypeClass(values)]}">&nbsp;</div>',"<div>","<h5>{name:htmlEncode}</h5>","<h6>{size:fileSize}</h6>","</div>","<div>",'<a class="download-file" href="#">Download</a>',"</div>","</div>","</div>",{compiled:!0,getMimeTypeClass:function(t){return Ext.util.Mime.getTypeCategory(Ext.util.Mime.normalized(t.mimeType,t.name))},getMimeTypeImage:function(t){return t.previewUrl?t.previewUrl:String.format("/common/images/docs/types/43x51/{0}.gif",Ext.util.Mime.normalized(t.mimeType,t.name))}}),listeners:{render:function(){this.getEl()&&this.getEl().on("click",function(e){var n=e.getTarget("a.download-file");n&&t.record&&(Ext.fly(n).update("Downloading"),location.href=String.format("/docs/docs/downloadfile?fileId={0}",t.record.get("id")),Ext.defer(function(){Ext.fly(n).update("Download")},2500)),e.stopEvent()})}}}}),Ext.ux.PreviewComponent.superclass.initComponent.call(t),t.on("activate",t.onActivate,t)},onActivate:function(){var t=this,e=t.record;"IMAGE"!=e.get("mediaType")||t.imageViewer?!0!==Ext.supports.Pdf&&!0!==Ext.isSafari&&!0!==Ext.isGecko||"PDF"!=e.get("mediaType")||t.pdfViewer||t.addPdfViewer():t.addImageViewer()},addImageViewer:function(){var t=this,e=t.record;t.removeAll(),t.imageViewer=new Ext.ux.ImageViewerComponent({src:String.format("/docs/docs/getfile?fileId={0}",e.get("id"))}),t.add(t.imageViewer)},addPdfViewer:function(){var t=this,e=t.record;!0===Ext.isSafari||!0===Ext.isGecko?Ext.Ajax.request({url:String.format("/docs/docs/getfileurl?fileId={0}",e.get("id")),method:"GET",callback:function(e,n,i){var a=Ext.decode(i.responseText);t.removeAll(),t.pdfViewer=new Ext.ux.PdfViewerComponent({style:{width:"100%",height:"100%"},src:a.url}),t.add(t.pdfViewer),t.doLayout()}}):(t.removeAll(),t.pdfViewer=new Ext.ux.PdfViewerComponent({style:{width:"100%",height:"100%"},src:String.format("/docs/docs/getfile?fileId={0}",e.get("id"))}),t.add(t.pdfViewer))},getType:function(){return this.record.get("mediaType")},downloadFile:function(t){t.getEl().addClass("downloading"),location.href=String.format("/docs/docs/downloadfile?fileId={0}",this.record.get("id")),Ext.defer(function(){t.getEl().removeClass("downloading")},2500)},centerImage:function(){var t=this;t.imageViewer&&(t.imageViewer.centerImage.apply(t.imageViewer,arguments),t.imageViewer.getImageContainer().getComponent("image").getHeight()<=6&&t.imageViewer.stretchOptimally())},stretchHorizontally:function(){var t=this;t.imageViewer&&t.imageViewer.stretchHorizontally.apply(t.imageViewer,arguments)},stretchOptimally:function(){var t=this;t.imageViewer&&t.imageViewer.stretchOptimally.apply(t.imageViewer,arguments)},stretchVertically:function(){var t=this;t.imageViewer&&t.imageViewer.stretchVertically.apply(t.imageViewer,arguments)},zoomOut:function(){var t=this;t.imageViewer&&t.imageViewer.zoomOut.apply(t.imageViewer,arguments)},zoomIn:function(){var t=this;t.imageViewer&&t.imageViewer.zoomIn.apply(t.imageViewer,arguments)},rotateClockwise:function(){var t=this;t.imageViewer&&t.imageViewer.rotateClockwise.apply(t.imageViewer,arguments)},rotateAntiClockwise:function(){var t=this;t.imageViewer&&t.imageViewer.rotateAntiClockwise.apply(t.imageViewer,arguments)}}),Ext.define("Ext.ux.PdfViewerComponent",{extend:"Ext.Container",initComponent:function(){var t=this;Ext.apply(t,{items:{xtype:"box",autoEl:{tag:"div",cls:"x-media x-media-pdf-frame",style:"height: 100%; width: 100%; border: none",children:[{tag:"embed",width:"100%",height:"100%",name:"plugin",src:t.src,type:"application/pdf"}]}}}),t.callParent(arguments)}}),Ext.ux.ImageViewerComponent=Ext.extend(Ext.Container,{style:{width:"100%",height:"100%"},isMoving:!1,imageWidth:null,imageHeight:null,originalImageWidth:null,originalImageHeight:null,clickX:null,clickY:null,lastMarginX:null,lastMarginY:null,rotation:0,imageOffset:30,initComponent:function(){var t=this;Ext.apply(t,{items:[{xtype:"container",itemId:"imagecontainer",cls:"image-previewer",style:{width:"100%",height:"100%",overflow:"hidden",backgroundColor:"#FAFBFB",padding:"10px",cursor:"move"},items:{xtype:"box",itemId:"image",autoEl:{tag:"img",src:"/common/images/ext-img/s.gif",cls:"preview-loading"},listeners:{render:function(e){t.centerImage(),e.el.dom.src=t.src,e.el.dom.onload=function(){e.el.removeClass("preview-loading"),t.setRotation(0),t.rotateImage(),t.setOriginalImageWidth(e.el.dom.width),t.setOriginalImageHeight(e.el.dom.height),t.setImageWidth(e.el.dom.width),t.setImageHeight(e.el.dom.height),t.stretchOptimally(),t.initEvents()}}}}}]}),Ext.ux.ImageViewerComponent.superclass.initComponent.call(this)},stretchHorizontally:function(){var t=this,e=t.getImageContainer().getWidth();t.setImageSize({width:e-60,height:t.getOriginalImageHeight()*(e-60)/t.getOriginalImageWidth()}),t.centerImage()},stretchVertically:function(){var t=this,e=t.getImageContainer().getHeight();t.setImageSize({width:t.getOriginalImageWidth()*(e-60)/t.getOriginalImageHeight(),height:e-60}),t.centerImage()},stretchOptimally:function(){var t=this,e=t.getImageContainer(),n=t.getAdjustedImageSize();n.width*e.getHeight()/n.height>e.getWidth()?t.stretchHorizontally():t.stretchVertically()},centerImage:function(){var t=this,e=t.getImageContainer(),n=t.getAdjustedImageSize();t.setMargins({top:(e.getHeight()-n.height-40)/2,left:(e.getWidth()-n.width-40)/2})},initEvents:function(){var t=this;t.mon(t.getImageContainer().getEl(),{mouseup:t.mouseup,mousedown:t.mousedown,mousemove:t.mousemove,scope:t})},mousedown:function(t){var e=this,n=e.getMargins();t.stopEvent(),e.setClickX(t.getPageX()),e.setClickY(t.getPageY()),e.setLastMarginY(n.top),e.setLastMarginX(n.left),e.setIsMoving(!0)},mousemove:function(t){var e=this;e.getIsMoving()&&e.setMargins({top:e.getLastMarginY()-e.getClickY()+t.getPageY(),left:e.getLastMarginX()-e.getClickX()+t.getPageX()})},mouseup:function(){var t=this;t.getIsMoving()&&(t.setClickX(null),t.setClickY(null),t.setLastMarginX(null),t.setLastMarginY(null),t.setIsMoving(!1))},zoomOut:function(t,e){var n=this,i=n.getMargins(),a=n.getAdjustedImageSize();n.setMargins({top:i.top+.05*a.height,left:i.left+.05*a.width}),n.setImageSize({width:.9*a.width,height:n.getOriginalImageHeight()*a.width*.9/n.getOriginalImageWidth()}),e.stopEvent(),n.doLayout()},zoomIn:function(t,e){var n=this,i=n.getMargins(),a=n.getAdjustedImageSize();n.setMargins({top:i.top-.05*a.height,left:i.left-.05*a.width}),n.setImageSize({width:1.1*a.width,height:n.getOriginalImageHeight()*a.width*1.1/n.getOriginalImageWidth()}),e.stopEvent(),n.doLayout()},rotateClockwise:function(){var t=this,e=t.getRotation();e+=90,e>360&&(e-=360),t.setRotation(e),t.rotateImage()},rotateAntiClockwise:function(){var t=this,e=t.getRotation();e-=90,e<0&&(e+=360),t.setRotation(e),t.rotateImage()},rotateImage:function(){var t,e=this,n="rotate("+e.getRotation()+"deg)";t=e.getOriginalImageWidth(),e.setOriginalImageWidth(e.getOriginalImageHeight()),e.setOriginalImageHeight(t),e.getImage().getEl().applyStyles({transform:n,"-o-transform":n,"-ms-transform":n,"-moz-transform":n,"-webkit-transform":n}),e.setMargins(e.getMargins())},setMargins:function(t){var e=this,n=e.getRotation(),i=e.getAdjustedImageSize(),a=e.getImageContainer(),o=a.getWidth(),r=a.getHeight();if(i.width>o-e.imageOffset?t.left>0?t.left=0:t.left<o-i.width-e.imageOffset&&(t.left=o-i.width-e.imageOffset):t.left<0?t.left=0:t.left>o-i.width-e.imageOffset&&(t.left=o-i.width-e.imageOffset),i.height>r-e.imageOffset?t.top>0?t.top=0:t.top<r-i.height-e.imageOffset&&(t.top=r-i.height-e.imageOffset):t.top<0?t.top=0:t.top>r-i.height-e.imageOffset&&(t.top=r-i.height-e.imageOffset),90===n||270===n){var s=(e.getImageHeight()-e.getImageWidth())/2;t.top=t.top-s,t.left=t.left+s}e.getImage().getEl().setStyle("margin-left",t.left+"px"),e.getImage().getEl().setStyle("margin-top",t.top+"px")},getMargins:function(){var t=this,e=t.getRotation(),n=t.getImage().getEl(),i={top:parseInt(n.getStyle("margin-top"),10),left:parseInt(n.getStyle("margin-left"),10)};if(90===e||270===e){var a=(t.getImageHeight()-t.getImageWidth())/2;i.top=i.top+a,i.left=i.left-a}return i},getAdjustedImageSize:function(){var t=this,e=t.getRotation();return 90===e||270===e?{width:t.getImageHeight(),height:t.getImageWidth()}:{width:t.getImageWidth(),height:t.getImageHeight()}},setImageSize:function(t){var e=this,n=e.getRotation();90===n||270===n?(e.setImageWidth(t.height),e.setImageHeight(t.width)):(e.setImageWidth(t.width),e.setImageHeight(t.height))},applyImageWidth:function(t){return this.getImage().setWidth(t),t},applyImageHeight:function(t){return this.getImage().setHeight(t),t},getImage:function(){return this.getImageContainer().getComponent("image")},getImageContainer:function(){return this.getComponent("imagecontainer")},setIsMoving:function(t){this.isMoving=t},getIsMoving:function(){return this.isMoving},setImageHeight:function(t){this.imageHeight=t,this.applyImageHeight(t)},getImageHeight:function(){return this.imageHeight},setImageWidth:function(t){this.imageWidth=t,this.applyImageWidth(t)},getImageWidth:function(){return this.imageWidth},setOriginalImageWidth:function(t){this.originalImageWidth=t},getOriginalImageWidth:function(){return this.originalImageWidth},setOriginalImageHeight:function(t){this.originalImageHeight=t},getOriginalImageHeight:function(){return this.originalImageHeight},setClickX:function(t){this.clickX=t},getClickX:function(){return this.clickX},setClickY:function(t){this.clickY=t},getClickY:function(){return this.clickY},setLastMarginX:function(t){this.lastMarginX=t},getLastMarginX:function(){return this.lastMarginX},setLastMarginY:function(t){this.lastMarginY=t},getLastMarginY:function(){return this.lastMarginY},setRotation:function(t){this.rotation=t},getRotation:function(){return this.rotation}})},function(t,e){Ext.namespace("Ext.ux.form"),Ext.ux.form.SuperBoxSelect=function(t){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,t),this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear")},Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:!1,allowAddNewData:!1,allowQueryAll:!0,backspaceDeletesLastItem:!0,classField:null,clearBtnCls:"",clearLastQueryOnEscape:!1,clearOnEscape:!1,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:!0,forceFormValue:!0,forceSameValueQuery:!1,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:!0,pinList:!0,preventDuplicates:!0,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:!0,renderFieldBtns:!0,showTagsInCombo:!1,stackItems:!1,styleField:null,supressClearValueRemoveEvents:!1,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(!1),usedRecords:new Ext.util.MixedCollection(!1),addedRecords:[],remoteLookup:[],hideTrigger:!0,grow:!1,resizable:!1,multiSelectMode:!1,preRenderValue:null,filteredQueryData:""}),this.queryFilterRe&&Ext.isString(this.queryFilterRe)&&(this.queryFilterRe=new RegExp(this.queryFilterRe)),this.transform&&this.doTransform(),this.forceFormValue&&this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this}),Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this),"remote"===this.mode&&this.store&&this.store.on("load",this.onStoreLoad,this)},onRender:function(t,e){var n=this.hiddenName;this.hiddenName=null,Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,t,e),this.hiddenName=n,this.manageNameAttribute();var i=!0===this.stackItems?"x-superboxselect-stacked":"";this.renderFieldBtns&&(i+=" x-superboxselect-display-btns"),this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field"),this.wrapEl=this.el.wrap({tag:"ul"}),this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+i}),this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"}),this.renderFieldBtns&&this.setupFieldButtons().manageClearBtn(),this.setupFormInterception()},doTransform:function(){var t=Ext.getDom(this.transform),e=[];if(!this.store){this.mode="local";for(var n=[],i=t.options,a=0,o=i.length;a<o;a++){var r=i[a],s=Ext.get(r),l=s.getAttributeNS(null,"value")||"",u=s.getAttributeNS(null,"className")||"",c=s.getAttributeNS(null,"style")||"";r.selected&&e.push(l),n.push([l,r.text,u,"string"==typeof c?c:c.cssText])}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:n}),Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"})}e.length&&(this.value=e.join(","))},setupFieldButtons:function(){return this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"}),this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls}),this.allowQueryAll&&(this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls})),this.initButtonEvents(),this},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(t){t.stopEvent(),this.disabled||(this.clearValue(),this.el.focus())},this),this.allowQueryAll&&this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(t){t.stopEvent(),this.disabled||(this.isExpanded()?this.multiSelectMode=!1:this.pinList&&(this.multiSelectMode=!0),this.onTriggerClick())},this)},removeButtonEvents:function(){return this.buttonClear.removeAllListeners(),this.allowQueryAll&&this.buttonExpand.removeAllListeners(),this},clearCurrentFocus:function(){return this.currentFocus&&(this.currentFocus.onLnkBlur(),this.currentFocus=null),this},initEvents:function(){var t=this.el;t.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this}),this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this}),this.wrapEl.on("click",this.onWrapClick,this),this.outerWrapEl.on("click",this.onWrapClick,this),this.inputEl.focus=function(){t.focus()},Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this),Ext.apply(this.keyNav,{tab:function(e){return this.fixFocusOnTabSelect&&this.isExpanded()?(e.stopEvent(),t.blur(),this.onViewClick(!1),this.focus(!1,10),!0):(this.onViewClick(!1),""!==t.dom.value&&this.setRawValue(""),!0)},down:function(t){this.isExpanded()||this.currentFocus?(this.inKeyMode=!0,this.selectNext()):this.allowQueryAll&&this.onTriggerClick()},enter:function(){}})},onClick:function(){this.clearCurrentFocus(),this.collapse(),this.autoSize()},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var t=this.el.dom.value;""!==t&&this.fireNewItemEvent(t)}Ext.form.ComboBox.superclass.beforeBlur.call(this)},onFocus:function(){this.outerWrapEl.addClass(this.focusClass),Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass),this.clearCurrentFocus(),""!==this.el.dom.value&&(this.applyEmptyText(),this.autoSize()),Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections(),this.multiSelectMode=!1},onWrapClick:function(t){t.stopEvent(),this.collapse(),this.el.focus(),this.clearCurrentFocus()},markInvalid:function(t){var e,n;if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.addClass(this.invalidClass),t=t||this.invalidText,this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:t,qclass:"x-form-invalid-tip"}),Ext.apply(this.wrapEl.dom,{qtip:t,qclass:"x-form-invalid-tip"}),Ext.QuickTips&&Ext.QuickTips.enable();break;case"title":this.el.dom.title=t,this.wrapEl.dom.title=t,this.outerWrapEl.dom.title=t;break;case"under":if(!this.errorEl){if(!(e=this.getErrorCt())){this.el.dom.title=t;break}this.errorEl=e.createChild({cls:"x-form-invalid-msg"}),this.errorEl.setWidth(e.getWidth(!0)-20)}this.errorEl.update(t),Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){if(!(e=this.getErrorCt())){this.el.dom.title=t;break}this.errorIcon=e.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon(),Ext.apply(this.errorIcon.dom,{qtip:t,qclass:"x-form-invalid-tip"}),this.errorIcon.show(),this.on("resize",this.alignErrorIcon,this);break;default:n=Ext.getDom(this.msgTarget),n.innerHTML=t,n.style.display=this.msgDisplay}this.fireEvent("invalid",this,t)}},clearInvalid:function(){if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.removeClass(this.invalidClass),this.msgTarget){case"qtip":this.el.dom.qtip="",this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="",this.wrapEl.dom.title="",this.outerWrapEl.dom.title="";break;case"under":this.errorEl&&Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);break;case"side":this.errorIcon&&(this.errorIcon.dom.qtip="",this.errorIcon.hide(),this.un("resize",this.alignErrorIcon,this));break;default:var t=Ext.getDom(this.msgTarget);t.innerHTML="",t.style.display="none"}this.fireEvent("valid",this)}},alignErrorIcon:function(){this.wrap&&this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])},expand:function(){!this.isExpanded()&&this.hasFocus&&(this.bufferSize&&(this.doResize(this.bufferSize),delete this.bufferSize),this.list.alignTo(this.outerWrapEl,this.listAlign).show(),this.innerList.setOverflow("auto"),this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf}),this.fireEvent("expand",this))},restrictHeight:function(){var t=this.innerList.dom,e=t.scrollTop,n=this.list;t.style.height="";var i=n.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,a=Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight),o=this.getPosition()[1]-Ext.getBody().getScroll().top,r=Ext.lib.Dom.getViewHeight()-o-this.getSize().height,s=Math.max(o,r,this.minHeight||0)-n.shadowOffset-i-5;a=Math.min(a,s,this.maxHeight),this.innerList.setHeight(a),n.beginUpdate(),n.setHeight(a+i),n.alignTo(this.outerWrapEl,this.listAlign),n.endUpdate(),this.multiSelectMode&&(t.scrollTop=e)},validateValue:function(t){return 0===this.items.getCount()?this.allowBlank?(this.clearInvalid(),!0):(this.markInvalid(this.blankText),!1):(this.clearInvalid(),!0)},manageNameAttribute:function(){0===this.items.getCount()&&this.forceFormValue?this.el.dom.setAttribute("name",this.hiddenName||this.name):this.el.dom.removeAttribute("name")},setupFormInterception:function(){var t;if(this.findParentBy(function(e){e.getForm&&(t=e.getForm())}),t){var e=t.getValues;t.getValues=function(n){this.el.dom.disabled=!0;var i=this.el.dom.value;this.setRawValue("");var a=e.call(t);return this.el.dom.disabled=!1,this.setRawValue(i),this.forceFormValue&&0===this.items.getCount()&&(a[this.name]=""),n?Ext.urlEncode(a):a}.createDelegate(this)}},onResize:function(t,e,n,i){var a=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;this.wrapEl&&(this._width=t,this.outerWrapEl.setWidth(t-a),this.renderFieldBtns&&(a+=this.buttonWrap.getWidth()+20,this.wrapEl.setWidth(t-a))),Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,t,e,n,i),this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this),this.items.each(function(t){t.enable()}),this.renderFieldBtns&&this.initButtonEvents()},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this),this.items.each(function(t){t.disable()}),this.renderFieldBtns&&this.removeButtonEvents()},clearValue:function(t){return Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this),this.preventMultipleRemoveEvents=t||this.supressClearValueRemoveEvents||!1,this.removeAllItems(),this.preventMultipleRemoveEvents=!1,this.fireEvent("clear",this),this},fireNewItemEvent:function(t){this.view.clearSelections(),this.collapse(),this.setRawValue(""),this.queryFilterRe&&!(t=t.replace(this.queryFilterRe,""))||this.fireEvent("newitem",this,t,this.filteredQueryData)},onKeyUp:function(t){!1===this.editable||t.isSpecialKey()&&t.getKey()!==t.BACKSPACE||this.itemDelimiterKey.indexOf===t.getKey()||t.hasModifier()&&!t.shiftKey||(this.lastKey=t.getKey(),this.dqTask.delay(this.queryDelay))},onKeyDownHandler:function(t,e){var n,i,a;if(t.getKey()===t.ESC&&(this.isExpanded()||""!=this.el.dom.value&&(this.clearOnEscape||this.clearLastQueryOnEscape)&&(this.clearOnEscape&&(this.el.dom.value=""),this.clearLastQueryOnEscape&&(this.lastQuery=""),t.stopEvent())),(t.getKey()===t.DELETE||t.getKey()===t.SPACE)&&this.currentFocus)return t.stopEvent(),n=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),a=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),a<this.items.getCount()-1&&(i=this.items.itemAt(a+1)),n.preDestroy(!0),i&&function(){i.onLnkFocus(),this.currentFocus=i}.defer(200,this),!0;var o,r=this.el.dom.value,s=t.ctrlKey;if(this.itemDelimiterKey===t.getKey()){if(t.stopEvent(),""!==r)s||!this.isExpanded()?this.fireNewItemEvent(r):(this.onViewClick(),this.unsetDelayCheck&&(this.delayedCheck=!0,this.unsetDelayCheck.defer(10,this)));else{if(!this.isExpanded())return;this.onViewClick(),this.unsetDelayCheck&&(this.delayedCheck=!0,this.unsetDelayCheck.defer(10,this))}return!0}return""!==r?void this.autoSize():t.getKey()===t.HOME?(t.stopEvent(),this.items.getCount()>0&&(this.collapse(),o=this.items.get(0),o.el.focus()),!0):t.getKey()===t.BACKSPACE?(t.stopEvent(),this.currentFocus?(n=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),a=this.items.indexOfKey(n.key),this.clearCurrentFocus(),a<this.items.getCount()-1&&(i=this.items.itemAt(a+1)),n.preDestroy(!0),void(i&&function(){i.onLnkFocus(),this.currentFocus=i}.defer(200,this))):(o=this.items.get(this.items.getCount()-1),o&&(this.backspaceDeletesLastItem?(this.on("expand",function(){this.collapse()},this,{single:!0}),o.preDestroy(!0)):this.navigateItemsWithTab?o.onElClick():this.on("expand",function(){this.collapse(),this.currentFocus=o,this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:!0})),!0)):t.isNavKeyPress()?t.getKey()===t.LEFT||t.getKey()===t.UP&&!this.isExpanded()?(t.stopEvent(),this.collapse(),o=this.items.get(this.items.getCount()-1),this.navigateItemsWithTab?o&&o.focus():this.currentFocus?(a=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),0!==a&&(this.currentFocus=this.items.itemAt(a-1),this.currentFocus.onLnkFocus())):(this.currentFocus=o,o&&o.onLnkFocus()),!0):t.getKey()===t.DOWN&&this.currentFocus?(this.collapse(),t.stopEvent(),a=this.items.indexOfKey(this.currentFocus.key),a==this.items.getCount()-1?this.clearCurrentFocus.defer(10,this):(this.clearCurrentFocus(),this.currentFocus=this.items.itemAt(a+1),this.currentFocus&&this.currentFocus.onLnkFocus()),!0):void(t.getKey()===t.RIGHT&&(this.collapse(),o=this.items.itemAt(0),this.navigateItemsWithTab?o&&o.focus():this.currentFocus?(a=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),a<this.items.getCount()-1&&(this.currentFocus=this.items.itemAt(a+1),this.currentFocus&&this.currentFocus.onLnkFocus())):(this.currentFocus=o,o&&o.onLnkFocus()))):(this.multiSelectMode=!1,void this.clearCurrentFocus())},onKeyUpBuffered:function(t){t.isNavKeyPress()||this.autoSize()},reset:function(){this.killItems(),Ext.ux.form.SuperBoxSelect.superclass.reset.call(this),this.addedRecords=[],this.autoSize().setRawValue("")},applyEmptyText:function(){return this.setRawValue(""),this.items.getCount()>0?(this.el.removeClass(this.emptyClass),this.setRawValue(""),this):(this.rendered&&this.emptyText&&this.getRawValue().length<1&&(this.setRawValue(this.emptyText),this.el.addClass(this.emptyClass)),this)},removeAllItems:function(){return this.items.each(function(t){t.preDestroy(!0)},this),this.manageClearBtn(),this},killItems:function(){return this.items.each(function(t){t.kill()},this),this.resetStore(),this.items.clear(),this.manageClearBtn(),this},resetStore:function(){return this.store.clearFilter(),this.removeValuesFromStore?(this.usedRecords.each(function(t){this.store.add(t)},this),this.usedRecords.clear(),this.store.remoteSort||this.store.sort(this.displayField,"ASC"),this):this},sortStore:function(){var t=this.store.getSortState();return t&&t.field&&this.store.sort(t.field,t.direction),this},getCaption:function(t){"string"==typeof this.displayFieldTpl&&(this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl));var e,n=t instanceof Ext.data.Record?t.data:t;return this.displayFieldTpl?e=this.displayFieldTpl.apply(n):this.displayField&&(e=n[this.displayField]),e},addRecord:function(t){var e=t.data[this.displayField],n=this.getCaption(t),i=t.data[this.valueField],a=this.classField?t.data[this.classField]:"",o=this.styleField?t.data[this.styleField]:"";this.removeValuesFromStore&&(this.usedRecords.add(i,t),this.store.remove(t)),this.showTagsInCombo&&this.addItemBox(i,e,n,a,o),this.fireEvent("additem",this,i,t)},createRecord:function(t){if(!this.recordConstructor){var e=[{name:this.valueField},{name:this.displayField}];this.classField&&e.push({name:this.classField}),this.styleField&&e.push({name:this.styleField}),this.recordConstructor=Ext.data.Record.create(e)}return new this.recordConstructor(t)},addItems:function(t){Ext.isArray(t)?Ext.each(t,function(t){this.addItem(t)},this):this.addItem(t)},addNewItem:function(t){this.addItem(t,!0)},addItem:function(t,e){var n=t[this.valueField];if(this.disabled)return!1;if(!this.preventDuplicates||!this.hasValue(n)){var i=this.findRecord(this.valueField,n);if(i)return void this.addRecord(i);if(this.allowAddNewData){if("remote"===this.mode)return this.remoteLookup.push(t),void this.doQuery(n,!1,!1,e);var a=this.createRecord(t);return this.store.add(a),this.addRecord(a),!0}}},addItemBox:function(t,e,n,i,a){var o,r=Ext.id(null,"sbx-item"),s=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+i,style:function(t){var e="";switch(typeof t){case"function":e=t.call();break;case"object":for(var n in t)e+=n+":"+t[n]+";";break;case"string":e=t+";"}return e}(this.extraItemStyle)+" "+a,caption:n,display:e,value:t,key:r,listeners:{remove:this.onItemRemove,destroy:function(){this.collapse(),this.autoSize().manageClearBtn().validateValue()},scope:this}});s.render(),o={tag:"input",type:"hidden",value:t,name:this.hiddenName||this.name},this.disabled&&Ext.apply(o,{disabled:"disabled"}),s.hidden=this.el.insertSibling(o,"before"),this.items.add(r,s),this.applyEmptyText().autoSize().manageClearBtn().validateValue()},removeItem:function(t){this.onItemRemove({value:t})},onItemRemove:function(t){if(!1===this.fireEvent("beforeremoveitem",this,t.value))return!1;this.items&&this.items.removeKey(t.key),this.removeValuesFromStore&&this.usedRecords.containsKey(t.value)&&(this.store.add(this.usedRecords.get(t.value)),this.usedRecords.removeKey(t.value),this.sortStore(),this.view&&this.view.render()),this.preventMultipleRemoveEvents||this.fireEvent.defer(250,this,["removeitem",this,t.value,this.findInStore(t.value)])},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered)return this;var t="x-superboxselect-btn-hide";return 0===this.items.getCount()?this.buttonClear.addClass(t):this.buttonClear.removeClass(t),this},findInStore:function(t){var e=this.store.find(this.valueField,t);return e>-1&&this.store.getAt(e)},getSelectedRecords:function(){var t=[];if(this.removeValuesFromStore)t=this.usedRecords.getRange();else{var e=[];this.items.each(function(t){e.push(t.value)}),Ext.each(e,function(e){t.push(this.findInStore(e))},this)}return t},findSelectedItem:function(t){var e;return this.items.each(function(n){if(n.el.dom===t)return e=n,!1}),e},findSelectedRecord:function(t){var e,n=this.findSelectedItem(t);return n&&(e=this.findSelectedRecordByValue(n.value)),e},findSelectedRecordByValue:function(t){var e;return this.removeValuesFromStore?this.usedRecords.each(function(n){if(n.get(this.valueField)==t)return e=n,!1},this):e=this.findInStore(t),e},getValue:function(){var t=[];return this.items.each(function(e){t.push(e.value)}),t.join(this.valueDelimiter)},getCount:function(){return this.items.getCount()},getValueEx:function(){var t=[];return this.items.each(function(e){var n={};n[this.valueField]=e.value,n[this.displayField]=e.display,this.classField&&(n[this.classField]=e.cls||""),this.styleField&&(n[this.styleField]=e.style||""),t.push(n)},this),t},initValue:function(){Ext.isObject(this.value)||Ext.isArray(this.value)?(this.setValueEx(this.value),this.originalValue=this.getValue()):Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this),"remote"===this.mode&&(this.setOriginal=!0)},addValue:function(t){if(!Ext.isEmpty(t)){var e=t;if(Ext.isArray(t)||(t=""+t,e=t.split(this.valueDelimiter)),Ext.each(e,function(t){var e=this.findRecord(this.valueField,t);e?this.addRecord(e):"remote"===this.mode&&this.remoteLookup.push(t)},this),"remote"===this.mode){var n=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(n,!1,!0)}}},setValue:function(t){if(!this.rendered)return void(this.value=t);this.removeAllItems().resetStore(),this.remoteLookup=[],this.addValue(t)},setValueEx:function(t){return this.rendered?(this.removeAllItems().resetStore(),Ext.isArray(t)||(t=[t]),this.remoteLookup=[],this.allowAddNewData&&"remote"===this.mode?void Ext.each(t,function(t){var e=this.findRecord(this.valueField,t[this.valueField])||this.createRecord(t);this.addRecord(e)},this):void Ext.each(t,function(t){this.addItem(t)},this)):void(this.value=t)},hasValue:function(t){var e=!1;return this.items.each(function(n){if(n.value==t)return e=!0,!1},this),e},onSelect:function(t,e){if(!1!==this.fireEvent("beforeselect",this,t,e)){var n=t.data[this.valueField];if(this.preventDuplicates&&this.hasValue(n))return;this.setRawValue(""),this.lastSelectionText="",!1!==this.fireEvent("beforeadditem",this,n,t,this.filteredQueryData)&&this.addRecord(t),0!==this.store.getCount()&&this.multiSelectMode?this.restrictHeight():this.collapse()}},onDestroy:function(){this.items.purgeListeners(),this.killItems(),this.allowQueryAll&&Ext.destroy(this.buttonExpand),this.renderFieldBtns&&Ext.destroy(this.buttonClear,this.buttonWrap),Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl),Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered)return this;this.metrics||(this.metrics=Ext.util.TextMetrics.createInstance(this.el));var t=this.el,e=t.dom.value,n=document.createElement("div");""===e&&this.emptyText&&this.items.getCount()<1&&(e=this.emptyText),n.appendChild(document.createTextNode(e)),e=n.innerHTML,n=null,e+="&#160;";var i=Math.max(this.metrics.getWidth(e)+24,24);return void 0!==this._width&&(i=Math.min(this._width,i)),this.el.setWidth(i),Ext.isIE&&(this.el.dom.style.top="0"),this.fireEvent("autosize",this,i),this},shouldQuery:function(t){if(this.lastQuery){var e=t.match("^"+this.lastQuery);return!(e&&!this.store.getCount())||e[0]!==this.lastQuery}return!0},doQuery:function(t,e,n,i){if(t=Ext.isEmpty(t)?"":t,this.queryFilterRe){this.filteredQueryData="";var a=t.match(this.queryFilterRe);if(a&&a.length&&(this.filteredQueryData=a[0]),!(t=t.replace(this.queryFilterRe,""))&&a)return}var o={query:t,forceAll:e,combo:this,cancel:!1};if(!1===this.fireEvent("beforequery",o)||o.cancel)return!1;t=o.query,(!0===(e=o.forceAll)||t.length>=this.minChars||n&&!Ext.isEmpty(t))&&(i||this.forceSameValueQuery||this.shouldQuery(t)?(this.lastQuery=t,"local"==this.mode?(this.selectedIndex=-1,e?this.store.clearFilter():this.store.filter(this.displayField,t),this.onLoad()):(this.store.baseParams[this.queryParam]=t,this.store.baseParams[this.queryValuesIndicator]=n,this.store.load({params:this.getParams(t)}),i||this.expand())):(this.selectedIndex=-1,this.onLoad()))},onStoreLoad:function(t,e,n){var i=n.params[this.queryParam]||t.baseParams[this.queryParam]||"",a=n.params[this.queryValuesIndicator]||t.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore&&this.store.each(function(t){this.usedRecords.containsKey(t.get(this.valueField))&&this.store.remove(t)},this),a){var o=i.split(this.queryValuesDelimiter);Ext.each(o,function(t){this.remoteLookup.remove(t);var e=this.findRecord(this.valueField,t);e&&this.addRecord(e)},this),this.setOriginal&&(this.setOriginal=!1,this.originalValue=this.getValue())}""!==i&&this.allowAddNewData&&Ext.each(this.remoteLookup,function(t){if("object"==typeof t&&t[this.valueField]===i){if(this.remoteLookup.remove(t),e.length&&e[0].get(this.valueField)===i)return void this.addRecord(e[0]);var n=this.createRecord(t);return this.store.add(n),this.addRecord(n),this.addedRecords.push(n),void function(){this.isExpanded()&&this.collapse()}.defer(10,this)}},this);var r=[];if(""===i)Ext.each(this.addedRecords,function(t){this.preventDuplicates&&this.usedRecords.containsKey(t.get(this.valueField))||r.push(t)},this);else{var s=new RegExp(Ext.escapeRe(i)+".*","i");Ext.each(this.addedRecords,function(t){this.preventDuplicates&&this.usedRecords.containsKey(t.get(this.valueField))||s.test(t.get(this.displayField))&&r.push(t)},this)}this.store.add(r),this.sortStore(),0===this.store.getCount()&&this.isExpanded()&&this.collapse()},doOnEnter:function(t){var e=this.el.dom.value;if(""!==e)this.isExpanded()?this.onViewClick():this.fireNewItemEvent(e);else{if(!this.isExpanded())return;this.onViewClick()}return!0}}),Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect),Ext.ux.form.SuperBoxSelectItem=function(t){Ext.apply(this,t),Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)},Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(t){var e=this.owner;e.clearCurrentFocus().collapse(),e.navigateItemsWithTab?this.focus():(e.el.dom.focus(),function(){this.onLnkFocus(),e.currentFocus=this}.defer(10,this))},onLnkClick:function(t){t&&t.stopEvent(),this.preDestroy(),this.owner.navigateItemsWithTab||this.owner.el.focus()},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.removeClass("x-form-focus")},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:!0}),this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover")},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners(),this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners(),this.lnk.un("click",this.onLnkClick,this),this.lnk.un("focus",this.onLnkFocus,this),this.lnk.un("blur",this.onLnkBlur,this)},onRender:function(t,e){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,t,e);var n=this.el;n&&n.remove(),this.el=n=t.createChild({tag:"li"},t.last()),n.addClass("x-superboxselect-item");var i=this.owner.navigateItemsWithTab?Ext.isSafari?"button":"a":"span";Ext.apply(n,{focus:function(){var t=this.down(i+".x-superboxselect-item-close");t&&t.focus()},preDestroy:function(){this.preDestroy()}.createDelegate(this)}),this.enableElListeners(),n.update(this.caption);var a={tag:i,class:"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};"a"===i&&(a.href="#"),this.lnk=n.createChild(a),this.disabled?this.disableAllListeners():this.enableLnkListeners(),this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this}),this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var t=this.owner.items.get(0).el.focus();t&&t.el.focus()},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]),this.keyMap.stopEvent=!0},moveFocus:function(t){var e=this.el["left"==t?"prev":"next"]()||this.owner.el;e.focus.defer(100,e)},preDestroy:function(t){if(!1!==this.fireEvent("remove",this)){var e=function(){this.owner.navigateItemsWithTab&&this.moveFocus("right"),this.hidden.remove(),this.hidden=null,this.destroy()};return t?e.call(this):this.el.hide({duration:.2,callback:e,scope:this}),this}},kill:function(){this.hidden.remove(),this.hidden=null,this.purgeListeners(),this.destroy()},onDisable:function(){this.hidden&&this.hidden.dom.setAttribute("disabled","disabled"),this.keyMap.disable(),Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){this.hidden&&this.hidden.dom.removeAttribute("disabled"),this.keyMap.enable(),Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el),Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}})},function(t,e){Ext.Window.DD=Ext.extend(Ext.dd.DD,{ddGhost:!0,constructor:function(t){this.win=t,this.ddGhost=!1!==this.win.ddGhost,Ext.Window.DD.superclass.constructor.call(this,t.el.id,"WindowDD-"+t.id),this.setHandleElId(t.header.id),this.scroll=!1},moveOnly:!0,headerOffsets:[100,25],startDrag:function(){if(this.ddGhost){var t=this.win;if(this.proxy=t.ghost(t.initialConfig.cls),!1!==t.constrain){var e=t.el.shadowOffset;this.constrainTo(t.container,{right:e,left:e,bottom:e})}else if(!1!==t.constrainHeader){var n=this.proxy.getSize();this.constrainTo(t.container,{right:-(n.width-this.headerOffsets[0]),bottom:-(n.height-this.headerOffsets[1])})}}},b4Drag:Ext.emptyFn,onDrag:function(t){this.alignElWithMouse(this.ddGhost?this.proxy:this.win.getEl(),t.getPageX(),t.getPageY()<20?20:t.getPageY())},endDrag:function(t){this.ddGhost&&(this.win.unghost(),this.win.saveState())}}),Ext.ux.TagsEditor=Ext.extend(Ext.Window,{cls:"x-popup",width:350,modal:!0,shadow:!1,resizable:!1,ddGhost:!1,title:"Add/Edit Tags",deleted:[],initComponent:function(){var t=this,e=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class=" x-superboxselect-item">',"{tag}",'<a href="#" class="x-superboxselect-item-close" tabindex="0" ></a>',"</li>","</tpl>","</ul>");Ext.data.Record.create([{name:"tag"}]);t.tags=t.tags||[],Ext.apply(t,{tagStore:new Ext.data.JsonStore({data:t.tags,fields:["tag"]}),tagComboStore:new Ext.data.JsonStore({proxy:new Ext.data.HttpProxy({url:"/docs/docs/gettags",method:"GET"}),fields:["tag"]})}),Ext.apply(t,{searchCombo:new Ext.ux.form.SuperBoxSelect({store:t.tagComboStore,width:285,allowBlank:!0,allowAddNewData:!0,fieldLabel:"Add or remove tags",name:"tags",anchor:"100%",mode:"remote",displayField:"tag",valueField:"tag",extraItemCls:"x-tag",queryDelay:0,hideTrigger:!0,queryParam:"search",minChars:1,renderFieldBtns:!1,value:t.tags.join(","),supressClearValueRemoveEvents:!0,listeners:{additem:function(e,n){t.addTagRecord(n)},newitem:function(e,n,i){var a={tag:n};e.addNewItem(a),t.addTagRecord(n)}}}),tagsView:new Ext.DataView({cls:"x-superboxselect",store:t.tagStore,tpl:e,boxMinHeight:100,autoHeight:!0,singleSelect:!1,overClass:"x-view-over",itemSelector:"li.x-superboxselect-item",listeners:{click:function(e,n,i,a){if(a.getTarget("a.x-superboxselect-item-close")){var o=t.tagStore.getAt(n);t.tagStore.remove(o),t.searchCombo.removeItem(o.get("tag")),t.deleted.push(o.data)}}}})}),Ext.apply(t,{items:[{xtype:"box",cls:"x-label",html:String.format("Add or remove tags for {0}:",t.tagsFor||"yada")},t.searchCombo,t.tagsView],buttons:[{text:"Save",cls:"green",handler:t.onSave,scope:t},{text:"Cancel",cls:"gray",handler:function(){t.close()}}]}),Ext.ux.TagsEditor.superclass.initComponent.call(this)},onSave:function(){var t=this;t.fireEvent("savetags",t,t.tagStore.data,t.deleted),t.close()},addTagRecord:function(t){var e=this;if(-1==e.tagStore.findExact("tag",t)){var n=new e.tagStore.recordType({tag:t});e.tagStore.add(n,t)}}})},function(t,e){!function(){"use strict";Ext.define("XERO.dashboard.Carousel",{extend:"Ext.Component",bus:null,el:null,focusingEl:null,carouselItemsContainer:null,itemsPerWindow:3,carouselItemTotal:0,carouselPosition:null,carouselItems:null,offsetClsPrefix:"carousel-item-offset-",changeEventDelay:500,carouselItemWidth:310,tpl:new Ext.XTemplate('<div class="carousel-items">','<tpl for=".">','<div class="carousel-item">{Html}</div>',"</tpl>","</div>",{compiled:!0}),constructor:function t(e){this.bus=XERO.bus,this.carouselItems=this.data=e.data,this.carouselItemTotal=this.carouselItems.length,this.callParentStrict(t,arguments)},listeners:{afterrender:function(){this.carouselItemsContainer=this.el.child(".carousel-items"),this.initEvents()}},initEvents:function(){this.el.on("keydown",this.onCarouselKeyDown,this),this.bus.on("carousel:shiftnextpage",this.moveNextPage,this),this.bus.on("carousel:shiftprevpage",this.movePrevPage,this)},onCarouselKeyDown:function(t){t.target===this.el.dom&&t.preventDefault()},movePrevPage:function(){this.setCarouselOffset(Math.max(0,this.carouselPosition-this.itemsPerWindow))},moveNextPage:function(){this.setCarouselOffset(Math.min(this.carouselItemTotal-this.itemsPerWindow,this.carouselPosition+this.itemsPerWindow))},atStart:function(){return 0===this.carouselPosition},atEnd:function(){return this.carouselPosition>=this.carouselItemTotal-this.itemsPerWindow},needToMove:function(t){return null===this.carouselPosition||this.carouselPosition!==t&&t>=0&&t<this.carouselItemTotal-this.itemsPerWindow+1},setCarouselOffset:function(t,e){var n,i;e=void 0!==e?e:this.changeEventDelay,this.needToMove(t)&&(n=this.atStart(),i=this.atEnd(),this.carouselPosition>0&&this.carouselItemsContainer.removeClass(this.offsetClsPrefix+this.carouselPosition),this.carouselPosition=t,t>0&&this.carouselItemsContainer.addClass(this.offsetClsPrefix+t),Ext.defer(function(){this.fireChangeEvents(n,i)},e,this))},canMovePrev:function(){return this.carouselPosition>0},canMoveNext:function(){return this.carouselPosition<this.carouselItemTotal-this.itemsPerWindow},fireChangeEvents:function(t,e){t?this.bus.fireEvent("carousel:movefromstart"):e&&this.bus.fireEvent("carousel:movefromend"),this.atStart()&&this.bus.fireEvent("carousel:movestart"),this.atEnd()&&this.bus.fireEvent("carousel:moveend")}})}()},function(t,e){!function(){"use strict";function t(){return window.localStorage.getItem(a)===o}function e(t){return t?"Show less":"Show more"}function n(t){var e=t?o:r;window.localStorage.setItem(a,e)}function i(t){return t.replace(/(<)br\s*\/*(>)/g," ")}var a="x-dashboard-checklist-status",o="expanded",r="collapsed",s=new Ext.XTemplate('<span class="{[this.getCheckListClasses(values.FlagHasBeenSet, xindex)]}">{[this.getCheckListValue(values.FlagHasBeenSet)]}</span>','<div class="item-checklist-desc">',"{[this.parseBreaks(values.DescriptionHtml)]}","</div>",{compiled:!0,getCheckListClasses:function(t,e){var n="checklist-flag";return n+=t?" checklist-flag-done":" checklist-flag-not-done"},getCheckListValue:function(t){return t?"done":"not done"},parseBreaks:i}),l=new Ext.XTemplate('<div class="checklist-items {[this.getExpandedCls(values.expanded)]}">','<div class="checklist-item item-headline prompt-{values.headlineItem.Key}">','<a href="javascript:void(0)" class="dashboard-prompt-image">{values.headlineItem.Key}</a>','<div class="dashboard-prompt-desc">',"{[this.parseBreaks(values.headlineItem.DescriptionHtml)]}","</div>","</div>",'<tpl for="values.checklist">','<div class="checklist-item item-checkable {[this.getHideableCls(xindex)]}">',"{[this.renderChecklistItem(values)]}","</div>","</tpl>",'<div class="checklist-item checklist-extras {[this.getHideableCls(3)]}">','<h3 class="checklist-extras-heading">More things to do</h3>','<ul class="checklist-extras-list">','<tpl for="values.extras">','<li class="item-extra">{[this.parseBreaks(values.DescriptionHtml)]}</li>',"</tpl>","</ul>","</div>","</div>",'<a href="javascript:void(0)" class="checklist-toggle" >{[this.getExpandedToggleLabel(values.expanded)]}</a>',{compiled:!0,getHideableCls:function(t){return t>2?"checklist-hideable":""},renderChecklistItem:function(t){return s.apply(t)},getExpandedCls:function(t){return t?"":"checklist-collapsed"},getExpandedToggleLabel:e,parseBreaks:i});Ext.define("XERO.dashboard.Checklist",{extend:"Ext.Component",tpl:l,constructor:function e(n){this.expanded=n.data.expanded=t(),this.callParentStrict(e,arguments)},listeners:{afterrender:function(){this.toggleEl=this.el.child(".checklist-toggle"),this.itemsEl=this.el.child(".checklist-items"),this.toggleEl.on("click",this.onToggleClick,this)}},onToggleClick:function(){if(this.expanded){var t=Ext.getBody(),i=this.itemsEl.getHeight(),a=t.getViewSize();this.itemsEl.addClass("checklist-collapsed"),i>a.height&&t.scrollTo("top",this.itemsEl.getTop())}else this.itemsEl.removeClass("checklist-collapsed");this.expanded=!this.expanded,this.toggleEl.dom.innerHTML=e(this.expanded),n(this.expanded)}})}()},function(t,e){!function(){"use strict";function t(t){return t.charCodeAt(t.length-1)%2==0?e:n}var e="carousel",n="checklist",i=new Ext.XTemplate('<a id="dashboardPromptMovePrev" href="#" class="carousel-shifter move-previous shifter-hidden">&nbsp;</a>','<a id="dashboardPromptMoveNext" href="#" class="carousel-shifter move-next shifter-hidden">&nbsp;</a>','<div class="carousel"></div>'),a=new Ext.XTemplate('<div class="dashboard-prompt prompt-{Key}">','<tpl if="values.VideoConfig">','<a href="javascript:void(0)" class="dashboard-prompt-image">{Key}</a>',"</tpl>",'<tpl if="values.ImageLinkUrl && values.IsExternalImageLink === true">','<a href="{ImageLinkUrl}" target="_blank" class="dashboard-prompt-image">{Key}</a>',"</tpl>",'<tpl if="values.ImageLinkUrl && values.IsExternalImageLink === false">','<a href="{ImageLinkUrl}" class="dashboard-prompt-image">{Key}</a>',"</tpl>",'<div class="dashboard-prompt-desc">',"{DescriptionHtml}","</div>","</div>",{compiled:!0}),o=new Ext.XTemplate('<div class="checklist"></div>');Ext.define("XERO.dashboard.Prompts",{extend:"Ext.Component",orgCompletionWindowTriggerLocationHash:"#setupComplete",squareOrgCompletionWindowTriggerLocationHash:"#squareSetupComplete",bus:null,el:null,visible:null,orgCompletionWindow:null,dashboardDocumentCls:"dashboard-prompts-visible",tpl:new Ext.XTemplate('<a id="hideDashboardPrompts" href="#">{HideGettingStarted}</a>',"{[ this.renderPromptType(values) ]}",{compiled:!0,renderPromptType:function(t){switch(t.PromptType){case n:return o.apply(t);case e:default:return i.apply(t)}}}),constructor:function e(n){this.bus=XERO.bus,this.data={HideGettingStarted:"Hide Getting Started",PromptType:t(n.orgShortCode)},n.promptType=this.data.PromptType,n.cls="dashboard-prompts-"+this.data.PromptType,this.dashboardPromptsUrl=n.dashboardPromptsUrl,this.visible=n.visible,this.callParentStrict(e,arguments)},listeners:{afterrender:function(){var t=this;this.el.show=function(){t.show()},this.pageContainer=Ext.get(Ext.query(".container")[0]),this.promptEl=this.el.child("."+this.promptType),this.promptType===e&&(this.carouselMovePrev=this.el.child("#dashboardPromptMovePrev"),this.carouselMoveNext=this.el.child("#dashboardPromptMoveNext")),this.closeLink=this.el.child("#hideDashboardPrompts"),this.itemsCls="."+this.promptType+"-items",this.itemCls="."+this.promptType+"-item",this.bus.on("gettingstarted:toggle",this.toggle,this),XERO.analytics.Analytics.set({"Dashboard prompt type":this.promptType})}},loadDashboardPrompts:function(){this.dashboardPromptsUrl&&(this.el.addClass("spinner"),Ext.Ajax.request({url:this.dashboardPromptsUrl,params:{getAllPrompts:this.promptType===n},method:"GET",success:this.onLoadDashboardPromptsSuccess,failure:this.onFailure,scope:this}))},onLoadDashboardPromptsSuccess:function(t,n){if(this.dashboardPrompts=Ext.decode(t.responseText),this.el.removeClass("spinner"),this.dashboardPrompts){var i={applyTo:this.promptEl,data:this.generatePrompts(this.dashboardPrompts)};if(this.promptType===e?(this.promptsCmp=new XERO.dashboard.Carousel(i),this.carouselMoveNext.removeClass("shifter-hidden"),this.carouselMovePrev.removeClass("shifter-hidden")):this.promptsCmp=new XERO.dashboard.Checklist(i),this.promptItemsEl=this.promptEl.child(this.itemsCls),this.initEvents(),this.promptType===e&&this.promptsCmp.setCarouselOffset(0,0),XERO.analytics.Analytics.isTrial()){var a=this;XERO.analytics.Analytics.trackLinks(this.itemsCls+" a","Dashboard",function(t){var e=a.getPromptIndex(t),n=a.getPromptKey(e),i=e+1;return{Action:"Prompt Click",PromptType:a.promptType,Class:t.className,Label:t.textContent||t.innerText,"Prompt Position":i,Prompt:n}})}}},onFailure:function(t,e){this.el.removeClass("spinner"),XERO.MsgBox.alert("There was an error loading the dashboard, please try again.","Uh oh!")},initEvents:function(){this.promptType===e&&(this.bus.on("carousel:movestart",this.onCarouselMoveStart,this),this.bus.on("carousel:moveend",this.onCarouselMoveEnd,this),this.bus.on("carousel:movefromstart",this.onCarouselMoveFromStart,this),this.bus.on("carousel:movefromend",this.onCarouselMoveFromEnd,this),this.carouselMoveNext.on("click",this.onCarouselMoveNextClick,this,{preventDefault:!0}),this.carouselMovePrev.on("click",this.onCarouselMovePrevClick,this,{preventDefault:!0})),this.closeLink.on("click",this.onCloseClick,this,{preventDefault:!0}),this.promptItemsEl.on("click",this.onPromptItemLinkClick,this,{delegate:"a"})},generatePrompts:function(t){var n,i,o;if(this.promptType===e){for(n=0,i=t.length;n<i;n++)t[n].Html=a.apply(t[n]);o=t}else for(o={headlineItem:null,checklist:[],extras:[]},n=0,i=t.length;n<i;n++)Ext.isEmpty(t[n].VideoConfig)?t[n].FlagInUse?o.checklist.push(t[n]):o.extras.push(t[n]):o.headlineItem=t[n];return o},show:function(){this.pageContainer.addClass(this.dashboardDocumentCls),this.applyChromeLayoutFix(),this.showOrgCompletionWindow(),this.visible=!0,this.dashboardPrompts||this.loadDashboardPrompts(),this.bus.fireEvent("gettingstarted:show")},applyChromeLayoutFix:function(){var t=this;t.closeLink.setStyle("position","static"),setTimeout(function(){t.closeLink.setStyle("position","")},0)},hide:function(){this.pageContainer.removeClass(this.dashboardDocumentCls),this.visible=!1,this.bus.fireEvent("gettingstarted:hide")},showOrgCompletionWindow:function(){var t=this;window.location.hash===this.orgCompletionWindowTriggerLocationHash?(window.location.hash="",this.orgCompletionWindow=XERO.MsgBox.createAjax("OrgCompletionWindow",{title:"You're all ready to go!",width:400,height:500,scope:t,footerCssClass:"x-window-footer-centerAlign",buttons:[XERO.buttons.createOK("OK",t.onOrgCompletionWindowOkClick,{size:"large x-pad",width:120})],listeners:{destroy:this.onOrgCompletionWindowDestroy,scope:this}}),t.mon(this.orgCompletionWindow.el,"click",t.onOrgCompletionWindowOkClick,t,{delegate:"#organisationSetupCompleteWindowOkBtn"}),Ext.Ajax.request({url:XERO.url.organisationSetupCompleteWindowUrl,success:this.onLoadOrgCompletionWindowSuccess,failure:this.onFailure,scope:this})):window.location.hash===this.squareOrgCompletionWindowTriggerLocationHash&&(window.location.hash="",this.orgCompletionWindow=XERO.MsgBox.createAjax("OrgCompletionWindow",{title:"Almost done...",width:400,height:500,closable:!1,scope:t,footerCssClass:"x-window-footer-centerAlign",buttons:[XERO.buttons.createOK("Add Bank Account",t.onAddBankAccountClick,{size:"large x-pad",width:120})],listeners:{destroy:this.onSquareOrgCompletionWindowDestroy,scope:this}}),t.mon(this.orgCompletionWindow.el,"click",t.onAddBankAccountClick,t,{delegate:"#organisationSetupCompleteAddBankAccountBtn"}),Ext.Ajax.request({url:XERO.url.organisationSetupCompleteWindowUrl,success:this.onLoadOrgCompletionWindowSuccess,failure:this.onFailure,scope:this}))},onOrgCompletionWindowOkClick:function(t){t.close()},onAddBankAccountClick:function(t){t.close(),ChartOfAccounts.addBankAccount(!1,{prompt:"AddBankAccount",action:"ClickDashboardBox",analyticsTrack:!0},!0)},onLoadOrgCompletionWindowSuccess:function(t){this.orgCompletionWindow.update(t.responseText),this.orgCompletionWindow.center()},onOrgCompletionWindowDestroy:function(t){},onSquareOrgCompletionWindowDestroy:function(t){},getPromptKey:function(t){return this.dashboardPrompts[t].Key},getPromptIndex:function(t){return Array.prototype.slice.call(Ext.fly(t).up(this.itemsCls).dom.children).indexOf(Ext.fly(t).up(this.itemCls).dom)},onPromptItemLinkClick:function(t,n){var i=this.getPromptIndex(n),a=this.getPromptKey(i),o=i+1;if(this.dashboardPrompts[i].VideoConfig)switch(a){case"Video":var r=XERO.MsgBox.video(this.dashboardPrompts[i].VideoConfig),s=Date.now(),l=this.dashboardPrompts[i].VideoConfig;r.on("close",function(){l.Duration=Date.now()-s,XERO.analytics.Analytics.track("Video MsgBox Closed",l)},this),t.preventDefault()}if(this.promptType===e)if(Ext.fly(n).hasClass("dashboard-prompt-image"))XERO.prompts.Tracking.track({prompt:a,action:"ClickCarouselImage",carouselPosition:o});else{var u="ClickCarouselLink",c=n.getAttribute("data-link-key");c&&(u+=c),XERO.prompts.Tracking.track({prompt:a,action:u,carouselPosition:o})}},toggle:function(){this.visible?this.hide():this.show(),this.save()},save:function(){Ajax.SaveGettingStarted(this.visible)},onCloseClick:function(t){this.toggle(),this.promptType===e&&XERO.prompts.Tracking.track({action:"ClickCarouselHide"})},onCarouselMoveNextClick:function(t){this.bus.fireEvent("carousel:shiftnextpage")},onCarouselMovePrevClick:function(t){this.bus.fireEvent("carousel:shiftprevpage")},onCarouselMoveStart:function(){this.carouselMovePrev.hide()},onCarouselMoveEnd:function(){this.carouselMoveNext.hide()},onCarouselMoveFromStart:function(){this.carouselMovePrev.show()},onCarouselMoveFromEnd:function(){this.carouselMoveNext.show()}})}()},function(t,e){!function(){"use strict";Ext.define("XERO.prompts.Tracking",{singleton:!0,promptsTrackingUrl:null,track:function(t){var e,n=[],i=["action"];for(this.promptsTrackingUrl||(this.promptsTrackingUrl=XERO.url.promptsTrackingUrl),e=0;e<i.length;e++)t.hasOwnProperty(i[e])||n.push(i[e]);if(n.length>0)throw new Error("Parameter object should contain "+n.toString()+" properties.");if(Ext.isEmpty(t.action))throw new Error("Action cannot be empty.");this.promptsTrackingUrl&&Ext.Ajax.request({url:this.promptsTrackingUrl,method:"POST",params:{expressSetupTrackingModel:Ext.encode({Action:t.action,Prompt:t.prompt,Source:this.getPageUrl(),CarouselPosition:t.carouselPosition})}})},getPageUrl:function(){return document.location.pathname}})}()},function(t,e){!function(){"use strict";function t(t,n){var i=t.textContent||t.innerText,a=e();return a.Class=t.className,a.Label=Ext.isEmpty(i)?t.className:i,a[h]=n,a}function e(){return{"Has Notification":n(),"Locked Balances":a(),"Grid Modified":i()}}function n(){if(!c){var t=Ext.query(".notify",l),e="None";t.length>0&&(-1!==t[0].className.indexOf("bg-orange")?e="Warning":-1!==t[0].className.indexOf("bg-green")?e="Success":-1!==t[0].className.indexOf("bg-red")&&(e="Error")),c=e}return c}function i(){return!(ConversionBalances.lineItemsGrid.store.getCount()===u&&0===ConversionBalances.lineItemsGrid.store.getModifiedRecords().length)}function a(){var t=Ext.query('input[name="LockBalances"]')[0];return t?t.checked?"Locked":"Unlocked":"No Lock Balances"}function o(t){if(XERO.analytics.Analytics.isTrial()){u=t.store.getCount(),l=Ext.query(".AllPageContent")[0];var n=e();n[h]=d.load,XERO.analytics.Analytics.track(f,n),r()}}function r(){XERO.analytics.Analytics.trackLinks(Ext.query(".call-out a",l),f,function(e){return t(e,d.callOut)}),XERO.analytics.Analytics.trackLinks(Ext.query(".secondaryButtons .trackItem",l),f,function(e){return t(e,d.secondaryButtons)}),XERO.analytics.Analytics.trackLinks(Ext.query(".notify.bg-orange  a",l),f,function(e){return t(e,d.orangeNotify)})}function s(){ConversionBalances.lineItemsGrid&&ConversionBalances.lineItemsGrid.rendered?o(ConversionBalances.lineItemsGrid):ConversionBalances.lineItemsGrid.on("afterrender",o,this)}var l,u,c,d={secondaryButtons:"Button Bar Click",orangeNotify:"Orange Error Click",callOut:"Call Out Click",grid:"Grid Click",gridFooter:"Grid Footer Click",load:"Loaded"},h="Conversion Balances Action",f="Conversion Balances";Ext.define("XERO.analytics.ConversionBalances",{singleton:!0,initTracking:function(){XERO.analytics.Analytics.onAnalyticsReady(s,this)},trackAction:function(e,n,i){var a=t(e,d[n]);XERO.analytics.Analytics.trackAction(e,f,a,i,!0)}})}()},function(t,e){!function(){"use strict";function t(t,e){var n=(t.textContent||t.innerText).trim();return e=e||{},e.Class=t.className,e.Label=Ext.isEmpty(n)?t.className:n,e}Ext.define("XERO.widget.GettingStarted",{extend:"Ext.Component",cls:"documentHeader--gettingStarted documentHeader--row",tpl:new Ext.XTemplate('<div class="documentHeader--row--container">','<tpl for="lines">',"<p>{[values]}</p>","</tpl>",'<a href="javascript:void(0)" class="close">Hide Help</a>','<a href="javascript:void(0)" class="video video-{shortName} videoTrigger html shadow" >&#160;</a>',"</div>",{compiled:!0}),constructor:function t(e){this.bus=XERO.bus,this.gsData=e.data,this.hidden=!e.visible,this.isTracking=function(){return XERO.analytics.Analytics.isTrial()},this.trackingEventName="Getting Started",this.callParentStrict(t,arguments)},listeners:{afterrender:function(){var e=this;if(this.el.set({"data-code":this.gsData.code}),this.closeLink=this.el.child(".close"),this.initEvents(),this.isTracking()){var n=this.el.query("p a:not(.videoTrigger)");XERO.analytics.Analytics.trackLinks(n,this.trackingEventName,function(n){return t(n,{Action:"External Link Click","Getting Started Name":e.gsData.title})});var i=this.el.query(".videoTrigger");XERO.analytics.Analytics.trackLinks(i,this.trackingEventName,function(n){return t(n,{Action:"Video Started","Getting Started Name":e.gsData.title,Video:e.gsData.videoId})})}}},initEvents:function(){this.bus.on("gettingstarted:toggle",this.toggle,this),this.closeLink.on("click",this.onCloseClick,this,{preventDefault:!0}),this.el.on("click",this.onVideoClick,this,{preventDefault:!0,delegate:".videoTrigger"})},onCloseClick:function(){this.isTracking()&&XERO.analytics.Analytics.track(this.trackingEventName,{Action:"Hide Help","Getting Started Name":this.gsData.title}),this.toggle()},onVideoClick:function(t){var e=XERO.MsgBox.video({title:this.gsData.title,videoId:this.gsData.videoId}),n=Date.now();e.on("close",function(){var t=Date.now()-n;this.isTracking()&&XERO.analytics.Analytics.track(this.trackingEventName,{Action:"Video Complete","Getting Started Name":this.gsData.title,Duration:t,Video:this.gsData.videoId})},this),t.preventDefault()},toggle:function(){this.visible?this.hide():(this.show(),this.isTracking()&&XERO.analytics.Analytics.track(this.trackingEventName,{Action:"Show Help","Getting Started Name":this.gsData.title})),this.save()},save:function(){Ajax.SaveGettingStarted(this.visible)},show:function(){this.visible=!0,this.removeClass("x-hide-display"),this.bus.fireEvent("gettingstarted:show")},hide:function(){this.visible=!1,this.addClass("x-hide-display"),this.bus.fireEvent("gettingstarted:hide")}})}()},function(t,e){!function(){"use strict";function t(t,n){var i=t.textContent||t.innerText,a=e();return a.Class=t.className,a.Label=Ext.isEmpty(i)?t.className:i,a[l]=n,a}function e(){return{"Has Notification":n()}}function n(){if(!r){var t=Ext.query(".notify",o),e="None";t.length>0&&Ext.fly(t[0]).isVisible()&&(-1!==t[0].className.indexOf("bg-orange")?e="Warning":-1!==t[0].className.indexOf("bg-green")&&(e="Success")),r=e}return r}function i(){XERO.analytics.Analytics.trackLinks(Ext.query(".tasks .xbtn",o),u,function(e){return t(e,s.tasks)})}function a(){if(XERO.analytics.Analytics.isTrial()){o=Ext.query(".w-content")[0];var t=e();t[l]=s.load,XERO.analytics.Analytics.track(u,t),i()}}var o,r,s={tasks:"Button Bar Click",save:"Next Click",load:"Loaded"},l="Historic Invoices Action",u="Historic Invoices";Ext.define("XERO.analytics.HistoricInvoices",{singleton:!0,initTracking:function(){XERO.analytics.Analytics.onAnalyticsReady(a,this)},trackAction:function(e,n,i){var a=t(e,s[n]);XERO.analytics.Analytics.trackAction(e,u,a,i,!0)}})}()},function(t,e){!function(){"use strict";function t(t){var e=t.textContent||t.innerText,n={};return n.Class=t.className,n.Label=Ext.isEmpty(e)?t.className:e,n}function e(e,n){XERO.analytics.Analytics.trackLinks(e,n||i,function(e){return t(e)})}function n(){XERO.analytics.Analytics.isTrial()&&e(Ext.query(".trackItem,","#dashboardColumns")),e(Ext.query(".manage-account-menu-item > a, .manage-account-menu-column > a"),"Dashboard: Manage Bank Account Links")}var i="Dashboard Box Click";Ext.define("XERO.analytics.Dashboard",{singleton:!0,initTracking:function(){XERO.analytics.Analytics.onAnalyticsReady(n,this)},trackAction:function(e,n,a){var o=t(e);XERO.analytics.Analytics.trackAction(e,i,o,a,!0)}})}()},function(t,e){Ext.define("XERO.invoicing.paymentservices.IFrameManager",{extend:"Ext.util.Observable",context:"Invoice",constructor:function(t){var e=this;e.addEvents({selectionchange:!0}),e.listeners=t.listeners,e.documentId=t.documentId,e.organisationTemplateId=t.organisationTemplateId,e.context=t.context,e.callParent(arguments),e._iframe=e.initIframe(e.documentId,e.organisationTemplateId)},_iframe:null,_isLoaded:!1,reload:function(t,e){this._iframe&&!0===this._isLoaded&&(this._isLoaded=!1,this._iframe.dom.contentWindow.location.href=Ext.String.format("/Accounts/Receivable/PaymentServiceProvisioning/Index?_dc={0}&documentId={1}&organisationTemplateId={2}&context={3}&fromUrl={4}",(new Date).getTime(),t,e||null,this.context,encodeURIComponent(location.href)))},initIframe:function(t,e){function n(t){var e=t.data;e&&e.event&&e.event.startsWith("paymentservices")&&("paymentservices:selectionchange"===e.event&&i.fireEvent("selectionchange",e.data),"paymentservices:close"===e.event&&i.hide(),"paymentservices:getparenthref"===e.event&&a.dom.contentWindow.postMessage({event:"paymentservices:respondparenthref",href:window.location.href},"*"),"paymentservices:setparenthref"===e.event&&("RepeatingTemplate"==i.context?parent.window.open(e.activationUrl):window.location.href=e.activationUrl))}var i=this,a=Ext.getBody().insertHtml("beforeEnd",Ext.String.format('<iframe id="PaymentGatewaysProvisioningIframe" src="/Accounts/Receivable/PaymentServiceProvisioning/Index?_dc={0}&documentId={1}&organisationTemplateId={2}&context={3}&fromUrl={4}" allowTransparency="true" width="100%" height="2000px" frameborder="0" scrolling="yes" marginheight="0" marginwidth="0" style="background-color:transparent; position: fixed; width: 100%; height: 2000px; min-height: 100%; overflow-y: scroll; z-index: 21000; top: 0px; left: 0px;display: none;"></iframe>',(new Date).getTime(),t,e||null,i.context,encodeURIComponent(location.href)),!0);return Ext.EventManager.on(a,"load",function(){i._isLoaded=!0,i.fireEvent("ready",i,a)}),Ext.EventManager.on(window,"resize",function(){a.dom.style.height=window.innerHeight+"px"}),window.addEventListener("message",function(t){n(t)}),a},show:function(t,e,n){var i=this._iframe;document.body.style.overflow="hidden",i.dom.style.display="block",i.dom.style.height=window.innerHeight+"px",i.dom.contentWindow.postMessage({event:"paymentservices",fromClick:t,fromOauthRedirect:e,paymentGatewayId:n,context:this.context},"*")},hide:function(){var t=this._iframe;document.body.style.overflow="visible",t.dom.style.display="none"}})},function(t,e){Ext.define("XERO.invoicing.paymentservices.AutoPayManager",{extend:"Ext.util.Observable",containerTpl:['<label style="width:80px;">Auto pay <img src="/common/images/paymentgateways/autopay/question@2x.png" class="auto-pay-info" /></label>','<label class="xui-styledcheckboxradio">','<input id="enableAutoPayCheckBox" class="xui-styledcheckboxradio--input xui-styledcheckboxradio--input-xsmall" type="checkbox">','<div class="xui-styledcheckboxradio--checkbox xui-styledcheckboxradio--checkbox-xsmall"></div>','<span id="autoPaySwitchLabel" class="xui-styledcheckboxradio--label xui-styledcheckboxradio--label-xsmall">Offer auto pay</span>',"</label>"],onlinePaymentsContainer:null,isNew:!1,invoiceTemplateId:null,constructor:function(t){var e=this;e.refreshConfig(t),e.callParent(arguments),e.initComponents(),e.refreshComponents()},refreshConfig:function(t){var e=this;Ext.apply(e,t),e.autoPayStatus=e.autoPayStatus||{merchantEnabled:!1}},refreshComponents:function(){var t=this;"true"==t.hiddenField.dom.value?(t.checkboxEl.dom.checked=!0,Ext.apply(t.autoPayStatus||{},{merchantEnabled:!0})):null!=t.autoPayStatus&&t.autoPayStatus.merchantEnabled&&(t.hiddenField.dom.value="true",t.checkboxEl.dom.checked=!0),t.onPaymentsContainerChange(null,{paymentGatewayGroups:t.activePaymentGatewayGroups}),t.toggleAutoPayTag()},initComponents:function(){var t=this;t.saveAsDraftEl=Ext.get("saveAsDraft"),t.saveAsAutoApprovedEl=Ext.get("saveAsAutoApproved"),t.saveAsAutoApprovedAndEmailEl=Ext.get("saveAsAutoApprovedAndEmail");var e=function(e,n){!0===n.checked&&t.onPaymentsContainerChange(n,{paymentGatewayGroups:t.activePaymentGatewayGroups})};t.saveAsDraftEl.on("click",function(n,i){i.checked&&!0===t.autoPayStatus.merchantEnabled&&!0===t.autoPayStatus.customerEnabled?t.showConfirmModal("Changing status will remove auto pay","Auto pay is only available on repeating invoices set to 'approve for sending'. Changing this status will remove auto pay from this repeating invoice.","Change status & remove auto pay",function(t){e(0,i),t.destroy()},function(e){t.saveAsDraftEl.dom.checked=!1,t.saveAsAutoApprovedAndEmailEl.dom.checked=!0,e.destroy()}):e(0,i)},t),t.saveAsAutoApprovedEl.on("click",function(n,i){i.checked&&!0===t.autoPayStatus.merchantEnabled&&!0===t.autoPayStatus.customerEnabled?t.showConfirmModal("Changing status will remove auto pay","Auto pay is only available on repeating invoices set to 'approve for sending'. Changing this status will remove auto pay from this repeating invoice.","Change status & remove auto pay",function(t){e(0,i),t.destroy()},function(e){t.saveAsAutoApprovedEl.dom.checked=!1,t.saveAsAutoApprovedAndEmailEl.dom.checked=!0,e.destroy()}):e(0,i)},t),t.saveAsAutoApprovedAndEmailEl.on("click",e,t),t.autoPayTagEl=Ext.get("autoPayStatus"),t.autoPayContainerEl=Ext.get("autoPayContainer"),t.autoPayContainerEl.insertHtml("beforeEnd",t.containerTpl.join("")),t.labelEl=t.autoPayContainerEl.down("#autoPaySwitchLabel"),t.imgEl=t.autoPayContainerEl.child("img[class=auto-pay-info]"),t.imgEl.on("click",function(){t.track("Click","Auto pay question mark"),t.showWindow()},t),t.hiddenField=t.autoPayContainerEl.down("#EnableAutoPay"),t.checkboxEl=t.autoPayContainerEl.down("#enableAutoPayCheckBox"),t.checkboxEl.on("click",function(){var e=!t.checkboxEl.dom.checked,n=function(){t.hiddenField.dom.value=t.autoPayStatus.merchantEnabled=t.checkboxEl.dom.checked,t.toggleAutoPayTag(),RT&&(RT.__delayInvoiceSave=!0),t.pointerTip&&t.pointerTip.destroy(),t.track(t.checkboxEl.dom.checked?"Offer":"Remove","Auto pay checkbox")},i=function(){t.checkboxEl.dom.checked=e};t.checkboxEl.dom.checked||!0!==t.autoPayStatus.merchantEnabled||!0!==t.autoPayStatus.customerEnabled?n():t.showConfirmModal("Remove auto pay","Are you sure you want to remove auto pay? Your customer's credit card will not be charged on future invoices.","Remove",function(t){n(),t.destroy()},function(t){i(),t.destroy()})}),t.onlinePaymentsContainer.on("renderedtoinvoice",t.onPaymentsContainerChange,t)},showConfirmModal:function(t,e,n,i,a){XERO.MsgBox.create(null,{title:t,html:e,buttons:[XERO.buttons.createOK(n,i),XERO.buttons.createCancel("Cancel",a)],modal:!0,closable:!1,width:400}).show()},toggleAutoPayTag:function(){var t=this;!0===t.supportsAutoPay&&!0===t.saveAsAutoApprovedAndEmailEl.dom.checked&&t.activePaymentGatewayGroups.some(function(t){return"PAYMENTGATEWAY/STRIPE"==t.activePaymentGateway.type})&&null!=t.autoPayStatus?(t.autoPayTagEl.removeClass(["failed","active","offered"]),t.autoPayStatus.isInError?t.autoPayTagEl.addClass("failed").setDisplayed(!0):t.autoPayStatus.merchantEnabled&&t.autoPayStatus.customerEnabled?t.autoPayTagEl.addClass("active").setDisplayed(!0):t.autoPayStatus.merchantEnabled?t.autoPayTagEl.addClass("offered").setDisplayed(!0):t.autoPayTagEl.setDisplayed(!1)):t.autoPayTagEl.setDisplayed(!1)},onPaymentsContainerChange:function(t,e){var n=this,i=function(){n.autoPayContainerEl.setDisplayed(!0),!0===n.showAutoPayToolTip&&n.showToolTip(),n.toggleAutoPayTag()},a=function(){n.autoPayContainerEl.setDisplayed(!1),n.hiddenField.dom.value=n.autoPayStatus.merchantEnabled=n.checkboxEl.dom.checked=!1,n.pointerTip&&n.pointerTip.destroy(),n.toggleAutoPayTag()};n.activePaymentGatewayGroups=e.paymentGatewayGroups;var o=n.activePaymentGatewayGroups.map(function(t){if(t.activePaymentGateway&&"PAYMENTGATEWAY/STRIPE"==t.activePaymentGateway.type)return t.activePaymentGateway}),r=o&&0!==o.length?o.reduce(function(t){if(t)return t}):null;!0===n.supportsAutoPay&&!0===n.saveAsAutoApprovedAndEmailEl.dom.checked&&r?Ext.Ajax.request({url:"/Accounts/Receivable/PaymentServiceProvisioning/IsStripeAccountActivated",params:{paymentGatewayId:r.paymentGatewayId},method:"GET",callback:function(t,e,n){!0===Ext.decode(n.responseText).activated?(r.activated=!0,i()):a()}}):a()},showToolTip:function(){function t(){i=e.imgEl.getXY();try{e.pointerTip.getEl().setXY([i[0]+40,i[1]-46])}catch(t){}}var e=this;if(!e.pointerTip||!e.pointerTip.isVisible()){var n=['<div id="tipContent" class="tip-content">',"<h4>Get paid on time, every time</h4>","<p>Customers set up an automatic credit or debit card payment that's charged on each due date. Auto pay is only available on repeating invoices set to 'Approve for sending'. </p>",'<a class="btn-setup" id="tooltipPSBtn" href="#" style="padding:7px 18px;margin-top:2px;height:16px;min-width:180px;">Learn more about auto pay</a>','<span class="close-tip" id="closeTip"></span>',"</div>"].join("");e.pointerTip=new XERO.tip.PointerTip({title:"",cls:"x-pointer-tip x-paymentservices-tip",html:n,closable:!0,width:300,listeners:{hide:function(){e.removeToolTip()},render:function(t){t.getEl()&&t.getEl().on("click",function(t,n){t.getTarget("span.close-tip")&&e.removeToolTip(),t.getTarget("a.btn-setup")&&(e.track("Click learn more","Auto pay tooltip"),e.showWindow(t,n))})}}});var i=(Date.now(),e.imgEl.getXY());e.pointerTip.setColor("white"),e.pointerTip.showAt([i[0]+40,i[1]-46]),XERO.bus.addListener("gettingstarted:hidden",t),XERO.bus.addListener("gettingstarted:show",t),window.addEventListener("resize",t),e.track("Show","Auto pay tooltip")}},showWindow:function(t,e){function n(t){var e=t.data;"autopay:selectionchange"===e.event&&i.fireEvent("selectionchange",e.data),"autopay:close"===e.event&&(e.data&&!0===e.data.autoPayEnabled&&(i.autoPayStatus.merchantEnabled=!0,i.checkboxEl.dom.checked=!0,i.hiddenField.dom.value=!0),i.hide())}var i=this;e&&(e.innerHTML='<img src="/Common/Images/spinner.svg" style="height:18px;">'),i.iframe=Ext.getBody().insertHtml("beforeEnd",Ext.String.format('<iframe id="AutoPayIframe" src="/Accounts/Receivable/AutoPay/AutoPayPrompt?_dc={0}&autoPayEnabled={1}&page=RepeatingTemplate" allowTransparency="true" width="100%" height="2000px" frameborder="0" scrolling="yes" marginheight="0" marginwidth="0" style="background-color:transparent; position: fixed; width: 100%; height: 2000px; min-height: 100%; overflow-y: scroll; z-index: 20000; top: 0px; left: 0px;display: none;"></iframe>',(new Date).getTime(),i.autoPayStatus.merchantEnabled),!0),Ext.EventManager.on(i.iframe,"load",function(){i.pointerTip&&i.pointerTip.destroy(),i.show()}),Ext.EventManager.on(window,"resize",function(){iframe.dom.style.height=window.innerHeight+"px"}),window.addEventListener("message",function(t){n(t)})},show:function(){var t=this.iframe;document.body.style.overflow="hidden",t.dom.style.display="block",t.dom.style.height=window.innerHeight+"px",t.dom.contentWindow.postMessage({event:"autopay"},"*")},hide:function(){var t=this.iframe;document.body.style.overflow="visible",t.dom.style.display="none"},removeToolTip:function(){var t=this;t.pointerTip&&t.pointerTip.destroy(),t.showToolTip=!1,Ext.Ajax.request({url:"/Accounts/Receivable/PaymentServiceProvisioning/SaveTooltipState?code=GETTINGSTARTED/AUTOPAYTOOLTIP&display=false",method:"POST",callback:function(){}}),t.track("Close","Auto pay tooltip")},track:function(t,e){var n={hitType:"event",eventCategory:"Auto pay",eventAction:t,eventLabel:e,dimension21:"RepeatingTemplate"};window.ga&&window.ga("send",n)}})},function(t,e){Ext.define("XERO.invoicing.paymentservices.AutoPayBannerManager",function(){var t=null,e=function(t){window.ga&&window.ga("send",{hitType:"event",eventCategory:"Auto pay",eventAction:t,eventLabel:"Auto pay promo banner",dimension21:"RepeatingList"})},n=function(e){function n(t){e&&(e.innerHTML="Learn more"),a()}e&&(e.innerHTML='<img src="/Common/Images/spinner.svg" style="height:18px;float:none;">'),t=Ext.getBody().insertHtml("beforeEnd",Ext.String.format('<iframe id="AutoPayIframe" src="/Accounts/Receivable/AutoPay/AutoPayPrompt?_dc={0}&autoPayEnabled={1}&page=RepeatingList" allowTransparency="true" width="100%" height="2000px" frameborder="0" scrolling="yes" marginheight="0" marginwidth="0" style="background-color:transparent; position: fixed; width: 100%; height: 2000px; min-height: 100%; overflow-y: scroll; z-index: 20000; top: 0px; left: 0px;display: none;"></iframe>',(new Date).getTime(),!0),!0),Ext.EventManager.on(t,"load",i),Ext.EventManager.on(window,"resize",function(){t.dom.style.height=window.innerHeight+"px"}),window.addEventListener("message",function(t){n(t)})},i=function(){document.body.style.overflow="hidden",t.dom.style.display="block",t.dom.style.height=window.innerHeight+"px",t.dom.contentWindow.postMessage({event:"autopay"},"*")},a=function(){document.body.style.overflow="visible",t.dom.style.display="none"};return{statics:{show:function(){Ext.Ajax.request({url:"/Accounts/Receivable/AutoPay/ShowAutoPayBanner",method:"GET",callback:function(t,i,a){if(!0===Ext.decode(a.responseText).showBanner){e("Show");var o=['<div class="tip-content" style="float:none;">',"<h4>Get paid on time, every time</h4>","<p>Customers can set up automatic credit card payment that's charged each due date. Auto pay is only available through Stripe on repeating invoices set to 'approve for sending'.</p>",'<div style="float:right !important;">','<a id="bannerSkipBtn" href="#" style="padding: 8px 20px;">Skip for now</a>','<a class="btn-setup" id="bannerLearnMoreBtn" href="#" style="padding:6px 30px;width: 90px;text-align:center;">Learn more</a>',"</div>",'<span class="close-tip" id="closeBannerBtn"></span>',"</div>"].join(""),r=document.createElement("div");r.innerHTML=o,r.className="x-paymentservices-tip x-paymentservices-activation",r.style="margin-bottom: 20px;width: 914px;margin: 0 auto;float: none;position: relative;padding: 10px;width: 906px;border-width: 2px;border-style: solid;margin-bottom: 15px;box-shadow: 1px 1px 3px #ddd;border-radius: 5px;",Ext.select("div.bridge-lower").first().dom.insertAdjacentElement("afterbegin",r),Ext.fly("bannerSkipBtn").on("click",function(){r.parentNode.removeChild(r)}),Ext.fly("bannerLearnMoreBtn").on("click",function(t,i){e("Click learn more"),n(i)}),Ext.fly("closeBannerBtn").on("click",function(){e("Close"),Ext.Ajax.request({url:"/Accounts/Receivable/PaymentServiceProvisioning/SaveTooltipState?code=GETTINGSTARTED/AUTOPAYBANNER&display=false",method:"POST",callback:function(){}}),r.parentNode.removeChild(r)})}}})}}}})},function(t,e){Ext.define("XERO.invoicing.paymentservices.AutoPayTagManager",function(){var t=function(t,e,n,i){var a;switch(n=n||"beforeEnd",t.status){case"AUTOPAY/OFFERED":a="xui-tag-neutral";break;case"AUTOPAY/FAILED":a="xui-tag-negative";break;case"AUTOPAY/ACTIVE":a="xui-tag-positive"}Ext.DomHelper.insertHtml(n,e,Ext.String.format('{2}<span class="xui-tag xui-tag-medium {0}">{1}</span>{3}',a,t.statusMessage,!0===i?"<div style='display: flex;align-items: center;height: 40px;padding-right: 15px;'>":"",!0===i?"</div>":""))},e=function(t,e,i){var a,o=Math.ceil(e.length/30),r=[],s=function(){0==--o&&i(r)};for(a=0;a<e.length;a+=30){var l=e.slice(a,a+30);n(t,l,function(t){r=r.concat(t),s()})}},n=function(t,e,n){Ext.Ajax.request({url:Ext.String.format("/Accounts/Receivable/AutoPay/{0}",t),method:"GET",params:{ids:e},callback:function(t,e,i){if(e&&i){var a=Ext.decode(i.responseText);n(a?a:[])}else n([])}})};return{statics:{showForRepeatingSearch:function(){var n=Array.prototype.slice.call(document.querySelectorAll("table.standard tr[data-id]"),0).map(function(t){return t.getAttribute("data-id")});n&&n.length>0&&e("GetAutoPayStatusForInvoiceTemplates",n,function(e){e.forEach(function(e){var n=document.querySelector(Ext.String.format("table.standard tr[data-id='{0}'] td[data-column=nextInvoiceDate]",e.invoiceTemplateId));t(e,n)})})},showForInvoiceSearch:function(){var n=Array.prototype.slice.call(document.querySelectorAll("table.standard tr[data-isrepeating=true]"),0).map(function(t){return t.getAttribute("data-id")});n&&n.length>0&&e("GetAutoPayStatusForInvoices",n,function(e){e.forEach(function(e){"AUTOPAY/ACTIVE"!=e.status&&"AUTOPAY/FAILED"!=e.status||e.invoiceIds.forEach(function(n){var i=document.querySelector(Ext.String.format("table.standard tr[data-id='{0}'] td[data-column=dueDate]",n));"AUTOPAY/ACTIVE"==e.status&&(e.statusMessage="Active"),"AUTOPAY/FAILED"==e.status&&(e.statusMessage="Failed"),i&&t(e,i)})})})},showForInvoice:function(e){if(e&&"AUTOPAY/ACTIVE"==e.status||"AUTOPAY/FAILED"==e.status){var n=document.querySelector("div.status");n&&t(e,n,"afterBegin",!0)}}}}})},function(t,e){Ext.define("XERO.invoicing.paymentservices.GoCardlessTagManager",function(){var t=function(){return Array.prototype.slice.call(document.querySelectorAll("table.standard tr[data-id]")).map(function(t){return t.getAttribute("data-id")})},e=function(t,e){var i;totalPages=Math.ceil(t.length/30);var a=[],o=function(){totalPages-=1,0===totalPages&&e(a)};for(i=0;i<t.length;i+=30){var r=t.slice(i,i+30);n(r,function(t){a=a.concat(t),o()})}},n=function(t,e){Ext.Ajax.request({url:window.location.origin+"/settings/paymentgateways/getgocardlesspayments",method:"GET",params:{invoiceIds:t},callback:function(t,n,i){if(n&&i){var a=Ext.decode(i.responseText);e(a?a:[])}else e([])}})},i=function(t){t.forEach(function(t,e){var n=document.querySelector(Ext.String.format("table.standard tr[data-id='{0}'] td[data-column=dueDate]",t.InvoiceId)),i=t.GcPaymentStatus;a(n,i)})},a=function(t,e){var n="xui-tag xui-tag-medium ",i="";switch(e){case"submitted":i="Payment processing";break;case"failed":i="Failed payment",n+="xui-tag-negative"}var a=document.createElement("span");a.setAttribute("class",n),a.setAttribute("style","padding: 0 5px !important;"),a.innerHTML=i,t.appendChild(a)};return{statics:{showForInvoiceSearch:function(){var n=t();e(n,i)}}}})},function(t,e){Ext.define("XERO.invoicing.paymentservices.OnlinePaymentsContainer",{extend:"Ext.Component",showPopup:!0,controller:null,settings:null,isIFrameReady:!1,fromOauthRedirect:!1,paymentGatewayId:null,disableTooltip:!1,isNew:!1,invoiceId:null,invoiceStatus:null,templateId:null,autoPayContainer:null,context:"Invoice",providerStatus:null,relevantStripePG:null,completeSetupPaymentGatewayId:null,deferredPaymentGatewayId:null,tpl:new Ext.XTemplate("<label>Online Payments</label>",'<div class="invoice-payment-gateways">','<tpl for="paymentGatewayGroups">','<div class="invoice-payment-gateway" style="{[xindex === 1 ? "" : "padding-top:2px;"]}">','<em class="logo {cls}"></em>','<tpl if="activePaymentGateway">',"{[Ext.util.Format.htmlEncode(values.activePaymentGateway.name)]}","</tpl>",'<tpl if="!activePaymentGateway">',"{[Ext.util.Format.htmlEncode(values.name)]}","</tpl>","</div>","</tpl>",'<tpl if="showEdit === true">','<div style="clear:both;padding-left:20px;"><a id="managePSBtn" href="#" style="clear:both;">Manage</a></div>',"</tpl>","</div>",{compiled:!0}),emptyTpl:new Ext.XTemplate("<label>Online Payments</label>",'<div class="no-invoice-payment-gateways">',"None. ",'<tpl if="showEdit === true">','<a id="managePSBtn" href="#">Manage</a>',"</tpl>",'<tpl if="hasPaymentGateways !== true">','<a id="setupPSBtn" href="#">Get set up now</a>',"</tpl>","</div>",{compiled:!0}),initComponent:function(){var t=this;t.callParent(arguments),t.on("afterrender",function(){t.getEl().on("click",t.btnClick,t),t.hiddenField=t.getEl().insertSibling({tag:"input",type:"hidden",id:"ActivePaymentGateways",name:"ActivePaymentGateways"},"before",!0),t.iframeMgr=new XERO.invoicing.paymentservices.IFrameManager({documentId:t.invoiceId,organisationTemplateId:t.templateId,context:t.context,listeners:{selectionchange:function(e){t.paymentGatewayGroups=e,t.hasPaymentGateways=t.paymentGatewayGroups.some(function(t){return t.paymentGateways&&0!==t.paymentGateways}),t.showEdit=t.paymentGatewayGroups.some(function(t){return t.paymentGateways&&0!==t.paymentGateways}),t.renderToInvoice(),Ext.defer(function(){XERO.widget.Histories.refresh(!1,!0)},50);var n=Ext.clean(e.map(function(t){if(!0===t.active)return t})),i=Ext.clean(n.map(function(t){return t.activePaymentGateway?t.activePaymentGateway.paymentGatewayId:null}));t.hiddenField.value=i.join("|")},ready:function(){t.isIFrameReady=!0,t.fireEvent("iframeready",t)},scope:t}}),t.loadData(t.invoiceId,t.templateId)})},loadIframe:function(t,e){this.isIFrameReady=!1,this.iframeMgr.reload(t,e)},loadData:function(t,e){var n=this;Ext.Ajax.request({url:Ext.String.format("/Accounts/Receivable/PaymentServiceProvisioning/GetAllPaymentGatewaysFor{0}",n.context),method:"GET",params:{invoiceId:t,organisationTemplateId:e||null},callback:function(t,e,i){var a=Ext.decode(i.responseText);if(XERO.invoicing.paymentservices.data=a,Ext.apply(n,a),n.renderToInvoice(),n.hiddenField&&(n.hiddenField.value=""),!0===n.showTooltip&&!0!==n.disableTooltip){n.showToolTip();var o=Ext.fly("sendEmailBtn");o&&o.on("click",function(){n.pointerTip&&n.pointerTip.destroy()})}if("RepeatingTemplate"==n.context){var r=Ext.apply(a,{onlinePaymentsContainer:n,invoiceTemplateId:n.invoiceId,isNew:n.isNew,activePaymentGatewayGroups:Ext.clean(n.paymentGatewayGroups.map(function(t){if(!0===t.active)return t}))});n.autoPayContainer?(n.autoPayContainer.refreshConfig(r),n.autoPayContainer.refreshComponents()):n.autoPayContainer=new XERO.invoicing.paymentservices.AutoPayManager(r)}"Invoice"==n.context&&n.autoPayStatus&&XERO.invoicing.paymentservices.AutoPayTagManager.showForInvoice(n.autoPayStatus)}})},showStripeNeedsInfoBanner:function(t){for(var e=this,n=0;n<t.length;n++){var i=t[n];if("PAYMENTGATEWAYGROUP/CREDITCARD"===i.type&&i.activePaymentGateway&&i.activePaymentGateway.ShowStripeBanner){e.deferredPaymentGatewayId=i.activePaymentGateway.paymentGatewayId,Ext.select(".x-stripe-banner").remove();var a=['<div class="tip-content" style="float:none;">',"<h4>","As of December 8th, you will no longer be able to accept payments using Stripe. Please click <a id='stripeNeedsInfoLink' style='float:none;font-size:13px;' href='#'>here</a> to provide Stripe with the information they need for you to continue to accept payments in Xero.","</h4 >",'<span class="close-tip" id="closeStripeBanner"></span>',"</div>"].join(""),o=document.createElement("div");if(o.innerHTML=a,o.className="x-paymentservices-tip x-stripe-banner","Invoice"==e.context)var r=Ext.select("div.status").first();else"RepeatingTemplate"==e.context&&(r=Ext.select("#xn_banner").first());r&&r.dom&&(r.dom.insertAdjacentElement("beforebegin",o),Ext.fly("closeStripeBanner").on("click",function(){o.parentNode.removeChild(o)}),Ext.fly("stripeNeedsInfoLink").on("click",e.btnClick,e));break}}},renderToInvoice:function(){var t=this,e={hasPaymentGateways:t.hasPaymentGateways,paymentGatewayGroups:Ext.clean(t.paymentGatewayGroups.map(function(t){if(!0===t.active)return t})),showEdit:t.showEdit};t.paymentGatewayGroups.forEach(function(e){if("PAYMENTGATEWAYGROUP/CREDITCARD"===e.type&&(t.relevantStripePG=e.paymentGateways.find(function(t){return"PAYMENTGATEWAY/STRIPE"===t.type}),t.relevantStripePG&&(t.completeSetupPaymentGatewayId=t.relevantStripePG.paymentGatewayId,t.providerStatus=t.relevantStripePG.providerStatus,"VERIFYING"===t.relevantStripePG.providerStatus||"DETAILSREQUIRED"===t.relevantStripePG.providerStatus))){var n="Your Stripe account is still pending. Check back in 10 minutes for an updated status.";"DETAILSREQUIRED"===t.relevantStripePG.providerStatus&&(n="Stripe needs more information. Click 'Complete set up' below to provide Stripe with the information they need."),t.setStripeBanner(n)}}),e.paymentGatewayGroups.length>0?t.update(t.tpl.apply(e)):t.update(t.emptyTpl.apply(e)),t.fireEvent("renderedtoinvoice",t,e),t.showStripeNeedsInfoBanner(t.paymentGatewayGroups)},setStripeBanner:function(t){Ext.select(".x-stripe-banner").remove();var e=['<div class="tip-content" style="float:none;">',"<h4>",t,"</h4 >",'<span class="close-tip" id="closeStripeBanner"></span>',"</div>"].join(""),n=document.createElement("div");n.innerHTML=e,n.className="x-paymentservices-tip x-stripe-banner";var i=Ext.select("div.status").first();i&&i.dom&&(i.dom.insertAdjacentElement("beforebegin",n),Ext.fly("closeStripeBanner").on("click",function(){n.parentNode.removeChild(n)}))},btnClick:function(t,e){var n=this;if(t.preventDefault(),n.isIFrameReady&&(t.getTarget("#tooltipPSBtn")&&(n.hasPaymentGateways?n.track("Click Tooltip: Complete set up","Continue SO",{dimension21:n.context,dimension22:n.toolTipVersion}):n.track("Tooltip button","Launch provisioning",{dimension21:n.context,dimension22:n.toolTipVersion})),t.getTarget("#setupPSBtn")&&n.track("Click link","Launch provisioning",{dimension21:n.context,dimension22:n.toolTipVersion}),t.getTarget("#managePSBtn")&&(n.track("Click Link: Manage","Invoice Manage",{dimension21:n.context,dimension22:n.toolTipVersion}),n.track("Click link","Launch payments management",{dimension21:n.context,dimension22:n.toolTipVersion})),t.getTarget("#stripeNeedsInfoLink")&&n.track("Click link","Stripe needs info",{}),t.getTarget("a"))){n.pointerTip&&n.pointerTip.destroy();try{if(!0===n.showPopup){var i=n.relevantStripePG&&("ONBOARDING"==n.relevantStripePG.providerStatus||"DETAILSREQUIRED"==n.relevantStripePG.providerStatus),a=n.relevantStripePG&&!n.relevantStripePG.paymentAccountId;t.getTarget("#tooltipPSBtn")&&i?n.getCompleteSetupUrl(n.completeSetupPaymentGatewayId):t.getTarget("#tooltipPSBtn")&&a?n.iframeMgr.show(!1,!0,n.relevantStripePG.paymentGatewayId):t.getTarget("#stripeNeedsInfoLink")?n.getCompleteSetupUrl(n.deferredPaymentGatewayId):n.iframeMgr.show(!0,n.fromOauthRedirect,n.paymentGatewayId)}else window.open(n.paymentGatewaysSettingsUrl||"/Settings/PaymentGateways/")}catch(t){location.href="/Settings/PaymentGateways/"}}},getCompleteSetupUrl:function(t){var e=this,n="RepeatingTemplate"==e.context?location.origin+e.paymentGatewaysSettingsUrl:location.href;Ext.Ajax.request({url:"/Accounts/Receivable/PaymentServiceProvisioning/CreateCompleteSetupUrl",method:"POST",timeout:6e4,params:{originUrl:n,paymentGatewayId:t},success:function(t){var n=Ext.decode(t.responseText),i=n.url;"RepeatingTemplate"==e.context?window.open(i):location.href=i},failure:function(t){Ext.decode(t.responseText);e.showError("An error occurred. Please try again")}})},showToolTip:function(){function t(){a=Ext.get("onlinePaymentsTip").getXY();try{e.pointerTip.getEl().setXY(a)}catch(t){}}var e=this;switch(e.countryCode){case"CNTRY/US":"ACH Debit";break;case"CNTRY/CA":"Pre-authorized Debit";break;case"CNTRY/AU":case"CNTRY/GB":"direct debit";break;default:""}var n=['<div id="tipContent" class="tip-content">',"<h4>{0}</h4>","<p>{1}</p>",'<a class="btn-setup" id="tooltipPSBtn" href="#">{2}</a>','<span class="close-tip" id="closeTip"></span>',"</div>"].join(""),i=document.createElement("div");i.innerHTML=Ext.String.format(n,e.toolTipHeader,e.toolTipText,e.toolTipButtonLabel),e.pointerTip=new XERO.tip.PointerTip({target:Ext.fly("onlinePaymentsTip"),title:"",cls:"x-pointer-tip x-paymentservices-tip",contentEl:i,closable:!0,width:325,listeners:{hide:function(){e.removeToolTip()}}}),e.pointerTip.setColor("white"),e.pointerTip.show(),Ext.fly("tooltipPSBtn").on("click",e.btnClick,e),Ext.fly("closeTip").on("click",e.removeToolTip,e);var a,o=Date.now(),r=setInterval(function(){t(),Date.now()-o>3e3&&clearInterval(r)},300);XERO.bus.addListener("gettingstarted:hidden",t),XERO.bus.addListener("gettingstarted:show",t),window.addEventListener("resize",t),e.track("Show tooltip","Launch provisioning",{dimension21:e.context,dimension22:e.toolTipVersion})},removeToolTip:function(){var t=this;t.pointerTip.destroy(),Ext.Ajax.request({url:"/Accounts/Receivable/PaymentServiceProvisioning/SaveTooltipState?code="+t.hideToolTipCode+"&display=false",method:"POST",callback:function(){}}),t.hasPaymentGateways?t.track("Close Tooltip: Complete set up","Continue SO",{dimension21:t.context,dimension22:t.toolTipVersion}):t.track("Close tooltip","Launch provisioning",{dimension21:t.context,dimension22:t.toolTipVersion})},track:function(t,e,n){var i=Ext.apply({hitType:"event",eventCategory:"Payment methods",eventAction:t,eventLabel:e},n||{});window.ga&&window.ga("send",i)}}),Ext.onReady(function(){function t(t,e){var n=t.split("?");if(n.length>=2){for(var i=encodeURIComponent(e.toLowerCase())+"=",a=n[1].split(/[&;]/g),o=a.length;o-- >0;)-1!==a[o].toLowerCase().lastIndexOf(i,0)&&a.splice(o,1);return t=n[0]+"?"+a.join("&")}return t}var e=-1!==location.hash.indexOf("Stripe")||-1!==location.hash.indexOf("PayPal"),n=Ext.urlDecode(location.search),i=Ext.get("onlinePaymentsContainer");if(i){var a=i.getAttribute("data-for"),o=i.getAttribute("data-documentid"),r=i.getAttribute("data-status"),s=i.getAttribute("data-templateid"),l="True"==i.getAttribute("data-isnew");new XERO.invoicing.paymentservices.OnlinePaymentsContainer({id:"onlinePayments",renderTo:"onlinePaymentsContainer",showPopup:!1,fromOauthRedirect:e,paymentGatewayId:n.PaymentGatewayID,disableTooltip:-1!==location.href.indexOf("setuppayments"),context:a||"Invoice",invoiceId:o,templateId:s,invoiceStatus:r,isNew:l,providerStatus:null,completeSetupPaymentGatewayId:null,listeners:{iframeready:function(i){-1!==location.href.indexOf("setuppayments")&&(!0===e&&"pushState"in history&&history.pushState("",document.title,t(t(window.location.pathname+window.location.search,"setuppayments"),"paymentgatewayid")),i.iframeMgr.show(!1,e,n.PaymentGatewayID))}}})}else if(-1!==location.href.indexOf("setuppayments")){new XERO.invoicing.paymentservices.IFrameManager({documentId:null,listeners:{selectionchange:function(t){},ready:function(t){t.show(!1,!1,null)}}})}})}]));