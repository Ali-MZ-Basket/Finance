!function(){"use strict";function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function c(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,r,n;t=i,n=o[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})}return i}function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function i(e,t,r){return(i=a()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&o(i,r.prototype),i}).apply(null,arguments)}function l(e){var r="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return i(e,arguments,s(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o(t,e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(n){var i=a();return function(){var e,t=s(n);if(i){var r=s(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?h(e):t}(this,e)}}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(e,t){return e(t={exports:{}},t.exports),t.exports}function _(e){return e&&e.Math==Math&&e}function m(e){try{return!!e()}catch(e){return!0}}function y(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function k(e){return O.call(e).slice(8,-1)}function b(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function S(e){return N(b(e))}function w(e){return"object"===D(e)?null!==e:"function"==typeof e}function T(e,t){if(!w(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!w(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!w(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!w(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}function E(e,t){return L.call(e,t)}function A(e){return q?F.createElement(e):{}}function x(e){if(!w(e))throw TypeError(String(e)+" is not an object");return e}function C(t,r){try{z(R,t,r)}catch(e){R[t]=r}return r}var R=_("object"==("undefined"==typeof globalThis?"undefined":D(globalThis))&&globalThis)||_("object"==("undefined"==typeof window?"undefined":D(window))&&window)||_("object"==("undefined"==typeof self?"undefined":D(self))&&self)||_("object"==D(r)&&r)||Function("return this")(),U=!m(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),P={}.propertyIsEnumerable,I=Object.getOwnPropertyDescriptor,M={f:I&&!P.call({1:2},1)?function(e){var t=I(this,e);return!!t&&t.enumerable}:P},O={}.toString,j="".split,N=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==k(e)?j.call(e,""):Object(e)}:Object,L={}.hasOwnProperty,F=R.document,q=w(F)&&w(F.createElement),B=!U&&!m(function(){return 7!=Object.defineProperty(A("div"),"a",{get:function(){return 7}}).a}),H=Object.getOwnPropertyDescriptor,V={f:U?H:function(e,t){if(e=S(e),t=T(t,!0),B)try{return H(e,t)}catch(e){}if(E(e,t))return y(!M.f.call(e,t),e[t])}},J=Object.defineProperty,K={f:U?J:function(e,t,r){if(x(e),t=T(t,!0),x(r),B)try{return J(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},z=U?function(e,t,r){return K.f(e,t,y(1,r))}:function(e,t,r){return e[t]=r,e},Q="__core-js_shared__",X=R[Q]||C(Q,{}),G=Function.toString;"function"!=typeof X.inspectSource&&(X.inspectSource=function(e){return G.call(e)});function Z(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++se+ae).toString(36)}function Y(e){return ue[e]||(ue[e]=Z(e))}var $,ee,te,re=X.inspectSource,ne=R.WeakMap,ie="function"==typeof ne&&/native code/.test(re(ne)),oe=v(function(e){(e.exports=function(e,t){return X[e]||(X[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),se=0,ae=Math.random(),ue=oe("keys"),ce={},le=R.WeakMap;if(ie){var de=new le,he=de.get,fe=de.has,pe=de.set;$=function(e,t){return pe.call(de,e,t),t},ee=function(e){return he.call(de,e)||{}},te=function(e){return fe.call(de,e)}}else{var ge=Y("state");ce[ge]=!0,$=function(e,t){return z(e,ge,t),t},ee=function(e){return E(e,ge)?e[ge]:{}},te=function(e){return E(e,ge)}}function ve(e){return"function"==typeof e?e:void 0}function _e(e,t){return arguments.length<2?ve(Ce[e])||ve(R[e]):Ce[e]&&Ce[e][t]||R[e]&&R[e][t]}function me(e){return isNaN(e=+e)?0:(0<e?Ue:Re)(e)}function ye(e){return 0<e?Pe(me(e),9007199254740991):0}function ke(a){return function(e,t,r){var n,i=S(e),o=ye(i.length),s=function(e,t){var r=me(e);return r<0?Ie(r+t,0):Me(r,t)}(r,o);if(a&&t!=t){for(;s<o;)if((n=i[s++])!=n)return!0}else for(;s<o;s++)if((a||s in i)&&i[s]===t)return a||s||0;return!a&&-1}}function be(e,t){var r,n=S(e),i=0,o=[];for(r in n)!E(ce,r)&&E(n,r)&&o.push(r);for(;t.length>i;)E(n,r=t[i++])&&(~je(o,r)||o.push(r));return o}function Se(e,t){for(var r=Be(t),n=K.f,i=V.f,o=0;o<r.length;o++){var s=r[o];E(e,s)||n(e,s,i(t,s))}}function we(e,t){var r=He[We(e)];return r==Je||r!=Ve&&("function"==typeof t?m(t):!!t)}function Te(e,t){var r,n,i,o,s,a=e.target,u=e.global,c=e.stat;if(r=u?R:c?R[a]||C(a,{}):(R[a]||{}).prototype)for(n in t){if(o=t[n],i=e.noTargetGet?(s=ze(r,n))&&s.value:r[n],!Ke(u?n:a+(c?".":"#")+n,e.forced)&&void 0!==i){if(D(o)===D(i))continue;Se(o,i)}(e.sham||i&&i.sham)&&z(o,"sham",!0),xe(r,n,o,e)}}function Ee(e){return Object(b(e))}var Ae={set:$,get:ee,has:te,enforce:function(e){return te(e)?ee(e):$(e,{})},getterFor:function(r){return function(e){var t;if(!w(e)||(t=ee(e)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return t}}},xe=v(function(e){var t=Ae.get,a=Ae.enforce,u=String(String).split("String");(e.exports=function(e,t,r,n){var i=!!n&&!!n.unsafe,o=!!n&&!!n.enumerable,s=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||E(r,"name")||z(r,"name",t),a(r).source=u.join("string"==typeof t?t:"")),e!==R?(i?!s&&e[t]&&(o=!0):delete e[t],o?e[t]=r:z(e,t,r)):o?e[t]=r:C(t,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||re(this)})}),Ce=R,Re=Math.ceil,Ue=Math.floor,Pe=Math.min,Ie=Math.max,Me=Math.min,Oe={includes:ke(!0),indexOf:ke(!1)},je=Oe.indexOf,Ne=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Le=Ne.concat("length","prototype"),Fe={f:Object.getOwnPropertyNames||function(e){return be(e,Le)}},qe={f:Object.getOwnPropertySymbols},Be=_e("Reflect","ownKeys")||function(e){var t=Fe.f(x(e)),r=qe.f;return r?t.concat(r(e)):t},De=/#|\.prototype\./,We=we.normalize=function(e){return String(e).replace(De,".").toLowerCase()},He=we.data={},Ve=we.NATIVE="N",Je=we.POLYFILL="P",Ke=we,ze=V.f,Qe=Object.keys||function(e){return be(e,Ne)},Xe=Object.assign,Ge=Object.defineProperty,Ze=!Xe||m(function(){if(U&&1!==Xe({b:1},Xe(Ge({},"a",{enumerable:!0,get:function(){Ge(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=Xe({},e)[r]||Qe(Xe({},t)).join("")!=n})?function(e,t){for(var r=Ee(e),n=arguments.length,i=1,o=qe.f,s=M.f;i<n;)for(var a,u=N(arguments[i++]),c=o?Qe(u).concat(o(u)):Qe(u),l=c.length,d=0;d<l;)a=c[d++],U&&!s.call(u,a)||(r[a]=u[a]);return r}:Xe;Te({target:"Object",stat:!0,forced:Object.assign!==Ze},{assign:Ze});function Ye(a){return function(e,t){var r,n,i=String(b(e)),o=me(t),s=i.length;return o<0||s<=o?a?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===s||(n=i.charCodeAt(o+1))<56320||57343<n?a?i.charAt(o):r:a?i.slice(o,o+2):n-56320+(r-55296<<10)+65536}}Ce.Object.assign;function $e(e){return E(lt,e)||(ut&&E(dt,e)?lt[e]=dt[e]:lt[e]=ht("Symbol."+e)),lt[e]}var et,tt,rt,nt={codeAt:Ye(!1),charAt:Ye(!0)},it=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),ot=Y("IE_PROTO"),st=Object.prototype,at=it?Object.getPrototypeOf:function(e){return e=Ee(e),E(e,ot)?e[ot]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?st:null},ut=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),ct=ut&&!Symbol.sham&&"symbol"==D(Symbol.iterator),lt=oe("wks"),dt=R.Symbol,ht=ct?dt:dt&&dt.withoutSetter||Z,ft=$e("iterator"),pt=!1;[].keys&&("next"in(rt=[].keys())?(tt=at(at(rt)))!==Object.prototype&&(et=tt):pt=!0),null==et&&(et={}),E(et,ft)||z(et,ft,function(){return this});function gt(){}function vt(e){return"<script>"+e+"</"+St+">"}var _t,mt={IteratorPrototype:et,BUGGY_SAFARI_ITERATORS:pt},yt=U?Object.defineProperties:function(e,t){x(e);for(var r,n=Qe(t),i=n.length,o=0;o<i;)K.f(e,r=n[o++],t[r]);return e},kt=_e("document","documentElement"),bt="prototype",St="script",wt=Y("IE_PROTO"),Tt=function(){try{_t=document.domain&&new ActiveXObject("htmlfile")}catch(e){}Tt=_t?function(e){e.write(vt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(_t):function(){var e,t=A("iframe");return t.style.display="none",kt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(vt("document.F=Object")),e.close(),e.F}();for(var e=Ne.length;e--;)delete Tt[bt][Ne[e]];return Tt()};ce[wt]=!0;function Et(e,t,r){e&&!E(e=r?e:e.prototype,Pt)&&Ut(e,Pt,{configurable:!0,value:t})}function At(){return this}function xt(){return this}function Ct(e,t,r,n,i,o,s){function a(e){if(e===i&&g)return g;if(!Nt&&e in f)return f[e];switch(e){case"keys":case Ft:case qt:return function(){return new r(this,e)}}return function(){return new r(this)}}!function(e,t,r){var n=t+" Iterator";e.prototype=Rt(Mt,{next:y(1,r)}),Et(e,n,!1),It[n]=At}(r,t,n);var u,c,l,d=t+" Iterator",h=!1,f=e.prototype,p=f[Lt]||f["@@iterator"]||i&&f[i],g=!Nt&&p||a(i),v="Array"==t&&f.entries||p;if(v&&(u=at(v.call(new e)),jt!==Object.prototype&&u.next&&(at(u)!==jt&&(Ot?Ot(u,jt):"function"!=typeof u[Lt]&&z(u,Lt,xt)),Et(u,d,!0))),i==Ft&&p&&p.name!==Ft&&(h=!0,g=function(){return p.call(this)}),f[Lt]!==g&&z(f,Lt,g),It[t]=g,i)if(c={values:a(Ft),keys:o?g:a("keys"),entries:a(qt)},s)for(l in c)!Nt&&!h&&l in f||xe(f,l,c[l]);else Te({target:t,proto:!0,forced:Nt||h},c);return c}var Rt=Object.create||function(e,t){var r;return null!==e?(gt[bt]=x(e),r=new gt,gt[bt]=null,r[wt]=e):r=Tt(),void 0===t?r:yt(r,t)},Ut=K.f,Pt=$e("toStringTag"),It={},Mt=mt.IteratorPrototype,Ot=Object.setPrototypeOf||("__proto__"in{}?function(){var r,n=!1,e={};try{(r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),n=e instanceof Array}catch(e){}return function(e,t){return x(e),function(e){if(!w(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),n?r.call(e,t):e.__proto__=t,e}}():void 0),jt=mt.IteratorPrototype,Nt=mt.BUGGY_SAFARI_ITERATORS,Lt=$e("iterator"),Ft="values",qt="entries",Bt=nt.charAt,Dt="String Iterator",Wt=Ae.set,Ht=Ae.getterFor(Dt);Ct(String,"String",function(e){Wt(this,{type:Dt,string:String(e),index:0})},function(){var e,t=Ht(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=Bt(r,n),t.index+=e.length,{value:e,done:!1})});function Vt(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function Jt(n,i,e){if(Vt(n),void 0===i)return n;switch(e){case 0:return function(){return n.call(i)};case 1:return function(e){return n.call(i,e)};case 2:return function(e,t){return n.call(i,e,t)};case 3:return function(e,t,r){return n.call(i,e,t,r)}}return function(){return n.apply(i,arguments)}}function Kt(t,e,r,n){try{return n?e(x(r)[0],r[1]):e(r)}catch(e){var i=t.return;throw void 0!==i&&x(i.call(t)),e}}function zt(e){return void 0!==e&&(It.Array===e||Gt[Xt]===e)}function Qt(e,t,r){var n=T(t);n in e?K.f(e,n,y(0,r)):e[n]=r}var Xt=$e("iterator"),Gt=Array.prototype,Zt={};Zt[$e("toStringTag")]="z";function Yt(e){if(null!=e)return e[nr]||e["@@iterator"]||It[rr(e)]}var $t="[object z]"===String(Zt),er=$e("toStringTag"),tr="Arguments"==k(function(){return arguments}()),rr=$t?k:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),er))?r:tr?k(t):"Object"==(n=k(t))&&"function"==typeof t.callee?"Arguments":n},nr=$e("iterator"),ir=$e("iterator"),or=!1;try{var sr=0,ar={next:function(){return{done:!!sr++}},return:function(){or=!0}};ar[ir]=function(){return this},Array.from(ar,function(){throw 2})}catch(e){}function ur(e,t){if(!t&&!or)return!1;var r=!1;try{var n={};n[ir]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r}var cr=!ur(function(e){Array.from(e)});Te({target:"Array",stat:!0,forced:cr},{from:function(e,t,r){var n,i,o,s,a,u,c=Ee(e),l="function"==typeof this?this:Array,d=arguments.length,h=1<d?t:void 0,f=void 0!==h,p=Yt(c),g=0;if(f&&(h=Jt(h,2<d?r:void 0,2)),null==p||l==Array&&zt(p))for(i=new l(n=ye(c.length));g<n;g++)u=f?h(c[g],g):c[g],Qt(i,g,u);else for(a=(s=p.call(c)).next,i=new l;!(o=a.call(s)).done;g++)u=f?Kt(s,h,[o.value,g],!0):o.value,Qt(i,g,u);return i.length=g,i}});Ce.Array.from;function lr(e,t){var r;return hr(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!hr(r.prototype)?w(r)&&null===(r=r[fr])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)}function dr(f){var p=1==f,g=2==f,v=3==f,_=4==f,m=6==f,y=5==f||m;return function(e,t,r,n){for(var i,o,s=Ee(e),a=N(s),u=Jt(t,r,3),c=ye(a.length),l=0,d=n||lr,h=p?d(e,c):g?d(e,0):void 0;l<c;l++)if((y||l in a)&&(o=u(i=a[l],l,s),f))if(p)h[l]=o;else if(o)switch(f){case 3:return!0;case 5:return i;case 6:return l;case 2:pr.call(h,i)}else if(_)return!1;return m?-1:v||_?_:h}}var hr=Array.isArray||function(e){return"Array"==k(e)},fr=$e("species"),pr=[].push,gr={forEach:dr(0),map:dr(1),filter:dr(2),some:dr(3),every:dr(4),find:dr(5),findIndex:dr(6)},vr=$e("unscopables"),_r=Array.prototype;null==_r[vr]&&K.f(_r,vr,{configurable:!0,value:Rt(null)});function mr(e){_r[vr][e]=!0}function yr(e){throw e}function kr(e,t){if(E(Sr,e))return Sr[e];var r=[][e],n=!!E(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=E(t,0)?t[0]:yr,o=E(t,1)?t[1]:void 0;return Sr[e]=!!r&&!m(function(){if(n&&!U)return!0;var e={length:-1};n?br(e,1,{enumerable:!0,get:yr}):e[1]=1,r.call(e,i,o)})}var br=Object.defineProperty,Sr={},wr=gr.find,Tr="find",Er=!0,Ar=kr(Tr);Tr in[]&&Array(1)[Tr](function(){Er=!1}),Te({target:"Array",proto:!0,forced:Er||!Ar},{find:function(e,t){return wr(this,e,1<arguments.length?t:void 0)}}),mr(Tr);function xr(e,t,r){return Jt(Cr,R[e].prototype[t],r)}var Cr=Function.call,Rr=(xr("Array","find"),gr.findIndex),Ur="findIndex",Pr=!0,Ir=kr(Ur);Ur in[]&&Array(1)[Ur](function(){Pr=!1}),Te({target:"Array",proto:!0,forced:Pr||!Ir},{findIndex:function(e,t){return Rr(this,e,1<arguments.length?t:void 0)}}),mr(Ur);xr("Array","findIndex");var Mr=Oe.includes,Or=kr("indexOf",{ACCESSORS:!0,1:0});Te({target:"Array",proto:!0,forced:!Or},{includes:function(e,t){return Mr(this,e,1<arguments.length?t:void 0)}}),mr("includes");xr("Array","includes");function jr(e){if(function(e){var t;return w(e)&&(void 0!==(t=e[Fr])?!!t:"RegExp"==k(e))}(e))throw TypeError("The method doesn't accept regular expressions");return e}function Nr(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[qr]=!1,"/./"[t](r)}catch(e){}}return!1}var Lr,Fr=$e("match"),qr=$e("match"),Br=V.f,Dr="".endsWith,Wr=Math.min,Hr=Nr("endsWith"),Vr=!(Hr||(!(Lr=Br(String.prototype,"endsWith"))||Lr.writable));Te({target:"String",proto:!0,forced:!Vr&&!Hr},{endsWith:function(e,t){var r=String(b(this));jr(e);var n=1<arguments.length?t:void 0,i=ye(r.length),o=void 0===n?i:Wr(ye(n),i),s=String(e);return Dr?Dr.call(r,s,o):r.slice(o-s.length,o)===s}});xr("String","endsWith");Te({target:"String",proto:!0,forced:!Nr("includes")},{includes:function(e,t){return!!~String(b(this)).indexOf(jr(e),1<arguments.length?t:void 0)}});xr("String","includes");var Jr,Kr=V.f,zr="".startsWith,Qr=Math.min,Xr=Nr("startsWith"),Gr=!(Xr||(!(Jr=Kr(String.prototype,"startsWith"))||Jr.writable));Te({target:"String",proto:!0,forced:!Gr&&!Xr},{startsWith:function(e,t){var r=String(b(this));jr(e);var n=ye(Qr(1<arguments.length?t:void 0,r.length)),i=String(e);return zr?zr.call(r,i,n):r.slice(n,n+i.length)===i}});xr("String","startsWith");var Zr=$t?{}.toString:function(){return"[object "+rr(this)+"]"};$t||xe(Object.prototype,"toString",Zr,{unsafe:!0});var Yr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},$r="Array Iterator",en=Ae.set,tn=Ae.getterFor($r),rn=Ct(Array,"Array",function(e,t){en(this,{type:$r,target:S(e),index:0,kind:t})},function(){var e=tn(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?{value:e.target=void 0,done:!0}:"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}},"values");It.Arguments=It.Array,mr("keys"),mr("values"),mr("entries");var nn=$e("iterator"),on=$e("toStringTag"),sn=rn.values;for(var an in Yr){var un=R[an],cn=un&&un.prototype;if(cn){if(cn[nn]!==sn)try{z(cn,nn,sn)}catch(e){cn[nn]=sn}if(cn[on]||z(cn,on,an),Yr[an])for(var ln in rn)if(cn[ln]!==rn[ln])try{z(cn,ln,rn[ln])}catch(e){cn[ln]=rn[ln]}}}function dn(e,t){var r,n=x(e).constructor;return void 0===n||null==(r=x(n)[Sn])?t:Vt(r)}function hn(e){if(In.hasOwnProperty(e)){var t=In[e];delete In[e],t()}}function fn(e){return function(){hn(e)}}function pn(e){hn(e.data)}function gn(e){R.postMessage(e+"",En.protocol+"//"+En.host)}var vn,_n,mn,yn=R.Promise,kn=$e("species"),bn=v(function(e){function f(e,t){this.stopped=e,this.result=t}(e.exports=function(e,t,r,n,i){var o,s,a,u,c,l,d,h=Jt(t,r,n?2:1);if(i)o=e;else{if("function"!=typeof(s=Yt(e)))throw TypeError("Target is not iterable");if(zt(s)){for(a=0,u=ye(e.length);a<u;a++)if((c=n?h(x(d=e[a])[0],d[1]):h(e[a]))&&c instanceof f)return c;return new f(!1)}o=s.call(e)}for(l=o.next;!(d=l.call(o)).done;)if("object"==D(c=Kt(o,h,d.value,n))&&c&&c instanceof f)return c;return new f(!1)}).stop=function(e){return new f(!0,e)}}),Sn=$e("species"),wn=_e("navigator","userAgent")||"",Tn=/(iphone|ipod|ipad).*applewebkit/i.test(wn),En=R.location,An=R.setImmediate,xn=R.clearImmediate,Cn=R.process,Rn=R.MessageChannel,Un=R.Dispatch,Pn=0,In={},Mn="onreadystatechange";An&&xn||(An=function(e){for(var t=[],r=1;r<arguments.length;)t.push(arguments[r++]);return In[++Pn]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},vn(Pn),Pn},xn=function(e){delete In[e]},"process"==k(Cn)?vn=function(e){Cn.nextTick(fn(e))}:Un&&Un.now?vn=function(e){Un.now(fn(e))}:Rn&&!Tn?(mn=(_n=new Rn).port2,_n.port1.onmessage=pn,vn=Jt(mn.postMessage,mn,1)):!R.addEventListener||"function"!=typeof postMessage||R.importScripts||m(gn)||"file:"===En.protocol?vn=Mn in A("script")?function(e){kt.appendChild(A("script"))[Mn]=function(){kt.removeChild(this),hn(e)}}:function(e){setTimeout(fn(e),0)}:(vn=gn,R.addEventListener("message",pn,!1)));var On,jn,Nn,Ln,Fn,qn,Bn,Dn,Wn={set:An,clear:xn},Hn=V.f,Vn=Wn.set,Jn=R.MutationObserver||R.WebKitMutationObserver,Kn=R.process,zn=R.Promise,Qn="process"==k(Kn),Xn=Hn(R,"queueMicrotask"),Gn=Xn&&Xn.value;Gn||(On=function(){var e,t;for(Qn&&(e=Kn.domain)&&e.exit();jn;){t=jn.fn,jn=jn.next;try{t()}catch(e){throw jn?Ln():Nn=void 0,e}}Nn=void 0,e&&e.enter()},Ln=Qn?function(){Kn.nextTick(On)}:Jn&&!Tn?(Fn=!0,qn=document.createTextNode(""),new Jn(On).observe(qn,{characterData:!0}),function(){qn.data=Fn=!Fn}):zn&&zn.resolve?(Bn=zn.resolve(void 0),Dn=Bn.then,function(){Dn.call(Bn,On)}):function(){Vn.call(R,On)});function Zn(e){var r,n;this.promise=new e(function(e,t){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=e,n=t}),this.resolve=Vt(r),this.reject=Vt(n)}function Yn(e,t){if(x(e),w(t)&&t.constructor===e)return t;var r=ni.f(e);return(0,r.resolve)(t),r.promise}function $n(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}var ei,ti,ri=Gn||function(e){var t={fn:e,next:void 0};Nn&&(Nn.next=t),jn||(jn=t,Ln()),Nn=t},ni={f:function(e){return new Zn(e)}},ii=R.process,oi=ii&&ii.versions,si=oi&&oi.v8;si?ti=(ei=si.split("."))[0]+ei[1]:wn&&(!(ei=wn.match(/Edge\/(\d+)/))||74<=ei[1])&&(ei=wn.match(/Chrome\/(\d+)/))&&(ti=ei[1]);function ai(e){var t;return!(!w(e)||"function"!=typeof(t=e.then))&&t}function ui(d,h,f){if(!h.notified){h.notified=!0;var p=h.reactions;ri(function(){for(var e=h.value,t=1==h.state,r=0;p.length>r;){var n,i,o,s=p[r++],a=t?s.ok:s.fail,u=s.resolve,c=s.reject,l=s.domain;try{a?(t||(2===h.rejection&&Bi(d,h),h.rejection=1),!0===a?n=e:(l&&l.enter(),n=a(e),l&&(l.exit(),o=!0)),n===s.promise?c(xi("Promise-chain cycle")):(i=ai(n))?i.call(n,u,c):u(n)):c(e)}catch(e){l&&!o&&l.exit(),c(e)}}h.reactions=[],h.notified=!1,f&&!h.rejection&&Fi(d,h)})}}function ci(e,t,r){var n,i;Oi?((n=Ci.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),R.dispatchEvent(n)):n={promise:t,reason:r},(i=R["on"+e])?i(n):e===ji&&function(e,t){var r=R.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)}function li(t,r,n,i){return function(e){t(r,n,e,i)}}function di(e,t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,ui(e,t,!0))}function hi(r,n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(r===e)throw xi("Promise can't be resolved itself");var i=ai(e);i?ri(function(){var t={done:!1};try{i.call(e,li(hi,r,t,n),li(di,r,t,n))}catch(e){di(r,t,e,n)}}):(n.value=e,n.state=1,ui(r,n,!1))}catch(e){di(r,{done:!1},e,n)}}}var fi,pi,gi,vi,_i,mi,yi=ti&&+ti,ki=Wn.set,bi=$e("species"),Si="Promise",wi=Ae.get,Ti=Ae.set,Ei=Ae.getterFor(Si),Ai=yn,xi=R.TypeError,Ci=R.document,Ri=R.process,Ui=_e("fetch"),Pi=ni.f,Ii=Pi,Mi="process"==k(Ri),Oi=!!(Ci&&Ci.createEvent&&R.dispatchEvent),ji="unhandledrejection",Ni=Ke(Si,function(){if(!(re(Ai)!==String(Ai))){if(66===yi)return!0;if(!Mi&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=yi&&/native code/.test(Ai))return!1;function e(e){e(function(){},function(){})}var t=Ai.resolve(1);return(t.constructor={})[bi]=e,!(t.then(function(){})instanceof e)}),Li=Ni||!ur(function(e){Ai.all(e).catch(function(){})}),Fi=function(r,n){ki.call(R,function(){var e,t=n.value;if(qi(n)&&(e=$n(function(){Mi?Ri.emit("unhandledRejection",t,r):ci(ji,r,t)}),n.rejection=Mi||qi(n)?2:1,e.error))throw e.value})},qi=function(e){return 1!==e.rejection&&!e.parent},Bi=function(e,t){ki.call(R,function(){Mi?Ri.emit("rejectionHandled",e):ci("rejectionhandled",e,t.value)})};Ni&&(Ai=function(e){!function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation")}(this,Ai,Si),Vt(e),fi.call(this);var t=wi(this);try{e(li(hi,this,t),li(di,this,t))}catch(e){di(this,t,e)}},(fi=function(e){Ti(this,{type:Si,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(e,t,r){for(var n in t)xe(e,n,t[n],r);return e}(Ai.prototype,{then:function(e,t){var r=Ei(this),n=Pi(dn(this,Ai));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=Mi?Ri.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&ui(this,r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),pi=function(){var e=new fi,t=wi(e);this.promise=e,this.resolve=li(hi,e,t),this.reject=li(di,e,t)},ni.f=Pi=function(e){return e===Ai||e===gi?new pi(e):Ii(e)},"function"==typeof yn&&(vi=yn.prototype.then,xe(yn.prototype,"then",function(e,t){var r=this;return new Ai(function(e,t){vi.call(r,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof Ui&&Te({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Yn(Ai,Ui.apply(R,arguments))}}))),Te({global:!0,wrap:!0,forced:Ni},{Promise:Ai}),Et(Ai,Si,!1),_i=_e(Si),mi=K.f,U&&_i&&!_i[kn]&&mi(_i,kn,{configurable:!0,get:function(){return this}}),gi=_e(Si),Te({target:Si,stat:!0,forced:Ni},{reject:function(e){var t=Pi(this);return t.reject.call(void 0,e),t.promise}}),Te({target:Si,stat:!0,forced:Ni},{resolve:function(e){return Yn(this,e)}}),Te({target:Si,stat:!0,forced:Li},{all:function(e){var a=this,t=Pi(a),u=t.resolve,c=t.reject,r=$n(function(){var n=Vt(a.resolve),i=[],o=0,s=1;bn(e,function(e){var t=o++,r=!1;i.push(void 0),s++,n.call(a,e).then(function(e){r||(r=!0,i[t]=e,--s||u(i))},c)}),--s||u(i)});return r.error&&c(r.value),t.promise},race:function(e){var r=this,n=Pi(r),i=n.reject,t=$n(function(){var t=Vt(r.resolve);bn(e,function(e){t.call(r,e).then(n.resolve,i)})});return t.error&&i(t.value),n.promise}}),Te({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=ni.f(a),u=t.resolve,r=t.reject,n=$n(function(){var n=Vt(a.resolve),i=[],o=0,s=1;bn(e,function(e){var t=o++,r=!1;i.push(void 0),s++,n.call(a,e).then(function(e){r||(r=!0,i[t]={status:"fulfilled",value:e},--s||u(i))},function(e){r||(r=!0,i[t]={status:"rejected",reason:e},--s||u(i))})}),--s||u(i)});return n.error&&r(n.value),t.promise}});var Di=!!yn&&m(function(){yn.prototype.finally.call({then:function(){}},function(){})});Te({target:"Promise",proto:!0,real:!0,forced:Di},{finally:function(t){var r=dn(this,_e("Promise")),e="function"==typeof t;return this.then(e?function(e){return Yn(r,t()).then(function(){return e})}:t,e?function(e){return Yn(r,t()).then(function(){throw e})}:t)}}),"function"!=typeof yn||yn.prototype.finally||xe(yn.prototype,"finally",_e("Promise").prototype.finally);Ce.Promise;var Wi=Ae.set,Hi=Ae.getterFor("AggregateError"),Vi=function(e,t){var r=this;if(!(r instanceof Vi))return new Vi(e,t);Ot&&(r=Ot(new Error(t),at(r)));var n=[];return bn(e,n.push,n),U?Wi(r,{errors:n,type:"AggregateError"}):r.errors=n,void 0!==t&&z(r,"message",String(t)),r};Vi.prototype=Rt(Error.prototype,{constructor:y(5,Vi),message:y(5,""),name:y(5,"AggregateError")}),U&&K.f(Vi.prototype,"errors",{get:function(){return Hi(this).errors},configurable:!0}),Te({global:!0},{AggregateError:Vi}),Te({target:"Promise",stat:!0},{try:function(e){var t=ni.f(this),r=$n(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var Ji="No one promise resolved";Te({target:"Promise",stat:!0},{any:function(e){var u=this,t=ni.f(u),c=t.resolve,l=t.reject,r=$n(function(){var n=Vt(u.resolve),i=[],o=0,s=1,a=!1;bn(e,function(e){var t=o++,r=!1;i.push(void 0),s++,n.call(u,e).then(function(e){r||a||(a=!0,c(e))},function(e){r||a||(r=!0,i[t]=e,--s||l(new(_e("AggregateError"))(i,Ji)))})}),--s||l(new(_e("AggregateError"))(i,Ji))});return r.error&&l(r.value),t.promise}});var Ki="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==Ki&&Ki,zi="URLSearchParams"in Ki,Qi="Symbol"in Ki&&"iterator"in Symbol,Xi="FileReader"in Ki&&"Blob"in Ki&&function(){try{return new Blob,!0}catch(e){return!1}}(),Gi="FormData"in Ki,Zi="ArrayBuffer"in Ki;if(Zi)var Yi=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],$i=ArrayBuffer.isView||function(e){return e&&-1<Yi.indexOf(Object.prototype.toString.call(e))};function eo(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function to(e){return"string"!=typeof e&&(e=String(e)),e}function ro(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return Qi&&(e[Symbol.iterator]=function(){return e}),e}function no(t){this.map={},t instanceof no?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function io(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function oo(r){return new Promise(function(e,t){r.onload=function(){e(r.result)},r.onerror=function(){t(r.error)}})}function so(e){var t=new FileReader,r=oo(t);return t.readAsArrayBuffer(e),r}function ao(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function uo(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:Xi&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:Gi&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:zi&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():Zi&&Xi&&function(e){return e&&DataView.prototype.isPrototypeOf(e)}(e)?(this._bodyArrayBuffer=ao(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Zi&&(ArrayBuffer.prototype.isPrototypeOf(e)||$i(e))?this._bodyArrayBuffer=ao(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):zi&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Xi&&(this.blob=function(){var e=io(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=io(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(so)}),this.text=function(){var e=io(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,r=oo(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Gi&&(this.formData=function(){return this.text().then(ho)}),this.json=function(){return this.text().then(JSON.parse)},this}no.prototype.append=function(e,t){e=eo(e),t=to(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},no.prototype.delete=function(e){delete this.map[eo(e)]},no.prototype.get=function(e){return e=eo(e),this.has(e)?this.map[e]:null},no.prototype.has=function(e){return this.map.hasOwnProperty(eo(e))},no.prototype.set=function(e,t){this.map[eo(e)]=to(t)},no.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},no.prototype.keys=function(){var r=[];return this.forEach(function(e,t){r.push(t)}),ro(r)},no.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),ro(t)},no.prototype.entries=function(){var r=[];return this.forEach(function(e,t){r.push([t,e])}),ro(r)},Qi&&(no.prototype[Symbol.iterator]=no.prototype.entries);var co=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function lo(e,t){if(!(this instanceof lo))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r=(t=t||{}).body;if(e instanceof lo){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new no(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new no(t.headers)),this.method=function(e){var t=e.toUpperCase();return-1<co.indexOf(t)?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var n=/([?&])_=[^&]*/;if(n.test(this.url))this.url=this.url.replace(n,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function ho(e){var i=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),r=t.shift().replace(/\+/g," "),n=t.join("=").replace(/\+/g," ");i.append(decodeURIComponent(r),decodeURIComponent(n))}}),i}function fo(e,t){if(!(this instanceof fo))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"",this.headers=new no(t.headers),this.url=t.url||"",this._initBody(e)}lo.prototype.clone=function(){return new lo(this,{body:this._bodyInit})},uo.call(lo.prototype),uo.call(fo.prototype),fo.prototype.clone=function(){return new fo(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new no(this.headers),url:this.url})},fo.error=function(){var e=new fo(null,{status:0,statusText:""});return e.type="error",e};var po=[301,302,303,307,308];fo.redirect=function(e,t){if(-1===po.indexOf(t))throw new RangeError("Invalid status code");return new fo(null,{status:t,headers:{location:e}})};var go=Ki.DOMException;try{new go}catch(e){(go=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),go.prototype.constructor=go}function vo(o,s){return new Promise(function(r,e){var t=new lo(o,s);if(t.signal&&t.signal.aborted)return e(new go("Aborted","AbortError"));var n=new XMLHttpRequest;function i(){n.abort()}n.onload=function(){var e={status:n.status,statusText:n.statusText,headers:function(e){var i=new no;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),r=t.shift().trim();if(r){var n=t.join(":").trim();i.append(r,n)}}),i}(n.getAllResponseHeaders()||"")};e.url="responseURL"in n?n.responseURL:e.headers.get("X-Request-URL");var t="response"in n?n.response:n.responseText;setTimeout(function(){r(new fo(t,e))},0)},n.onerror=function(){setTimeout(function(){e(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){e(new TypeError("Network request failed"))},0)},n.onabort=function(){setTimeout(function(){e(new go("Aborted","AbortError"))},0)},n.open(t.method,function(t){try{return""===t&&Ki.location.href?Ki.location.href:t}catch(e){return t}}(t.url),!0),"include"===t.credentials?n.withCredentials=!0:"omit"===t.credentials&&(n.withCredentials=!1),"responseType"in n&&(Xi?n.responseType="blob":Zi&&t.headers.get("Content-Type")&&-1!==t.headers.get("Content-Type").indexOf("application/octet-stream")&&(n.responseType="arraybuffer")),!s||"object"!==D(s.headers)||s.headers instanceof no?t.headers.forEach(function(e,t){n.setRequestHeader(t,e)}):Object.getOwnPropertyNames(s.headers).forEach(function(e){n.setRequestHeader(e,to(s.headers[e]))}),t.signal&&(t.signal.addEventListener("abort",i),n.onreadystatechange=function(){4===n.readyState&&t.signal.removeEventListener("abort",i)}),n.send(void 0===t._bodyInit?null:t._bodyInit)})}vo.polyfill=!0,Ki.fetch||(Ki.fetch=vo,Ki.Headers=no,Ki.Request=lo,Ki.Response=fo);var _o,mo,yo=function(){function t(e){W(this,t),this._name=void 0,this._callbacks={},this._name=e,this._callbacks=[]}return d(t,[{key:"addHandler",value:function(e){this._callbacks.push(e)}},{key:"removeHandler",value:function(t){var e=this._callbacks.findIndex(function(e){return e===t});0<=e&&this._callbacks.splice(e,1)}},{key:"raise",value:function(){for(var e=0;e<this._callbacks.length;e++){var t;(t=this._callbacks)[e].apply(t,arguments)}}}]),t}(),ko=function(){function e(){W(this,e),this._userReturnedEvent=void 0,this._userReturnedEvent=new yo("User returned")}return d(e,[{key:"addUserReturned",value:function(e){this._userReturnedEvent.addHandler(e)}},{key:"raiseUserReturned",value:function(){this._userReturnedEvent.raise()}}]),e}(),bo=["mousemove","keypress"],So=function(){function r(e){var t=this;W(this,r),this._options=void 0,this._eventHandles={},this._events=void 0,this._lastActiveTime=0,this.recordUserActivity=function(){10<=t.lastActiveDuration&&t.debug("User Active",t.now),t.isUserActive||t.isFirstTimeActive?t._lastActiveTime=t.now:(t._lastActiveTime=t.now,t._events.raiseUserReturned())},this._events=new ko,this._options=c({userActivityEvents:bo,userInactivityDuration:600},e)}return d(r,[{key:"start",value:function(){var t=this;this.stop(),this.recordUserActivity(),this._options.userActivityEvents.forEach(function(e){t._eventHandles[e]=t.recordUserActivity,window.addEventListener(e,t.recordUserActivity)})}},{key:"stop",value:function(){var r=this;this._options.userActivityEvents.forEach(function(e){var t=r._eventHandles[e];t&&(r._eventHandles[e]=null,window.removeEventListener(e,t))})}},{key:"debug",value:function(){if(this._options.enableLogging){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,["BrowserActivityMonitor"].concat(r))}}},{key:"isFirstTimeActive",get:function(){return 0==this._lastActiveTime}},{key:"lastActiveTime",get:function(){return this._lastActiveTime}},{key:"lastActiveDuration",get:function(){return this.now-this.lastActiveTime}},{key:"isUserActive",get:function(){return this.lastActiveDuration<this._options.userInactivityDuration}},{key:"now",get:function(){return Math.round(Date.now()/1e3)}},{key:"events",get:function(){return this._events}}]),r}(),wo={debug:function(){},info:function(){},warn:function(){},error:function(){}},To=function(){function e(){W(this,e)}return d(e,null,[{key:"reset",value:function(){mo=3,_o=wo}},{key:"debug",value:function(){if(4<=mo){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];_o.debug.apply(_o,Array.from(t))}}},{key:"info",value:function(){if(3<=mo){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];_o.info.apply(_o,Array.from(t))}}},{key:"warn",value:function(){if(2<=mo){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];_o.warn.apply(_o,Array.from(t))}}},{key:"error",value:function(){if(1<=mo){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];_o.error.apply(_o,Array.from(t))}}},{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return mo},set:function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");mo=e}},{key:"logger",get:function(){return _o},set:function(e){if(!e.debug&&e.info&&(e.debug=e.info),!(e.debug&&e.info&&e.warn&&e.error))throw new Error("Invalid logger");_o=e}}]),e}();To.reset();var Eo,Ao,xo={setInterval:(Ao=function(e,t){return setInterval(e,t)},Ro.toString=function(){return Ao.toString()},Ro),clearInterval:(Eo=function(e){return clearInterval(e)},Co.toString=function(){return Eo.toString()},Co)};function Co(e){return Eo.apply(this,arguments)}function Ro(e,t){return Ao.apply(this,arguments)}for(var Uo=!1,Po=null,Io=function(){function e(){W(this,e)}return d(e,null,[{key:"_testing",value:function(){Uo=!0}},{key:"setXMLHttpRequest",value:function(e){Po=e}},{key:"location",get:function(){if(!Uo)return location}},{key:"localStorage",get:function(){if(!Uo&&"undefined"!=typeof window)return localStorage}},{key:"sessionStorage",get:function(){if(!Uo&&"undefined"!=typeof window)return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!Uo&&"undefined"!=typeof window)return Po||XMLHttpRequest}},{key:"timer",get:function(){if(!Uo)return xo}}]),e}(),Mo=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix,r=void 0===t?"oidc.":t,n=e.store,i=void 0===n?Io.localStorage:n;W(this,o),this._store=i,this._prefix=r}return d(o,[{key:"set",value:function(e,t){return To.debug("WebStorageStateStore.set",e),e=this._prefix+e,this._store.setItem(e,t),Promise.resolve()}},{key:"get",value:function(e){To.debug("WebStorageStateStore.get",e),e=this._prefix+e;var t=this._store.getItem(e);return Promise.resolve(t)}},{key:"remove",value:function(e){To.debug("WebStorageStateStore.remove",e),e=this._prefix+e;var t=this._store.getItem(e);return this._store.removeItem(e),Promise.resolve(t)}},{key:"getAllKeys",value:function(){To.debug("WebStorageStateStore.getAllKeys");for(var e=[],t=0;t<this._store.length;t++){var r=this._store.key(t);0===r.indexOf(this._prefix)&&e.push(r.substr(this._prefix.length))}return Promise.resolve(e)}}]),o}(),Oo=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Io.XMLHttpRequest,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;W(this,n),e&&Array.isArray(e)?this._contentTypes=e.slice():this._contentTypes=[],this._contentTypes.push("application/json"),r&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=t,this._jwtHandler=r}return d(n,[{key:"getJson",value:function(a,e){var t=this;if(!a)throw To.error("JsonService.getJson: No url passed"),new Error("url");return To.debug("JsonService.getJson, url: ",a),new Promise(function(r,n){var i=new t._XMLHttpRequest;i.open("GET",a);var o=t._contentTypes,s=t._jwtHandler;i.onload=function(){if(To.debug("JsonService.getJson: HTTP response received, status",i.status),200===i.status){var t=i.getResponseHeader("Content-Type");if(t){var e=o.find(function(e){if(t.startsWith(e))return!0});if("application/jwt"==e)return void s(i).then(r,n);if(e)try{return void r(JSON.parse(i.responseText))}catch(e){return To.error("JsonService.getJson: Error parsing JSON response",e.message),void n(e)}}n(Error("Invalid response Content-Type: "+t+", from URL: "+a))}else n(Error(i.statusText+" ("+i.status+")"))},i.onerror=function(){To.error("JsonService.getJson: network error"),n(Error("Network Error"))},e&&(To.debug("JsonService.getJson: token passed, setting Authorization header"),i.setRequestHeader("Authorization","Bearer "+e)),i.send()})}},{key:"postForm",value:function(a,u){var c=this;if(!a)throw To.error("JsonService.postForm: No url passed"),new Error("url");return To.debug("JsonService.postForm, url: ",a),new Promise(function(r,n){var i=new c._XMLHttpRequest;i.open("POST",a);var o=c._contentTypes;i.onload=function(){if(To.debug("JsonService.postForm: HTTP response received, status",i.status),200!==i.status){if(400===i.status)if(t=i.getResponseHeader("Content-Type"))if(o.find(function(e){if(t.startsWith(e))return!0}))try{var e=JSON.parse(i.responseText);if(e&&e.error)return To.error("JsonService.postForm: Error from server: ",e.error),void n(new Error(e.error))}catch(e){return To.error("JsonService.postForm: Error parsing JSON response",e.message),void n(e)}n(Error(i.statusText+" ("+i.status+")"))}else{var t;if((t=i.getResponseHeader("Content-Type"))&&o.find(function(e){if(t.startsWith(e))return!0}))try{return void r(JSON.parse(i.responseText))}catch(e){return To.error("JsonService.postForm: Error parsing JSON response",e.message),void n(e)}n(Error("Invalid response Content-Type: "+t+", from URL: "+a))}},i.onerror=function(){To.error("JsonService.postForm: network error"),n(Error("Network Error"))};var e="";for(var t in u){var s=u[t];s&&(0<e.length&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(s))}i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e)})}}]),n}(),jo=".well-known/openid-configuration",No=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Oo;if(W(this,r),!e)throw To.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=e,this._jsonService=new t(["application/jwk-set+json"])}return d(r,[{key:"getMetadata",value:function(){var t=this;return this._settings.metadata?(To.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(To.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(e){return To.debug("MetadataService.getMetadata: json received"),t._settings.metadata=e})):(To.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))}},{key:"getIssuer",value:function(){return this._getMetadataProperty("issuer")}},{key:"getAuthorizationEndpoint",value:function(){return this._getMetadataProperty("authorization_endpoint")}},{key:"getUserInfoEndpoint",value:function(){return this._getMetadataProperty("userinfo_endpoint")}},{key:"getTokenEndpoint",value:function(e){var t=!(0<arguments.length&&void 0!==e)||e;return this._getMetadataProperty("token_endpoint",t)}},{key:"getCheckSessionIframe",value:function(){return this._getMetadataProperty("check_session_iframe",!0)}},{key:"getEndSessionEndpoint",value:function(){return this._getMetadataProperty("end_session_endpoint",!0)}},{key:"getRevocationEndpoint",value:function(){return this._getMetadataProperty("revocation_endpoint",!0)}},{key:"getKeysEndpoint",value:function(){return this._getMetadataProperty("jwks_uri",!0)}},{key:"_getMetadataProperty",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return To.debug("MetadataService.getMetadataProperty for: "+t),this.getMetadata().then(function(e){if(To.debug("MetadataService.getMetadataProperty: metadata recieved"),void 0!==e[t])return e[t];if(!0!==r)throw To.error("MetadataService.getMetadataProperty: Metadata does not contain property "+t),new Error("Metadata does not contain property "+t);To.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+t)})}},{key:"getSigningKeys",value:function(){var t=this;return this._settings.signingKeys?(To.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(e){return To.debug("MetadataService.getSigningKeys: jwks_uri received",e),t._jsonService.getJson(e).then(function(e){if(To.debug("MetadataService.getSigningKeys: key set received",e),!e.keys)throw To.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return t._settings.signingKeys=e.keys,t._settings.signingKeys})})}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(jo)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=jo))),this._metadataUrl}}]),r}(),Lo=v(function(N,e){(function(){var e;function y(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function k(){return new y(null)}var t="undefined"!=typeof navigator;e=t&&"Microsoft Internet Explorer"==navigator.appName?(y.prototype.am=function(e,t,r,n,i,o){for(var s=32767&t,a=t>>15;0<=--o;){var u=32767&this[e],c=this[e++]>>15,l=a*u+c*s;i=((u=s*u+((32767&l)<<15)+r[n]+(1073741823&i))>>>30)+(l>>>15)+a*c+(i>>>30),r[n++]=1073741823&u}return i},30):t&&"Netscape"!=navigator.appName?(y.prototype.am=function(e,t,r,n,i,o){for(;0<=--o;){var s=t*this[e++]+r[n]+i;i=Math.floor(s/67108864),r[n++]=67108863&s}return i},26):(y.prototype.am=function(e,t,r,n,i,o){for(var s=16383&t,a=t>>14;0<=--o;){var u=16383&this[e],c=this[e++]>>14,l=a*u+c*s;i=((u=s*u+((16383&l)<<14)+r[n]+i)>>28)+(l>>14)+a*c,r[n++]=268435455&u}return i},28),y.prototype.DB=e,y.prototype.DM=(1<<e)-1,y.prototype.DV=1<<e;y.prototype.FV=Math.pow(2,52),y.prototype.F1=52-e,y.prototype.F2=2*e-52;var r,n,i="0123456789abcdefghijklmnopqrstuvwxyz",o=new Array;for(r="0".charCodeAt(0),n=0;n<=9;++n)o[r++]=n;for(r="a".charCodeAt(0),n=10;n<36;++n)o[r++]=n;for(r="A".charCodeAt(0),n=10;n<36;++n)o[r++]=n;function u(e){return i.charAt(e)}function c(e,t){var r=o[e.charCodeAt(t)];return null==r?-1:r}function v(e){var t=k();return t.fromInt(e),t}function b(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function _(e){this.m=e}function m(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function s(e,t){return e&t}function a(e,t){return e|t}function l(e,t){return e^t}function d(e,t){return e&~t}function h(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function f(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function p(){}function g(e){return e}function S(e){this.r2=k(),this.q3=k(),y.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}_.prototype.convert=function(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},_.prototype.revert=function(e){return e},_.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},_.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},_.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},m.prototype.convert=function(e){var t=k();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(y.ZERO)&&this.m.subTo(t,t),t},m.prototype.revert=function(e){var t=k();return e.copyTo(t),this.reduce(t),t},m.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},m.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},m.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},y.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e[t]=this[t];e.t=this.t,e.s=this.s},y.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,0<e?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},y.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,i=!1,o=0;0<=--n;){var s=8==r?255&e[n]:c(e,n);s<0?"-"==e.charAt(n)&&(i=!0):(i=!1,0==o?this[this.t++]=s:o+r>this.DB?(this[this.t-1]|=(s&(1<<this.DB-o)-1)<<o,this[this.t++]=s>>this.DB-o):this[this.t-1]|=s<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,0<o&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&y.ZERO.subTo(this,this)},y.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this[this.t-1]==e;)--this.t},y.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;0<=r;--r)t[r+e]=this[r];for(r=e-1;0<=r;--r)t[r]=0;t.t=this.t+e,t.s=this.s},y.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},y.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,o=(1<<i)-1,s=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;0<=r;--r)t[r+s+1]=this[r]>>i|a,a=(this[r]&o)<<n;for(r=s-1;0<=r;--r)t[r]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},y.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,o=(1<<n)-1;t[0]=this[r]>>n;for(var s=r+1;s<this.t;++s)t[s-r-1]|=(this[s]&o)<<i,t[s-r]=this[s]>>n;0<n&&(t[this.t-r-1]|=(this.s&o)<<i),t.t=this.t-r,t.clamp()}},y.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:0<n&&(t[r++]=n),t.t=r,t.clamp()},y.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),i=r.t;for(t.t=i+n.t;0<=--i;)t[i]=0;for(i=0;i<n.t;++i)t[i+r.t]=r.am(0,n[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&y.ZERO.subTo(t,t)},y.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}0<e.t&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},y.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=k());var o=k(),s=this.s,a=e.s,u=this.DB-b(n[n.t-1]);0<u?(n.lShiftTo(u,o),i.lShiftTo(u,r)):(n.copyTo(o),i.copyTo(r));var c=o.t,l=o[c-1];if(0!=l){var d=l*(1<<this.F1)+(1<c?o[c-2]>>this.F2:0),h=this.FV/d,f=(1<<this.F1)/d,p=1<<this.F2,g=r.t,v=g-c,_=null==t?k():t;for(o.dlShiftTo(v,_),0<=r.compareTo(_)&&(r[r.t++]=1,r.subTo(_,r)),y.ONE.dlShiftTo(c,_),_.subTo(o,o);o.t<c;)o[o.t++]=0;for(;0<=--v;){var m=r[--g]==l?this.DM:Math.floor(r[g]*h+(r[g-1]+p)*f);if((r[g]+=o.am(0,m,r,v,0,c))<m)for(o.dlShiftTo(v,_),r.subTo(_,r);r[g]<--m;)r.subTo(_,r)}null!=t&&(r.drShiftTo(c,t),s!=a&&y.ZERO.subTo(t,t)),r.t=c,r.clamp(),0<u&&r.rShiftTo(u,r),s<0&&y.ZERO.subTo(r,r)}}},y.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},y.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},y.prototype.exp=function(e,t){if(4294967295<e||e<1)return y.ONE;var r=k(),n=k(),i=t.convert(this),o=b(e)-1;for(i.copyTo(r);0<=--o;)if(t.sqrTo(r,n),0<(e&1<<o))t.mulTo(n,i,r);else{var s=r;r=n,n=s}return t.revert(r)},y.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(0<s--)for(a<this.DB&&0<(r=this[s]>>a)&&(i=!0,o=u(r));0<=s;)a<t?(r=(this[s]&(1<<a)-1)<<t-a,r|=this[--s]>>(a+=this.DB-t)):(r=this[s]>>(a-=t)&n,a<=0&&(a+=this.DB,--s)),0<r&&(i=!0),i&&(o+=u(r));return i?o:"0"},y.prototype.negate=function(){var e=k();return y.ZERO.subTo(this,e),e},y.prototype.abs=function(){return this.s<0?this.negate():this},y.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;0<=--r;)if(0!=(t=this[r]-e[r]))return t;return 0},y.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)},y.prototype.mod=function(e){var t=k();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(y.ZERO)&&e.subTo(t,t),t},y.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new _(t):new m(t),this.exp(e,r)},y.ZERO=v(0),y.ONE=v(1),p.prototype.convert=g,p.prototype.revert=g,p.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},p.prototype.sqrTo=function(e,t){e.squareTo(t)},S.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=k();return e.copyTo(t),this.reduce(t),t},S.prototype.revert=function(e){return e},S.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},S.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var w,T,E,A=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],x=(1<<26)/A[A.length-1];function C(){!function(e){T[E++]^=255&e,T[E++]^=e>>8&255,T[E++]^=e>>16&255,T[E++]^=e>>24&255,j<=E&&(E-=j)}((new Date).getTime())}if(y.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},y.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=v(r),i=k(),o=k(),s="";for(this.divRemTo(n,i,o);0<i.signum();)s=(r+o.intValue()).toString(e).substr(1)+s,i.divRemTo(n,i,o);return o.intValue().toString(e)+s},y.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),i=!1,o=0,s=0,a=0;a<e.length;++a){var u=c(e,a);u<0?"-"==e.charAt(a)&&0==this.signum()&&(i=!0):(s=t*s+u,++o>=r&&(this.dMultiply(n),this.dAddOffset(s,0),s=o=0))}0<o&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(s,0)),i&&y.ZERO.subTo(this,this)},y.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(y.ONE.shiftLeft(e-1),a,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(y.ONE.shiftLeft(e-1),this);else{var n=new Array,i=7&e;n.length=1+(e>>3),t.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},y.prototype.bitwiseTo=function(e,t,r){var n,i,o=Math.min(e.t,this.t);for(n=0;n<o;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(i=e.s&this.DM,n=o;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=o;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},y.prototype.changeBit=function(e,t){var r=y.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},y.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,0<n?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},y.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},y.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},y.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;0<i;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},y.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;0<=--n;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},y.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(0<this.t)if(0==t)r=this[0]%e;else for(var n=this.t-1;0<=n;--n)r=(t*r+this[n])%e;return r},y.prototype.millerRabin=function(e){var t=this.subtract(y.ONE),r=t.getLowestSetBit();if(r<=0)return!1;var n=t.shiftRight(r);A.length<(e=e+1>>1)&&(e=A.length);for(var i=k(),o=0;o<e;++o){i.fromInt(A[Math.floor(Math.random()*A.length)]);var s=i.modPow(n,this);if(0!=s.compareTo(y.ONE)&&0!=s.compareTo(t)){for(var a=1;a++<r&&0!=s.compareTo(t);)if(0==(s=s.modPowInt(2,this)).compareTo(y.ONE))return!1;if(0!=s.compareTo(t))return!1}}return!0},y.prototype.clone=function(){var e=k();return this.copyTo(e),e},y.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},y.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},y.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},y.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},y.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(0<e--)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);0<=e;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(0<i||r!=this.s)&&(t[i++]=r);return t},y.prototype.equals=function(e){return 0==this.compareTo(e)},y.prototype.min=function(e){return this.compareTo(e)<0?this:e},y.prototype.max=function(e){return 0<this.compareTo(e)?this:e},y.prototype.and=function(e){var t=k();return this.bitwiseTo(e,s,t),t},y.prototype.or=function(e){var t=k();return this.bitwiseTo(e,a,t),t},y.prototype.xor=function(e){var t=k();return this.bitwiseTo(e,l,t),t},y.prototype.andNot=function(e){var t=k();return this.bitwiseTo(e,d,t),t},y.prototype.not=function(){for(var e=k(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},y.prototype.shiftLeft=function(e){var t=k();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},y.prototype.shiftRight=function(e){var t=k();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},y.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+h(this[e]);return this.s<0?this.t*this.DB:-1},y.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=f(this[r]^t);return e},y.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},y.prototype.setBit=function(e){return this.changeBit(e,a)},y.prototype.clearBit=function(e){return this.changeBit(e,d)},y.prototype.flipBit=function(e){return this.changeBit(e,l)},y.prototype.add=function(e){var t=k();return this.addTo(e,t),t},y.prototype.subtract=function(e){var t=k();return this.subTo(e,t),t},y.prototype.multiply=function(e){var t=k();return this.multiplyTo(e,t),t},y.prototype.divide=function(e){var t=k();return this.divRemTo(e,t,null),t},y.prototype.remainder=function(e){var t=k();return this.divRemTo(e,null,t),t},y.prototype.divideAndRemainder=function(e){var t=k(),r=k();return this.divRemTo(e,t,r),new Array(t,r)},y.prototype.modPow=function(e,t){var r,n,i=e.bitLength(),o=v(1);if(i<=0)return o;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new _(t):t.isEven()?new S(t):new m(t);var s=new Array,a=3,u=r-1,c=(1<<r)-1;if(s[1]=n.convert(this),1<r){var l=k();for(n.sqrTo(s[1],l);a<=c;)s[a]=k(),n.mulTo(l,s[a-2],s[a]),a+=2}var d,h,f=e.t-1,p=!0,g=k();for(i=b(e[f])-1;0<=f;){for(u<=i?d=e[f]>>i-u&c:(d=(e[f]&(1<<i+1)-1)<<u-i,0<f&&(d|=e[f-1]>>this.DB+i-u)),a=r;0==(1&d);)d>>=1,--a;if((i-=a)<0&&(i+=this.DB,--f),p)s[d].copyTo(o),p=!1;else{for(;1<a;)n.sqrTo(o,g),n.sqrTo(g,o),a-=2;0<a?n.sqrTo(o,g):(h=o,o=g,g=h),n.mulTo(g,s[d],o)}for(;0<=f&&0==(e[f]&1<<i);)n.sqrTo(o,g),h=o,o=g,g=h,--i<0&&(i=this.DB-1,--f)}return n.revert(o)},y.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return y.ZERO;for(var r=e.clone(),n=this.clone(),i=v(1),o=v(0),s=v(0),a=v(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),t?(s.isEven()&&a.isEven()||(s.addTo(this,s),a.subTo(e,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);0<=r.compareTo(n)?(r.subTo(n,r),t&&i.subTo(s,i),o.subTo(a,o)):(n.subTo(r,n),t&&s.subTo(i,s),a.subTo(o,a))}return 0!=n.compareTo(y.ONE)?y.ZERO:0<=a.compareTo(e)?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},y.prototype.pow=function(e){return this.exp(e,new p)},y.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),o=r.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),0<o&&(t.rShiftTo(o,t),r.rShiftTo(o,r));0<t.signum();)0<(i=t.getLowestSetBit())&&t.rShiftTo(i,t),0<(i=r.getLowestSetBit())&&r.rShiftTo(i,r),0<=t.compareTo(r)?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return 0<o&&r.lShiftTo(o,r),r},y.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=A[A.length-1]){for(t=0;t<A.length;++t)if(r[0]==A[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<A.length;){for(var n=A[t],i=t+1;i<A.length&&n<x;)n*=A[i++];for(n=r.modInt(n);t<i;)if(n%A[t++]==0)return!1}return r.millerRabin(e)},y.prototype.square=function(){var e=k();return this.squareTo(e),e},y.prototype.Barrett=S,null==T){var R;if(T=new Array,E=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var U=new Uint8Array(32);for(window.crypto.getRandomValues(U),R=0;R<32;++R)T[E++]=U[R]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var P=window.crypto.random(32);for(R=0;R<P.length;++R)T[E++]=255&P.charCodeAt(R)}for(;E<j;)R=Math.floor(65536*Math.random()),T[E++]=R>>>8,T[E++]=255&R;E=0,C()}function I(){if(null==w){for(C(),(w=new O).init(T),E=0;E<T.length;++E)T[E]=0;E=0}return w.next()}function M(){}function O(){this.i=0,this.j=0,this.S=new Array}M.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=I()},O.prototype.init=function(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(t=r=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},O.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var j=256;y.SecureRandom=M,y.BigInteger=y,N.exports=y}).call(r)}),Fo=v(function(e,t){var r;e.exports=(r=r||function(d){var r=Object.create||function(){function r(){}return function(e){var t;return r.prototype=e,t=new r,r.prototype=null,t}}(),e={},t=e.lib={},n=t.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},h=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=d.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,r=[],n=function(t){var t=t,r=987654321,n=4294967295;return function(){var e=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return e/=4294967296,(e+=.5)*(.5<d.random()?1:-1)}},i=0;i<e;i+=4){var o=n(4294967296*(t||d.random()));t=987654071*o(),r.push(4294967296*o()|0)}return new h.init(r,e)}}),i=e.enc={},o=i.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new h.init(r,t/2)}},s=i.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new h.init(r,t)}},a=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=a.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,r=t.words,n=t.sigBytes,i=this.blockSize,o=4*i,s=n/o,a=(s=e?d.ceil(s):d.max((0|s)-this._minBufferSize,0))*i,u=d.min(4*a,n);if(a){for(var c=0;c<a;c+=i)this._doProcessBlock(r,c);var l=r.splice(0,a);t.sigBytes-=u}return new h.init(l,u)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c=(t.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new c.HMAC.init(r,t).finalize(e)}}}),e.algo={});return e}(Math),r)}),qo=v(function(e,t){var u;e.exports=(u=Fo,function(i){var e=u,t=e.lib,r=t.WordArray,n=t.Hasher,o=e.algo,s=[],y=[];!function(){function e(e){for(var t=i.sqrt(e),r=2;r<=t;r++)if(!(e%r))return!1;return!0}function t(e){return 4294967296*(e-(0|e))|0}for(var r=2,n=0;n<64;)e(r)&&(n<8&&(s[n]=t(i.pow(r,.5))),y[n]=t(i.pow(r,1/3)),n++),r++}();var k=[],a=o.SHA256=n.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],u=r[5],c=r[6],l=r[7],d=0;d<64;d++){if(d<16)k[d]=0|e[t+d];else{var h=k[d-15],f=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,p=k[d-2],g=(p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10;k[d]=f+k[d-7]+g+k[d-16]}var v=n&i^n&o^i&o,_=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),m=l+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&u^~a&c)+y[d]+k[d];l=c,c=u,u=a,a=s+m|0,s=o,o=i,i=n,n=m+(_+v)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+u|0,r[6]=r[6]+c|0,r[7]=r[7]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=i.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA256=n._createHelper(a),e.HmacSHA256=n._createHmacHelper(a)}(Math),u.SHA256)}),Bo=function(e){var t=Xo(e),r=t[0],n=t[1];return 3*(r+n)/4-n},Do=function(e){var t,r,n=Xo(e),i=n[0],o=n[1],s=new Jo(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),a=0,u=0<o?i-4:i;for(r=0;r<u;r+=4)t=Vo[e.charCodeAt(r)]<<18|Vo[e.charCodeAt(r+1)]<<12|Vo[e.charCodeAt(r+2)]<<6|Vo[e.charCodeAt(r+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;2===o&&(t=Vo[e.charCodeAt(r)]<<2|Vo[e.charCodeAt(r+1)]>>4,s[a++]=255&t);1===o&&(t=Vo[e.charCodeAt(r)]<<10|Vo[e.charCodeAt(r+1)]<<4|Vo[e.charCodeAt(r+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t);return s},Wo=function(e){for(var t,r=e.length,n=r%3,i=[],o=0,s=r-n;o<s;o+=16383)i.push(Go(e,o,s<o+16383?s:o+16383));1==n?(t=e[r-1],i.push(Ho[t>>2]+Ho[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],i.push(Ho[t>>10]+Ho[t>>4&63]+Ho[t<<2&63]+"="));return i.join("")},Ho=[],Vo=[],Jo="undefined"!=typeof Uint8Array?Uint8Array:Array,Ko="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zo=0,Qo=Ko.length;zo<Qo;++zo)Ho[zo]=Ko[zo],Vo[Ko.charCodeAt(zo)]=zo;function Xo(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function Go(e,t,r){for(var n,i,o=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(Ho[(i=n)>>18&63]+Ho[i>>12&63]+Ho[i>>6&63]+Ho[63&i]);return o.join("")}Vo["-".charCodeAt(0)]=62,Vo["_".charCodeAt(0)]=63;var Zo={byteLength:Bo,toByteArray:Do,fromByteArray:Wo},Yo=Lo.BigInteger,$o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",es={b64tohex:function(e){var t,r,n="",i=0;for(t=0;t<e.length&&"="!==e.charAt(t);++t){var o=$o.indexOf(e.charAt(t));o<0||(i=0===i?(n+=String.fromCharCode(o>>2),r=3&o,1):1===i?(n+=String.fromCharCode(r<<2|o>>4),r=15&o,2):2===i?(n+=String.fromCharCode(r),n+=String.fromCharCode(o>>2),r=3&o,3):(n+=String.fromCharCode(r<<2|o>>4),n+=String.fromCharCode(15&o),0))}return 1===i&&(n+=String.fromCharCode(r<<2)),n},hexToBase64:function(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=$o.charAt(r>>6)+$o.charAt(63&r);for(t+1===e.length?(r=parseInt(e.substring(t,t+1),16),n+=$o.charAt(r<<2)):t+2===e.length&&(r=parseInt(e.substring(t,t+2),16),n+=$o.charAt(r>>2)+$o.charAt((3&r)<<4));0<(3&n.length);)n+="=";return n},padding:function(e){var t=e.length%4;return 0==t?e:e+new Array(1+(4-t)).join("=")},byteArrayToHex:function(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);t+=2===n.length?n:"0"+n}return t},decodeToHEX:function(e){return es.byteArrayToHex(Zo.toByteArray(es.padding(e)))},base64ToBase64Url:function(e){return e=(e=(e=e.replace(/=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")},urlDecode:function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g," "),atob(e)}},ts={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},rs={sha256:qo,SHA256:qo};function ns(e,t){if(this.n=null,this.e=0,!(null!=e&&null!=t&&0<e.length&&0<t.length))throw new Error("Invalid key data");this.n=new Yo(e,16),this.e=parseInt(t,16)}ns.prototype.verify=function(e,t){t=(t=es.decodeToHEX(t)).replace(/[^0-9a-f]|[\s\n]]/gi,"");var r=new Yo(t,16);if(r.bitLength()>this.n.bitLength())throw new Error("Signature does not match with the key modulus.");var n=function(e){for(var t in ts){var r=ts[t],n=r.length;if(e.substring(0,n)===r)return{alg:t,hash:e.substring(n)}}return[]}(r.modPowInt(this.e,this.n).toString(16).replace(/^1f+00/,""));if(0===n.length)return!1;if(!rs.hasOwnProperty(n.alg))throw new Error("Hashing algorithm is not supported.");var i=rs[n.alg](e).toString();return n.hash===i};var is=["RS256"],os={JWS:{parse:function(e){var t,r,n=e.split(".");if(3===n.length){try{t=JSON.parse(es.urlDecode(n[0])),r=JSON.parse(es.urlDecode(n[1]))}catch(e){return new Error("Token header or payload is not valid JSON")}return{headerObj:t,payloadObj:r}}},verify:function(e,t){(2<arguments.length&&void 0!==arguments[2]?arguments[2]:[]).forEach(function(e){if(-1===is.indexOf(e))throw new Error("Invalid signing algorithm: "+e)});var r=new ns(t.n,t.e),n=e.split("."),i=[n[0],n[1]].join(".");return r.verify(i,n[2])}}},ss={getKey:function(e){return"RSA"===e.kty?{e:es.decodeToHEX(e.e),n:es.decodeToHEX(e.n)}:null}},as={getPublicKeyFromCertPEM:function(){throw new Error("Not implemented. Use the full oidc-client library if you need support for X509.")}},us={Util:{hashString:function(e,t){return(0,rs[t])(e).toString()}}};var cs=es.b64tohex;for(var ls,ds,hs,fs,ps,gs,vs,_s,ms=(ds=(ls={jws:os,KeyUtil:ss,X509:as,crypto:us,hextob64u:function(e){return e.length%2==1&&(e="0"+e),es.base64ToBase64Url(es.hexToBase64(e))},b64tohex:cs,AllowedSigningAlgs:is}).jws,hs=ls.KeyUtil,fs=ls.X509,ps=ls.crypto,gs=ls.hextob64u,vs=ls.b64tohex,_s=ls.AllowedSigningAlgs,function(){function c(){W(this,c)}return d(c,null,[{key:"parseJwt",value:function(e){To.debug("JoseUtil.parseJwt");try{var t=ds.JWS.parse(e);return{header:t.headerObj,payload:t.payloadObj}}catch(e){To.error(e)}}},{key:"validateJwt",value:function(e,t,r,n,i,o,s){To.debug("JoseUtil.validateJwt");try{if("RSA"===t.kty)if(t.e&&t.n)t=hs.getKey(t);else{if(!t.x5c||!t.x5c.length)return To.error("JoseUtil.validateJwt: RSA key missing key material",t),Promise.reject(new Error("RSA key missing key material"));var a=vs(t.x5c[0]);t=fs.getPublicKeyFromCertHex(a)}else{if("EC"!==t.kty)return To.error("JoseUtil.validateJwt: Unsupported key type",t&&t.kty),Promise.reject(new Error("Unsupported key type: "+t&&t.kty));if(!(t.crv&&t.x&&t.y))return To.error("JoseUtil.validateJwt: EC key missing key material",t),Promise.reject(new Error("EC key missing key material"));t=hs.getKey(t)}return c._validateJwt(e,t,r,n,i,o,s)}catch(e){return To.error(e&&e.message||e),Promise.reject("JWT validation failed")}}},{key:"validateJwtAttributes",value:function(e,t,r,n,i,o){n=n||0,i=i||parseInt(Date.now()/1e3);var s=c.parseJwt(e).payload;if(!s.iss)return To.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(s.iss!==t)return To.error("JoseUtil._validateJwt: Invalid issuer in token",s.iss),Promise.reject(new Error("Invalid issuer in token: "+s.iss));if(!s.aud)return To.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(s.aud===r||Array.isArray(s.aud)&&0<=s.aud.indexOf(r)))return To.error("JoseUtil._validateJwt: Invalid audience in token",s.aud),Promise.reject(new Error("Invalid audience in token: "+s.aud));if(s.azp&&s.azp!==r)return To.error("JoseUtil._validateJwt: Invalid azp in token",s.azp),Promise.reject(new Error("Invalid azp in token: "+s.azp));if(!o){var a=i+n,u=i-n;if(!s.iat)return To.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(a<s.iat)return To.error("JoseUtil._validateJwt: iat is in the future",s.iat),Promise.reject(new Error("iat is in the future: "+s.iat));if(s.nbf&&a<s.nbf)return To.error("JoseUtil._validateJwt: nbf is in the future",s.nbf),Promise.reject(new Error("nbf is in the future: "+s.nbf));if(!s.exp)return To.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(s.exp<u)return To.error("JoseUtil._validateJwt: exp is in the past",s.exp),Promise.reject(new Error("exp is in the past:"+s.exp))}return Promise.resolve(s)}},{key:"_validateJwt",value:function(t,r,e,n,i,o,s){return c.validateJwtAttributes(t,e,n,i,o,s).then(function(e){try{return ds.JWS.verify(t,r,_s)?e:(To.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(e){return To.error(e&&e.message||e),Promise.reject(new Error("signature validation failed"))}})}},{key:"hashString",value:function(e,t){try{return ps.Util.hashString(e,t)}catch(e){To.error(e)}}},{key:"hexToBase64Url",value:function(e){try{return gs(e)}catch(e){To.error(e)}}}]),c}()),ys=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Oo,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:No,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ms;if(W(this,i),!e)throw To.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new r(this._settings),this._joseUtil=n}return d(i,[{key:"getClaims",value:function(t){var r=this;return t?this._metadataService.getUserInfoEndpoint().then(function(e){return To.debug("UserInfoService.getClaims: received userinfo url",e),r._jsonService.getJson(e,t).then(function(e){return To.debug("UserInfoService.getClaims: claims received",e),e})}):(To.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))}},{key:"_getClaimsFromJwt",value:function(o){var s=this;try{var a=this._joseUtil.parseJwt(o.responseText);if(!a||!a.header||!a.payload)return To.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",a),Promise.reject(new Error("Failed to parse id_token"));var e,u=a.header.kid;switch(this._settings.userInfoJwtIssuer){case"OP":e=this._metadataService.getIssuer();break;case"ANY":e=Promise.resolve(a.payload.iss);break;default:e=Promise.resolve(this._settings.userInfoJwtIssuer)}return e.then(function(i){return To.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+i),s._metadataService.getSigningKeys().then(function(e){if(!e)return To.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));var t;if(To.debug("UserInfoService._getClaimsFromJwt: Received signing keys"),u)t=e.filter(function(e){return e.kid===u})[0];else{if(1<(e=s._filterByAlg(e,a.header.alg)).length)return To.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));t=e[0]}if(!t)return To.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var r=s._settings.client_id,n=s._settings.clockSkew;return To.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",n),s._joseUtil.validateJwt(o.responseText,t,i,r,n,void 0,!0).then(function(){return To.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),a.payload})})})}catch(e){return To.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",e.message),void reject(e)}}},{key:"_filterByAlg",value:function(e,t){var r=null;if(t.startsWith("RS"))r="RSA";else if(t.startsWith("PS"))r="PS";else{if(!t.startsWith("ES"))return To.debug("UserInfoService._filterByAlg: alg not supported: ",t),[];r="EC"}return To.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",r),e=e.filter(function(e){return e.kty===r}),To.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",r,e.length),e}}]),i}(),ks=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Oo,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:No;if(W(this,n),!e)throw To.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=e,this._jsonService=new t,this._metadataService=new r(this._settings)}return d(n,[{key:"exchangeCode",value:function(e){var t=this,r=0<arguments.length&&void 0!==e?e:{};return(r=Object.assign({},r)).grant_type=r.grant_type||"authorization_code",r.client_id=r.client_id||this._settings.client_id,r.redirect_uri=r.redirect_uri||this._settings.redirect_uri,r.code?r.redirect_uri?r.code_verifier?r.client_id?this._metadataService.getTokenEndpoint(!1).then(function(e){return To.debug("TokenClient.exchangeCode: Received token endpoint"),t._jsonService.postForm(e,r).then(function(e){return To.debug("TokenClient.exchangeCode: response received"),e})}):(To.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(To.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(To.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(To.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))}},{key:"exchangeRefreshToken",value:function(e){var t=this,r=0<arguments.length&&void 0!==e?e:{};return(r=Object.assign({},r)).grant_type=r.grant_type||"refresh_token",r.client_id=r.client_id||this._settings.client_id,r.client_secret=r.client_secret||this._settings.client_secret,r.refresh_token?r.client_id?this._metadataService.getTokenEndpoint(!1).then(function(e){return To.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),t._jsonService.postForm(e,r).then(function(e){return To.debug("TokenClient.exchangeRefreshToken: response received"),e})}):(To.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(To.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))}}]),n}(),bs=function(){e(u,l(Error));var a=g(u);function u(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.error,n=t.error_description,i=t.error_uri,o=t.state,s=t.session_state;if(W(this,u),!r)throw To.error("No error passed to ErrorResponse"),new Error("error");return(e=a.call(this,n||r)).name="ErrorResponse",e.error=r,e.error_description=n,e.error_uri=i,e.state=o,e.session_state=s,e}return u}(),Ss=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"],ws=function(){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:No,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ys,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ms,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ks;if(W(this,o),!e)throw To.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=e,this._metadataService=new t(this._settings),this._userInfoService=new r(this._settings),this._joseUtil=n,this._tokenClient=new i(this._settings)}return d(o,[{key:"validateSigninResponse",value:function(t,e){var r=this;return To.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(t,e).then(function(e){return To.debug("ResponseValidator.validateSigninResponse: state processed"),r._validateTokens(t,e).then(function(e){return To.debug("ResponseValidator.validateSigninResponse: tokens validated"),r._processClaims(t,e).then(function(e){return To.debug("ResponseValidator.validateSigninResponse: claims processed"),e})})})}},{key:"validateSignoutResponse",value:function(e,t){return e.id!==t.state?(To.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(To.debug("ResponseValidator.validateSignoutResponse: state validated"),t.state=e.data,t.error?(To.warn("ResponseValidator.validateSignoutResponse: Response was error",t.error),Promise.reject(new bs(t))):Promise.resolve(t))}},{key:"_processSigninParams",value:function(e,t){if(e.id!==t.state)return To.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!e.client_id)return To.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!e.authority)return To.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==e.authority)return To.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=e.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==e.client_id)return To.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=e.client_id;return To.debug("ResponseValidator._processSigninParams: state validated"),t.state=e.data,t.error?(To.warn("ResponseValidator._processSigninParams: Response was error",t.error),Promise.reject(new bs(t))):e.nonce&&!t.id_token?(To.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!e.nonce&&t.id_token?(To.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):e.code_verifier&&!t.code?(To.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!e.code_verifier&&t.code?(To.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(t.scope||(t.scope=e.scope),Promise.resolve(t))}},{key:"_processClaims",value:function(e,t){var r=this;if(t.isOpenIdConnect){if(To.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),t.profile=this._filterProtocolClaims(t.profile),!0!==e.skipUserInfo&&this._settings.loadUserInfo&&t.access_token)return To.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(t.access_token).then(function(e){return To.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),e.sub!==t.profile.sub?(To.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in access_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in access_token"))):(t.profile=r._mergeClaims(t.profile,e),To.debug("ResponseValidator._processClaims: user info claims received, updated profile:",t.profile),t)});To.debug("ResponseValidator._processClaims: not loading user info")}else To.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(t)}},{key:"_mergeClaims",value:function(e,t){var r=Object.assign({},e);for(var n in t){var i=t[n];Array.isArray(i)||(i=[i]);for(var o=0;o<i.length;o++){var s=i[o];r[n]?Array.isArray(r[n])?r[n].indexOf(s)<0&&r[n].push(s):r[n]!==s&&("object"===D(s)?r[n]=this._mergeClaims(r[n],s):r[n]=[r[n],s]):r[n]=s}}return r}},{key:"_filterProtocolClaims",value:function(e){To.debug("ResponseValidator._filterProtocolClaims, incoming claims:",e);var t=Object.assign({},e);return this._settings._filterProtocolClaims?(Ss.forEach(function(e){delete t[e]}),To.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",t)):To.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),t}},{key:"_validateTokens",value:function(e,t){return t.code?(To.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(e,t)):t.id_token?t.access_token?(To.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(e,t)):(To.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(e,t)):(To.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(t))}},{key:"_processCode",value:function(r,n){var i=this,e={client_id:r.client_id,client_secret:r.client_secret,code:n.code,redirect_uri:r.redirect_uri,code_verifier:r.code_verifier};return r.extraTokenParams&&"object"===D(r.extraTokenParams)&&Object.assign(e,r.extraTokenParams),this._tokenClient.exchangeCode(e).then(function(e){for(var t in e)n[t]=e[t];return n.id_token?(To.debug("ResponseValidator._processCode: token response successful, processing id_token"),i._validateIdTokenAttributes(r,n)):(To.debug("ResponseValidator._processCode: token response successful, returning response"),n)})}},{key:"_validateIdTokenAttributes",value:function(n,i){var o=this;return this._metadataService.getIssuer().then(function(e){var t=n.client_id,r=o._settings.clockSkew;return To.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",r),o._joseUtil.validateJwtAttributes(i.id_token,e,t,r).then(function(e){return n.nonce&&n.nonce!==e.nonce?(To.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):e.sub?(i.profile=e,i):(To.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}},{key:"_validateIdTokenAndAccessToken",value:function(e,t){var r=this;return this._validateIdToken(e,t).then(function(e){return r._validateAccessToken(e)})}},{key:"_validateIdToken",value:function(o,s){var a=this;if(!o.nonce)return To.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var u=this._joseUtil.parseJwt(s.id_token);if(!u||!u.header||!u.payload)return To.error("ResponseValidator._validateIdToken: Failed to parse id_token",u),Promise.reject(new Error("Failed to parse id_token"));if(o.nonce!==u.payload.nonce)return To.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"));var c=u.header.kid;return this._metadataService.getIssuer().then(function(i){return To.debug("ResponseValidator._validateIdToken: Received issuer"),a._metadataService.getSigningKeys().then(function(e){if(!e)return To.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));var t;if(To.debug("ResponseValidator._validateIdToken: Received signing keys"),c)t=e.filter(function(e){return e.kid===c})[0];else{if(1<(e=a._filterByAlg(e,u.header.alg)).length)return To.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));t=e[0]}if(!t)return To.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var r=o.client_id,n=a._settings.clockSkew;return To.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",n),a._joseUtil.validateJwt(s.id_token,t,i,r,n).then(function(){return To.debug("ResponseValidator._validateIdToken: JWT validation successful"),u.payload.sub?(s.profile=u.payload,s):(To.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})}},{key:"_filterByAlg",value:function(e,t){var r=null;if(t.startsWith("RS"))r="RSA";else if(t.startsWith("PS"))r="PS";else{if(!t.startsWith("ES"))return To.debug("ResponseValidator._filterByAlg: alg not supported: ",t),[];r="EC"}return To.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",r),e=e.filter(function(e){return e.kty===r}),To.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",r,e.length),e}},{key:"_validateAccessToken",value:function(e){if(!e.profile)return To.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!e.profile.at_hash)return To.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!e.id_token)return To.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var t=this._joseUtil.parseJwt(e.id_token);if(!t||!t.header)return To.error("ResponseValidator._validateAccessToken: Failed to parse id_token",t),Promise.reject(new Error("Failed to parse id_token"));var r=t.header.alg;if(!r||5!==r.length)return To.error("ResponseValidator._validateAccessToken: Unsupported alg:",r),Promise.reject(new Error("Unsupported alg: "+r));var n=r.substr(2,3);if(!n)return To.error("ResponseValidator._validateAccessToken: Unsupported alg:",r,n),Promise.reject(new Error("Unsupported alg: "+r));if(256!==(n=parseInt(n))&&384!==n&&512!==n)return To.error("ResponseValidator._validateAccessToken: Unsupported alg:",r,n),Promise.reject(new Error("Unsupported alg: "+r));var i="sha"+n,o=this._joseUtil.hashString(e.access_token,i);if(!o)return To.error("ResponseValidator._validateAccessToken: access_token hash failed:",i),Promise.reject(new Error("Failed to validate at_hash"));var s=o.substr(0,o.length/2),a=this._joseUtil.hexToBase64Url(s);return a!==e.profile.at_hash?(To.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",a,e.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(To.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(e))}}]),o}(),Ts=".well-known/openid-configuration",Es=function(){function B(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.authority,r=e.metadataUrl,n=e.metadata,i=e.signingKeys,o=e.client_id,s=e.client_secret,a=e.response_type,u=void 0===a?"id_token":a,c=e.scope,l=void 0===c?"openid":c,d=e.redirect_uri,h=e.post_logout_redirect_uri,f=e.prompt,p=e.display,g=e.max_age,v=e.ui_locales,_=e.acr_values,m=e.resource,y=e.response_mode,k=e.filterProtocolClaims,b=void 0===k||k,S=e.loadUserInfo,w=void 0===S||S,T=e.staleStateAge,E=void 0===T?900:T,A=e.clockSkew,x=void 0===A?300:A,C=e.userInfoJwtIssuer,R=void 0===C?"OP":C,U=e.stateStore,P=void 0===U?new Mo:U,I=e.ResponseValidatorCtor,M=void 0===I?ws:I,O=e.MetadataServiceCtor,j=void 0===O?No:O,N=e.extraQueryParams,L=void 0===N?{}:N,F=e.extraTokenParams,q=void 0===F?{}:F;W(this,B),this._authority=t,this._metadataUrl=r,this._metadata=n,this._signingKeys=i,this._client_id=o,this._client_secret=s,this._response_type=u,this._scope=l,this._redirect_uri=d,this._post_logout_redirect_uri=h,this._prompt=f,this._display=p,this._max_age=g,this._ui_locales=v,this._acr_values=_,this._resource=m,this._response_mode=y,this._filterProtocolClaims=!!b,this._loadUserInfo=!!w,this._staleStateAge=E,this._clockSkew=x,this._userInfoJwtIssuer=R,this._stateStore=P,this._validator=new M(this),this._metadataService=new j(this),this._extraQueryParams="object"===D(L)?L:{},this._extraTokenParams="object"===D(q)?q:{}}return d(B,[{key:"client_id",get:function(){return this._client_id},set:function(e){if(this._client_id)throw To.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=e}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(e){if(this._authority)throw To.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=e}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(Ts)<0&&("/"!==this._metadataUrl[this._metadataUrl.length-1]&&(this._metadataUrl+="/"),this._metadataUrl+=Ts)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(e){this._metadata=e}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(e){this._signingKeys=e}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(e){"object"===D(e)?this._extraQueryParams=e:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(e){"object"===D(e)?this._extraTokenParams=e:this._extraTokenParams={}}}]),B}(),As=function(){function e(){W(this,e)}return d(e,null,[{key:"addQueryParam",value:function(e,t,r){return e.indexOf("?")<0&&(e+="?"),"?"!==e[e.length-1]&&(e+="&"),e+=encodeURIComponent(t),e+="=",e+=encodeURIComponent(r)}},{key:"parseUrlFragment",value:function(e,t,r){var n=1<arguments.length&&void 0!==t?t:"#";"string"!=typeof e&&(e=(2<arguments.length&&void 0!==r?r:Io).location.href);var i=e.lastIndexOf(n);0<=i&&(e=e.substr(i+1)),"?"===n&&0<=(i=e.indexOf("#"))&&(e=e.substr(0,i));for(var o,s={},a=/([^&=]+)=([^&]*)/g,u=0;o=a.exec(e);)if(s[decodeURIComponent(o[1])]=decodeURIComponent(o[2]),50<u++)return To.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",e),{error:"Response exceeded expected number of parameters"};for(var c in s)return s;return{}}}]),e}(),xs=v(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}),Cs=[],Rs=0;Rs<256;++Rs)Cs[Rs]=(Rs+256).toString(16).substr(1);var Us=function(e,t){var r=t||0,n=Cs;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")};var Ps=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||xs)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||Us(i)};function Is(){return Ps().replace(/-/g,"")}function Ms(e){var t=e.url,r=e.id_token_hint,n=e.post_logout_redirect_uri,i=e.data,o=e.extraQueryParams,s=e.request_type;if(W(this,Ms),!t)throw To.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var a in r&&(t=As.addQueryParam(t,"id_token_hint",r)),n&&(t=As.addQueryParam(t,"post_logout_redirect_uri",n),i&&(this.state=new js({data:i,request_type:s}),t=As.addQueryParam(t,"state",this.state.id))),o)t=As.addQueryParam(t,a,o[a]);this.url=t}function Os(e){W(this,Os);var t=As.parseUrlFragment(e,"?");this.error=t.error,this.error_description=t.error_description,this.error_uri=t.error_uri,this.state=t.state}var js=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=e.data,n=e.created,i=e.request_type;W(this,a),this._id=t||Is(),this._data=r,this._created="number"==typeof n&&0<n?n:parseInt(Date.now()/1e3),this._request_type=i}return d(a,[{key:"toStorageString",value:function(){return To.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})}},{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}],[{key:"fromStorageString",value:function(e){return To.debug("State.fromStorageString"),new a(JSON.parse(e))}},{key:"clearStaleState",value:function(o,e){var s=Date.now()/1e3-e;return o.getAllKeys().then(function(t){To.debug("State.clearStaleState: got keys",t);for(var r=[],e=function(e){var n=t[e];i=o.get(n).then(function(e){var t=!1;if(e)try{var r=a.fromStorageString(e);To.debug("State.clearStaleState: got item from key: ",n,r.created),r.created<=s&&(t=!0)}catch(e){To.error("State.clearStaleState: Error parsing state for key",n,e.message),t=!0}else To.debug("State.clearStaleState: no item in storage for key: ",n),t=!0;if(t)return To.debug("State.clearStaleState: removed item for key: ",n),o.remove(n)}),r.push(i)},n=0;n<t.length;n++){var i;e(n)}return To.debug("State.clearStaleState: waiting on promise count:",r.length),Promise.all(r)})}}]),a}(),Ns=function(){e(p,js);var f=g(p);function p(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.nonce,n=t.authority,i=t.client_id,o=t.redirect_uri,s=t.code_verifier,a=t.response_mode,u=t.client_secret,c=t.scope,l=t.extraTokenParams,d=t.skipUserInfo;if(W(this,p),e=f.call(this,arguments[0]),!0===r?e._nonce=Is():r&&(e._nonce=r),!0===s?e._code_verifier=Is()+Is()+Is():s&&(e._code_verifier=s),e.code_verifier){var h=ms.hashString(e.code_verifier,"SHA256");e._code_challenge=ms.hexToBase64Url(h)}return e._redirect_uri=o,e._authority=n,e._client_id=i,e._response_mode=a,e._client_secret=u,e._scope=c,e._extraTokenParams=l,e._skipUserInfo=d,e}return d(p,[{key:"toStorageString",value:function(){return To.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})}},{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}],[{key:"fromStorageString",value:function(e){return To.debug("SigninState.fromStorageString"),new p(JSON.parse(e))}}]),p}(),Ls=function(){function R(e){var t=e.url,r=e.client_id,n=e.redirect_uri,i=e.response_type,o=e.scope,s=e.authority,a=e.data,u=e.prompt,c=e.display,l=e.max_age,d=e.ui_locales,h=e.id_token_hint,f=e.login_hint,p=e.acr_values,g=e.resource,v=e.response_mode,_=e.request,m=e.request_uri,y=e.extraQueryParams,k=e.request_type,b=e.client_secret,S=e.extraTokenParams,w=e.skipUserInfo;if(W(this,R),!t)throw To.error("SigninRequest.ctor: No url passed"),new Error("url");if(!r)throw To.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!n)throw To.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!i)throw To.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!o)throw To.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!s)throw To.error("SigninRequest.ctor: No authority passed"),new Error("authority");var T=R.isOidc(i),E=R.isCode(i);v=v||(R.isCode(i)?"query":null),this.state=new Ns({nonce:T,data:a,client_id:r,authority:s,redirect_uri:n,code_verifier:E,request_type:k,response_mode:v,client_secret:b,scope:o,extraTokenParams:S,skipUserInfo:w}),t=As.addQueryParam(t,"client_id",r),t=As.addQueryParam(t,"redirect_uri",n),t=As.addQueryParam(t,"response_type",i),t=As.addQueryParam(t,"scope",o),t=As.addQueryParam(t,"state",this.state.id),T&&(t=As.addQueryParam(t,"nonce",this.state.nonce)),E&&(t=As.addQueryParam(t,"code_challenge",this.state.code_challenge),t=As.addQueryParam(t,"code_challenge_method","S256"));var A={prompt:u,display:c,max_age:l,ui_locales:d,id_token_hint:h,login_hint:f,acr_values:p,resource:g,request:_,request_uri:m,response_mode:v};for(var x in A)A[x]&&(t=As.addQueryParam(t,x,A[x]));for(var C in y)t=As.addQueryParam(t,C,y[C]);this.url=t}return d(R,null,[{key:"isOidc",value:function(e){return!!e.split(/\s+/g).filter(function(e){return"id_token"===e})[0]}},{key:"isOAuth",value:function(e){return!!e.split(/\s+/g).filter(function(e){return"token"===e})[0]}},{key:"isCode",value:function(e){return!!e.split(/\s+/g).filter(function(e){return"code"===e})[0]}}]),R}(),Fs=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#";W(this,n);var r=As.parseUrlFragment(e,t);this.error=r.error,this.error_description=r.error_description,this.error_uri=r.error_uri,this.code=r.code,this.state=r.state,this.id_token=r.id_token,this.session_state=r.session_state,this.access_token=r.access_token,this.token_type=r.token_type,this.scope=r.scope,this.profile=void 0,this.expires_in=r.expires_in}return d(n,[{key:"expires_in",get:function(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}},set:function(e){var t=parseInt(e);if("number"==typeof t&&0<t){var r=parseInt(Date.now()/1e3);this.expires_at=r+t}}},{key:"expired",get:function(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return 0<=this.scopes.indexOf("openid")||!!this.id_token}}]),n}(),qs=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};W(this,t),this._settings=e instanceof Es?e:new Es(e)}return d(t,[{key:"createSigninRequest",value:function(e,t){var n=this,r=0<arguments.length&&void 0!==e?e:{},i=r.response_type,o=r.scope,s=r.redirect_uri,a=r.data,u=r.state,c=r.prompt,l=r.display,d=r.max_age,h=r.ui_locales,f=r.id_token_hint,p=r.login_hint,g=r.acr_values,v=r.resource,_=r.request,m=r.request_uri,y=r.response_mode,k=r.extraQueryParams,b=r.extraTokenParams,S=r.request_type,w=r.skipUserInfo,T=1<arguments.length?t:void 0;To.debug("OidcClient.createSigninRequest");var E=this._settings.client_id;i=i||this._settings.response_type,o=o||this._settings.scope,s=s||this._settings.redirect_uri,c=c||this._settings.prompt,l=l||this._settings.display,d=d||this._settings.max_age,h=h||this._settings.ui_locales,g=g||this._settings.acr_values,v=v||this._settings.resource,y=y||this._settings.response_mode,k=k||this._settings.extraQueryParams,b=b||this._settings.extraTokenParams;var A=this._settings.authority;return Ls.isCode(i)&&"code"!==i?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(e){To.debug("OidcClient.createSigninRequest: Received authorization endpoint",e);var t=new Ls({url:e,client_id:E,redirect_uri:s,response_type:i,scope:o,data:a||u,authority:A,prompt:c,display:l,max_age:d,ui_locales:h,id_token_hint:f,login_hint:p,acr_values:g,resource:v,request:_,request_uri:m,extraQueryParams:k,extraTokenParams:b,request_type:S,response_mode:y,client_secret:n._settings.client_secret,skipUserInfo:w}),r=t.state;return(T=T||n._stateStore).set(r.id,r.toStorageString()).then(function(){return t})})}},{key:"readSigninResponseState",value:function(e,t,r){var n=2<arguments.length&&void 0!==r&&r;To.debug("OidcClient.readSigninResponseState");var i="query"===this._settings.response_mode||!this._settings.response_mode&&Ls.isCode(this._settings.response_type),o=new Fs(e,i?"?":"#");return o.state?(t=t||this._stateStore,(n?t.remove.bind(t):t.get.bind(t))(o.state).then(function(e){if(!e)throw To.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:Ns.fromStorageString(e),response:o}})):(To.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response")))}},{key:"processSigninResponse",value:function(e,t){var n=this;return To.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(e,t,!0).then(function(e){var t=e.state,r=e.response;return To.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),n._validator.validateSigninResponse(t,r)})}},{key:"createSignoutRequest",value:function(e,t){var n=this,r=0<arguments.length&&void 0!==e?e:{},i=r.id_token_hint,o=r.data,s=r.state,a=r.post_logout_redirect_uri,u=r.extraQueryParams,c=r.request_type,l=1<arguments.length?t:void 0;return To.debug("OidcClient.createSignoutRequest"),a=a||this._settings.post_logout_redirect_uri,u=u||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(e){if(!e)throw To.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");To.debug("OidcClient.createSignoutRequest: Received end session endpoint",e);var t=new Ms({url:e,id_token_hint:i,post_logout_redirect_uri:a,data:o||s,extraQueryParams:u,request_type:c}),r=t.state;return r&&(To.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(l=l||n._stateStore).set(r.id,r.toStorageString())),t})}},{key:"readSignoutResponseState",value:function(e,t,r){var n=2<arguments.length&&void 0!==r&&r;To.debug("OidcClient.readSignoutResponseState");var i=new Os(e);if(!i.state)return To.debug("OidcClient.readSignoutResponseState: No state in response"),i.error?(To.warn("OidcClient.readSignoutResponseState: Response was error: ",i.error),Promise.reject(new bs(i))):Promise.resolve({undefined:void 0,response:i});var o=i.state;return t=t||this._stateStore,(n?t.remove.bind(t):t.get.bind(t))(o).then(function(e){if(!e)throw To.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:js.fromStorageString(e),response:i}})}},{key:"processSignoutResponse",value:function(e,t){var n=this;return To.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(e,t,!0).then(function(e){var t=e.state,r=e.response;return t?(To.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),n._validator.validateSignoutResponse(t,r)):(To.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),r)})}},{key:"clearStaleState",value:function(e){return To.debug("OidcClient.clearStaleState"),e=e||this._stateStore,js.clearStaleState(e,this.settings.staleStateAge)}},{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),t}(),Bs=function(){function e(){W(this,e),this._data={}}return d(e,[{key:"getItem",value:function(e){return To.debug("InMemoryWebStorage.getItem",e),this._data[e]}},{key:"setItem",value:function(e,t){To.debug("InMemoryWebStorage.setItem",e),this._data[e]=t}},{key:"removeItem",value:function(e){To.debug("InMemoryWebStorage.removeItem",e),delete this._data[e]}},{key:"key",value:function(e){return Object.getOwnPropertyNames(this._data)[e]}},{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),e}(),Ds=function(){function e(){W(this,e)}return d(e,[{key:"prepare",value:function(){return Promise.resolve(this)}},{key:"navigate",value:function(e){return e&&e.url?(e.useReplaceToNavigate?window.location.replace(e.url):window.location=e.url,Promise.resolve()):(To.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))}},{key:"url",get:function(){return window.location.href}}]),e}(),Ws=function(){function i(e){var r=this;W(this,i),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t});var t=e.popupWindowTarget||"_blank",n=e.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",t,n),this._popup&&(To.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return d(i,[{key:"navigate",value:function(e){return this._popup?e&&e.url?(To.debug("PopupWindow.navigate: Setting URL in popup"),this._id=e.id,this._id&&(window["popupCallback_"+e.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=e.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise}},{key:"_success",value:function(e){To.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(e)}},{key:"_error",value:function(e){To.error("PopupWindow.error: ",e),this._cleanup(),this._reject(new Error(e))}},{key:"close",value:function(){this._cleanup(!1)}},{key:"_cleanup",value:function(e){To.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!e&&this._popup.close(),this._popup=null}},{key:"_checkForPopupClosed",value:function(){this._popup&&!this._popup.closed||this._error("Popup window closed")}},{key:"_callback",value:function(e,t){this._cleanup(t),e?(To.debug("PopupWindow.callback success"),this._success({url:e})):(To.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))}},{key:"promise",get:function(){return this._promise}}],[{key:"notifyOpener",value:function(e,t,r){if(window.opener){if(e=e||window.location.href){var n=As.parseUrlFragment(e,r);if(n.state){var i="popupCallback_"+n.state,o=window.opener[i];o?(To.debug("PopupWindow.notifyOpener: passing url message to opener"),o(e,t)):To.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else To.warn("PopupWindow.notifyOpener: no state found in response url")}}else To.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")}}]),i}(),Hs=function(){function e(){W(this,e)}return d(e,[{key:"prepare",value:function(e){var t=new Ws(e);return Promise.resolve(t)}},{key:"callback",value:function(e,t,r){To.debug("PopupNavigator.callback");try{return Ws.notifyOpener(e,t,r),Promise.resolve()}catch(e){return Promise.reject(e)}}}]),e}(),Vs=function(){function t(e){var r=this;W(this,t),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,window.document.body.appendChild(this._frame)}return d(t,[{key:"navigate",value:function(e){if(e&&e.url){var t=e.silentRequestTimeout||1e4;To.debug("IFrameWindow.navigate: Using timeout of:",t),this._timer=window.setTimeout(this._timeout.bind(this),t),this._frame.src=e.url}else this._error("No url provided");return this.promise}},{key:"_success",value:function(e){this._cleanup(),To.debug("IFrameWindow: Successful response from frame window"),this._resolve(e)}},{key:"_error",value:function(e){this._cleanup(),To.error(e),this._reject(new Error(e))}},{key:"close",value:function(){this._cleanup()}},{key:"_cleanup",value:function(){this._frame&&(To.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)}},{key:"_timeout",value:function(){To.debug("IFrameWindow.timeout"),this._error("Frame window timed out")}},{key:"_message",value:function(e){if(To.debug("IFrameWindow.message"),this._timer&&e.origin===this._origin&&e.source===this._frame.contentWindow){var t=e.data;t?this._success({url:t}):this._error("Invalid response from frame")}}},{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}],[{key:"notifyParent",value:function(e){To.debug("IFrameWindow.notifyParent"),window.frameElement&&(e=e||window.location.href)&&(To.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(e,location.protocol+"//"+location.host))}}]),t}(),Js=function(){function e(){W(this,e)}return d(e,[{key:"prepare",value:function(e){var t=new Vs(e);return Promise.resolve(t)}},{key:"callback",value:function(e){To.debug("IFrameNavigator.callback");try{return Vs.notifyParent(e),Promise.resolve()}catch(e){return Promise.reject(e)}}}]),e}(),Ks=function(){e(N,Es);var j=g(N);function N(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.popup_redirect_uri,n=t.popup_post_logout_redirect_uri,i=t.popupWindowFeatures,o=t.popupWindowTarget,s=t.silent_redirect_uri,a=t.silentRequestTimeout,u=t.automaticSilentRenew,c=void 0!==u&&u,l=t.validateSubOnSilentRenew,d=void 0!==l&&l,h=t.includeIdTokenInSilentRenew,f=void 0===h||h,p=t.monitorSession,g=void 0===p||p,v=t.monitorAnonymousSession,_=void 0!==v&&v,m=t.checkSessionInterval,y=void 0===m?2e3:m,k=t.stopCheckSessionOnError,b=void 0===k||k,S=t.query_status_response_type,w=t.revokeAccessTokenOnSignout,T=void 0!==w&&w,E=t.accessTokenExpiringNotificationTime,A=void 0===E?60:E,x=t.redirectNavigator,C=void 0===x?new Ds:x,R=t.popupNavigator,U=void 0===R?new Hs:R,P=t.iframeNavigator,I=void 0===P?new Js:P,M=t.userStore,O=void 0===M?new Mo({store:Io.sessionStorage}):M;return W(this,N),(e=j.call(this,arguments[0]))._popup_redirect_uri=r,e._popup_post_logout_redirect_uri=n,e._popupWindowFeatures=i,e._popupWindowTarget=o,e._silent_redirect_uri=s,e._silentRequestTimeout=a,e._automaticSilentRenew=c,e._validateSubOnSilentRenew=d,e._includeIdTokenInSilentRenew=f,e._accessTokenExpiringNotificationTime=A,e._monitorSession=g,e._monitorAnonymousSession=_,e._checkSessionInterval=y,e._stopCheckSessionOnError=b,S?e._query_status_response_type=S:arguments[0]&&arguments[0].response_type?e._query_status_response_type=Ls.isOidc(arguments[0].response_type)?"id_token":"code":e._query_status_response_type="id_token",e._revokeAccessTokenOnSignout=T,e._redirectNavigator=C,e._popupNavigator=U,e._iframeNavigator=I,e._userStore=O,e}return d(N,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),N}(),zs=function(){function l(e){var t=e.id_token,r=e.session_state,n=e.access_token,i=e.refresh_token,o=e.token_type,s=e.scope,a=e.profile,u=e.expires_at,c=e.state;W(this,l),this.id_token=t,this.session_state=r,this.access_token=n,this.refresh_token=i,this.token_type=o,this.scope=s,this.profile=a,this.expires_at=u,this.state=c}return d(l,[{key:"toStorageString",value:function(){return To.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}},{key:"expires_in",get:function(){if(this.expires_at){var e=parseInt(Date.now()/1e3);return this.expires_at-e}},set:function(e){var t=parseInt(e);if("number"==typeof t&&0<t){var r=parseInt(Date.now()/1e3);this.expires_at=r+t}}},{key:"expired",get:function(){var e=this.expires_in;if(void 0!==e)return e<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}],[{key:"fromStorageString",value:function(e){return To.debug("User.fromStorageString"),new l(JSON.parse(e))}}]),l}(),Qs=function(){function t(e){W(this,t),this._name=e,this._callbacks=[]}return d(t,[{key:"addHandler",value:function(e){this._callbacks.push(e)}},{key:"removeHandler",value:function(t){var e=this._callbacks.findIndex(function(e){return e===t});0<=e&&this._callbacks.splice(e,1)}},{key:"raise",value:function(){To.debug("Event: Raising event: "+this._name);for(var e=0;e<this._callbacks.length;e++){var t;(t=this._callbacks)[e].apply(t,arguments)}}}]),t}(),Xs=function(){e(o,Qs);var i=g(o);function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Io.timer,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return W(this,o),(t=i.call(this,e))._timer=r,t._nowFunc=n||function(){return Date.now()/1e3},t}return d(o,[{key:"init",value:function(e){e<=0&&(e=1),e=parseInt(e);var t=this.now+e;if(this.expiration===t&&this._timerHandle)To.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),To.debug("Timer.init timer "+this._name+" for duration:",e),this._expiration=t;var r=5;e<r&&(r=e),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*r)}}},{key:"cancel",value:function(){this._timerHandle&&(To.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)}},{key:"_callback",value:function(){var e=this._expiration-this.now;To.debug("Timer.callback; "+this._name+" timer expires in:",e),this._expiration<=this.now&&(this.cancel(),u(s(o.prototype),"raise",this).call(this))}},{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),o}(),Gs=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.accessTokenExpiringNotificationTime,r=void 0===t?60:t,n=e.accessTokenExpiringTimer,i=void 0===n?new Xs("Access token expiring"):n,o=e.accessTokenExpiredTimer,s=void 0===o?new Xs("Access token expired"):o;W(this,a),this._accessTokenExpiringNotificationTime=r,this._accessTokenExpiring=i,this._accessTokenExpired=s}return d(a,[{key:"load",value:function(e){if(e.access_token&&void 0!==e.expires_in){var t=e.expires_in;if(To.debug("AccessTokenEvents.load: access token present, remaining duration:",t),0<t){var r=t-this._accessTokenExpiringNotificationTime;r<=0&&(r=1),To.debug("AccessTokenEvents.load: registering expiring timer in:",r),this._accessTokenExpiring.init(r)}else To.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var n=t+1;To.debug("AccessTokenEvents.load: registering expired timer in:",n),this._accessTokenExpired.init(n)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()}},{key:"unload",value:function(){To.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()}},{key:"addAccessTokenExpiring",value:function(e){this._accessTokenExpiring.addHandler(e)}},{key:"removeAccessTokenExpiring",value:function(e){this._accessTokenExpiring.removeHandler(e)}},{key:"addAccessTokenExpired",value:function(e){this._accessTokenExpired.addHandler(e)}},{key:"removeAccessTokenExpired",value:function(e){this._accessTokenExpired.removeHandler(e)}}]),a}(),Zs=function(){e(n,Gs);var r=g(n);function n(e){var t;return W(this,n),(t=r.call(this,e))._userLoaded=new Qs("User loaded"),t._userUnloaded=new Qs("User unloaded"),t._silentRenewError=new Qs("Silent renew error"),t._userSignedIn=new Qs("User signed in"),t._userSignedOut=new Qs("User signed out"),t._userSessionChanged=new Qs("User session changed"),t}return d(n,[{key:"load",value:function(e,t){var r=!(1<arguments.length&&void 0!==t)||t;To.debug("UserManagerEvents.load"),u(s(n.prototype),"load",this).call(this,e),r&&this._userLoaded.raise(e)}},{key:"unload",value:function(){To.debug("UserManagerEvents.unload"),u(s(n.prototype),"unload",this).call(this),this._userUnloaded.raise()}},{key:"addUserLoaded",value:function(e){this._userLoaded.addHandler(e)}},{key:"removeUserLoaded",value:function(e){this._userLoaded.removeHandler(e)}},{key:"addUserUnloaded",value:function(e){this._userUnloaded.addHandler(e)}},{key:"removeUserUnloaded",value:function(e){this._userUnloaded.removeHandler(e)}},{key:"addSilentRenewError",value:function(e){this._silentRenewError.addHandler(e)}},{key:"removeSilentRenewError",value:function(e){this._silentRenewError.removeHandler(e)}},{key:"_raiseSilentRenewError",value:function(e){To.debug("UserManagerEvents._raiseSilentRenewError",e.message),this._silentRenewError.raise(e)}},{key:"addUserSignedIn",value:function(e){this._userSignedIn.addHandler(e)}},{key:"removeUserSignedIn",value:function(e){this._userSignedIn.removeHandler(e)}},{key:"_raiseUserSignedIn",value:function(){To.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()}},{key:"addUserSignedOut",value:function(e){this._userSignedOut.addHandler(e)}},{key:"removeUserSignedOut",value:function(e){this._userSignedOut.removeHandler(e)}},{key:"_raiseUserSignedOut",value:function(){To.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()}},{key:"addUserSessionChanged",value:function(e){this._userSessionChanged.addHandler(e)}},{key:"removeUserSessionChanged",value:function(e){this._userSessionChanged.removeHandler(e)}},{key:"_raiseUserSessionChanged",value:function(){To.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()}}]),n}(),Ys=function(){function t(e){W(this,t),this._userManager=e}return d(t,[{key:"start",value:function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(e){}).catch(function(e){To.error("SilentRenewService.start: Error from getUser:",e.message)}))}},{key:"stop",value:function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)}},{key:"_tokenExpiring",value:function(){var t=this;this._userManager.signinSilent().then(function(e){To.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(e){To.error("SilentRenewService._tokenExpiring: Error from signinSilent:",e.message),t._userManager.events._raiseSilentRenewError(e)})}}]),t}(),$s=function(){function s(e,t,r,n){var i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];W(this,s),this._callback=e,this._client_id=t,this._url=r,this._interval=n||2e3,this._stopOnError=i;var o=r.indexOf("/",r.indexOf("//")+2);this._frame_origin=r.substr(0,o),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.style.width=0,this._frame.style.height=0,this._frame.src=r}return d(s,[{key:"load",value:function(){var t=this;return new Promise(function(e){t._frame.onload=function(){e()},window.document.body.appendChild(t._frame),t._boundMessageEvent=t._message.bind(t),window.addEventListener("message",t._boundMessageEvent,!1)})}},{key:"_message",value:function(e){e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(To.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===e.data?(To.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):To.debug("CheckSessionIFrame: "+e.data+" message from check session op iframe"))}},{key:"start",value:function(e){var t=this;if(this._session_state!==e){To.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=e;var r=function(){t._frame.contentWindow.postMessage(t._client_id+" "+t._session_state,t._frame_origin)};r(),this._timer=window.setInterval(r,this._interval)}}},{key:"stop",value:function(){this._session_state=null,this._timer&&(To.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)}}]),s}(),ea=function(){function i(e){var r=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:$s,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Io.timer;if(W(this,i),!e)throw To.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=e,this._CheckSessionIFrameCtor=t,this._timer=n,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),this._userManager.getUser().then(function(e){e?r._start(e):r._settings.monitorAnonymousSession&&r._userManager.querySessionStatus().then(function(e){var t={session_state:e.session_state};e.sub&&e.sid&&(t.profile={sub:e.sub,sid:e.sid}),r._start(t)}).catch(function(e){To.error("SessionMonitor ctor: error from querySessionStatus:",e.message)})}).catch(function(e){To.error("SessionMonitor ctor: error from getUser:",e.message)})}return d(i,[{key:"_start",value:function(e){var i=this,o=e.session_state;o&&(e.profile?(this._sub=e.profile.sub,this._sid=e.profile.sid,To.debug("SessionMonitor._start: session_state:",o,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,To.debug("SessionMonitor._start: session_state:",o,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(o):this._metadataService.getCheckSessionIframe().then(function(e){if(e){To.debug("SessionMonitor._start: Initializing check session iframe");var t=i._client_id,r=i._checkSessionInterval,n=i._stopCheckSessionOnError;i._checkSessionIFrame=new i._CheckSessionIFrameCtor(i._callback.bind(i),t,e,r,n),i._checkSessionIFrame.load().then(function(){i._checkSessionIFrame.start(o)})}else To.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(e){To.error("SessionMonitor._start: Error from getCheckSessionIframe:",e.message)}))}},{key:"_stop",value:function(){var r=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(To.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var e=this._timer.setInterval(function(){r._timer.clearInterval(e),r._userManager.querySessionStatus().then(function(e){var t={session_state:e.session_state};e.sub&&e.sid&&(t.profile={sub:e.sub,sid:e.sid}),r._start(t)}).catch(function(e){To.error("SessionMonitor: error from querySessionStatus:",e.message)})},1e3)}},{key:"_callback",value:function(){var r=this;this._userManager.querySessionStatus().then(function(e){var t=!0;e?e.sub===r._sub?(t=!1,r._checkSessionIFrame.start(e.session_state),e.sid===r._sid?To.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",e.session_state):(To.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",e.session_state),r._userManager.events._raiseUserSessionChanged())):To.debug("SessionMonitor._callback: Different subject signed into OP:",e.sub):To.debug("SessionMonitor._callback: Subject no longer signed into OP"),t&&(r._sub?(To.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),r._userManager.events._raiseUserSignedOut()):(To.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),r._userManager.events._raiseUserSignedIn()))}).catch(function(e){r._sub&&(To.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",e.message),r._userManager.events._raiseUserSignedOut())})}},{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),i}(),ta=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Io.XMLHttpRequest,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:No;if(W(this,n),!e)throw To.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=e,this._XMLHttpRequestCtor=t,this._metadataService=new r(this._settings)}return d(n,[{key:"revoke",value:function(n,i,e){var o=this,s=2<arguments.length&&void 0!==e?e:"access_token";if(!n)throw To.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if("access_token"!==s&&"refresh_token"!=s)throw To.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(e){if(e){To.debug("TokenRevocationClient.revoke: Revoking "+s);var t=o._settings.client_id,r=o._settings.client_secret;return o._revoke(e,t,r,n,s)}if(i)throw To.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})}},{key:"_revoke",value:function(i,o,s,a,u){var c=this;return new Promise(function(e,t){var r=new c._XMLHttpRequestCtor;r.open("POST",i),r.onload=function(){To.debug("TokenRevocationClient.revoke: HTTP response received, status",r.status),200===r.status?e():t(Error(r.statusText+" ("+r.status+")"))},r.onerror=function(){To.debug("TokenRevocationClient.revoke: Network Error."),t("Network Error")};var n="client_id="+encodeURIComponent(o);s&&(n+="&client_secret="+encodeURIComponent(s)),n+="&token_type_hint="+encodeURIComponent(u),n+="&token="+encodeURIComponent(a),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(n)})}}]),n}(),ra=function(){e(u,qs);var a=g(u);function u(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Ys,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ea,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ta,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ks,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:ms;return W(this,u),t instanceof Ks||(t=new Ks(t)),(e=a.call(this,t))._events=new Zs(t),e._silentRenewService=new r(h(e)),e.settings.automaticSilentRenew&&(To.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),e.startSilentRenew()),e.settings.monitorSession&&(To.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),e._sessionMonitor=new n(h(e))),e._tokenRevocationClient=new i(e._settings),e._tokenClient=new o(e._settings),e._joseUtil=s,e}return d(u,[{key:"getUser",value:function(){var t=this;return this._loadUser().then(function(e){return e?(To.info("UserManager.getUser: user loaded"),t._events.load(e,!1),e):(To.info("UserManager.getUser: user not found in storage"),null)})}},{key:"removeUser",value:function(){var e=this;return this.storeUser(null).then(function(){To.info("UserManager.removeUser: user removed from storage"),e._events.unload()})}},{key:"signinRedirect",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};(t=Object.assign({},t)).request_type="si:r";var r={useReplaceToNavigate:t.useReplaceToNavigate};return this._signinStart(t,this._redirectNavigator,r).then(function(){To.info("UserManager.signinRedirect: successful")})}},{key:"signinRedirectCallback",value:function(e){return this._signinEnd(e||this._redirectNavigator.url).then(function(e){return e.profile&&e.profile.sub?To.info("UserManager.signinRedirectCallback: successful, signed in sub: ",e.profile.sub):To.info("UserManager.signinRedirectCallback: no sub"),e})}},{key:"signinPopup",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};(t=Object.assign({},t)).request_type="si:p";var r=t.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return r?(t.redirect_uri=r,t.display="popup",this._signin(t,this._popupNavigator,{startUrl:r,popupWindowFeatures:t.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:t.popupWindowTarget||this.settings.popupWindowTarget}).then(function(e){return e&&(e.profile&&e.profile.sub?To.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",e.profile.sub):To.info("UserManager.signinPopup: no sub")),e})):(To.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))}},{key:"signinPopupCallback",value:function(e){return this._signinCallback(e,this._popupNavigator).then(function(e){return e&&(e.profile&&e.profile.sub?To.info("UserManager.signinPopupCallback: successful, signed in sub: ",e.profile.sub):To.info("UserManager.signinPopupCallback: no sub")),e}).catch(function(e){To.error("UserManager.signinPopupCallback error: "+e&&e.message)})}},{key:"signinSilent",value:function(e){var t=this,r=0<arguments.length&&void 0!==e?e:{};return(r=Object.assign({},r)).request_type="si:s",this._loadUser().then(function(e){return e&&e.refresh_token?(r.refresh_token=e.refresh_token,t._useRefreshToken(r)):(r.id_token_hint=r.id_token_hint||t.settings.includeIdTokenInSilentRenew&&e&&e.id_token,e&&t._settings.validateSubOnSilentRenew&&(To.debug("UserManager.signinSilent, subject prior to silent renew: ",e.profile.sub),r.current_sub=e.profile.sub),t._signinSilentIframe(r))})}},{key:"_useRefreshToken",value:function(e){var n=this,t=0<arguments.length&&void 0!==e?e:{};return this._tokenClient.exchangeRefreshToken(t).then(function(r){return r?r.access_token?n._loadUser().then(function(e){if(e){var t=Promise.resolve();return r.id_token&&(t=n._validateIdTokenFromTokenRefreshToken(e.profile,r.id_token)),t.then(function(){return To.debug("UserManager._useRefreshToken: refresh token response success"),e.id_token=r.id_token,e.access_token=r.access_token,e.refresh_token=r.refresh_token||e.refresh_token,e.expires_in=r.expires_in,n.storeUser(e).then(function(){return n._events.load(e),e})})}return null}):(To.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(To.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})}},{key:"_validateIdTokenFromTokenRefreshToken",value:function(t,r){var n=this;return this._metadataService.getIssuer().then(function(e){return n._joseUtil.validateJwtAttributes(r,e,n._settings.client_id,n._settings.clockSkew).then(function(e){return e?e.sub!==t.sub?(To.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):e.auth_time&&e.auth_time!==t.auth_time?(To.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):e.azp&&e.azp!==t.azp?(To.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!e.azp&&t.azp?(To.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(To.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})}},{key:"_signinSilentIframe",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},r=t.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return r?(t.redirect_uri=r,t.prompt=t.prompt||"none",this._signin(t,this._iframeNavigator,{startUrl:r,silentRequestTimeout:t.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(e){return e&&(e.profile&&e.profile.sub?To.info("UserManager.signinSilent: successful, signed in sub: ",e.profile.sub):To.info("UserManager.signinSilent: no sub")),e})):(To.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))}},{key:"signinSilentCallback",value:function(e){return this._signinCallback(e,this._iframeNavigator).then(function(e){return e&&(e.profile&&e.profile.sub?To.info("UserManager.signinSilentCallback: successful, signed in sub: ",e.profile.sub):To.info("UserManager.signinSilentCallback: no sub")),e})}},{key:"signinCallback",value:function(r){var n=this;return this.readSigninResponseState(r).then(function(e){var t=e.state;e.response;return"si:r"===t.request_type?n.signinRedirectCallback(r):"si:p"===t.request_type?n.signinPopupCallback(r):"si:s"===t.request_type?n.signinSilentCallback(r):Promise.reject(new Error("invalid response_type in state"))})}},{key:"signoutCallback",value:function(n,i){var o=this;return this.readSignoutResponseState(n).then(function(e){var t=e.state,r=e.response;return t?"so:r"===t.request_type?o.signoutRedirectCallback(n):"so:p"===t.request_type?o.signoutPopupCallback(n,i):Promise.reject(new Error("invalid response_type in state")):r})}},{key:"querySessionStatus",value:function(e){var t=this,r=0<arguments.length&&void 0!==e?e:{};(r=Object.assign({},r)).request_type="si:s";var n=r.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return n?(r.redirect_uri=n,r.prompt="none",r.response_type=r.response_type||this.settings.query_status_response_type,r.scope=r.scope||"openid",r.skipUserInfo=!0,this._signinStart(r,this._iframeNavigator,{startUrl:n,silentRequestTimeout:r.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(e){return t.processSigninResponse(e.url).then(function(e){if(To.debug("UserManager.querySessionStatus: got signin response"),e.session_state&&e.profile.sub)return To.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid};To.info("querySessionStatus successful, user not authenticated")}).catch(function(e){if(e.session_state&&t.settings.monitorAnonymousSession&&("login_required"==e.message||"consent_required"==e.message||"interaction_required"==e.message||"account_selection_required"==e.message))return To.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:e.session_state};throw e})})):(To.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))}},{key:"_signin",value:function(t,e,r){var n=this,i=2<arguments.length&&void 0!==r?r:{};return this._signinStart(t,e,i).then(function(e){return n._signinEnd(e.url,t)})}},{key:"_signinStart",value:function(e,t,r){var n=this,i=2<arguments.length&&void 0!==r?r:{};return t.prepare(i).then(function(t){return To.debug("UserManager._signinStart: got navigator window handle"),n.createSigninRequest(e).then(function(e){return To.debug("UserManager._signinStart: got signin request"),i.url=e.url,i.id=e.state.id,t.navigate(i)}).catch(function(e){throw t.close&&(To.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),t.close()),e})})}},{key:"_signinEnd",value:function(e,t){var r=this,n=1<arguments.length&&void 0!==t?t:{};return this.processSigninResponse(e).then(function(e){To.debug("UserManager._signinEnd: got signin response");var t=new zs(e);if(n.current_sub){if(n.current_sub!==t.profile.sub)return To.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",t.profile.sub),Promise.reject(new Error("login_required"));To.debug("UserManager._signinEnd: current user matches user returned from signin")}return r.storeUser(t).then(function(){return To.debug("UserManager._signinEnd: user stored"),r._events.load(t),t})})}},{key:"_signinCallback",value:function(e,t){return To.debug("UserManager._signinCallback"),t.callback(e)}},{key:"signoutRedirect",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};(t=Object.assign({},t)).request_type="so:r";var r=t.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;r&&(t.post_logout_redirect_uri=r);var n={useReplaceToNavigate:t.useReplaceToNavigate};return this._signoutStart(t,this._redirectNavigator,n).then(function(){To.info("UserManager.signoutRedirect: successful")})}},{key:"signoutRedirectCallback",value:function(e){return this._signoutEnd(e||this._redirectNavigator.url).then(function(e){return To.info("UserManager.signoutRedirectCallback: successful"),e})}},{key:"signoutPopup",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};(t=Object.assign({},t)).request_type="so:p";var r=t.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return t.post_logout_redirect_uri=r,t.display="popup",t.post_logout_redirect_uri&&(t.state=t.state||{}),this._signout(t,this._popupNavigator,{startUrl:r,popupWindowFeatures:t.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:t.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){To.info("UserManager.signoutPopup: successful")})}},{key:"signoutPopupCallback",value:function(e,t){void 0===t&&"boolean"==typeof e&&(t=e,e=null);return this._popupNavigator.callback(e,t,"?").then(function(){To.info("UserManager.signoutPopupCallback: successful")})}},{key:"_signout",value:function(e,t,r){var n=this,i=2<arguments.length&&void 0!==r?r:{};return this._signoutStart(e,t,i).then(function(e){return n._signoutEnd(e.url)})}},{key:"_signoutStart",value:function(e,t,r){var n=this,i=0<arguments.length&&void 0!==e?e:{},o=2<arguments.length&&void 0!==r?r:{};return(1<arguments.length?t:void 0).prepare(o).then(function(r){return To.debug("UserManager._signoutStart: got navigator window handle"),n._loadUser().then(function(t){return To.debug("UserManager._signoutStart: loaded current user from storage"),(n._settings.revokeAccessTokenOnSignout?n._revokeInternal(t):Promise.resolve()).then(function(){var e=i.id_token_hint||t&&t.id_token;return e&&(To.debug("UserManager._signoutStart: Setting id_token into signout request"),i.id_token_hint=e),n.removeUser().then(function(){return To.debug("UserManager._signoutStart: user removed, creating signout request"),n.createSignoutRequest(i).then(function(e){return To.debug("UserManager._signoutStart: got signout request"),o.url=e.url,e.state&&(o.id=e.state.id),r.navigate(o)})})})}).catch(function(e){throw r.close&&(To.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),r.close()),e})})}},{key:"_signoutEnd",value:function(e){return this.processSignoutResponse(e).then(function(e){return To.debug("UserManager._signoutEnd: got signout response"),e})}},{key:"revokeAccessToken",value:function(){var r=this;return this._loadUser().then(function(t){return r._revokeInternal(t,!0).then(function(e){if(e)return To.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),t.access_token=null,t.refresh_token=null,t.expires_at=null,t.token_type=null,r.storeUser(t).then(function(){To.debug("UserManager.revokeAccessToken: user stored"),r._events.load(t)})})}).then(function(){To.info("UserManager.revokeAccessToken: access token revoked successfully")})}},{key:"_revokeInternal",value:function(e,r){var n=this;if(e){var t=e.access_token,i=e.refresh_token;return this._revokeAccessTokenInternal(t,r).then(function(t){return n._revokeRefreshTokenInternal(i,r).then(function(e){return t||e||To.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),t||e})})}return Promise.resolve(!1)}},{key:"_revokeAccessTokenInternal",value:function(e,t){return!e||0<=e.indexOf(".")?Promise.resolve(!1):this._tokenRevocationClient.revoke(e,t).then(function(){return!0})}},{key:"_revokeRefreshTokenInternal",value:function(e,t){return e?this._tokenRevocationClient.revoke(e,t,"refresh_token").then(function(){return!0}):Promise.resolve(!1)}},{key:"startSilentRenew",value:function(){this._silentRenewService.start()}},{key:"stopSilentRenew",value:function(){this._silentRenewService.stop()}},{key:"_loadUser",value:function(){return this._userStore.get(this._userStoreKey).then(function(e){return e?(To.debug("UserManager._loadUser: user storageString loaded"),zs.fromStorageString(e)):(To.debug("UserManager._loadUser: no user storageString"),null)})}},{key:"storeUser",value:function(e){if(e){To.debug("UserManager.storeUser: storing user");var t=e.toStorageString();return this._userStore.set(this._userStoreKey,t)}return To.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)}},{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:".concat(this.settings.authority,":").concat(this.settings.client_id)}}]),u}(),na=function(){function t(e){var r=this;W(this,t),this._promise=new Promise(function(e,t){r._resolve=e,r._reject=t}),this.features=e.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=e.popupWindowTarget||"_blank",this.redirect_uri=e.startUrl,To.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return d(t,[{key:"_isInAppBrowserInstalled",value:function(t){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(e){return t.hasOwnProperty(e)})}},{key:"navigate",value:function(e){if(e&&e.url){if(!window.cordova)return this._error("cordova is undefined");var t=window.cordova.require("cordova/plugin_list").metadata;if(!1===this._isInAppBrowserInstalled(t))return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(e.url,this.target,this.features),this._popup?(To.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise}},{key:"_loadStartCallback",value:function(e){0===e.url.indexOf(this.redirect_uri)&&this._success({url:e.url})}},{key:"_exitCallback",value:function(e){this._error(e)}},{key:"_success",value:function(e){this._cleanup(),To.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(e)}},{key:"_error",value:function(e){this._cleanup(),To.error(e),this._reject(new Error(e))}},{key:"close",value:function(){this._cleanup()}},{key:"_cleanup",value:function(){this._popup&&(To.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null}},{key:"promise",get:function(){return this._promise}}]),t}(),ia={Version:"1.10.1",Log:To,OidcClient:qs,OidcClientSettings:Es,WebStorageStateStore:Mo,InMemoryWebStorage:Bs,UserManager:ra,AccessTokenEvents:Gs,MetadataService:No,CordovaPopupNavigator:function(){function e(){W(this,e)}return d(e,[{key:"prepare",value:function(e){var t=new na(e);return Promise.resolve(t)}}]),e}(),CordovaIFrameNavigator:function(){function e(){W(this,e)}return d(e,[{key:"prepare",value:function(e){e.popupWindowFeatures="hidden=yes";var t=new na(e);return Promise.resolve(t)}}]),e}(),CheckSessionIFrame:$s,TokenRevocationClient:ta,SessionMonitor:ea,Global:Io,User:zs},oa=ia.UserManager,sa=ia.Log,aa=function(){function s(){W(this,s)}return d(s,null,[{key:"getUserManagerForAuthentication",value:function(e,t){var r=!(1<arguments.length&&void 0!==t)||t;sa.logger=console,sa.level=e.enableDebugLogging?sa.DEBUG:sa.WARN;var n="authentication|".concat(e.authority,"|").concat(e.clientId),i=s.__userManagerCache[n];if(!i&&r){var o={authority:e.authority,client_id:e.clientId,response_type:"code",query_status_response_type:"code",monitorSession:!0,scope:e.scope,redirect_uri:e.redirectUri,silent_redirect_uri:e.silentRedirectUri,post_logout_redirect_uri:e.postLogoutRedirectUri,includeIdTokenInSilentRenew:!1,loadUserInfo:!1,filterProtocolClaims:!0,revokeAccessTokenOnSignout:!0,staleStateAge:900};(i=new oa(o)).clearStaleState(),s.__userManagerCache[n]=i}return i}},{key:"getUserManagerForSessionKeepAlive",value:function(e,t){var r=!(1<arguments.length&&void 0!==t)||t,n=s.getUserManagerForAuthentication(e,!1);if(!n){var i="keepAlive|".concat(e.authority,"|").concat(e.clientId);!(n=s.__userManagerCache[i])&&r&&((n=new oa({authority:e.authority,client_id:e.clientId,silent_redirect_uri:e.silentRedirectUri,redirect_uri:e.redirectUri,response_type:"code",loadUserInfo:!1,includeIdTokenInSilentRenew:!1,scope:e.scope})).clearStaleState(),s.__userManagerCache[i]=n)}return n}},{key:"getUserManagerForSessionStatus",value:function(e){var t=s.getUserManagerForSessionKeepAlive(e,!1);if(!t){var r="sessionStatus|".concat(e.authority,"|").concat(e.clientId);if(!(t=s.__userManagerCache[r])){var n={authority:e.authority,client_id:e.clientId,silent_redirect_uri:e.silentRedirectUri,response_type:"code",monitorSession:!0,loadUserInfo:!1,includeIdTokenInSilentRenew:!1};(t=new oa(n)).clearStaleState(),s.__userManagerCache[r]=t}}return t}}]),s}();aa.__userManagerCache={};function ua(e){var t,s=this;W(this,ua),this._options=void 0,this._failedKeepAliveCallbacks=[],this._successfulKeepAliveCallbacks=[],this.intervalId=void 0,this.startKeepAlive=function(){s.intervalId?s.debug("ignoring attempt to start keep alive when check is already active"):(s.debug("starting keep alive"),s.intervalId=window.setInterval(s.pingKeepAliveEndpoint,s._options.interval))},this.cancelKeepAlive=function(){s.intervalId?(window.clearInterval(s.intervalId),s.intervalId=null):s.debug("ignoring attempt to cancel a keep alive check when one isn't active")},this.pause=function(t){return new Promise(function(e){return setTimeout(e,t)})},this.backoff=function(r,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:500,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return n().catch(function(e){var t=Math.pow(2,o)*i;return 1<r?(s.debug("Keep alive request failed, retrying in ".concat(t,"ms"),e),s.pause(t).then(function(){return s.backoff(r-1,n,i,o+1)})):(s.debug("Too many retries in backoff function. Ending backoff"),Promise.reject(e))})},this.pingKeepAliveEndpoint=function(){if(!s._options.browserActivityMonitor.isUserActive)return s.debug("user not active not firing request to keep alive keep alive endpoint"),void s.cancelKeepAlive();s.debug("Firing request to ".concat(s._options.keepAliveEndpoint)),s.backoff(4,s.fireKeepAliveRequest,1e3).catch(function(e){s.debug("Too many failures to keepalive endpoint in exponential retry. Cancelling"),s.fireFailedCallbacks(ua.NETWORK_FAILURE),s.cancelKeepAlive()})},this.fireKeepAliveRequest=function(){return fetch(s._options.keepAliveEndpoint,{method:"GET",cache:"no-cache"}).then(function(e){return 401===e.status?(s.fireFailedCallbacks(ua.UNAUTHORIZED),void s.cancelKeepAlive()):e.ok?(s.debug("Request ".concat(s._options.keepAliveEndpoint," responded with 2xx status")),void s.fireSuccessfulCallbacks()):(s.debug("Keep alive response was not 2xx"),s.fireFailedCallbacks(ua.UNKNOWN),void s.cancelKeepAlive())})},this.registerSuccessfulCallback=function(e){s._successfulKeepAliveCallbacks.push(e)},this.registerFailedCallback=function(e){s._failedKeepAliveCallbacks.push(e)},this.fireSuccessfulCallbacks=function(){s._successfulKeepAliveCallbacks.forEach(function(e){e()})},this.fireFailedCallbacks=function(t){s._failedKeepAliveCallbacks.forEach(function(e){e(t)})},this.debug=function(){if(s._options.enableLogging){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,["KeepAliveService"].concat(r))}},this._options=c(c({},e),{},{keepAliveEndpoint:null!==(t=e.keepAliveEndpoint)&&void 0!==t?t:"/keep-alive",interval:6e4})}ua.NETWORK_FAILURE="NETWORK_FAILURE",ua.UNAUTHORIZED="UNAUTHORIZED",ua.UNKNOWN="UNKNOWN";var ca=function(){function e(){W(this,e),this._modal=void 0}return d(e,[{key:"prepare",value:function(e){return this._modal=e,Promise.resolve(e)}},{key:"dispose",value:function(){this._modal.dispose(),this._modal=null}}]),e}(),la=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],da=la.join(","),ha="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function fa(e,t){t=t||{};var r,n,i,o=[],s=[],a=e.querySelectorAll(da);for(t.includeContainer&&ha.call(e,da)&&(a=Array.prototype.slice.apply(a)).unshift(e),r=0;r<a.length;r++)pa(n=a[r])&&(0===(i=_a(n))?o.push(n):s.push({documentOrder:r,tabIndex:i,node:n}));return s.sort(ma).map(function(e){return e.node}).concat(o)}function pa(e){return!(!ga(e)||function(e){return function(e){return ya(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t=function(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t]}(e.ownerDocument.querySelectorAll('input[type="radio"][name="'+e.name+'"]'));return!t||t===e}(e)}(e)||_a(e)<0)}function ga(e){return!(e.disabled||function(e){return ya(e)&&"hidden"===e.type}(e)||function(e){return null===e.offsetParent||"hidden"===getComputedStyle(e).visibility}(e))}fa.isTabbable=function(e){if(!e)throw new Error("No node provided");return!1!==ha.call(e,da)&&pa(e)},fa.isFocusable=function(e){if(!e)throw new Error("No node provided");return!1!==ha.call(e,va)&&ga(e)};var va=la.concat("iframe").join(",");function _a(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?function(e){return"true"===e.contentEditable}(e)?0:e.tabIndex:t}function ma(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}function ya(e){return"INPUT"===e.tagName}var ka,ba=fa,Sa=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)wa.call(r,n)&&(e[n]=r[n])}return e},wa=Object.prototype.hasOwnProperty;var Ta,Ea=(Ta=[],{activateTrap:function(e){if(0<Ta.length){var t=Ta[Ta.length-1];t!==e&&t.pause()}var r=Ta.indexOf(e);-1===r||Ta.splice(r,1),Ta.push(e)},deactivateTrap:function(e){var t=Ta.indexOf(e);-1!==t&&Ta.splice(t,1),0<Ta.length&&Ta[Ta.length-1].unpause()}});function Aa(e){return setTimeout(e,0)}function xa(){return"".concat(location.protocol,"//").concat(location.host)}function Ca(e,r,t){var n=document.createElement(e);return Object.keys(r).forEach(function(e){var t=r[e];"textContent"!==e?"style"!==e?n.setAttribute(e,t):Object.assign(n.style,t):n[e]=t}),t&&n.appendChild(t),n}function Ra(e){var t=document.createDocumentFragment();return e.forEach(function(e){t.appendChild(e)}),t}function Ua(e){var i=this;W(this,Ua),this._options=void 0,this.xerolyticsEndpoint=void 0,this.info=function(e,t){return i.sendEvent("error",e,t)},this.warn=function(e,t){return i.sendEvent("error",e,t)},this.error=function(e,t){return i.sendEvent("error",e,t)},this.sendEvent=function(e,t,r){if(""!==i.xerolyticsEndpoint){var n=i.buildPayload(e,t,r);navigator.sendBeacon?navigator.sendBeacon(i.xerolyticsEndpoint,n):i.sendXhrRequest(n)}else console.log("".concat(e,": ").concat(t,", ").concat(r))},this.buildPayload=function(e,t,r){return JSON.stringify({eventType:e,properties:c(c({location:window.location.href,timestamp:Date.now(),eventAction:t},i._options),r)},La)},this.sendXhrRequest=function(e){var t=new XMLHttpRequest;t.open("POST",i.xerolyticsEndpoint,!0),t.setRequestHeader("Content-Type","text/plain"),t.send(e)},this._options={userAgent:navigator.userAgent,eventSource:"Identity.js",clientId:e,identityJsVersion:"1.1.10"},this.xerolyticsEndpoint="https://telemetry.ext.platformdevelopment.xero.com"}var Pa=function(e,t){var n=document,r="string"==typeof e?n.querySelector(e):e,i=Sa({returnFocusOnDeactivate:!0,escapeDeactivates:!0},t),o={firstTabbableNode:null,lastTabbableNode:null,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},s={activate:function(e){if(o.active)return;v(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=n.activeElement;var t=e&&e.onActivate?e.onActivate:i.onActivate;t&&t();return u(),s},deactivate:a,pause:function(){if(o.paused||!o.active)return;o.paused=!0,c()},unpause:function(){if(!o.paused||!o.active)return;o.paused=!1,v(),u()}};return s;function a(e){if(o.active){clearTimeout(ka),c(),o.active=!1,o.paused=!1,Ea.deactivateTrap(s);var t=e&&void 0!==e.onDeactivate?e.onDeactivate:i.onDeactivate;return t&&t(),(e&&void 0!==e.returnFocus?e.returnFocus:i.returnFocusOnDeactivate)&&Aa(function(){_(o.nodeFocusedBeforeActivation)}),s}}function u(){if(o.active)return Ea.activateTrap(s),ka=Aa(function(){_(d())}),n.addEventListener("focusin",f,!0),n.addEventListener("mousedown",h,{capture:!0,passive:!1}),n.addEventListener("touchstart",h,{capture:!0,passive:!1}),n.addEventListener("click",g,{capture:!0,passive:!1}),n.addEventListener("keydown",p,{capture:!0,passive:!1}),s}function c(){if(o.active)return n.removeEventListener("focusin",f,!0),n.removeEventListener("mousedown",h,!0),n.removeEventListener("touchstart",h,!0),n.removeEventListener("click",g,!0),n.removeEventListener("keydown",p,!0),s}function l(e){var t=i[e],r=t;if(!t)return null;if("string"==typeof t&&!(r=n.querySelector(t)))throw new Error("`"+e+"` refers to no known node");if("function"==typeof t&&!(r=t()))throw new Error("`"+e+"` did not return a node");return r}function d(){var e;if(!(e=null!==l("initialFocus")?l("initialFocus"):r.contains(n.activeElement)?n.activeElement:o.firstTabbableNode||l("fallbackFocus")))throw new Error("You can't have a focus-trap without at least one focusable element");return e}function h(e){r.contains(e.target)||(i.clickOutsideDeactivates?a({returnFocus:!ba.isFocusable(e.target)}):e.preventDefault())}function f(e){r.contains(e.target)||e.target instanceof Document||(e.stopImmediatePropagation(),_(o.mostRecentlyFocusedNode||d()))}function p(e){if(!1!==i.escapeDeactivates&&function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e))return e.preventDefault(),void a();!function(e){return"Tab"===e.key||9===e.keyCode}(e)||function(e){if(v(),e.shiftKey&&e.target===o.firstTabbableNode)return e.preventDefault(),_(o.lastTabbableNode);if(!e.shiftKey&&e.target===o.lastTabbableNode)e.preventDefault(),_(o.firstTabbableNode)}(e)}function g(e){i.clickOutsideDeactivates||r.contains(e.target)||(e.preventDefault(),e.stopImmediatePropagation())}function v(){var e=ba(r);o.firstTabbableNode=e[0]||d(),o.lastTabbableNode=e[e.length-1]||d()}function _(e){e!==n.activeElement&&(e&&e.focus?(e.focus(),function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(o.mostRecentlyFocusedNode=e)&&e.select()):_(d()))}},Ia={iframeWrapper:{width:"100%",maxWidth:"320px",minHeight:"243px",backgroundColor:"#fff",boxShadow:"0 0 10px rgba(0, 0, 0, .5)",borderRadius:"10px",position:"relative",overflow:"hidden"},popup:{position:"fixed",top:"0px",left:"0px",zIndex:2147483640,width:"100%",height:"100%",backgroundColor:"rgba(50, 57, 69, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",overflowY:"auto"},iframe:{width:"100%",height:"100%",margin:"auto",borderRadius:"10px",border:"none",display:"block",backgroundColor:"#fff",position:"absolute"},title:{position:"absolute",top:"-100px",zIndex:"5",background:"#fff",fontSize:"13px",color:"#32465a",padding:".75em .75em .75em",marginTop:"0px",right:"0px",left:"0px",textAlign:"center",fontFamily:"sans-serif"}},Ma=function(e){console.debug(e)},Oa=function(e){console.log(e)},ja={authority:"",id:"",requestTimeout:6e4,modalTitle:"Your Xero session has expired",blurFilter:"blur(3px)",smallXUIBreakPoint:600,maxBlurrySiblings:100},Na=function(){function s(){var o=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};W(this,s),this._frame=void 0,this._popup=void 0,this._iframeWrapper=void 0,this._title=void 0,this._switchAccountButton=void 0,this._promise=void 0,this._getLocation=void 0,this._timer=void 0,this._reject=void 0,this._resolve=void 0,this._options=void 0,this._focusTrap=void 0,this._minModalHeight=void 0,this.handleEscapeKey=function(e){-1<["Esc","Escape"].indexOf(e.key)&&console.error("The timedout modal dialog cannot be closed")},this.handleTitleFocus=function(e){e.target.style.top="0px"},this.handleTitleBlur=function(e){e.target.style.top="-100px"},this.handleTimeout=function(){Ma("IFrameWindow.handleTimeout"),o.rejectError(new Error("frame_window_timedout"))},this.handlePostMessage=function(e){Ma("IFrameWindow.handlePostMessage");var t=e.origin===o._getLocation(),r=e.source===o._frame.contentWindow;if(o._timer)if(r){if(e.origin===o._options.authority){Ma("message from authority");try{var n=JSON.parse(e.data);if(!n.hasOwnProperty("type"))return void Ma("Payload does not contain 'type' property: ".concat(e.data));if("HEIGHT_CHANGE"===n.type)return void o.handleHeightChange(n)}catch(e){return void Ma("Error deserialising payload as JSON: ".concat(e.message))}}if(t){var i=e.data;"INVALID_SESSION"!==i?"VALID_SESSION"!==i?i?o.handleSuccess(i):o.rejectError("Invalid response from frame"):o.handleValidSession():o.handleInvalidSession()}}else Ma("message not from child iframe, ignoring")},this._options=c(c({},ja),e),this._promise=new Promise(function(e,t){o._resolve=e,o._reject=t}),this._getLocation=e&&e.getLocation?e.getLocation:xa,window.addEventListener("message",this.handlePostMessage,!1),this._minModalHeight=parseInt(Ia.iframeWrapper.minHeight.replace("px",""),10);var t=Ca("iframe",{id:this._options.id,scrolling:"no",style:Ia.iframe});this._frame=t;var r=Ca("h1",{textContent:this._options.modalTitle,tabIndex:0,style:Ia.title});this._switchAccountButton=r;var n=Ca("h1",{textContent:this._options.modalTitle,tabIndex:0,id:"timedout-modal-message",style:Ia.title});this._title=n;var i=Ca("div",{role:"dialog","aria-labelledby":"timedout-modal-message","aria-modal":"true",tabIndex:0,style:Ia.iframeWrapper},Ra([n,this._frame,r]));this._iframeWrapper=i,this._popup=Ca("div",{id:"oidc-timedoutmodal-".concat(e.id),style:Ia.popup},Ra([i])),this._popup.dataset.timedoutModal=e.id,this._focusTrap=Pa(i,{escapeDeactivates:!1,initialFocus:'[aria-modal="true"]'}),window.addEventListener("keydown",this.handleEscapeKey),n.addEventListener("focus",this.handleTitleFocus),n.addEventListener("blur",this.handleTitleBlur),requestAnimationFrame(function(){o._popup&&(window.document.body.appendChild(o._popup),o._focusTrap.activate(),o.blurOtherVisibleElements())})}return d(s,[{key:"navigate",value:function(e){if(Ma("IFrameWindow.navigate"),e&&e.url){var t=this._options.requestTimeout;return this._timer=window.setTimeout(this.handleTimeout,t),this._frame.src=e.url,this._promise}this.rejectError("No url provided")}},{key:"handleSuccess",value:function(e){var t=this._resolve;this.dispose(),Ma("Successful response from frame window"),t(e)}},{key:"handleInvalidSession",value:function(){var e=this._reject;this.dispose(),Ma("Invalid session"),e(new Error("INVALID_SESSION"))}},{key:"handleValidSession",value:function(){var e=this._resolve;this.dispose(),Ma("Valid session"),e()}},{key:"rejectError",value:function(e){var t=this._reject;this.dispose(),Oa("string"==typeof e?e:e.message),t(e)}},{key:"getSiblings",value:function(e){for(var t=[],r=e.parentNode.firstElementChild,n=this._options.maxBlurrySiblings,i=0;r&&i<n;)r!==e&&t.push(r),r=r.nextElementSibling,i+=1;return t}},{key:"blurOtherVisibleElements",value:function(){if(!(document.body.getBoundingClientRect().width<this._options.smallXUIBreakPoint)){var t,r,e=this.getSiblings(this._popup);window.requestAnimationFrame((t=e,r=this._options.blurFilter,function(){for(var e=0;e<t.length;e+=1)t[e].style.filter=r}))}}},{key:"unblurOtherVisibleElements",value:function(){var t,e=this.getSiblings(this._popup);window.requestAnimationFrame((t=e,function(){for(var e=0;e<t.length;e+=1)t[e].style.filter=""}))}},{key:"dispose",value:function(){Ma("IFrameWindow._cleanup"),window.removeEventListener("keydown",this.handleEscapeKey),window.removeEventListener("message",this.handlePostMessage,!1),window.clearTimeout(this._timer),window.removeEventListener("keyup",this.handleEscapeKey),this._switchAccountButton&&(this._switchAccountButton=null),this._focusTrap&&(this._focusTrap.deactivate(),this._focusTrap=null),this._popup&&this._popup.parentNode&&(this.unblurOtherVisibleElements(),this._popup.parentNode.removeChild(this._popup)),this._title&&(this._title.addEventListener("focus",this.handleTitleFocus),this._title.addEventListener("blur",this.handleTitleBlur)),this._timer=null,this._frame=null,this._popup=null,this._resolve=null,this._reject=null,this._options=null}},{key:"handleHeightChange",value:function(e){var t=this;e.height>this._minModalHeight&&requestAnimationFrame(function(){t._iframeWrapper.style.height="".concat(e.height,"px")})}}]),s}(),La=function(e,t){return void 0===t?"undefined":t};function Fa(e){var t="",r="";if(e&&-1<e.indexOf("//")){var n=e.split("//");t=n[0].toString();n[1]&&(r=n[1].split("/")[0].toString())}return t.concat("//",r)}function qa(){var e=this;W(this,qa),this._initialTime=0,this._currentTime=0,this._frames=0,this._shouldContinue=!1,this.start=function(){e._initialTime=Date.now()},this.getDuration=function(){return e._currentTime=Date.now(),e._currentTime-e._initialTime}}function Ba(t){var s=this;if(W(this,Ba),this._options=void 0,this._userManager=void 0,this._browserActivityMonitor=void 0,this._ssoStatusChangeCallbacks=[],this._modalSignInCallbacks=[],this._loginRequired="login_required",this._errorHandlers=void 0,this._pageAge=void 0,this._xeroLytics=void 0,this._userLoadedCallbacks=[],this._userUnloadedCallbacks=[],this._defaults={shouldSignInAutomatically:!0,timedOutModalTimeoutIntervalMs:36e5,minSessionDurationForTimedoutModalMs:1e4},this._modalNavigator=void 0,this._localStorage=void 0,this.signInAutomatically=function(t){return s.getUserProfile(!0,!0).then(function(e){t&&t(e)})},this.signIn=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")||s.getCurrentLocation();return s._userManager.signinRedirect({state:{returnUrl:e},useReplaceToNavigate:!0})},this.signInPopup=function(){return Promise.reject("Not Implemented")},this.signOut=function(){return s._userManager.signoutRedirect()},this.returnUserProfile=function(e){return e?(s.debug("user anonymous locally, logged in at STS, now logged in locally"),e.profile):(s.debug("user anonymous locally, anonymous at STS"),null)},this.catchAndRedirectToLogin=function(e){return e.error===s._loginRequired?(s.debug("Getting UserProfile with automatic login: User session ended at STS, removing local user"),s._userManager.removeUser().then(function(){return s.signIn()})):s.clearState().then(function(){s.debug("error in silent renew",e),s.notifyErrorCallback(e)})},this.catchAndShowTimedoutModal=function(e){return e.error===s._loginRequired?s.handleUserSessionEnded():s.clearState().then(function(){throw s.debug("error in query session status",e),s.notifyErrorCallback(e),e})},this.handleSessionStatusQuery=function(e,t,r){return t&&t.sub===e.profile.sub?(s.debug("user signed in locally, and same user at STS"),e.profile):(s.debug("Removing existing user from store before comparison with STS"),s._userManager.removeUser().then(function(){if(r)return s._userManager.signinSilent().then(s.returnUserProfile)}))},this.getUserProfileWithAutomaticSignIn=function(){return s.getUserProfile(!1,!0)},this.getUserProfile=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return s._userManager.getUser().then(function(t){return t?e?s._userManager.querySessionStatus().then(function(e){return s.handleSessionStatusQuery(t,e,r)}).catch(s.catchAndShowTimedoutModal):(s.debug("user signed in locally, unknown status at STS"),t.profile):r?s._userManager.signinSilent().then(s.returnUserProfile).then(function(e){return e||s.signIn()}).catch(s.catchAndRedirectToLogin):(s.debug("user anonymous locally, unknown status at STS"),null)})},this.handleAccessTokenSilentRenewalSuccess=function(e,t,r){var n=e&&e.profile.sub,i="";e&&e.expired&&(i="user logged in locally, but access token is expired;"),r&&(i+="forcing silent renewal of access token;");var o=n&&t&&n!==t.profile.sub;return!t||o?(s.debug("Getting accessToken: new access token doesnât match the current user. Forcing logout."),s._userManager.removeUser().then(function(){return s.debug(i,"user at STS has changed. logging user out locally."),s.signOut().then(function(){return null})})):(s.debug(i,"new access token obtained"),s.clearTimedOutModal().then(function(){return t.access_token}))},this.handleAccessTokenSilentRenewalError=function(e){return e.error===s._loginRequired?s.handleUserSessionEnded().then(function(e){if(e)return e.access_token;throw new Error("No user present")}):s.clearState().then(function(){throw s.debug("error in silent renew",e),s.notifyErrorCallback(e),e})},this.getAccessTokenWithSilentRefresh=function(){return s.getAccessToken(!0)},this.getAccessToken=function(){var r=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return s._userManager.getUser().then(function(t){return t&&t.expired||r?s._userManager.signinSilent().then(function(e){return s.handleAccessTokenSilentRenewalSuccess(t,e,r)}).catch(s.handleAccessTokenSilentRenewalError):t&&t.access_token?(s.debug("user logged in locally with non-expired access token"),t.access_token):(s.debug("user anonymous locally"),null)})},this.registerSsoStatusChange=function(e){s._ssoStatusChangeCallbacks.push(e)},this.unregisterSsoStatusChange=function(e){var t=s._ssoStatusChangeCallbacks.indexOf(e);0<=t&&s._ssoStatusChangeCallbacks.splice(t,1)},this.renewAccessToken=function(){if(s._browserActivityMonitor.isUserActive){if(!s._modalNavigator)return s._userManager.signinSilent().then(function(e){return s.debug("renewed access token"),e}).catch(s.catchAndShowTimedoutModal);s.debug("Modal navigator is active, not renewing access token")}else s.debug("user not active; not renewing access token")},this.revokeAccessToken=function(){return s._userManager.revokeAccessToken().then(function(){s.debug("revoked access token")}).catch(function(e){throw s._xeroLytics.error("error revoking access token. ".concat(e.message)),e})},this.handleSignInModalResponse=function(e){return s._userManager.processSigninResponse(e).then(function(e){s.debug("signInModal: got signin response");var t=c(c({},e),{},{refresh_token:null}),r=new ia.User(t);return s._userManager.storeUser(r).then(function(){return s.debug("signInModal: user stored"),s.clearTimedOutModal().then(function(){return s._userManager.events.load(r),s.notifyModalSignInCallback(),r})})})},this.startSignInModalRequest=function(t){var e,r,n=s._options.iframeNavigator||new ca;s._modalNavigator=n;var i=new Na({authority:Fa(null===(e=s._userManager.settings)||void 0===e?void 0:null===(r=e.metadata)||void 0===r?void 0:r.authorization_endpoint),requestTimeout:s._options.timedOutModalTimeoutIntervalMs,id:t.state.id});return n.prepare(i).then(function(e){return e.navigate(t)})},this.handleSignInModalError=function(e){if("access_denied"===e.message)return s._xeroLytics.error("signInModal: error processing sign in response from iFrame. ".concat(e.message)),console.warn("Received access_denied from the OIDC server.\n The user is unable to proceed, so will be logged out."),s.signIn();if("frame_window_timedout"===e.message)return s.signOut().then(function(){return null});throw s.debug("signInModal: error attempting to get the user.",e.message),e},this.createSignInModalParameters=function(e,t){var r={display:"popup",prompt:"login",redirect_uri:s._options.modalRedirectUri,id_token_hint:""};return e&&t&&(r.id_token_hint=e.id_token),r},this.signInModalInternal=function(t){return Promise.resolve().then(function(){var e=s.createSignInModalParameters(t,!0);return s._userManager.createSigninRequest(e).then(s.startSignInModalRequest).then(s.handleSignInModalResponse)}).catch(s.handleSignInModalError)},this.signInModal=function(){return s._userManager.getUser().then(function(e){return s.signInModalInternal(e)}).catch(s.handleSignInModalError)},this.clearState=function(){return s._userManager.clearStaleState(s._localStorage)},this.clearTimedOutModal=function(){return s.clearState().then(function(){s._modalNavigator&&(s.debug("clearTimedOutModal: clearing existing modal"),s._modalNavigator.dispose(),s._modalNavigator=null)})},this.handleUserSessionEnded=function(){if(s._pageAge.getDuration()<s._options.minSessionDurationForTimedoutModalMs){var e=Math.floor(s._options.minSessionDurationForTimedoutModalMs/1e3);return s.debug("User session has ended, and user has been on page for < ".concat(e," sec. Redirecting to STS")),s.signOut(),Promise.reject("Session ended, signing out")}return s._userManager.getUser().then(function(e){return s._userManager.removeUser().then(function(){return e&&e.id_token&&Ba.sessionExpiredWithinHours(e,8)?s._modalNavigator?void s.debug("handleUserSessionEnded: TimedOutModal already visible"):s.signInModalInternal(e):s.signIn()})})},this.notifyErrorCallback=function(t){s._errorHandlers.forEach(function(e){return e(t)})},this.registerErrorCallback=function(e){s._errorHandlers.push(e)},this.unregisterErrorCallback=function(e){var t=s._errorHandlers.indexOf(e);-1<t&&s._errorHandlers.splice(t,1)},this.notifyModalSignInCallback=function(){s._modalSignInCallbacks.forEach(function(e){return e()})},this.registerModalSignInCallback=function(e){s._modalSignInCallbacks.push(e)},this.unregisterModalSignInCallback=function(e){var t=s._modalSignInCallbacks.indexOf(e);-1<t&&s._modalSignInCallbacks.splice(t,1)},this.userSsoStatusChange=function(){return s.debug("detected user signed out at STS"),s._ssoStatusChangeCallbacks.forEach(function(e){e()}),s.handleUserSessionEnded()},this.notifyUserLoadedCallback=function(t){s._userLoadedCallbacks.forEach(function(e){return e(t)})},this.registerUserLoadedCallback=function(e){s._userLoadedCallbacks.push(e)},this.unregisterUserLoadedCallback=function(e){var t=s._userLoadedCallbacks.indexOf(e);-1<t&&s._userLoadedCallbacks.splice(t,1)},this.notifyUserUnloadedCallback=function(){s._userUnloadedCallbacks.forEach(function(e){return e()})},this.registerUserUnloadedCallback=function(e){s._userUnloadedCallbacks.push(e)},this.unregisterUserUnloadedCallback=function(e){var t=s._userUnloadedCallbacks.indexOf(e);-1<t&&s._userUnloadedCallbacks.splice(t,1)},this.debug=function(){if(s._options.enableLogging){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,["AuthenticationService"].concat(r))}},this.getCurrentLocation=function(){var e=window.location,t=e.pathname,r=e.search,n=e.hash;return"".concat(t).concat(r).concat(n)},this.getClientId=function(){return s._options.clientId},!t)throw new Error("options is required");return this._options=c(c({},this._defaults),t),this._xeroLytics=new Ua(t.clientId),this._localStorage=new ia.WebStorageStateStore({store:window.localStorage}),this._userManager=t.userManager||aa.getUserManagerForAuthentication(t),this._userManager.events.addAccessTokenExpiring(this.renewAccessToken.bind(this)),this._userManager.events.addAccessTokenExpired(this.renewAccessToken.bind(this)),this._userManager.events.addUserSignedOut(this.userSsoStatusChange.bind(this)),this._userManager.events.addUserLoaded(this.notifyUserLoadedCallback.bind(this)),this._userManager.events.addUserUnloaded(this.notifyUserUnloadedCallback.bind(this)),this._browserActivityMonitor=new So(t),this._browserActivityMonitor.events.addUserReturned(this.renewAccessToken.bind(this)),this._browserActivityMonitor.start(),this._errorHandlers=[],this.signInAutomatically=this.signInAutomatically.bind(this),this._options.shouldSignInAutomatically&&setTimeout(function(){s.signInAutomatically(t.signInAutomaticallyCallback).catch(function(e){t.signInAutomaticallyFailureCallback?t.signInAutomaticallyFailureCallback(e):console.error(e)})},0),this._pageAge=this._options.timer||new qa,this._pageAge.start(),this}Ba.sessionExpiredWithinHours=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.expires_at)return!1;var n=r||new Date;n.setHours(n.getHours()-t);var i=Math.floor(n.getTime()/1e3);return e.expires_at>i};function Da(){var d=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:window.sessionStorage,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:console;W(this,Da),this._storage=void 0,this._logger=void 0,this.findSessionStorageKey=function(e){for(var t,r=0;r<d._storage.length;r+=1){var n=d._storage.key(r);0===n.indexOf(e)&&(t=n)}return t},this.log=function(e){d._logger.log(Da.formatMessage(e))},this.warn=function(e){d._logger.warn(Da.formatMessage(e))},this.error=function(e){d._logger.error(Da.formatMessage(e))},this.signOut=function(e){var t=Da.parseQueryString(e),r=t.iss,n=t.sid;if(!r)throw new Error("No issuer provided in queryString. Unable to sign out");if(!n)throw new Error("No sid provided in queryString. Unable to sign out");var i="oidc.user:".concat(r),o=d.findSessionStorageKey(i);if(!o){var s="Attempted to remove session for issuer ".concat(r," but no issuer was present");return d.error(s),Promise.reject(s)}var a={};try{a=JSON.parse(d._storage.getItem(o))}catch(e){return d.error(e),Promise.reject(e)}if(!a.profile){var u="No profile found in session";return d.error(u),Promise.reject(u)}if(!a.profile.sid){var c="No sid found in the profile";return d.error(c),Promise.reject(c)}if(a.profile.sid===n)return d._storage.removeItem(o),d.log("Successfully cleared session for ".concat(r)),Promise.resolve();var l="Expected SID of ".concat(n," but found SID ").concat(a.profile.sid);return d.error(l),Promise.reject(l)},this._storage=e,this._logger=t}Da.parseQueryString=function(e){return e.replace(/^\?/,"").split("&").reduce(function(e,t){if(-1<t.indexOf("=")){var r=f(t.split("="),2),n=r[0],i=r[1];e[n]=decodeURIComponent(i)}return e},{})},Da.formatMessage=function(e){return"[oidc:".concat(window.location.host,"] ").concat(e)};function Wa(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)}function Ha(e){var i=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(W(this,Ha),this._options=void 0,this._xeroLytics=void 0,this._authService=void 0,this._userLoaded=!1,this._userLoadedPromiseResolves=[],this._userLoadedPromiseRejects=[],this.waitForUserToBeLoaded=function(){return i._userLoaded?Promise.resolve():i.withTimeout(i._createUserLoadedPromise(),i._options.timeout)},this.setUserLoaded=function(e){i._userLoaded=!!e,e?i._userLoadedPromiseResolves.forEach(function(e){return e()}):i._userLoadedPromiseRejects.forEach(function(e){return e("User has been unloaded")})},this._createUserLoadedPromise=function(){var r,n;return new Promise(function(e,t){r=e,n=t,i._userLoadedPromiseResolves.push(r),i._userLoadedPromiseRejects.push(n)}).finally(function(){Wa(i._userLoadedPromiseResolves,r),Wa(i._userLoadedPromiseRejects,n)})},this.createTimeoutPromise=function(n){return new Promise(function(e,t){var r="Waited for more than ".concat(n,"ms for user to be loaded.");setTimeout(function(){t(r)},n)}).then(function(){return null})},this.withTimeout=function(e,t){return Promise.race([e,i.createTimeoutPromise(t)])},!e)throw new Error("AuthenticationService cannot be null");this._options=c(c({},za),t),this._xeroLytics=new Ua(e.getClientId()),this._authService=e,this._authService.registerUserLoadedCallback(this.setUserLoaded.bind(this)),this._authService.registerUserUnloadedCallback(this.setUserLoaded.bind(this)),this._authService.getAccessToken().then(function(e){e&&(i._userLoaded=!0,i._userLoadedPromiseResolves.forEach(function(e){return e()}))})}function Va(e){var u=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Qa;W(this,Va),this._xeroLytics=void 0,this._sessionMonitor=void 0,this._authService=void 0,this._options=void 0,this.createTimeoutPromise=function(e,n){return new Promise(function(e,t){var r=new Xa("Request took longer than timeout of ".concat(n,"ms."));r.timeout=n,setTimeout(function(){t(r)},n)}).then(function(){return null})},this.withTimeout=function(r,n){return function(e,t){return Promise.race([r(e,t),u.createTimeoutPromise(e,n)])}},this.addAuthorizationHeader=function(e,t){return e.headers.set("Authorization","Bearer ".concat(t)),e},this.getBackoffStrategy=function(){return D(u._options.backoff)?function(e,t){var r="function"==typeof u._options.backoff?u._options.backoff(e):Va.defaultBackoffPolicy(e,u._options.backoff||0);return new Promise(function(e){return setTimeout(e,r)}).then(t)}:function(e,t){return t()}},this.fetchWithRetry=function(i,o,s,e){var t=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},r=c(c({},u._options),t),a=r.timeout?u.withTimeout(r.fetcher,r.timeout):r.fetcher;return u._authService.getAccessToken(e).then(function(e){var t,r=u.getBackoffStrategy();if(e&&(t=u.addAuthorizationHeader(o,e)),!e&&s>=u._options.retries)return Promise.reject("No token present, unable to make request");if(s>u._options.retries)return Promise.reject("Number of retries exceeded.");var n=s+1;return a(i,t).then(function(e){return 401===e.status&&s<u._options.retries?(u._xeroLytics.error("Received status code ".concat(e.status," when sending request to ").concat(i)),r(s,function(){return u.fetchWithRetry(i,o,n,!0)})):e}).catch(function(e){if("string"==typeof e)throw new Error(e);if("timeout"in e&&(u._xeroLytics.error("Request to ".concat(i," timed out")),n<=u._options.retries))return r(s,function(){return u.fetchWithRetry(i,o,n,!0)});throw e})})},this.request=function(t,e,r){var n=e||{};return n.headers=new Headers(n.headers||{}),Object.keys(u._options.defaultHeaders).forEach(function(e){var t=u._options.defaultHeaders[e];n.headers.set(e,"function"==typeof t?t():t)}),(null==r?void 0:r.waitForAccessToken)?u._sessionMonitor.waitForUserToBeLoaded().then(function(e){return u.fetchWithRetry(t,n,0,!1,r)}).catch(function(e){throw u._xeroLytics.error(e),e}):u.fetchWithRetry(t,n,0,!1,r)},this._options=c(c(c({},Qa),t),{},{defaultHeaders:c(c({},Qa.defaultHeaders),t.defaultHeaders)}),this._authService=e,this._xeroLytics=new Ua(this._authService.getClientId()),this._sessionMonitor=new Ha(this._authService,{timeout:this._options.timeout})}var Ja=ia.UserManager,Ka=function(){function e(){W(this,e)}return d(e,null,[{key:"redirectCallback",value:function(n){return new Ja({monitorSession:!1,response_type:"code"}).signinRedirectCallback().then(function(e){var t=e&&e.state&&e.state.returnUrl||n,r=window.location.origin+window.location.pathname;window.history.replaceState({},window.document.title,t||r),window.location.href=t}).catch(function(e){!function(e){console.error(e)}(e),function(e){var t=document.createDocumentFragment(),r=document.createElement("link");r.rel="stylesheet",r.href="https://edge.xero.com/style/xui/15.2.2/xui.css";var n=document.createElement("div");n.className="xui-u-flex xui-u-flex-column",n.style.height="100%";var i=document.createElement("div");i.className="xui-padding-large xui-page-width-standard xui-text-align-center xui-u-flex-1",i.style.paddingTop="12vh";var o=document.createElement("img");o.src="https://edge.xero.com/images/1.0.0/logo/xero-logo.svg",o.alt="The word âXeroâ contained in a blue a circle",o.style.width="60px",o.style.height="60px",o.style.marginTop="30px";var s=document.createElement("h3");s.textContent="Sorry, something went wrong";var a=document.createElement("p");a.textContent="".concat(e.message),a.className="xui-text-secondary";var u=document.createElement("p");u.className="xui-padding-top";var c=document.createElement("a");c.className="xui-button xui-button-standard xui-button-medium",u.appendChild(c),c.href="/",c.textContent="Go back to the application",i.appendChild(o),i.appendChild(s),i.appendChild(a),i.appendChild(u);var l=document.createElement("div");l.className="xui-padding-2xlarge xui-text-align-center";var d=document.createElement("a");d.className="xui-text-decoration-none xui-text-secondary xui-padding-horizontal-small",d.href="https://help.xero.com",d.textContent="Help Center";var h=document.createElement("a");h.className="xui-text-decoration-none xui-text-secondary xui-padding-horizontal-small",h.href="https://status.xero.com/",h.textContent="Status Page",l.appendChild(h),l.appendChild(d),n.appendChild(i),n.appendChild(l),t.appendChild(n),n.style.display="none",r.addEventListener("load",function(){n.style.display=""}),document.head.appendChild(r),document.documentElement.classList.add("xui-html"),document.body.classList.add("xui-body"),document.body.classList.add("xui-background-white"),document.body.appendChild(t),document.body.style.height="100%",document.body.style.minHeight="100%"}(function(e){return e.message.match(/No state in response/)?{id:"ERROR_NO_STATE",message:"There was no session state found. Please try again."}:{id:"ERROR_UNKNOWN",message:"There was an internal error. Please try again."}}(e))})}},{key:"silentCallback",value:function(){return new Ja({monitorSession:!1}).signinSilentCallback()}},{key:"modalCallback",value:function(e){var t=e||window.location.href,r="".concat(window.location.protocol,"//").concat(window.location.host);return t?(window.parent.postMessage(t,r),Promise.resolve()):Promise.reject("url not present in callback")}},{key:"signOutCallback",value:function(){return(new Da).signOut(window.location.search)}}]),e}(),za={timeout:1e4},Qa={retries:1,backoff:200,timeout:1e4,fetcher:window.fetch,waitForAccessToken:!1,defaultHeaders:{"Xero-Correlation-Id":function(){return Ps()},"X-Client":"xero-secure-fetch"}},Xa=function(){e(o,l(Error));var i=g(o);function o(){var e;W(this,o);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=i.call.apply(i,[this].concat(r))).timeout=void 0,e}return o}();Va.defaultBackoffPolicy=function(e,t){return Math.pow(2,e)*t};var Ga=document.getElementById("identity-script");if(Ga&&Ga.dataset&&Ga.dataset.action)switch(Ga.dataset.action){case"callback":Ka.redirectCallback();break;case"modal":Ka.modalCallback();break;case"silent":Ka.silentCallback();break;case"signout":Ka.signOutCallback();break;case"valid-session":Ka.modalCallback();break;default:console.warn("data-action must be one of silent|modal|callback")}window.XeroIdentity={SsoSessionService:function e(t){var s=this;if(W(this,e),this._options=void 0,this._userManager=void 0,this._keepAliveService=void 0,this._browserActivityMonitor=void 0,this._keepSsoSessionAlive=!1,this._modalNavigator=void 0,this._xeroLytics=void 0,this._ssoStatusChangeCallbacks=[],this._getSessionTimeOut=void 0,this._userLoadedCallbacks=[],this._userUnloadedCallbacks=[],this.restartKeepAlive=function(){s.debug("Restarting KeepAliveService"),s._keepAliveService.startKeepAlive()},this.startKeepSsoSessionAlive=function(){s._keepSsoSessionAlive||(s._keepSsoSessionAlive=!0,!s._options.initViaLoader||s._options.trustUserSignedOut?s._userManager.getUser().then(function(e){e||s.pingSsoServer()}).catch(function(e){s.debug("error when loading user from session storage"),s._xeroLytics.error("Error loading user from session store. ".concat(e.message))}):s.pingSsoServer())},this.getAccessToken=function(){return s._userManager.getUser().then(function(e){return e&&e.access_token&&!e.expired?(s.debug("user logged in locally with non-expired access token"),e.access_token):(s.debug("user anonymous locally"),null)})},this.stopKeepSsoSessionAlive=function(){s._keepSsoSessionAlive=!1},this.keepSsoSessionAlive=function(){s._keepSsoSessionAlive&&s._browserActivityMonitor.isUserActive?s.pingSsoServer():s._keepSsoSessionAlive&&s.debug("user not active; not keeping sso session alive")},this.userSsoStatusChange=function(){s.debug("detected user signed out at STS"),s.stopKeepSsoSessionAlive(),s.delay(s._getSessionTimeOut).then(s.getSessionState).then(s.handleSessionState).catch(function(e){s._xeroLytics.error("Error getting session state from the /auth endpoint. ".concat(e.message)),s._userManager.signinRedirect({useReplaceToNavigate:!0})}),s._ssoStatusChangeCallbacks.forEach(function(e){e()})},this.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},this.handleSessionState=function(e){e.json().then(function(e){e.showModal?s.startSignInModalRequest(e.challengeUrl):e.showModal||(s.debug("Invalid session response. Redirecting to login page"),window.location.assign(e.challengeUrl))})},this.getSessionState=function(){return fetch("/auth",{method:"GET",cache:"no-cache"}).then(function(e){return e.ok?(s.debug("Request /auth responded with 2xx status"),Promise.resolve(e)):(s.debug("Session valid response was not 2xx"),Promise.reject(e))})},this.pingSsoServer=function(){s._userManager.signinSilent().then(function(e){return s.debug("keeping sso session alive"),e}).catch(function(e){throw s.debug("error keeping sso session alive",e.message),e.message.toLowerCase().includes("Network Error".toLowerCase())||s._xeroLytics.error("error keeping sso session alive. ".concat(e.message)),e})},this.registerSsoStatusChange=function(e){s._ssoStatusChangeCallbacks.push(e)},this.unregisterSsoStatusChange=function(e){var t=s._ssoStatusChangeCallbacks.indexOf(e);0<=t&&s._ssoStatusChangeCallbacks.splice(t,1)},this.startSignInModalRequest=function(e){var t,r,n={url:null==e||null==e?"/auth":e,state:null};s._userManager.removeUser();var i=new ca;s._modalNavigator=i;var o=new Na({authority:Fa(null===(t=s._userManager.settings)||void 0===t?void 0:null===(r=t.metadata)||void 0===r?void 0:r.authorization_endpoint),requestTimeout:36e5,id:"ssoSessionModal"});return i.prepare(o).then(function(e){return e.navigate(n)}).then(s.clearTimedOutModal).then(s.startKeepSsoSessionAlive).catch(function(e){if("frame_window_timedout"===e.message)return s.debug("Modal has been open for too long. Redirecting to login"),void s.getSessionState().then(s.handleSessionState).catch(function(e){s._xeroLytics.error("Error getting session state from the /auth endpoint after modal timeout. ".concat(e.message))});s.debug("unexpected error from timedout modal",e)})},this.clearTimedOutModal=function(){return s.debug("Clearing timed out modal"),s._userManager.clearStaleState().then(function(){s._modalNavigator&&(s.debug("clearTimedOutModal: clearing existing modal"),s._modalNavigator.dispose(),s._modalNavigator=null)})},this.debug=function(){if(s._options.enableLogging){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,["SsoSessionService"].concat(r))}},this.getClientId=function(){return s._options.clientId},this.notifyUserLoadedCallback=function(t){s._userLoadedCallbacks.forEach(function(e){return e(t)})},this.registerUserLoadedCallback=function(e){s._userLoadedCallbacks.push(e)},this.unregisterUserLoadedCallback=function(e){var t=s._userLoadedCallbacks.indexOf(e);-1<t&&s._userLoadedCallbacks.splice(t,1)},this.notifyUserUnloadedCallback=function(){s._userUnloadedCallbacks.forEach(function(e){return e()})},this.registerUserUnloadedCallback=function(e){s._userUnloadedCallbacks.push(e)},this.unregisterUserUnloadedCallback=function(e){var t=s._userUnloadedCallbacks.indexOf(e);-1<t&&s._userUnloadedCallbacks.splice(t,1)},!t)throw new Error("options is required");this._options=t,this._getSessionTimeOut=2e3,this._xeroLytics=new Ua(t.clientId),this._userManager=this._options.userManager||aa.getUserManagerForSessionKeepAlive(t),this._userManager.events.addAccessTokenExpiring(this.keepSsoSessionAlive.bind(this)),this._userManager.events.addAccessTokenExpired(this.keepSsoSessionAlive.bind(this)),this._userManager.events.addUserSignedOut(this.userSsoStatusChange.bind(this)),this._userManager.events.addUserLoaded(this.notifyUserLoadedCallback.bind(this)),this._userManager.events.addUserUnloaded(this.notifyUserUnloadedCallback.bind(this)),this._browserActivityMonitor=new So(t),this._browserActivityMonitor.events.addUserReturned(this.keepSsoSessionAlive.bind(this)),this._browserActivityMonitor.start();var r={browserActivityMonitor:this._browserActivityMonitor,enableLogging:this._options.enableLogging,keepAliveEndpoint:this._options.keepAliveEndpoint};this._keepAliveService=this._options.keepAliveService||new ua(r),this._keepAliveService.registerFailedCallback(function(e){s.debug("Keep alive service has failed.")}),this._userManager.events.addUserLoaded(this.restartKeepAlive.bind(this)),this._keepAliveService.startKeepAlive(),this.startKeepSsoSessionAlive()},SsoCallback:Ka,AuthenticationService:Ba,SecureFetch:Va}}();
