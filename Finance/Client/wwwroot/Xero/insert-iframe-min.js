!function(){function e(){var e=4===T.readyState&&200===T.status&&T.response;if(e){var t=JSON.parse(T.responseText);N.ajaxComplete=!0,N.showTout=t.show,a()}}function t(){var e="foo";try{return C.setItem(e,"bar"),C.removeItem(e),!0}catch(t){return!1}}function n(e,t){var n=new RegExp(e,"i"),a=window.location.pathname,o=a.split("/").filter(Boolean)[0],i=t?o:a;return n.test(i)}function a(){var e=N.searchRendered&&N.ajaxComplete,t=E&&N.showTout,n=C.getItem("enableGsTout"),a=N.userContextRequestComplete&&!N.demoOrg,o=N.correctPage&&e&&t&&"false"!==n&&a;if(o){N.storageEnabled&&C.setItem("enableGsTout",!0);var i=f({elementName:"div",attributes:[{name:"id",value:"GlobalSearchTout"},{name:"style",value:M+" z-index: 1; background: #fff; border: 1px solid #d0dae2; border-radius: 3px; box-shadow: 0px 5px 10px 0px rgba(0,0,0,0.05), 0px 2px 1px 0px rgba(0,0,0,0.03); color: #fff; cursor: default; font-size: 13px; font-weight: normal; line-height: 24px; padding: 20px; position: absolute; text-shadow: none; width: 270px; -webkit-font-smoothing: auto;"}]}),r=f({elementName:"div",attributes:[{name:"style",value:"background: #fff; border-top: 1px solid #d0dae2; border-left: 1px solid #d0dae2; height: 6px; position: absolute; right: 18px; top: -5px; transform: rotate(45deg); width: 6px;"}]}),d=f({elementName:"p",attributes:[{name:"style",value:'color: #32465a; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: bold; margin-bottom: 0.5em; margin-top: 0;'}],innerHTML:"Search for anything"}),l=f({elementName:"p",attributes:[{name:"style",value:'color: #8296aa; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; margin-bottom: 1em;'}],innerHTML:"Introducing search, a new way to quickly find what you&#39;re looking for in Xero."}),s=f({elementName:"a",attributes:[{name:"href",value:"javascript:void(0);"},{name:"class",value:"try-out"},{name:"style",value:'background-color: #2baaed; border: 1px solid #fff; border-radius: 3px; box-sizing: border-box; color: #fff; float: right; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: bold; line-height: 16px; min-width: 60px; padding: 8px 16px; text-align: center; text-decoration: none;'}],innerHTML:"Try it out"}),u=f({elementName:"a",attributes:[{name:"href",value:"javascript:void(0);"},{name:"class",value:"dismiss"},{name:"style",value:'color: #8296aa; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 18px; font-weight: 100; line-height: 18px; margin: 8px; position: absolute; right: 6px; text-align: center; text-decoration: none; top: 13px; width: 18px'}],innerHTML:"&times;"});s.addEventListener("mouseup",m),u.addEventListener("mouseup",c);for(var p=[r,d,l,s,u],g=0;g<p.length;g++)i.appendChild(p[g]);H.appendChild(i)}}function o(){if(N.searchRendered&&N.demoOrg){var e,t=N.usOrg?"Center":"Centre",n="DemoOrgNotification",a="Search for anything in Xero",o='Watch the video to see how it works or learn more in the <a href="https://help.xero.com/int/XeroSearch" style="color: #2baaed;" class="js-link" target="_blank">Help '+t+"</a>.",r="Search is not available to demo organizations.",d=k.iframe,l=d.parentNode;l&&l.removeChild(d);var s=f({elementName:"img",attributes:[{name:"id",value:"demo-video-image"},{name:"src",value:k.baseUrl+"/images/demo-video.png"},{name:"style",value:"border-radius: 2px; cursor: pointer; display: block; margin: 0 auto 2em auto;"}]}),m=f({elementName:"p",attributes:[{name:"style",value:"color: #9FACBA; text-align: center;"}],innerHTML:r});e=[s,m],u(n,a,o,e,!1),i()}}function i(){var e=720,t=405,n=f({elementName:"div",attributes:[{name:"id",value:"demo-video-modal"},{name:"style",value:"align-items: center; background: rgba(40, 70, 100, 0.7); display: none; height: 0; justify-content: center; position: absolute; top: 0; width: 100%; z-index: 2147483647;"}]}),a=f({elementName:"div",attributes:[{name:"id",value:"demo-video-container"},{name:"style",value:"display: block; margin: 0 auto; position: relative; top: 0; width: "+e+"px;"}]}),o=f({elementName:"button",attributes:[{name:"type",value:"button"},{name:"title",value:"close"},{name:"aria-label",value:"close"},{name:"style",value:"background: none; border: none; color: white; cursor: pointer; float: right; font-size: 18px; margin-bottom: 10px; padding: 0; outline: none;"}],innerHTML:"âœ•"}),i=f({elementName:"iframe",attributes:[{name:"id",value:"demo-video"},{name:"src",value:"https://player.vimeo.com/video/143796209?api=1"},{name:"width",value:e},{name:"height",value:t},{name:"frameborder",value:"0"},{name:"webkitallowfullscreen",value:""},{name:"mozallowfullscreen",value:""},{name:"allowfullscreen",value:""}]});n.appendChild(a),a.appendChild(o),a.appendChild(i),document.body.appendChild(n)}function r(){var e=document.getElementById("demo-video-modal"),t=document.getElementById("demo-video-container"),n=document.getElementById("demo-video"),a="none"===e.style.display,o=window.innerHeight,i=document.body.clientHeight,l=o>i?o:i,s=n.getAttribute("height"),u=o/2,m=s/2,c=22;a?(k.toggle(),e.style.height=l+"px",t.style.top=Math.round(u-m-c)+"px",e.style.display="block",e.addEventListener("click",r),window.addEventListener("keydown",d),window.analytics&&window.analytics.track("XS: Demo Org Video Played")):(e.style.display="none",e.removeEventListener("click",r),window.removeEventListener("keydown",d),n.contentWindow.postMessage({method:"unload",value:"void"},"*"),n.contentWindow.postMessage({method:"pause",value:"void"},"*"))}function d(e){e.keyCode&&27===e.keyCode&&r()}function l(){var e=H.parentNode,t=document.getElementById("DemoOrgNotification"),n=t.style.display,a=document.getElementById("demo-video-image"),o=t.querySelector(".js-link");"none"===n?(t.style.display="block",a.addEventListener("click",r),o.addEventListener("click",s),window.analytics&&window.analytics.track("XS: Demo Org Clicked Search Icon")):(t.style.display="none",a.removeEventListener("click",r),o.removeEventListener("click",s),e&&e.blur()),k.isDemoOrgNotificationHidden=!k.isDemoOrgNotificationHidden}function s(){window.analytics&&window.analytics.track("XS: Demo Org Help Centre Link Clicked")}function u(e,t,n,a,o){var i,r=f({elementName:"div",attributes:[{name:"id",value:e},{name:"style",value:M+" z-index: 1; background: #fff; border: 1px solid #d0dae2; border-radius: 3px; box-shadow: 0px 5px 10px 0px rgba(0,0,0,0.05), 0px 2px 1px 0px rgba(0,0,0,0.03); color: #fff; cursor: default; display: none; font-size: 13px; font-weight: normal; line-height: 24px; padding: 20px; position: absolute; text-shadow: none; width: 270px; -webkit-font-smoothing: auto;"}]});o&&(r.style.display="block");var d=f({elementName:"div",attributes:[{name:"style",value:"background: #fff; border-top: 1px solid #d0dae2; border-left: 1px solid #d0dae2; height: 6px; position: absolute; right: 18px; top: -5px; transform: rotate(45deg); width: 6px;"}]}),l=f({elementName:"p",attributes:[{name:"style",value:'color: #32465a; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: bold; margin-bottom: 0.5em; margin-top: 0;'}],innerHTML:t}),s=f({elementName:"p",attributes:[{name:"style",value:'color: #8296aa; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; margin-bottom: 1em;'}],innerHTML:n});i=[d,l,s].concat(a);for(var u=0;u<i.length;u++)r.appendChild(i[u]);H&&H.appendChild(r)}function m(){p(),window.analytics&&window.analytics.track("XS: Notification Used"),k.toggle()}function c(){window.analytics&&window.analytics.track("XS: Notification Dismissed"),p()}function p(){var e=document.getElementById("GlobalSearchTout"),t=e.parentNode;g(),t&&t.removeChild(e)}function g(){N.storageEnabled&&C.setItem("enableGsTout",!1),T.open("POST",O),T.send()}function f(e){if(e){var t,n=e.elementName,a=e.attributes,o=e.innerHTML,i=0;if(t=document.createElement(n),a&&a.length>0)for(i=0;i<a.length;i++)t.setAttribute(a[i].name,a[i].value);return o&&(t.innerHTML=o),t}}function h(e){var t=e.style,n=S?A?"narrow":"wide":"legacy";t.right=R[n].right,t.top=R[n].top}function v(e){var t=f({elementName:"iframe",attributes:[{name:"id",value:"GlobalSearchApp"},{name:"frameBorder",value:"0"},{name:"scrolling",value:"no"},{name:"data-baseUrl",value:e},{name:"style",value:I}]});h(t);var n=f({elementName:"script",attributes:[{name:"src",value:k.baseUrl+"/js/main.js"}]}),a=f({elementName:"link",attributes:[{name:"rel",value:"stylesheet"},{name:"type",value:"text/css"},{name:"href",value:k.baseUrl+"/styles/styles.css"}]}),o=f({elementName:"div",attributes:[{name:"id",value:"main"},{name:"class",value:"container"}]}),i=f({elementName:"base",attributes:[{name:"target",value:"_parent"}]});H.appendChild(t);var r=t.contentWindow.document;return r.open(),r.write("<html><head></head><body></body></html>"),r.close(),r.head.appendChild(i),r.head.appendChild(a),r.body.appendChild(o),r.body.appendChild(n),t}function b(e){e.target===e.currentTarget&&(e.preventDefault(),k.toggle())}function y(e,t){var n=!t.contains(e.target),a=!(k.isHidden&&k.isDemoOrgNotificationHidden);n&&a&&k.toggle()}function w(e){return k.baseUrl=e.baseUrl,{render:function(){return H=document.createElement("a"),H.className="search",setTimeout(function(){k.setupIframe()},10),H}}}function x(e){return A="narrow"===e.displayMode,k.baseUrl=e.options.baseUrl,H=e.el,k.setupIframe(H),XERO.bus.on("header:displayModeChange:narrow",function(){A=!0,h(k.iframe)}),XERO.bus.on("header:displayModeChange:wide",function(){A=!1,h(k.iframe)}),{show:function(){k.isHidden&&k.toggle()},hide:function(){k.isHidden||k.toggle()},isActive:function(){return!k.isHidden}}}var H,k,E=!1,C=window.localStorage,N={searchRendered:!1,ajaxComplete:!1,showTout:!1,storageEnabled:t(),correctPage:n("Dashboard",!0),demoOrg:!1,usOrg:!1,iframeContentRendered:!1,userContextRequestComplete:!1},T=new XMLHttpRequest,L="/Ajax/GettingStarted/GetState?code=GETTINGSTARTED/GLOBALSEARCHTIP",O="/Ajax/GettingStarted/SaveState?code=GETTINGSTARTED/GLOBALSEARCHTIP&display=false",S=!!document.querySelector(".xrh-header"),A=!1,M=S?"right: -1px; top: 60px;":"right: 3px; top: 39px;";T.addEventListener("load",e),T.open("GET",L),T.send();var I="position:absolute;background-color:transparent;display:none;width:350px;height:63px;z-index:100",R={legacy:{right:"-5px",top:"29px"},narrow:{right:"47px",top:"40px"},wide:{right:"-10px",top:"40px"}},D=function(e){var t=document.activeElement,n=t.tagName.toLowerCase(),a=t.contentEditable&&"true"===t.contentEditable.toLowerCase(),o="input"===n||"textarea"===n||a;!o&&k.isHidden&&k.shortcuts.forEach(function(t){t.keyCode===e.keyCode&&(e.preventDefault(),k.toggle())})},G=function(e){k.handleMessage(e.data)},X=function(){var e=/^https:\/\/.*\.xero(-test)?\.com$/;S||(H.addEventListener("mouseup",function(e){e.stopPropagation(),b(e)}),document.addEventListener("mousedown",function(e){y(e,H)})),window.addEventListener("keydown",function(e){D(e)}),window.addEventListener("message",function(t){e.test(t.origin)&&G(t)},!1)};k={isHidden:!0,iframe:null,baseUrl:null,minHeight:43,shortcuts:[{keyCode:191}],isDemoOrgNotificationHidden:!0,messageActions:{returnFocus:function(){this.isHidden||this.toggle()},pageRedirect:function(e){window.location.href=e}},sendMessage:function(e){this.iframe.contentWindow.postMessage(e,"*")},handleMessage:function(e){if("string"==typeof e){var t=e.split(":::");if("globalsearch_postmessage"===t[0]){var n=t[1],a=t[2],o=this.messageActions[n];o.call(this,a)}}},toggle:function(){var e=this,t=document.getElementById("GlobalSearchTout");return e.observer=new MutationObserver(e.handleMutations),N.demoOrg?(l(),void(e.isHidden=!e.isHidden)):(e.isHidden&&N.iframeContentRendered?(e.iframe.style.display="block",window.analytics&&window.analytics.track("XS: Opened"),e.observer.observe(e.iframe.contentDocument.getElementById("dropdown-panel"),{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})):(e.iframe.style.display="none",e.observer.disconnect(),S||(e.iframe.blur(),document.body.tabIndex=-1,document.body.focus())),e.sendMessage("iframe:toggle"),e.isHidden=!e.isHidden,void(E&&t&&p()))},handleMutations:function(){k.iframe.style.height=k.getAppHeight()},getAppHeight:function(){var e=k.iframe.contentDocument,t=e.getElementById("filter-list").clientHeight+e.querySelector(".input-container").clientHeight,n=e.getElementById("dropdown-panel").clientHeight,a=Math.max(t,n),o=20;return a=a||k.minHeight,a+o+"px"},setupIframe:function(){this.iframe=v(this.baseUrl),N.searchRendered=!0,a(),o(),X()}},XERO&&XERO.Header&&"function"==typeof XERO.Header.registerAddon&&XERO.Header.registerAddon(function(e){return S?x(e):w(e)}),window.addEventListener("message",function(e){var t=e.data;if("search"===t.source)switch(e.data.message){case"rendered":N.iframeContentRendered=!0;break;case"demoOrg":N.demoOrg=!0,a();break;default:N.userContextRequestComplete=!0,"CNTRY/US"===e.data.message&&(N.usOrg=!0),o(),a()}})}();