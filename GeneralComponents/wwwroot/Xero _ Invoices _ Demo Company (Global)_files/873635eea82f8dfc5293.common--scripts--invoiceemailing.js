!function(e){function t(l){if(n[l])return n[l].exports;var a=n[l]={i:l,l:!1,exports:{}};return e[l].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,l){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:l})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/assets/",t(t.s=294)}({294:function(e,t){window.InvoiceEmailing={},window.MAX_ATTACHMENT_SIZE=7340032,Object.extend(InvoiceEmailing,{emailWindow:null,noOfInvoicesToEmailDisplayText:" invoices to email",hasSetSendEmailsAsHtml:null,SendInvoiceWithHtmlOptIn:function(e,t){var n=InvoiceEmailing;null==n.hasSetSendEmailsAsHtml&&(n.hasSetSendEmailsAsHtml=t),!1!==n.hasSetSendEmailsAsHtml?n.SendInvoiceByEmail(e):new XERO.invoicing.emailing.HtmlEmailOptIn({invoiceId:e,listeners:{afterclose:function(t,l){n.hasSetSendEmailsAsHtml=!0,n.SendInvoiceByEmail(e)}}}).show()},SendInvoiceByEmail:function(e,t){var n=[];n.push(e),t||(t="Send Invoice"),InvoiceEmailing.emailWindow=XERO.MsgBox.createAjax("__emailWindow",{title:t,fromEl:"emailButton",width:470,modal:!0}),InvoiceEmailing.sentDocumentType=t.replace(/Send/gi,"").trim(),Ajax.ShowBulkEmailDialog(n.toJSON(),InvoiceEmailing.openEmailFormWindowGetHtmlCallBack)},SendByEmail:function(e,t,n,l){if(t||(t="Invoice"),null!=e&&0!=e.length){var a;a="string"==typeof e?[e]:Ext.Array.map(e,function(e){if(e.value)return e.value}),0===a.length&&(a=e),XERO.v2&&XERO.widget.Buttons&&setTimeout(function(){XERO.widget.Buttons.enable()},1e3);var i="Remittance Advice"==t||"Receipt"==t?500:1==a.length?460:580,o="repeating"!==t?"Send "+t:"Edit Message";a.length>1&&(o+="s"),InvoiceEmailing.sentDocumentType=t,InvoiceEmailing.emailWindow=XERO.MsgBox.createAjax("__emailWindow",{title:o,fromEl:"emailButton",width:i,modal:!0});var c="Remittance Advice"==t&&!l||"Receipt"==t?a[0]:a;return"Remittance Advice"!=t&&"Receipt"!=t||n?Ajax.ShowBulkEmailDialog(Object.toJSON(c),InvoiceEmailing.openEmailFormWindowGetHtmlCallBack):Ajax.ShowSingleEmailDialog(Object.toJSON(c),t,InvoiceEmailing.openEmailFormWindowGetHtmlCallBack),!0}},openEmailFormWindowGetHtmlCallBack:function(e){var t=e.value,n=t.Data.getValue("isRepeating");if(!t)return InvoiceEmailing.CanSend=!1,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!1,void InvoiceEmailing.emailWindow.destroy();InvoiceEmailing.emailWindow.setHtml(t.Result),InvoiceEmailing.emailWindow.center(),InvoiceEmailing.initButtons(),InvoiceEmailing.initPlaceholder(),InvoiceEmailing.initFileAttachments(),Ext.get("SendMeACopy").dom.checked=t.Data.getValue("SendMeACopy"),n&&Ext.get("popupSend").update("Save"),new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(100)},initFileAttachments:function(){var e=Ext.StoreMgr.get("attachedFilesStore"),t=e?e.query("send",!0).getRange():null;if(t)InvoiceEmailing.handleFilesLoad(e,t);else{var n=InvoiceEmailing.GetInvoices(),l=Ext.Array.map(n,function(e){return e.DocumentID});1==l.length?(e=new XERO.docs.FilesStore({proxy:new Ext.data.HttpProxy({method:"GET",prettyUrls:!1,url:"/docs/docs/getfilestosend"}),listeners:{load:Ext.createDelegate(InvoiceEmailing.handleFilesLoad,InvoiceEmailing)}}),e.load({params:{associatedWith:l[0]}})):Ext.Ajax.request({url:"/docs/docs/gethasfilestosend",method:"POST",params:{objectIds:l},callback:function(e,t,n){var l=Ext.decode(n.responseText);l.associations&&l.associations.length>0&&(maxTotalSize=Math.max.apply(null,Ext.Array.map(l.associations,function(e){return e.TotalSize})),maxTotalSize>MAX_ATTACHMENT_SIZE&&Ext.fly("includeFiles").addListener("click",function(){InvoiceEmailing.handleBulkEmailAttachmentLimit(l.associations)}),Ext.each(l.associations,function(e){if(e.FileCount&&e.FileCount>0){var t=e.FileCount>9?"9+":e.FileCount;Ext.fly("BulkSendInvoicesForm").select(Ext.String.format("td.attachment[data-id={0}], td.attachment[data-id={1}], td.attachment div.inner-attachment[data-id={0}], td.attachment div.inner-attachment[data-id={1}]",e.ObjectId.toLowerCase(),e.ObjectId.toUpperCase())).insertHtml("beforeEnd",Ext.String.format('<a href="javascript:" class="icons attachment" id="{0}"><span>{1}</span></a>',e.ObjectId,t))}}))}})}},handleFilesLoad:function(e,t){var n=Ext.get("BulkSendInvoicesForm");if(n&&(n.show(),(n=n.select("div.files-to-send").first())&&t.length>0)){var l=new Ext.XTemplate('<div class="field long">','<label style="padding-top:5px;">',"Included files","</label>",'<table width="340px">','<tpl for=".">','<tr data-index="{#}">','<td style="padding:5px;">',"<strong>{name}</strong>&nbsp;({prettyFileSize})","</td>",'<td align="right" style="width:50px;">','<a href="#" class="remove-attached-files">Remove</a>',"</td>","</tr>","</tpl>","</table>","</div>");Ext.Array.map(t,function(e){e.data.prettyFileSize=InvoiceEmailing.prettyFileSize(e.data.size)});l.overwrite(n,Ext.Array.map(t,function(e){return e.data}),!0).on("click",function(e,l){e.stopEvent();var a=Ext.fly(l).up("tr");if(a){var i=a.getAttribute("data-index"),o=t[i-1];XERO.docs.attachments.FileUploadButton.current&&XERO.docs.attachments.FileUploadButton.current()?XERO.docs.attachments.FileUploadButton.current().handleSendFile(null,o,!1):InvoiceEmailing.handleBulkSendFile(o,InvoiceEmailing.GetInvoices()[0].DocumentID),a.remove(),o.set("send",!1),0===Ext.clean(Ext.Array.map(t,function(e){return!0===e.get("send")})).length&&n.update(""),InvoiceEmailing.handleEmailAttachmentLimit(t)}},this,{delegate:"a.remove-attached-files"}),InvoiceEmailing.handleEmailAttachmentLimit(t)}},prettyFileSize:function(e){switch(length=e.toString().length,!0){case length<=3:return Ext.util.Format.number(e,"0.00B");case length<=6:return Ext.util.Format.number(e/1024,"0.00KB");case length<=9:return Ext.util.Format.number(e/1048576,"0.00MB")}},handleEmailAttachmentLimit:function(e){totalAttachmentSize=0,e.each(function(e){e.data.send&&(totalAttachmentSize+=e.data.size)}),includeFilesCheckbox=Ext.get("includeFiles").dom,includeFilesLabel=Ext.get("includeFilesLabel"),emailAttachmentLimitLabel=Ext.get("emailAttachmentLimit"),totalAttachmentSize>MAX_ATTACHMENT_SIZE?(includeFilesCheckbox.disabled=!0,includeFilesCheckbox.checked=!1,includeFilesLabel.setStyle("color","#aaa"),emailAttachmentLimitLabel.removeClass("x-hidden")):(includeFilesCheckbox.disabled=!1,includeFilesLabel.setStyle("color","#333"),emailAttachmentLimitLabel.addClass("x-hidden"))},handleBulkEmailAttachmentLimit:function(e){e?(Ext.fly("includeFiles").dom.checked=!1,e.each(function(e){sendInvoicesForm=Ext.fly("BulkSendInvoicesForm"),e.TotalSize>MAX_ATTACHMENT_SIZE&&(sendInvoicesForm.select(Ext.String.format("tr[id={0}]",e.ObjectId.toLowerCase())).addClass("caution"),Ext.fly("attachmentsTooLargeNotice").setStyle("display","inherit"))})):(invoiceIds=Ext.Array.map(InvoiceEmailing.GetInvoices(),function(e){return e.DocumentID}),Ext.Ajax.request({url:"/docs/docs/gethasfilestosend",method:"POST",params:{objectIds:invoiceIds},callback:function(e,t,n){var l=Ext.decode(n.responseText);l.associations&&l.associations.length>0&&(maxTotalSize=Math.max.apply(null,Ext.Array.map(l.associations,function(e){return e.TotalSize})),maxTotalSize<MAX_ATTACHMENT_SIZE&&(includeFiles=Ext.fly("includeFiles"),includeFiles.dom.checked=!0,includeFiles.removeAllListeners(),Ext.fly("attachmentsTooLargeNotice").setStyle("display","none")))}}))},handleBulkSendFile:function(e,t){Ext.Ajax.request({url:"/docs/docs/sendwithinvoice",method:"POST",params:{fileId:e.getId(),objectId:t,send:!1},success:function(){},failure:function(){}})},initButtons:function(){var e=Ext.get("AddOnlineInvoiceDetailsPrompt");InvoiceEmailing.removePopupButtons(),InvoiceEmailing.addPopupButtons();var t=Ext.get("popupSend");t&&t.on("click",InvoiceEmailing.openEmailFormWindowOKButtonHandler,!0),Ext.select("div.icons.delete-small").each(function(e){e.on("click",function(e,t,n){Ext.removeNode(Ext.get(t).parent("tr.EmailInvoice").dom),InvoiceEmailing.handleBulkEmailAttachmentLimit();var l=Ext.get("InvoicesToEmailText"),a=Ext.select("tr.EmailInvoice").elements.length;if(l.dom.innerHTML=a.toString()+InvoiceEmailing.noOfInvoicesToEmailDisplayText,a<=1){var i=Ext.select("div.icons.delete-small").first();i.addClass("none"),i.removeClass("delete-small"),i.removeAllListeners(),l.dom.innerHTML=a.toString()+InvoiceEmailing.noOfInvoicesToEmailDisplayText.replace(/invoices/gi,"invoice")}})}),null!==e&&this.initOnlineInvoicePrompt(e,Ext.get("MessageTextBody"))},initOnlineInvoicePrompt:function(e,t){e.on("click",function(){var e=t.getValue();!1===InvoiceEmailing.containsOnlineInvoicePlaceholder(e)&&(t.dom.value=e.trim()+"\n\n---\n\nView and pay your bill online: [Online Invoice Link]\n\nFrom your online bill you can print a PDF, export a CSV, or create a free login and view your outstanding bills.\n",t.scrollTo("top",t.dom.scrollHeight),XERO.analytics.Analytics.track("Invoice Email",{Action:"Insert link click"},"xx"))})},containsOnlineInvoicePlaceholder:function(e){return/\[Online Invoice Link\]/i.test(e)},onTemplateUpdate:function(e,t){var n=Ext.query(".onlineinvoicedetails").map(function(e){return new Ext.Element(e)}),l=this.containsOnlineInvoicePlaceholder(t.getValue()),a=n.some(function(e){return!1===e.hasClass("hidden")}),i=!l&&!a,o=l&&a;(i||o)&&this.toggleOnlineInvoicePrompt(n)},toggleOnlineInvoicePrompt:function(e){e.map(function(e){e.toggleClass("hidden")})},initPlaceholder:function(){var e,t,n;(e=this.emailWindow.getEl())&&(e=e.child(".placeholder"))&&(t=e.child(".toggle"),n=e.child(".info"),n.setVisibilityMode(Ext.Element.DISPLAY),t.on("click",function(){var e;n.toggle(),e=n.isVisible()?"Hide placeholder info":"Show placeholder info",t.update(e),this.emailWindow.center()},this))},addPopupButtons:function(){Ext.fly("popupSend")&&XERO.widget.Buttons.cache.add("popupSend",new XERO.widget.XButton("popupSend")),Ext.fly("popupCancel")&&XERO.widget.Buttons.cache.add("popupCancel",new XERO.widget.XButton("popupCancel"))},removePopupButtons:function(){Ext.fly("popupSend")&&XERO.widget.Buttons.cache.removeKey("popupSend"),Ext.fly("popupCancel")&&XERO.widget.Buttons.cache.removeKey("popupCancel")},GetInvoices:function(){for(var e,t,n=Ext.select("tr.EmailInvoice"),l=[],a=0,i=n.elements.length;a<i;a++){var o=n.elements[a].id,c="notavailable";Ext.get("MarkAsSent_"+o)&&(c=Ext.get("MarkAsSent_"+o).dom.checked);var d="notavailable";Ext.get("UseXeroNetwork_"+o)&&(d=Ext.get("UseXeroNetwork_"+o).dom.checked);var s=!0;Ext.get("Send_"+o)&&(s="hidden"==Ext.get("Send_"+o).dom.type?Ext.get("Send_"+o).dom.value:Ext.get("Send_"+o).dom.checked),e=Ext.get("ContactFirstName_"+o),t=Ext.get("ContactLastName_"+o),l.push({DocumentID:o,DocumentNumber:Ext.fly("DocumentNumber_"+o).dom.value,ContactName:Ext.fly("ContactName_"+o).dom.value,ContactFirstName:e?e.dom.value:"",ContactLastName:t?t.dom.value:"",ContactEmail:Ext.fly("ContactEmail_"+o).dom.value,OriginalContactEmail:Ext.fly("OriginalContactEmail_"+o).dom.value,ContactID:Ext.fly("ContactID_"+o).dom.value,UpdateContactEmail:Ext.fly("UpdateContactEmail_"+o).dom.value,ItemSummary:null!=Ext.fly("ItemSummary_"+o)?Ext.fly("ItemSummary_"+o).dom.value:null,MarkAsSent:c,UseXeroNetwork:d,PayRunNumber:null!=Ext.get("PayRunNumber_"+o)?Ext.get("PayRunNumber_"+o).dom.value:null,PayslipInvoiceID:null!=Ext.get("PayslipInvoiceID_"+o)?Ext.get("PayslipInvoiceID_"+o).dom.value:null,Send:s,Summary:null!=Ext.get("Summary_"+o)?Ext.get("Summary_"+o).dom.value:null,IsValid:null!=Ext.get("IsValid_"+o)&&Ext.get("IsValid_"+o).dom.value,IncludePDF:null!=Ext.get("includePDF")?Ext.get("includePDF").dom.checked:null,IncludeFiles:null!=Ext.get("includeFiles")?Ext.get("includeFiles").dom.checked:null})}return Ext.get("DocumentID")&&(o=Ext.get("DocumentID").dom.value,d="notavailable",Ext.get("UseXeroNetwork")&&(d=Ext.get("UseXeroNetwork").dom.checked),c="notavailable",Ext.get("MarkAsSent")&&(c=Ext.get("MarkAsSent").dom.checked),e=Ext.get("ContactFirstName"),t=Ext.get("ContactLastName"),l.push({DocumentID:o,DocumentNumber:Ext.fly("DocumentNumber").dom.value,ContactID:Ext.fly("ContactID").dom.value,ContactName:Ext.fly("ContactName").dom.value,ContactFirstName:e?e.dom.value:"",ContactLastName:t?t.dom.value:"",ContactEmail:Ext.fly("ContactEmail").dom.value,UpdateContactEmail:Ext.fly("UpdateContactEmail").dom.value,ItemSummary:null!=Ext.fly("ItemSummary_"+o)?Ext.fly("ItemSummary_"+o).dom.value:null,MarkAsSent:c,UseXeroNetwork:d,Send:!0,PayRunNumber:null!=Ext.get("PayRunNumber")?Ext.get("PayRunNumber").dom.value:null,PayslipInvoiceID:null!=Ext.get("PayslipInvoiceID")?Ext.get("PayslipInvoiceID").dom.value:null,Summary:null!=Ext.get("Summary")?Ext.get("Summary").dom.value:null,IncludePDF:null!=Ext.get("includePDF")?Ext.get("includePDF").dom.checked:null,IncludeFiles:null!=Ext.get("includeFiles")?Ext.get("includeFiles").dom.checked:null})),l},CanSend:!1,AlreadyCheckedUnpopulatedPlaceholders:!1,openEmailFormWindowOKButtonHandler:function(e){if(InvoiceEmailing.CanSend||InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders||void 0!=Ext.get("ImAPayRunEmail")){if(1==InvoiceEmailing.sendingEmail)return;Ext.get("popupSend")&&(InvoiceEmailing.sendingEmail=!0,XERO.widget.Buttons.disable());var t=InvoiceEmailing.GetInvoices(),n={Items:t,Subject:Ext.fly("MessageSubject").dom.value,Message:Ext.fly("MessageTextBody").dom.value,SendMeACopy:Ext.fly("SendMeACopy").dom.checked,DefaultSubject:null!=Ext.get("DefaultSubject")?Ext.get("DefaultSubject").dom.value:null,BatchPaymentInvoiceID:null!=Ext.get("BatchPaymentInvoiceID")?Ext.get("BatchPaymentInvoiceID").dom.value:null,SendToAll:null!=Ext.get("SendToAll")&&Ext.get("SendToAll").dom.checked,IncludePDF:null!=Ext.get("includePDF")?Ext.get("includePDF").dom.checked:null,IncludeFiles:null!=Ext.get("includeFiles")?Ext.get("includeFiles").dom.checked:null,EmailType:null!=Ext.get("EmailTemplate")&&Ext.get("EmailTemplate").dom.value?Ext.decode(Ext.get("EmailTemplate").dom.value).Type:""};null!=Ext.get("EmailTemplate")&&Ext.get("EmailTemplate").dom.value&&(n.EmailTemplate=Ext.decode(Ext.get("EmailTemplate").dom.value).EmailTemplateID);var l=Ext.get("MessageBrandingTheme");null!=l&&l.dom.value&&(n.TemplateID=Ext.fly("MessageBrandingTheme").dom.value);var a=null!=Ext.get("EmailTemplate")&&Ext.get("EmailTemplate").dom.value?Ext.decode(Ext.get("EmailTemplate").dom.value).Type:"";!0===e?InvoiceEmailing.checkAttachmentAndSend(a,n):InvoiceEmailing.validatePlaceholders(Object.toJSON(n))}else InvoiceEmailing.CanSend=!0,InvoiceEmailing.CheckForUnpopulatedPlaceholders()},submitEmail:function(e,t){var n=Ext.get("NotBatch"),l=function(e){InvoiceEmailing.openEmailFormWindowOKButtonHandler_callback.apply(InvoiceEmailing,[e,t])};!n||"EMAILTYPE/PAYMENTRECEIPT"!=e&&"EMAILTYPE/REMITTANCE"!=e?n?Ajax.SubmitSingleEmailDialog(Object.toJSON(t),l):Ajax.SubmitBulkEmailDialog(Object.toJSON(t),l):Ajax.SubmitSingleEmailPaymentAdviceDialog(Object.toJSON(t),e,l)},trackOnlineInvoiceEmailEvent:function(e){var t=[];try{t=Ext.clean(XERO.invoicing.paymentservices.data.paymentGatewayGroups.map(function(e){return e.activePaymentGateway?e.activePaymentGateway.paymentGatewayCode:null}))}catch(e){t=[]}"EMAILTYPE/INVOICE"==e.EmailType?e.Items.forEach(function(n){if(XERO.analytics.Analytics.track("Invoice Email",{EmailType:e.EmailType,funnel:"GettingPaid",invoiceId:n.DocumentID,Action:"Email send",OnlineInvoiceLinkIncluded:e.Message&&-1!==e.Message.indexOf("[Online Invoice Link]"),IncludePDF:e.IncludePDF||!1,SendMeACopy:e.SendMeACopy||!1,MarkAsSent:n.MarkAsSent||!1,PaymentServiceTypes:t},"xx"),window.ga){var l={hitType:"event",eventCategory:"Send and Approve Invoice",eventAction:"Send Email",eventLabel:"Send Email from classic Invoicing",dimension30:!0===n.UseXeroNetwork?"Email | Xero Network":!1===n.UseXeroNetwork?"Email | No Xero Network":"Email"};window.ga("send",l)}}):XERO.analytics.Analytics.track("Invoice Email",{EmailType:e.EmailType,Action:"Email send",OnlineInvoiceLinkIncluded:e.Message&&-1!==e.Message.indexOf("[Online Invoice Link]")},"xx")},shouldShowAttachmentWarning:function(e){return-1!==["EMAILTYPE/INVOICE","EMAILTYPE/REPEATINGINVOICE","EMAILTYPE/CREDITNOTE"].indexOf(e)},checkAttachmentAndSend:function(e,t){var n=Ext.get("includePDF");n&&n.dom.checked||InvoiceEmailing.containsOnlineInvoicePlaceholder(Ext.get("MessageTextBody").getValue())||!InvoiceEmailing.shouldShowAttachmentWarning(e)?InvoiceEmailing.submitEmail(e,t):XERO.Window.confirm("It looks like you haven't included an Online Invoice link or PDF attachment.<br/>Would you like to send this email anyway?","No "+InvoiceEmailing.sentDocumentType+" attached",null,"Send Anyway",function(n){n.destroy(),InvoiceEmailing.submitEmail(e,t)},null,function(e){XERO.widget.Buttons.enable(),e.destroy(),InvoiceEmailing.sendingEmail=!1},this)},validatePlaceholders:function(e){Ajax.CheckEmailTemplatePlaceholders(e,InvoiceEmailing.validatePlaceholders_callback)},validatePlaceholders_callback:function(e){InvoiceEmailing.sendingEmail=!1,""!=e.value.Result?XERO.Window.confirm("Some items in brackets [ ] are not recognized as email template placeholders: "+e.value.Result,"Placeholders not recognized","ConfirmButton","OK",function(e){InvoiceEmailing.openEmailFormWindowOKButtonHandler(!0),InvoiceEmailing.CanSend=!1,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!1,e.destroy()},null,function(e){new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(100),InvoiceEmailing.CanSend=!1,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!1,e.destroy(),new Ext.util.DelayedTask(function(){Ext.fly("popupSend").removeClass("spin"),Ext.fly("popupSend").removeClass("disabled")}).delay(100)},this,null,{beforeclose:function(){new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(100)}}):InvoiceEmailing.openEmailFormWindowOKButtonHandler(!0)},CheckForUnpopulatedPlaceholders:function(){var e=InvoiceEmailing.GetInvoices(),t={Items:e,Subject:Ext.fly("MessageSubject").dom.value,Message:Ext.fly("MessageTextBody").dom.value,SendMeACopy:Ext.fly("SendMeACopy").dom.checked,DefaultSubject:null!=Ext.get("DefaultSubject")?Ext.get("DefaultSubject").dom.value:null,BatchPaymentInvoiceID:null!=Ext.get("BatchPaymentInvoiceID")?Ext.get("BatchPaymentInvoiceID").dom.value:null,SendToAll:null!=Ext.get("SendToAll")&&Ext.get("SendToAll").dom.checked,IncludePDF:null!=Ext.get("includePDF")?Ext.get("includePDF").dom.checked:null,IncludeFiles:null!=Ext.get("includeFiles")?Ext.get("includeFiles").dom.checked:null};null!=Ext.get("EmailTemplate")&&Ext.get("EmailTemplate").dom.value&&(t.EmailTemplate=Ext.decode(Ext.get("EmailTemplate").dom.value).EmailTemplateID),Ajax.CheckUnpopulatedTemplatePlaceholders(Object.toJSON(t),InvoiceEmailing.CheckForUnpopulatedPlaceholders_callback)},CheckForUnpopulatedPlaceholders_callback:function(e){var t=Ext.get("placeholderErrors"),n=document.getElementById("errorMessages");if(null!=e.value.Data.getValue("unpopulatedPlaceholders")){var l=JSON.parse(e.value.Data.getValue("unpopulatedPlaceholders"));n.innerHTML="<em>&nbsp;</em>",l.each(function(e){n.innerHTML+="<p class='placeholderMessage'><a href=\""+e.ViewContactUrl+'" target="_blank">'+e.ContactName+"</a> is missing the placeholder: "+e.Placeholder+"</p>"}),n.innerHTML=n.innerHTML+"</div></div>",t.removeClass("x-hidden"),document.getElementById("popupSend").innerHTML="Send Anyway",InvoiceEmailing.CanSend=!0,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!1,XERO.util.enableButtons()}else t.addClass("x-hidden"),InvoiceEmailing.CanSend&&(InvoiceEmailing.CanSend=!1,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!0,InvoiceEmailing.openEmailFormWindowOKButtonHandler(!1))},toggleMessageState:function(e,t){t?(e.removeClassName("bg-red"),e.addClassName("bg-green")):(e.removeClassName("bg-green"),e.addClassName("bg-red"))},openEmailFormWindowOKButtonHandler_callback:function(e,t){var n=e.value;if(n){if(!n.IsValid)return Ext.get("popupSend")&&(Ext.get("popupSend").removeClass("disabled spin"),InvoiceEmailing.sendingEmail=!1),InvoiceEmailing.openEmailFormWindowGetHtmlCallBack(e),void new Ext.util.DelayedTask(function(){XERO.widget.Buttons.enable()}).delay(100);n.Data.getValue("noteAdded")&&XERO.widget.Histories.cache.length>0&&XERO.widget.Histories.refresh(null,!0),InvoiceEmailing.sendingEmail=!1,InvoiceEmailing.CanSend=!1,InvoiceEmailing.AlreadyCheckedUnpopulatedPlaceholders=!1,Windows.closeAll(),XERO.widget.Buttons.enable(),XERO.invoicing&&XERO.invoicing.creditlimits&&XERO.invoicing.creditlimits.CreditMonitoringManager.refreshCreditBlockActions(50);var l=n.Data.getValue("sentMessage"),a=n.Data.getValue("success");a=null==a||a;var i=a?"green":"red";$("sentMessageContents")?($("sentMessageContents").update(l),$("sentMessage").show(),InvoiceEmailing.toggleMessageState($("sentMessage"),a)):Ext.get("banner")?new XERO.widget.Banner({renderTo:"banner",data:{notificationType:i,messages:[l]}}):Ext.get("emailsent")?Ext.get("emailsent").show().child("div").update("<p>"+l+"</p>"):null!=Ext.get("notify01")?Ext.get("notify01").show().child("div").update("<p>"+l+"</p>"):(null!=Ext.get("marked")&&Ext.get("marked").show().child("div/p").update(l),newMsg=Ext.fly(Ext.query("div.bigger")[0]));var o=n.Data.getValue("invoiceMarkAsSent"),c=n.Data.getValue("repeatingInvoice");if(o)if(c)for(var d=0;d<o.count();d++)Ext.query("td.attachment[data-id="+o.keys[d]+"]")[0].previous().update("Approved & Sent"),Ext.query("input[name=selectedInvoices][value="+o.keys[d]+"]")[0].click();else for(var s=0,m=o.count();s<m;s++)if("True"==o.values[s]){Ext.select("div.status div.left span").show();var r=Ext.get("sent_"+o.keys[s]);r&&(r.removeClass("hide"),r.addClass("show"))}XERO.v2&&(mark=n.Data.getValue("markAsSent")),InvoiceEmailing.trackOnlineInvoiceEmailEvent(t)}},TickMarkAsSent:function(e,t,n){t.id;t.checked&&(n?$("MessageMarkAsSent"+n)&&($("MessageMarkAsSent"+n).checked=!0):$("MessageMarkAsSent")&&($("MessageMarkAsSent").checked=!0))},UntickUseXeroNetwork:function(e,t,n){t.id;t.checked||(n?$("MessageUseXeroNetwork"+n)&&($("MessageUseXeroNetwork"+n).checked=!1):$("MessageUseXeroNetwork")&&($("MessageUseXeroNetwork").checked=!1))},selectAllMarkAsSent:function(){this.selectAll("MarkAllAsSent","mark_as_sent")},selectSendToAll:function(e){e&&this.selectAll("SendToAll","send");for(var t=Ext.select("td.send input"),n=0,l=t.elements.length;n<l;n++){var a=t.elements[n].id.substring(5);this.enableSend(a)}t.elements.length>1&&this.updateRACount()},updateRACount:function(){var e=Ext.select("td.send input:checked").elements.length,t="s",n=" to send",l=Ext.fly("RACountTemplate").dom.innerHTML;0===e&&Ext.fly("SendMeACopy").dom.checked&&(e=Ext.select("td.send input").elements.length,n=" will be sent to you"),1===e&&(t="");var a=Ext.String.format(l,e,t,n);Ext.get("RACount").dom.innerHTML=a},selectAll:function(e,t){for(var n=Ext.get(e).dom.checked,l=Ext.select("td."+t+" input"),a=0,i=l.elements.length;a<i;a++)l.elements[a].disabled||(l.elements[a].checked=n)},selectUseXeroNetwork:function(){for(var e=Ext.get("AllUseXeroNetwork").dom.checked,t=Ext.select("td.use_xero_network input"),n=0,l=t.elements.length;n<l;n++)if(!t.elements[n].disabled){t.elements[n].checked=e;var a=t.elements[n].id.sub("UseXeroNetwork_",""),i=Ext.get("MarkAsSent_"+a);i&&(e?(i.dom.checked=e,i.dom.disabled=e):(i.dom.checked=!0,i.dom.disabled=e))}},checkMarkAsSent:function(e){Ext.get("MarkAsSent_"+e).dom.checked=!0,Ext.get("MarkAsSent_"+e).dom.disabled=!Ext.get("MarkAsSent_"+e).dom.disabled,this.checkAllUseXeroNetwork()},checkSend:function(e){this.updateRACount(),this.enableSend(e),this.checkSendToAll()},enableSend:function(e){var t=Ext.get("Send_"+e).dom.checked;Ext.get("ContactNameText_"+e).dom.style.color=t?"#333":"#999",Ext.get("ContactEmail_"+e).dom.disabled=!t,Ext.get("ContactEmail_"+e).dom.style.color=t?"#333":"#999",Ext.get("ContactEmail_"+e).dom.style.borderColor=t?"":"#CFD4DB",Ext.get("ContactEmail_"+e).dom.style.backgroundColor=t?"":"#F4F7FD","false"==Ext.get("IsValid_"+e).dom.value&&(Ext.get("ContactEmail_"+e).dom.style.borderColor=t?"#f00":"#CFD4DB")},checkAllUseXeroNetwork:function(){this.checkAll("AllUseXeroNetwork","use_xero_network")},checkMarkAllAsSent:function(){this.checkAll("MarkAllAsSent","mark_as_sent")},checkSendToAll:function(){this.checkAll("SendToAll","send")},checkAll:function(e,t){var n=Ext.get(e);if(null!=n){var l,a,i,o=Ext.select("td."+t+" input");if(n.dom.checked){for(l=0,a=o.elements.length;l<a;l++)if(i=o.elements[l],!i.disabled&&!i.checked){n.dom.checked=!1;break}}else for(l=0,a=o.elements.length;l<a&&(i=o.elements[l],i.disabled||i.checked);l++)l==a-1&&(n.dom.checked=!0)}}})}});